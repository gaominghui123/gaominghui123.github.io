<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Day08-MyBatis | Jason</title><meta name="keywords" content="MyBatis"><meta name="author" content="高明辉"><meta name="copyright" content="高明辉"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="学习前先来个小结 ★123456789101112131415161718192021222324252627282930313233343536idea常用技巧：    1 alt 拖动鼠标，能选中任意方框的代码，然后进行编辑    2 new xxx(); 然后alt+enter 能自动生成接受对象代码。    3 快速两次 shift 进入全局搜索，比如：搜索框输入typeAliases">
<meta property="og:type" content="article">
<meta property="og:title" content="Day08-MyBatis">
<meta property="og:url" content="http://example.com/2022/01/24/Day08-MyBatis/index.html">
<meta property="og:site_name" content="Jason">
<meta property="og:description" content="学习前先来个小结 ★123456789101112131415161718192021222324252627282930313233343536idea常用技巧：    1 alt 拖动鼠标，能选中任意方框的代码，然后进行编辑    2 new xxx(); 然后alt+enter 能自动生成接受对象代码。    3 快速两次 shift 进入全局搜索，比如：搜索框输入typeAliases">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day08-Mybatis/Mybatis.jpeg">
<meta property="article:published_time" content="2022-01-24T13:35:58.000Z">
<meta property="article:modified_time" content="2022-04-18T05:59:48.882Z">
<meta property="article:author" content="高明辉">
<meta property="article:tag" content="MyBatis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day08-Mybatis/Mybatis.jpeg"><link rel="shortcut icon" href="/img/%E7%BD%91%E7%AB%99%E5%9B%BE%E6%A0%87.png"><link rel="canonical" href="http://example.com/2022/01/24/Day08-MyBatis/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Day08-MyBatis',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-04-18 13:59:48'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Jason" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/%E5%A4%B4%E5%83%8F.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">147</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">186</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E5%85%B3%E4%BA%8E"><i class="fa-fw /about/"></i><span> 0</span></a></li><li><a class="site-page child" href="/myself"><i class="fa-fw /myself/"></i><span> 1</span></a></li><li><a class="site-page child" href="/butterfly%E4%B8%BB%E9%A2%98"><i class="fa-fw https://github.com/jerryc127/hexo-theme-butterfly/"></i><span> 2</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day08-Mybatis/Mybatis.jpeg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Jason</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E5%85%B3%E4%BA%8E"><i class="fa-fw /about/"></i><span> 0</span></a></li><li><a class="site-page child" href="/myself"><i class="fa-fw /myself/"></i><span> 1</span></a></li><li><a class="site-page child" href="/butterfly%E4%B8%BB%E9%A2%98"><i class="fa-fw https://github.com/jerryc127/hexo-theme-butterfly/"></i><span> 2</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Day08-MyBatis</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-24T13:35:58.000Z" title="发表于 2022-01-24 21:35:58">2022-01-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-04-18T05:59:48.882Z" title="更新于 2022-04-18 13:59:48">2022-04-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/mysql/">mysql</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Day08-MyBatis"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="学习前先来个小结-★"><a href="#学习前先来个小结-★" class="headerlink" title="学习前先来个小结 ★"></a>学习前先来个小结 ★</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">idea常用技巧：</span><br><span class="line">    <span class="number">1</span> alt 拖动鼠标，能选中任意方框的代码，然后进行编辑</span><br><span class="line">    <span class="number">2</span> <span class="keyword">new</span> xxx(); 然后alt+enter 能自动生成接受对象代码。</span><br><span class="line">    <span class="number">3</span> 快速两次 shift 进入全局搜索，比如：搜索框输入typeAliases </span><br><span class="line">    然后选择进入能查看 Mybatis框架关于映射文件中输入输出参数类型的别名集合。</span><br><span class="line">    比如别名 <span class="keyword">int</span> 对应 Integer.class，可以使用别名<span class="keyword">int</span>来如下代替：</span><br><span class="line">    parameterType=<span class="string">&quot;java.lang.Integer&quot;</span>可以代替为：</span><br><span class="line">    parameterType=<span class="string">&quot;int&quot;</span></span><br><span class="line">    <span class="number">4</span> 热键的配置：file--&gt;setting--&gt;editor--&gt;live Template --&gt; + </span><br><span class="line">    --&gt; TempGroup ---然后在这个Group下 + live Template </span><br><span class="line">    --&gt; 输入关键字，选用文件类型，写入要 添加的代码，点击 Apply添加即可。</span><br><span class="line">    如添加的关键字是 sqlConfig ,文件类型为xml，那么在xml文件输入sqlC...</span><br><span class="line">    就会提示要输入的内容！！！按Tap键或者回车 就可以方便将一堆代码导进来！</span><br><span class="line"></span><br><span class="line">工具类: 对一个功能进行封装</span><br><span class="line">框架: 针对某一种技术提供了全方位的解决方案；</span><br><span class="line">	一个软件的半成品,封装了无数通用操作.可以基于框架直接开发我们的程序</span><br><span class="line">    </span><br><span class="line">三层架构:</span><br><span class="line">	所谓的三层架构,就是将代码根据功能分包存放.</span><br><span class="line">	优点:方便管理；方便维护；方便识别和扩展</span><br><span class="line">	缺点:编写效率低；执行效率低；级联维护难度大即</span><br><span class="line">    	(当修改一个功能时,可能导致三层的代码都要修改)</span><br><span class="line">	<span class="number">1</span>：view/web/controller: 视图层,跟用户交互(获取用户信息,返回结果给用户)</span><br><span class="line">	<span class="number">2</span>：service: 业务层,用于处理业务逻辑</span><br><span class="line">	<span class="number">3</span>：dao/mapper: 持久层,存放jdbc代码完成对数据库的增删改查</span><br><span class="line">Mybatis概述:</span><br><span class="line">    Mybatis是持久层框架,对JDBC进行的封装</span><br><span class="line">	优点:</span><br><span class="line">		简单易学；灵活使用；解除SQL与程序代码的耦合</span><br><span class="line">	缺点:</span><br><span class="line">		<span class="number">1.</span> 编写SQL语句时工作量很大，尤其是字段多、关联表多时，更是如此</span><br><span class="line">		<span class="number">2.</span> SQL语句依赖于数据库，导致数据库移植性差，不能更换数据库 </span><br><span class="line">		<span class="number">3.</span> 框架还是比较简陋，功能尚有缺失，二级缓存机制不佳</span><br><span class="line">对象关系映射: ORM</span><br><span class="line">      	java对象与表中一台记录的对应关系</span><br></pre></td></tr></table></figure>

<h1 id="第一章-框架"><a href="#第一章-框架" class="headerlink" title="第一章 框架"></a>第一章 框架</h1><h2 id="1-1-框架概述"><a href="#1-1-框架概述" class="headerlink" title="1.1 框架概述"></a>1.1 框架概述</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">工具类: 工具类就是对某一个功能进行的封装.</span><br><span class="line">框架: 工具类集.一个标准的框架,针对一类问题提供了全方位的解决方案.</span><br></pre></td></tr></table></figure>

<p>1 框架(Framework)是整个或者部分系统的可重用设计，是JavaEE<strong>底层技术的封装</strong></p>
<p>2 程序开发中框架往往是对常见功能的封装（对工具类再次封装），可以把框架理解为软件的设计规范或者标准化的组件；</p>
<p>3 框架是可以被开发者定制的应用骨架；框架是一个半成品，软件是成品。我们在它的基础上开发出成品。</p>
<p><strong>框架解决的问题</strong></p>
<hr>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">1.</span> <span class="string">解决了技术通用的问题</span></span><br><span class="line"><span class="meta">2.</span> <span class="string">提升了开发效率</span></span><br><span class="line"><span class="meta">3.</span> <span class="string">提升了系统稳定性</span></span><br></pre></td></tr></table></figure>



<h2 id="1-2-项目的三层架构"><a href="#1-2-项目的三层架构" class="headerlink" title="1.2 项目的三层架构"></a>1.2 项目的三层架构</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">所谓的三层架构,就是将代码根据功能分包存放.</span><br><span class="line"><span class="number">1</span>:view/web/controller: 视图层,跟用户交互(获取用户信息,返回结果给用户)</span><br><span class="line"><span class="number">2</span>:service: 业务层,用于处理业务逻辑</span><br><span class="line"><span class="number">3</span>:dao/mapper: 持久层,存放jdbc代码完成对数据库的增删改查</span><br></pre></td></tr></table></figure>

<p><strong>三层架构的作用</strong></p>
<hr>
<p>一个中大型软件开发需要有明确分层</p>
<table>
<thead>
<tr>
<th><strong>层</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>1 表示层 View</td>
<td>面向客户，处理客户的输入和输出。前端代码</td>
</tr>
<tr>
<td>2 业务层 Service</td>
<td>处理业务逻辑的代码，如：登陆、注册、支付</td>
</tr>
<tr>
<td>3 数据访问层 DAO (Data Access Object)</td>
<td>面向数据库，提供增删改查的功能，也叫持久层</td>
</tr>
</tbody></table>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day07-Mybatis/1566607560103.png" alt="1566607560103"></p>
<p><strong>分层的方式</strong></p>
<hr>
<table>
<thead>
<tr>
<th><strong>分层包</strong></th>
<th><strong>功能描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td>com.itheima.view <br/>com.itheima.web<br/>com.itheima.controller</td>
<td>表示层</td>
</tr>
<tr>
<td>com.itheima.service</td>
<td>业务层</td>
</tr>
<tr>
<td>com.itheima.dao<br/>com.itheima.mapper</td>
<td>数据访问层</td>
</tr>
</tbody></table>
<p><strong>三层架构的优缺点</strong></p>
<hr>
<ol>
<li><p>优点</p>
<ol>
<li>降低了代码的耦合度，降低类与类之间关系。有利于团队的开发</li>
<li>项目的可扩展性更好</li>
<li>可维护性更好</li>
<li>可重用性更好，同一个方法可以由多个类去调用</li>
</ol>
</li>
<li><p>缺点</p>
<ol>
<li>执行效率更低</li>
<li>开发工作量更大</li>
<li>会导致级联的修改，如果修改一个功能，导致三层都要进行修改</li>
</ol>
</li>
</ol>
<h2 id="1-3-MyBatis框架介绍"><a href="#1-3-MyBatis框架介绍" class="headerlink" title="1.3 MyBatis框架介绍"></a>1.3 MyBatis框架介绍</h2><p><strong>MyBatis历史</strong></p>
<hr>
<p>MyBatis官网：<a target="_blank" rel="noopener" href="http://www.mybatis.org/mybatis-3/%EF%BC%8C">http://www.mybatis.org/mybatis-3/，</a></p>
<p>框架包下载地址：<a target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3/releases">https://github.com/mybatis/mybatis-3/releases</a></p>
<p>MyBatis是Apache软件基金会下的一个开源项目，前身是iBatis框架。</p>
<p>2010年这个项目由apache 软件基金会迁移到google code下，改名为MyBatis</p>
<p>2013年11月又迁移到了GitHub</p>
<p>MyBatis 是一款优秀的持久层框架，它支持定制化 SQL、存储过程以及高级映射</p>
<p><strong>优点：</strong></p>
<ol>
<li><strong>简单易学</strong>：Mybatis本身就很小且简单，没有任何第三方依赖，最简单安装只要两个jar文件+配置几个SQL映射文件即可 </li>
<li><strong>使用灵活：</strong>Mybatis不会对应用程序或者数据库的现有设计强加任何影响。SQL语句写在XML里，便于统一管理和优化。（和Hibernate相比）</li>
<li><strong>解除SQL与程序代码的耦合</strong>：通过提供DAO层，将业务逻辑和数据访问逻辑分离，使系统的设计更清晰，更易维护，更易进行单元测试。SQL语句和代码的分离，提高了可维护性</li>
</ol>
<p><strong>缺点：</strong></p>
<ol>
<li>编写SQL语句时工作量很大，尤其是字段多、关联表多时，更是如此</li>
<li>SQL语句依赖于数据库，导致数据库移植性差，不能更换数据库</li>
<li>框架还是比较简陋，功能尚有缺失，二级缓存机制不佳</li>
</ol>
<p><strong>MyBatis的ORM方式</strong></p>
<hr>
<p><strong>ORM</strong>：Object Relational Mapping 对象关系映射</p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day07-Mybatis/1566614801843.png" alt="1566614801843"></p>
<p><strong>MyBatis的两种映射方式：</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">1.</span> <span class="string">通过XML映射</span></span><br><span class="line"><span class="meta">2.</span> <span class="string">通过注解</span></span><br></pre></td></tr></table></figure>

<h1 id="第二章-MyBatis入门案例"><a href="#第二章-MyBatis入门案例" class="headerlink" title="第二章 MyBatis入门案例"></a>第二章 MyBatis入门案例</h1><p>有<strong>传统方式</strong>跟<strong>动态代理</strong>两种方式，这里先使用<strong>动态代理方式进行入门讲解</strong>，将Mybatis 框架跑起来，进行简单的查询！</p>
<h2 id="动态代理方式演示"><a href="#动态代理方式演示" class="headerlink" title="动态代理方式演示"></a>动态代理方式演示</h2><h2 id="2-1-环境搭建"><a href="#2-1-环境搭建" class="headerlink" title="2.1 环境搭建"></a>2.1 环境搭建</h2><h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><hr>
<p>利用Mybatis框架，从MySQL中查询所有的用户</p>
<h3 id="准备数据"><a href="#准备数据" class="headerlink" title="准备数据"></a>准备数据</h3><hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span> (</span><br><span class="line">  id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">  username <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">  birthday <span class="type">date</span>,</span><br><span class="line">  sex <span class="type">char</span>(<span class="number">1</span>) <span class="keyword">default</span> <span class="string">&#x27;男&#x27;</span>,</span><br><span class="line">  address <span class="type">varchar</span>(<span class="number">50</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span> (<span class="keyword">null</span>, <span class="string">&#x27;孙悟空&#x27;</span>,<span class="string">&#x27;1980-10-24&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;花果山水帘洞&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span> (<span class="keyword">null</span>, <span class="string">&#x27;白骨精&#x27;</span>,<span class="string">&#x27;1992-11-12&#x27;</span>,<span class="string">&#x27;女&#x27;</span>,<span class="string">&#x27;白虎岭白骨洞&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span> (<span class="keyword">null</span>, <span class="string">&#x27;猪八戒&#x27;</span>,<span class="string">&#x27;1983-05-20&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;福临山云栈洞&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span> (<span class="keyword">null</span>, <span class="string">&#x27;玉面狐&#x27;</span>,<span class="string">&#x27;1995-03-22&#x27;</span>,<span class="string">&#x27;女&#x27;</span>,<span class="string">&#x27;积雷山摩云洞&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span> (<span class="keyword">null</span>, <span class="string">&#x27;玉兔精&#x27;</span>,<span class="string">&#x27;2010-02-12&#x27;</span>,<span class="string">&#x27;女&#x27;</span>,<span class="string">&#x27;天竺国皇宫&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span> (<span class="keyword">null</span>, <span class="string">&#x27;豹子精&#x27;</span>,<span class="string">&#x27;2008-05-03&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;隐雾山折岳洞&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>

<h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><hr>
<ol>
<li><p>创建模块</p>
</li>
<li><p>创建lib目录，复制以下jar包</p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day07-Mybatis/1566617018806.png" alt="1566617018806"></p>
</li>
<li><p>创建核心配置文件</p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day07-Mybatis/1566617148389.png" alt="1566617148389"></p>
</li>
<li><p>创建日志记录的配置文件</p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day07-Mybatis/1566617171831.png" alt="1566617171831"></p>
<p>用来设置日志记录的格式，因为Mybaits需要使用到log4j来记录它的日志</p>
<p>日志文件用来记录程序运行过程中的各种事件。</p>
<p>可以更改<strong>日志输出位置</strong>：log4j.appender.logfile.File=<strong>d:/mybatislog/mybatis.log</strong></p>
</li>
<li><p>编写用户dao接口和dao映射文件</p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day07-Mybatis/1566617251916.png" alt="1566617251916"></p>
</li>
<li><p>编写用户的实体类文件</p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day07-Mybatis/1566617307023.png" alt="1566617307023"></p>
</li>
<li><p>编写测试代码</p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day07-Mybatis/1566617335225.png" alt="1566617335225"></p>
</li>
</ol>
<p><strong>项目整体结构</strong></p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day07-Mybatis/1566617376283.png" alt="1566617376283"></p>
<h3 id="分包开发思想"><a href="#分包开发思想" class="headerlink" title="分包开发思想"></a>分包开发思想</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">以用户登录为例,我们在用户登录时,将所有的业务都写在了一个方法中.</span><br><span class="line">从长远来看,我们的代码存在问题,扩展维护不方便.</span><br><span class="line">解决方案:</span><br><span class="line">	将我们的程序代码分包管理,不同的包中存放不同业务的java代码</span><br><span class="line">    view|web: 存放和用户相关的程序代码</span><br><span class="line">    dao: 存放和数据库交互的程序代码</span><br><span class="line">    pojo: 存放实体对象</span><br><span class="line">    utils: 存放工具类代码</span><br><span class="line">    resources: 存放配置文件</span><br><span class="line">    lib: 存放jar包</span><br></pre></td></tr></table></figure>

<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day07-Mybatis/image-20200801120100828.png" alt="image-20200801120100828"></p>
<h3 id="数据库表对应实体"><a href="#数据库表对应实体" class="headerlink" title="数据库表对应实体"></a>数据库表对应实体</h3><p><strong>基本类型使用包装类</strong></p>
<hr>
<p>实体类中基本数据类型，都使用它的<strong>包装类</strong>。这样与表中的数据更加匹配</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> id;  <span class="comment">//基本数据类型，默认的值是0</span></span><br><span class="line">Integer id; <span class="comment">//包装类，默认是null, 0 表示有值是0</span></span><br></pre></td></tr></table></figure>

<p><strong>代码</strong></p>
<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.entity;</span><br><span class="line"><span class="keyword">import</span> java.sql.Date;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 用户实体类对象 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(Integer id, String username, Date birthday, String sex, String address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">        <span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getBirthday</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthday</span><span class="params">(Date birthday)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSex</span><span class="params">(String sex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, username=&#x27;&quot;</span> + username + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, birthday=&quot;</span> + birthday +</span><br><span class="line">                <span class="string">&quot;, sex=&#x27;&quot;</span> + sex + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, address=&#x27;&quot;</span> + address + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-2-配置文件和接口"><a href="#2-2-配置文件和接口" class="headerlink" title="2.2 配置文件和接口"></a>2.2 配置文件和接口</h2><h3 id="2-2-1-核心配置文件sqlMapConfig-xml"><a href="#2-2-1-核心配置文件sqlMapConfig-xml" class="headerlink" title="2.2.1 核心配置文件sqlMapConfig.xml"></a>2.2.1 核心配置文件sqlMapConfig.xml</h3><hr>
<p>可以在Mybatis官网入门中找到配置模板，一下是中文翻译网站！</p>
<p><a target="_blank" rel="noopener" href="http://www.mybatis.org/mybatis-3/zh/getting-started.html">http://www.mybatis.org/mybatis-3/zh/getting-started.html</a></p>
<p><strong>如下代码</strong>，根标签下有<strong>environments</strong>以及<strong>mappers</strong>两个标签，其下又有environment以及mapper标签，表示可以有多种<strong>连接数据库的环境</strong>，以及多种<strong>sql映射文件地址</strong>。这里使用了default默认环境，以及只有一个映射文件地址com/itheima/dao/UserMapper.xml。</p>
<hr>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- <span class="doctag">TODO:</span>Mybatis核心配置文件:</span></span><br><span class="line"><span class="comment">            environments: 环境-连接数据库的环境</span></span><br><span class="line"><span class="comment">            mappers: 映射,sql语句 映射文件在哪个位置</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;default&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--环境变量--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;default&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--事务管理器：由JDBC管理事务 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--数据源配置信息：POOLED 使用连接池(使用Mybatis自带的连接池) --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://192.168.253.129:3306/db8?characterEncoding=utf8&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhangjie&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 加载其他的映射文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置sql映射文件所在位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/itheima/dao/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-2-UserMapper接口"><a href="#2-2-2-UserMapper接口" class="headerlink" title="2.2.2 UserMapper接口"></a>2.2.2 UserMapper接口</h3><p>这个接口其实就是<strong>数据访问层：DAO层</strong></p>
<p>接口里面有<strong>抽象方法</strong>，作用为<strong>查询所有用户的方法</strong></p>
<p><strong>代码</strong></p>
<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.dao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.User;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 数据访问层方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     查询所有的用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAllUsers</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-3-用户映射文件"><a href="#2-2-3-用户映射文件" class="headerlink" title="2.2.3 用户映射文件"></a>2.2.3 用户映射文件</h3><p>在<strong>接口目录</strong>中创建UserMapper.xml映射文件（一个接口文件，对应一个xml映射文件）</p>
<p>映射文件的模板可以在<a target="_blank" rel="noopener" href="http://www.mybatis.org/mybatis-3/zh/getting-started.html">http://www.mybatis.org/mybatis-3/zh/getting-started.html</a> 找到</p>
<p><strong>代码</strong></p>
<p>主要看 1：namespace，2：id，3：resultType，4：select标签的文本： select * from user；他们分别为 接口全名，接口中抽象方法名，查询返回值，以及sql语句。</p>
<hr>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  <span class="doctag">TODO:</span>Sql映射文件: 在此配置文件中,编写接口中方法对应的sql语句 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- namespace:名称空间</span></span><br><span class="line"><span class="comment">        作用: 指定对应的接口(当前这个sql映射文件为哪个接口提供)</span></span><br><span class="line"><span class="comment">        值: 接口的全限定名</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- select: 用于查询的标签</span></span><br><span class="line"><span class="comment">         id: id为对应方法的名称</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注意，这里用.而不是/,而且User后没有后缀名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.entity.User&quot;</span>&gt;</span></span><br><span class="line">        select * from user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-4-日志文件-log4j-properties"><a href="#2-2-4-日志文件-log4j-properties" class="headerlink" title="2.2.4 日志文件 log4j.properties"></a>2.2.4 日志文件 log4j.properties</h3><p>记录MyBatis运行过程中的各种事件</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#############</span></span><br><span class="line"><span class="comment"># 输出到控制台</span></span><br><span class="line"><span class="comment">#############</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># log4j.rootLogger日志输出类别和级别：只输出不低于该级别的日志信息DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL</span></span><br><span class="line"><span class="comment"># WARN：日志级别     CONSOLE：输出位置自己定义的一个名字       logfile：输出位置自己定义的一个名字</span></span><br><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">DEBUG,CONSOLE,logfile</span></span><br><span class="line"><span class="comment"># 配置CONSOLE输出到控制台</span></span><br><span class="line"><span class="meta">log4j.appender.CONSOLE</span>=<span class="string">org.apache.log4j.ConsoleAppender </span></span><br><span class="line"><span class="comment"># 配置CONSOLE设置为自定义布局模式</span></span><br><span class="line"><span class="meta">log4j.appender.CONSOLE.layout</span>=<span class="string">org.apache.log4j.PatternLayout </span></span><br><span class="line"><span class="comment"># 配置CONSOLE日志的输出格式  [frame] 2019-08-22 22:52:12,000  %r耗费毫秒数 %p日志的优先级 %t线程名 %C所属类名通常为全类名 %L代码中的行号 %x线程相关联的NDC %m日志 %n换行</span></span><br><span class="line"><span class="meta">log4j.appender.CONSOLE.layout.ConversionPattern</span>=<span class="string">[frame] %d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; - %-4r %-5p [%t] %C:%L %x - %m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"><span class="comment"># 输出到日志文件中</span></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置logfile输出到文件中 文件大小到达指定尺寸的时候产生新的日志文件</span></span><br><span class="line"><span class="meta">log4j.appender.logfile</span>=<span class="string">org.apache.log4j.RollingFileAppender</span></span><br><span class="line"><span class="comment"># 保存编码格式</span></span><br><span class="line"><span class="meta">log4j.appender.logfile.Encoding</span>=<span class="string">UTF-8</span></span><br><span class="line"><span class="comment"># 输出文件位置此为项目根目录下的logs文件夹中 <span class="doctag">TODO:</span>修改日志存放位置</span></span><br><span class="line"><span class="meta">log4j.appender.logfile.File</span>=<span class="string">d:/mybatislog/mybatis.log</span></span><br><span class="line"><span class="comment"># 后缀可以是KB,MB,GB达到该大小后创建新的日志文件</span></span><br><span class="line"><span class="meta">log4j.appender.logfile.MaxFileSize</span>=<span class="string">10MB</span></span><br><span class="line"><span class="comment"># 设置滚定文件的最大值3 指可以产生root.log.1、root.log.2、root.log.3和root.log四个日志文件</span></span><br><span class="line"><span class="meta">log4j.appender.logfile.MaxBackupIndex</span>=<span class="string">3  </span></span><br><span class="line"><span class="comment"># 配置logfile为自定义布局模式</span></span><br><span class="line"><span class="meta">log4j.appender.logfile.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.logfile.layout.ConversionPattern</span>=<span class="string">[frame] %d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; - %-4r %-5p [%t] %C:%L %x - %m%n</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2-3-测试类"><a href="#2-3-测试类" class="headerlink" title="2.3 测试类"></a>2.3 测试类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.test;</span><br><span class="line"><span class="keyword">import</span> com.itheima.dao.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.ResourceBundle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestUserMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//<span class="doctag">TODO:</span>0.读取核心配置文件,获取流信息</span></span><br><span class="line">        InputStream is = Resources.getResourceAsStream(<span class="string">&quot;mybatisConfig.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//<span class="doctag">TODO:</span>1.创建SqlSessionFactoryBuilder对象</span></span><br><span class="line">        <span class="comment">//作用:解析Mybatis核心配置文件,获取配置文件中的所有配置信息,</span></span><br><span class="line">        <span class="comment">//     封装到java对象中(Configuration)</span></span><br><span class="line">        SqlSessionFactoryBuilder sqlSessionFactoryBuilder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">        <span class="comment">//<span class="doctag">TODO:</span>2.根据配置信息创建SqlSessionFactory对象</span></span><br><span class="line">        <span class="comment">//作用:此工厂用于生产SqlSession对象,一个SqlSession就是与mysql的一次会话(conn)</span></span><br><span class="line">        SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(is);</span><br><span class="line">        <span class="comment">//<span class="doctag">TODO:</span>3.创建SqlSession对象(通过工厂创建SqlSession)</span></span><br><span class="line">        <span class="comment">//作用:建立与mysql的连接关系,有了sqlSession就能够访问mysql.(相当于我们之前使用的conn)</span></span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//<span class="doctag">TODO:</span>4.动态生成接口的实现类(代理类)</span></span><br><span class="line">        <span class="comment">//作用:sqlSession使用动态代理生成了接口的实现类,在接口的实现类中完成了与mysql的通讯</span></span><br><span class="line">        UserMapper mapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        <span class="comment">//<span class="doctag">TODO:</span>5.调用代理类的方法完成查询</span></span><br><span class="line">        List&lt;User&gt; allUsers = mapper.findAllUsers();</span><br><span class="line">        <span class="keyword">for</span> (User allUser : allUsers) &#123;</span><br><span class="line">            System.out.println(allUser);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Mybatis中的核心api介绍"><a href="#Mybatis中的核心api介绍" class="headerlink" title="Mybatis中的核心api介绍"></a>Mybatis中的核心api介绍</h2><h3 id="SqlSessionFactoryBuilder"><a href="#SqlSessionFactoryBuilder" class="headerlink" title="SqlSessionFactoryBuilder:"></a>SqlSessionFactoryBuilder:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">作用:</span><br><span class="line">	解析核心配置文件: MybatisConfig.xml</span><br><span class="line">	得到连接数据库的基本信息</span><br><span class="line">	得到所有的sql语句及对应的返回值信息</span><br><span class="line">	然后将得到的信息封装到Configuration对象当中！！！</span><br><span class="line">        这个对象接下来会被传给SqlSessionFactory对象，</span><br><span class="line">        再接着被传递给SqlSession。</span><br><span class="line">方法: </span><br><span class="line">	build(is); 用来创建SqlSessionFactory对象 其中is: 核心配置文件的流信息</span><br></pre></td></tr></table></figure>

<h3 id="SqlSessionFactory"><a href="#SqlSessionFactory" class="headerlink" title="SqlSessionFactory:"></a>SqlSessionFactory:</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">作用</span>: <span class="string">创建SqlSession对象</span></span><br><span class="line"><span class="attr">特点：是一个线程安全的对象，多个线程访问同一个已经创建好的sqlSessionfactory（单例对象）</span></span><br><span class="line">	<span class="meta">方法</span>: <span class="string">openSession();  用来创建SqlSession对象</span></span><br></pre></td></tr></table></figure>

<h3 id="SqlSession接口"><a href="#SqlSession接口" class="headerlink" title="SqlSession接口:"></a>SqlSession接口:</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">制定规范</span><br><span class="line">    作用：内部封装了jdbc操作，进行数据库的CRUD操作</span><br><span class="line">    特点：不是一个线程安全的对象，请求一次，创建一个新的sqlSession（多例对象）</span><br><span class="line">方法:</span><br><span class="line">数据库操作:</span><br><span class="line">    selectList	：查询列表</span><br><span class="line">    selectOne：查询单个对象</span><br><span class="line">    <span class="keyword">insert</span>	：保存</span><br><span class="line">    update	：更新</span><br><span class="line">    <span class="keyword">delete</span>	：删除</span><br><span class="line">生成代理类对象:</span><br><span class="line">	getMapper : 生成dao接口的代理对象</span><br><span class="line">资源和事务操作:</span><br><span class="line">	<span class="keyword">commit</span> : 提交事务</span><br><span class="line">	colse : 释放资源</span><br><span class="line">	<span class="keyword">rollback</span>: 回滚</span><br><span class="line">            ...</span><br><span class="line">注意：</span><br><span class="line">sqlSession只是一个接口，真正调用的是他的实现类DefaultSqlSession对象</span><br><span class="line">的方法去操作数据库。</span><br></pre></td></tr></table></figure>

<p><strong>测试类步骤总结</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">1.</span> <span class="string">通过框架提供的Resources类，加载sqlMapConfig.xml，</span></span><br><span class="line">	<span class="meta">得到文件输入流InputStream对象</span> <span class="string">。</span></span><br><span class="line"><span class="meta">2.</span> <span class="string">实例化会话工厂创建类SqlSessionFactoryBuilder</span></span><br><span class="line"><span class="meta">3.</span> <span class="string">通过上面的SqlSessionFactoryBuilder对象，读取核心配置文件的输入流，</span></span><br><span class="line">   <span class="attr">将读取到的内容封装到Configuration对象中，同时得到会话工厂SqlSessionFactory类</span></span><br><span class="line"><span class="meta">4.</span> <span class="string">使用SqlSessionFactory对象，创建SqlSession对象</span></span><br><span class="line">   <span class="meta">1.</span> <span class="string">它相当于JDBC中的Connection对象，提供了操作数据库的CRUD方法</span></span><br><span class="line">   <span class="meta">2.</span> <span class="string">它提供了一个getMapper()方法，获取接口的实现对象。</span></span><br><span class="line"><span class="meta">5.</span> <span class="string">获取接口的对象UserMapper，得到接口的代理对象</span></span><br><span class="line"><span class="meta">6.</span> <span class="string">执行数据库的查询操作，输出用户信息</span></span><br><span class="line"><span class="meta">7.</span> <span class="string">关闭会话，释放资源  </span></span><br></pre></td></tr></table></figure>

<p>其中第四步：以动态代理方式来操作数据库，后面还会讲一种传统方式！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TODO:<span class="number">4.</span>动态生成接口的实现类(代理类)，牛逼！</span><br><span class="line">UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br></pre></td></tr></table></figure>



<h2 id="2-4-入门案例总结分析"><a href="#2-4-入门案例总结分析" class="headerlink" title="2.4 入门案例总结分析"></a>2.4 入门案例总结分析</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">日志配置文件</span>: <span class="string">log4j.properties(直接拷贝使用即可)</span></span><br><span class="line">	<span class="attr">TODO</span>:<span class="string">修改日志文件输出路径</span></span><br><span class="line"><span class="meta">Mybatis配置文件</span>:<span class="string"></span></span><br><span class="line">	<span class="meta">第一类</span>: <span class="string">核心配置文件(名称自定义)  mybatis-config.xml</span></span><br><span class="line">		<span class="attr">1.环境标签：连接数据库的相关环境配置，一般使用default方式就好。</span></span><br><span class="line">		<span class="meta">&lt;environment</span> <span class="string">id=&quot;default&quot;&gt;配置连接数据库的相关信息&lt;/environment&gt;</span></span><br><span class="line">		<span class="attr">2.sql映射文件所在位置标签：</span></span><br><span class="line">		<span class="meta">&lt;mapper</span> <span class="string">resource=&quot;com/itheima/dao/UserMapper.xml&quot;/&gt;</span></span><br><span class="line">	<span class="meta">第二类</span>: <span class="string">sql映射文件</span></span><br><span class="line">		<span class="meta">&lt;mapper</span> <span class="string">namespace=&quot;com.itheima.dao.UserMapper&quot;&gt;</span></span><br><span class="line">           <span class="meta">&lt;!--</span> <span class="string">select: 用于查询的标签 id: id为对应方法的名称  --&gt;</span></span><br><span class="line">           <span class="meta">&lt;select</span> <span class="string">id=&quot;findAll&quot; resultType=&quot;com.itheima.pojo.User&quot;&gt;</span></span><br><span class="line">                <span class="attr">select</span> <span class="string">* from user</span></span><br><span class="line">           <span class="attr">&lt;/select&gt;</span></span><br><span class="line">        <span class="attr">&lt;/mapper&gt;</span></span><br><span class="line"><span class="meta">java类</span>:<span class="string"></span></span><br><span class="line">		<span class="meta">接口</span>: <span class="string">用于描述业务的接口</span></span><br><span class="line">			<span class="attr">UserMapper.java</span></span><br><span class="line">			<span class="meta">List&lt;User&gt;</span> <span class="string">findAll();</span></span><br><span class="line">		<span class="meta">实体类</span>: <span class="string">用于封装查询结果</span></span><br><span class="line">			<span class="attr">User.java</span></span><br><span class="line">			<span class="attr">private</span> <span class="string">int id;</span></span><br><span class="line">				<span class="attr">....</span></span><br><span class="line"><span class="attr">---------------执行流程-----------------</span></span><br><span class="line"><span class="meta">//TODO</span>:<span class="string">0.读取核心配置文件,获取流信息</span></span><br><span class="line"><span class="meta">//TODO</span>:<span class="string">1.创建SqlSessionFactoryBuilder对象</span></span><br><span class="line"><span class="meta">//作用</span>:<span class="string">解析Mybatis核心配置文件,获取配置文件中的所有配置信息,</span></span><br><span class="line"><span class="meta">//</span> <span class="string">封装到java对象中(Configuration)</span></span><br><span class="line"><span class="meta">//TODO</span>:<span class="string">2.根据配置信息创建SqlSessionFactory对象</span></span><br><span class="line"><span class="meta">//作用</span>:<span class="string">此工厂用于生产SqlSession对象,一个SqlSession就是与mysql的一次会话(conn)</span></span><br><span class="line"><span class="meta">//TODO</span>:<span class="string">3.创建SqlSession对象(通过工厂创建SqlSession)</span></span><br><span class="line"><span class="meta">//作用</span>:<span class="string">建立与mysql的连接关系,有了sqlSession就能够访问mysql.</span></span><br><span class="line">	<span class="attr">(相当于我们之前使用的conn)</span></span><br><span class="line"><span class="meta">//TODO</span>:<span class="string">4.动态生成接口的实现类(代理类)</span></span><br><span class="line"><span class="meta">//作用</span>:<span class="string">sqlSession使用动态代理生成了接口的实现类,在接口的实现类中完成了与mysql的通讯</span></span><br><span class="line"><span class="meta">//TODO</span>:<span class="string">5.调用代理类的方法完成查询</span></span><br><span class="line"><span class="meta">List&lt;User&gt;</span> <span class="string">list = userMapper.findAll();</span></span><br><span class="line"></span><br><span class="line"><span class="attr">//释放资源（读取完xml文件后就可以关闭了哈）</span></span><br><span class="line"><span class="attr">is.close();</span></span><br></pre></td></tr></table></figure>

<h2 id="传统方式演示Mybatis"><a href="#传统方式演示Mybatis" class="headerlink" title="传统方式演示Mybatis"></a>传统方式演示Mybatis</h2><h3 id="传统方式跟动态代理方式的不同点："><a href="#传统方式跟动态代理方式的不同点：" class="headerlink" title="传统方式跟动态代理方式的不同点："></a>传统方式跟动态代理方式的不同点：</h3><p>1：动态代理方式的xml映射文件必须与逻辑接口同名，然后xml映射文件要么跟接口放在同一个包下，要么放在resource目录下。而传统方法要么放在src下，要么放在resource目录下（也就是包的根目录下）。</p>
<p>2：动态代理方式的映射文件中的namespace必须与自定义的逻辑接口名一样：</p>
<mapper namespace="com.itheima.dao.UserMapper">

<p>而传统方式则的namespace随便写：<mapper namespace="hhh">，但是不要与同包下的其他传统方式的映射文件的namespace重名哦。</p>
<p>3：动态代理方式的映射文件中的操作标签中的 id 必须与自定义的代理接口里面的抽象方法一样。而传统方式随便写，最好能见名知其义吧！利用namespace+id来定位映射文件里面的sql语句就行！</p>
<p>其实动态代理方式也是通过namespace.id能定位到sql语句哈。</p>
<p>4：传统方式不需要自定义接口，直接调用SqlSession方法+namespace.id定位sql语句就好。而动态代理需要自己自定义接口（不需要自己写接口的实现类），然后动态生成自定义接口的代理类，调用代理类对象方法就会自动调用处理方法（Mybatis封装好了处理方法，本质也是调用SqlSession 的实现类DefaultSqlSession 的方法+定位sql语句来与数据库交互）；</p>
<p>ps：SqlSession的实现类DefaultSqlSession 里面封装了JDBC代码哈哈哈。</p>
<p>可以见下一篇博客，详细讲解<strong>动态代理的原理</strong>（分为不需要被代理类，和需要被代理类两种）；而<strong>Mybatis的动态代理是不需要被代理类的动态代理方式</strong>！</p>
<p>从上面讲的那么多不同点，似乎传统方式更方便哦，但是</p>
<p>下面代码只贴出不同的部分地方就好了：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 映射文件的部分代码 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- <span class="doctag">TODO:</span>给此sql映射文件起一个唯一的名称 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- <span class="doctag">TODO:</span>给此sql语句起一个唯一的名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;All&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        select * from user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;User&gt; list = sqlSession.selectList(<span class="string">&quot;user.All&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (User user : list) &#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>大总结（环境搭建，执行过程，执行原理）如下图：</p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day08-Mybatis/%E6%80%BB%E7%BB%93.png" alt="总结"></p>
<h2 id="自己描述：（敲重点）"><a href="#自己描述：（敲重点）" class="headerlink" title="自己描述：（敲重点）"></a>自己描述：（敲重点）</h2><p>其实就是Mybatis将JDBC代码封装起来，封装到DefaultSqlSession这个类中，同时将sql语句从java代码抽离，放到xml文件，然后读取xml文件将内容封装到Configuration对象当中，一步一步将Configuration对象传递给DefaultSqlSession对象，调用DefaultSqlSession的成员方法以及得到的Configuration对象（sql语句）来与mysql数据库进行交互！！！（我们看到的代码是SqlSession对象调用方法，其实是调用DefaultSqlSession对象方法，因为SqlSession是接口类的，这里使用了多态）</p>
<h1 id="第三章-MyBatis综合应用"><a href="#第三章-MyBatis综合应用" class="headerlink" title="第三章 MyBatis综合应用"></a>第三章 MyBatis综合应用</h1><p>1 这里的应用案例，使用的<strong>动态代理方式</strong></p>
<p>2 因为SqlSession线程不安全，为了节省代码，测试类中利用到了静态代码块，也利用到了@BeforeClass，@AfterClass，@Test 注解。除开第三章后，后面会用到自定义的封装 可以很方便得到SqlSession对象，以及提交并关闭资源哈!</p>
<p>3 流程什么的跟入门案例一样，只不过代理接口多了三个方法而已，在映射文件添加对应标签以及sql语句即可！</p>
<h2 id="3-1-需求"><a href="#3-1-需求" class="headerlink" title="3.1 需求"></a>3.1 需求</h2><hr>
<p>创建用户表，使用MyBatis完成下面的SQL操作</p>
<ol>
<li>查询id为3的用户信息</li>
<li>修改id为2的用户信息</li>
<li>删除id为1的用户信息</li>
<li>插入一条用户信息</li>
<li>查询所有用户信息</li>
</ol>
<h2 id="3-2-数据环境准备"><a href="#3-2-数据环境准备" class="headerlink" title="3.2 数据环境准备"></a>3.2 数据环境准备</h2><h3 id="user表结构和数据"><a href="#user表结构和数据" class="headerlink" title="user表结构和数据"></a>user表结构和数据</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">跟上面入门案例一样，这里省略！！！</span><br></pre></td></tr></table></figure>

<h3 id="MyBatis事务提交"><a href="#MyBatis事务提交" class="headerlink" title="MyBatis事务提交"></a>MyBatis事务提交</h3><p>事务的提交有如下2种方式</p>
<ol>
<li><p>自动提交事务（在创建SqlSession对象时多加一个参数true）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openSession(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>手动提交事务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> ：上面openSession调用时不使用参数，默认为<span class="keyword">false</span>，需要手动提交，</span><br><span class="line"><span class="number">2</span> ：然后调用SqlSession对象的commit方法便可以完成手动提交。</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="3-3-步骤"><a href="#3-3-步骤" class="headerlink" title="3.3 步骤"></a>3.3 步骤</h2><hr>
<ol>
<li><p>创建mybatis工程</p>
</li>
<li><p>创建lib目录，添加依赖包到lib目录下</p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day07-Mybatis/1566828188983.png" alt="1566828188983"></p>
</li>
<li><p>新增配置文件</p>
<p>3.1 sqlMapConfig.xml</p>
<p>3.2 log4j.properties</p>
</li>
<li><p>创建com.itheima.entity包，新增User实体类</p>
</li>
<li><p>创建com.itheima.dao包，新增UserMapper接口、UserMapper.xml映射文件</p>
</li>
<li><p>创建com.itheima.test包，新增TestUserDao测试类</p>
</li>
</ol>
<p>项目的整体架构图</p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day07-Mybatis/1566829612872.png" alt="1566829612872"></p>
<h2 id="3-4-代码"><a href="#3-4-代码" class="headerlink" title="3.4 代码"></a>3.4 代码</h2><hr>
<p><strong>log4j.properties</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">跟入门案例一样。</span></span><br></pre></td></tr></table></figure>

<p><strong>sqlMapConfig.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">跟入门案例一样。</span><br></pre></td></tr></table></figure>

<p><strong>User.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">跟入门案例一样。</span><br></pre></td></tr></table></figure>

<p><strong>UserMapper.java</strong></p>
<p>主要是增加了三种方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.dao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.User;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 数据访问层方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     查询所有的用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAllUsers</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//根据User来更新数据库中的某个id的一条user数据。</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">    <span class="comment">//注意，传参如果是基本类型要用包装类哦。</span></span><br><span class="line">    <span class="comment">//功能分别为根据 id来查询或者删除user表数据。</span></span><br><span class="line">    <span class="function">User <span class="title">findById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteUser</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="comment">//插入一条用户信息。</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insertUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>UserMapper.xml</strong></p>
<p><strong>delete以及update</strong>数据<strong>返回int 类型</strong>，这里<strong>省略了返回值类型 int</strong>。</p>
<p>参数类型的别名，后面在介绍。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  <span class="doctag">TODO:</span>Sql映射文件: 在此配置文件中,编写接口中方法对应的sql语句 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- namespace:名称空间</span></span><br><span class="line"><span class="comment">        作用: 指定对应的接口(当前这个sql映射文件为哪个接口提供)</span></span><br><span class="line"><span class="comment">        值: 接口的全限定名</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- select: 用于查询的标签</span></span><br><span class="line"><span class="comment">         id: id为对应方法的名称</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注意，这里用.而不是/,而且User后没有后缀名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.entity.User&quot;</span>&gt;</span></span><br><span class="line">        select * from user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.entity.User&quot;</span>&gt;</span></span><br><span class="line">        select * from user where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--修改用户--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.itheima.entity.User&quot;</span>&gt;</span></span><br><span class="line">        update user set username=#&#123;username&#125;, birthday=#&#123;birthday&#125;, sex=#&#123;sex&#125;, address=#&#123;address&#125; where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--删除用户--&gt;</span>  <span class="comment">&lt;!--出入参数本该写Integer的全类名的，但是这里用了别名哈 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        delete from user where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 添加 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.itheima.entity.User&quot;</span>&gt;</span></span><br><span class="line">        insert into user values(null,#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>测试类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.dao.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestUserMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//<span class="doctag">TODO:</span>0.读取核心配置文件,获取流信息</span></span><br><span class="line">        InputStream is = Resources.getResourceAsStream(<span class="string">&quot;mybatisConfig.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//<span class="doctag">TODO:</span>1.创建SqlSessionFactoryBuilder对象</span></span><br><span class="line">        <span class="comment">//作用:解析Mybatis核心配置文件,获取配置文件中的所有配置信息,</span></span><br><span class="line">        <span class="comment">//     封装到java对象中(Configuration)</span></span><br><span class="line">        SqlSessionFactoryBuilder sqlSessionFactoryBuilder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">        <span class="comment">//<span class="doctag">TODO:</span>2.根据配置信息创建SqlSessionFactory对象</span></span><br><span class="line">        <span class="comment">//作用:此工厂用于生产SqlSession对象,一个SqlSession就是与mysql的一次会话(conn)</span></span><br><span class="line">        SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(is);</span><br><span class="line">        <span class="comment">//<span class="doctag">TODO:</span>3.创建SqlSession对象(通过工厂创建SqlSession)</span></span><br><span class="line">        <span class="comment">//作用:建立与mysql的连接关系,有了sqlSession就能够访问mysql.(相当于我们之前使用的conn)</span></span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//<span class="doctag">TODO:</span>4.动态生成接口的实现类(代理类)</span></span><br><span class="line">        <span class="comment">//作用:sqlSession使用动态代理生成了接口的实现类,在接口的实现类中完成了与mysql的通讯</span></span><br><span class="line">        UserMapper mapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        <span class="comment">//<span class="doctag">TODO:</span>5.调用代理类的方法完成查询</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//1：查询全部user：</span></span><br><span class="line">        List&lt;User&gt; allUsers = mapper.findAllUsers();</span><br><span class="line">        <span class="keyword">for</span> (User allUser : allUsers) &#123;</span><br><span class="line">            System.out.println(allUser);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2:根据id查询user</span></span><br><span class="line">        User user = mapper.findById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//3：修改</span></span><br><span class="line">        User user1 = <span class="keyword">new</span> User(<span class="number">3</span>, <span class="string">&quot;猪八戒&quot;</span>, Date.valueOf(<span class="string">&quot;1999-05-20&quot;</span>), <span class="string">&quot;女&quot;</span>, <span class="string">&quot;深圳大学&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> i = mapper.updateUser(user1);</span><br><span class="line">        <span class="keyword">if</span>(i&gt;<span class="number">0</span>) System.out.println(<span class="string">&quot;修改了&quot;</span> + i + <span class="string">&quot;条数据&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> System.out.println(<span class="string">&quot;修改数据失败&quot;</span>);</span><br><span class="line">        <span class="comment">//去SQLyog数据库查看是否真修改了数据，发现没有，必须有参数才行哈openSession(true);</span></span><br><span class="line">        <span class="comment">//或者手动提交</span></span><br><span class="line">        <span class="comment">//sqlSession.commit();</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//4：删除</span></span><br><span class="line">        <span class="keyword">int</span> j = mapper.deleteUser(<span class="number">4</span>);</span><br><span class="line">        <span class="keyword">if</span>(j&gt;<span class="number">0</span>) System.out.println(<span class="string">&quot;删除了&quot;</span> + j + <span class="string">&quot;条数据&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> System.out.println(<span class="string">&quot;删除失败&quot;</span>);</span><br><span class="line">        <span class="comment">//再次运行时，因为已经删除过了，那么返回值j为0哈！</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//5: 插入</span></span><br><span class="line">        User user2 = <span class="keyword">new</span> User(<span class="keyword">null</span>,<span class="string">&quot;高明辉&quot;</span>,Date.valueOf(<span class="string">&quot;1997-04-11&quot;</span>),<span class="string">&quot;男&quot;</span>,<span class="string">&quot;深圳大学&quot;</span>);</span><br><span class="line">        User user3 = <span class="keyword">new</span> User();</span><br><span class="line">        user3.setUsername(<span class="string">&quot;高明辉&quot;</span>);</span><br><span class="line">        user3.setAddress(<span class="string">&quot;深圳大学&quot;</span>);</span><br><span class="line">        user3.setBirthday(Date.valueOf(<span class="string">&quot;1997-04-11&quot;</span>));</span><br><span class="line">        user3.setSex(<span class="string">&quot;m&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> k1 = mapper.insertUser(user2);</span><br><span class="line">        <span class="keyword">if</span>(k1&gt;<span class="number">0</span>) System.out.println(<span class="string">&quot;插入数据user2成功&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> System.out.println(<span class="string">&quot;插入数据user2失败&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> k2 = mapper.insertUser(user3);</span><br><span class="line">        <span class="keyword">if</span>(k2&gt;<span class="number">0</span>) System.out.println(<span class="string">&quot;插入数据user3成功&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> System.out.println(<span class="string">&quot;插入数据user3失败&quot;</span>);</span><br><span class="line"></span><br><span class="line">        is.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上面的测试类显然能满足我们的测试要求，但是由于<strong>SqlSession是线程不安全的</strong>，在<strong>执行sql时需要再次获取新的SqlSession对象</strong>，因此我们把<strong>测试类改成如下注解方式</strong>，</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1</span> <span class="string">使用@BeforeClass静态代码块来读取xml配置文件，并创建SqlSessionFactory对象</span></span><br><span class="line"><span class="attr">2</span> <span class="string">使用@Before来得到SqlSession对象以及代理类对象 usermapper</span></span><br><span class="line"><span class="attr">3</span> <span class="string">@After 提交事务以及关闭SqlSession</span></span><br><span class="line"><span class="attr">4</span> <span class="string">@Test 测试具体代码。</span></span><br></pre></td></tr></table></figure>

<p>使用上述注解需要导入 hamcrest-core-1.3.jar 以及junit-4.12.jar 包！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.dao.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.BeforeClass;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestUserMapper1</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 会话工厂，只需要创建一次</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory factory;</span><br><span class="line">    <span class="comment">// 会话，每个方法都有自己的会话</span></span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line">    <span class="comment">// 接口</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 类加载的时候执行一次，创建会话工厂</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> kelvin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2019/8/26/0026-22:20</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@BeforeClass</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        InputStream inputStream = Resources.getResourceAsStream(<span class="string">&quot;mybatisConfig.xml&quot;</span>);</span><br><span class="line">        SqlSessionFactoryBuilder builder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">        factory = builder.build(inputStream);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 每个测试方法前都会执行的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">begin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        session = factory.openSession();</span><br><span class="line">        <span class="comment">// 创建代理对象</span></span><br><span class="line">        userMapper = session.getMapper(UserMapper.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 每个测试方法后都会执行的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">end</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        session.commit();</span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试 查询所有user数据方法：</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAllUsers</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;User&gt; allUsers = userMapper.findAllUsers();</span><br><span class="line">        System.out.println(<span class="string">&quot;查询到的如数如下所示：&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (User allUser : allUsers) &#123;</span><br><span class="line">            System.out.println(allUser);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    查询到的如数如下所示：</span></span><br><span class="line"><span class="comment">    User&#123;id=1, username=&#x27;孙悟空&#x27;, birthday=1980-10-24, sex=&#x27;男&#x27;, address=&#x27;花果山水帘洞&#x27;&#125;</span></span><br><span class="line"><span class="comment">    User&#123;id=2, username=&#x27;白骨精&#x27;, birthday=1992-11-12, sex=&#x27;女&#x27;, address=&#x27;白虎岭白骨洞&#x27;&#125;</span></span><br><span class="line"><span class="comment">    User&#123;id=3, username=&#x27;猪八戒&#x27;, birthday=1999-05-20, sex=&#x27;女&#x27;, address=&#x27;深圳大学&#x27;&#125;</span></span><br><span class="line"><span class="comment">    User&#123;id=5, username=&#x27;玉兔精&#x27;, birthday=2010-02-12, sex=&#x27;女&#x27;, address=&#x27;天竺国皇宫&#x27;&#125;</span></span><br><span class="line"><span class="comment">    User&#123;id=6, username=&#x27;豹子精&#x27;, birthday=2008-05-03, sex=&#x27;男&#x27;, address=&#x27;隐雾山折岳洞&#x27;&#125;</span></span><br><span class="line"><span class="comment">    User&#123;id=12, username=&#x27;高明辉&#x27;, birthday=1997-04-11, sex=&#x27;男&#x27;, address=&#x27;深圳大学&#x27;&#125;</span></span><br><span class="line"><span class="comment">    User&#123;id=13, username=&#x27;高明辉&#x27;, birthday=1997-04-11, sex=&#x27;m&#x27;, address=&#x27;深圳大学&#x27;&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 2 根据id查询用户信息的测试方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindUserById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = userMapper.findById(<span class="number">3</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;查询到的如数如下所示：&quot;</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        <span class="comment">//User&#123;id=3, username=&#x27;猪八戒&#x27;, birthday=1999-05-20, sex=&#x27;女&#x27;, address=&#x27;深圳大学&#x27;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 3 根据id修改用户信息的测试方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdateUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user1 = <span class="keyword">new</span> User(<span class="number">3</span>, <span class="string">&quot;猪八戒&quot;</span>, Date.valueOf(<span class="string">&quot;1999-05-20&quot;</span>), <span class="string">&quot;女&quot;</span>, <span class="string">&quot;深圳大学&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> i = userMapper.updateUser(user1);</span><br><span class="line">        <span class="keyword">if</span>(i&gt;<span class="number">0</span>) System.out.println(<span class="string">&quot;修改了&quot;</span> + i + <span class="string">&quot;条数据&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> System.out.println(<span class="string">&quot;修改数据失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 4 根据id删除用户信息的测试方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeleteUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> j = userMapper.deleteUser(<span class="number">4</span>);</span><br><span class="line">        <span class="keyword">if</span>(j&gt;<span class="number">0</span>) System.out.println(<span class="string">&quot;删除了&quot;</span> + j + <span class="string">&quot;条数据&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> System.out.println(<span class="string">&quot;删除失败&quot;</span>);</span><br><span class="line">        <span class="comment">//再次运行时，因为已经删除过了，那么返回值j为0哈！</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 5 插入一条User数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsertUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        User user2 = <span class="keyword">new</span> User(<span class="keyword">null</span>,<span class="string">&quot;高明辉&quot;</span>,Date.valueOf(<span class="string">&quot;1997-04-11&quot;</span>),<span class="string">&quot;男&quot;</span>,<span class="string">&quot;深圳大学&quot;</span>);</span><br><span class="line">        User user3 = <span class="keyword">new</span> User();</span><br><span class="line">        user3.setUsername(<span class="string">&quot;高明辉&quot;</span>);</span><br><span class="line">        user3.setAddress(<span class="string">&quot;深圳大学&quot;</span>);</span><br><span class="line">        user3.setBirthday(Date.valueOf(<span class="string">&quot;1997-04-11&quot;</span>));</span><br><span class="line">        user3.setSex(<span class="string">&quot;m&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> k1 = userMapper.insertUser(user2);</span><br><span class="line">        <span class="keyword">if</span>(k1&gt;<span class="number">0</span>) System.out.println(<span class="string">&quot;插入数据user2成功&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> System.out.println(<span class="string">&quot;插入数据user2失败&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> k2 = userMapper.insertUser(user3);</span><br><span class="line">        <span class="keyword">if</span>(k2&gt;<span class="number">0</span>) System.out.println(<span class="string">&quot;插入数据user3成功&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> System.out.println(<span class="string">&quot;插入数据user3失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="第四章-核心配置文件标签"><a href="#第四章-核心配置文件标签" class="headerlink" title="第四章 核心配置文件标签"></a>第四章 核心配置文件标签</h1><p><strong>常用标签</strong></p>
<hr>
<p>sqlMapConfig.xml是MyBatis框架的核心配置文件，主要用来配置数据源、映射文件、属性等，文件名可以自定义，加载时能找到该文件就可！</p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day07-Mybatis/1566869842463.png" alt="1566869842463"></p>
<h2 id="4-1-properties标签"><a href="#4-1-properties标签" class="headerlink" title="4.1 properties标签"></a>4.1 properties标签</h2><p><strong>作用</strong>：核心文件里连接数据库的属性值独立到一个properties文件，这样方便动态替换</p>
<p><strong>应用</strong>：在src目录下，（或者在resources目录下）新增db.properties文件</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/itcast?characterEncoding=utf8</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>

<p>修改sqlMapConfig.xml文件，通过读取外部文件来动态配置内部的属性值</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 第一步：在environments标签前添加properties属性如下--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;db.properties&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;default&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 第二步：修改environments下id为default的environment标签下的property标签 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--原本为 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://192.168.253.129:3306/db8?characterEncoding=utf8&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhangjie&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 改为 如下--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ps: value 中&#123;&#125;里面的值为properties文件中的键值对中的键名 --&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="4-2-typeAliases标签"><a href="#4-2-typeAliases标签" class="headerlink" title="4.2 typeAliases标签"></a>4.2 typeAliases标签</h2><p><strong>作用</strong>：给用户自定义的实体类定义别名，它只和 XML 配置有关，用来减少类完全限定名的冗余。比如说在核心文件配置了别名，那么<strong>在映射文件中的参数以及返回类型就可以用别名来代替了</strong>，而不用写全类名了。如：java.lang.Integer 可以用int来代替；com.itheima.pro.User可以用user来代替。</p>
<p><strong>内置别名</strong></p>
<p>shift+快速两次 shift 进入全局搜索，搜索框输入typeAliases 然后选择进入能查看Mybatis框架关于映射文件中输入输出参数类型的别名集合。比如别名 int 对应 Integer.class，在映射文件中的参数可以使用别名int来如下代替：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">parameterType=&quot;java.lang.Integer&quot;可以代替为：</span><br><span class="line">parameterType=&quot;int&quot;</span><br></pre></td></tr></table></figure>

<hr>
<p>如下<strong>内置别名可以直接使用</strong>，别名<strong>不区分大小写</strong></p>
<table>
<thead>
<tr>
<th><strong>别名</strong></th>
<th><strong>映射类型</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>_byte</strong></td>
<td>byte</td>
</tr>
<tr>
<td><strong>_long</strong></td>
<td>long</td>
</tr>
<tr>
<td><strong>_short</strong></td>
<td>short</td>
</tr>
<tr>
<td><strong>_int</strong></td>
<td>int</td>
</tr>
<tr>
<td><strong>_integer</strong></td>
<td>int</td>
</tr>
<tr>
<td><strong>_double</strong></td>
<td>double</td>
</tr>
<tr>
<td><strong>_float</strong></td>
<td>float</td>
</tr>
<tr>
<td><strong>_boolean</strong></td>
<td>boolean</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>string</strong></td>
<td>String</td>
</tr>
<tr>
<td><strong>byte</strong></td>
<td>Byte</td>
</tr>
<tr>
<td><strong>long</strong></td>
<td>Long</td>
</tr>
<tr>
<td><strong>short</strong></td>
<td>Short</td>
</tr>
<tr>
<td><strong>int</strong></td>
<td>Integer</td>
</tr>
<tr>
<td><strong>integer</strong></td>
<td>Integer</td>
</tr>
<tr>
<td><strong>double</strong></td>
<td>Double</td>
</tr>
<tr>
<td><strong>float</strong></td>
<td>Float</td>
</tr>
<tr>
<td><strong>boolean</strong></td>
<td>Boolean</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>date</strong></td>
<td>Date</td>
</tr>
<tr>
<td><strong>decimal</strong></td>
<td>BigDecimal</td>
</tr>
<tr>
<td><strong>bigdecimal</strong></td>
<td>BigDecimal</td>
</tr>
<tr>
<td><strong>object</strong></td>
<td>Object</td>
</tr>
<tr>
<td><strong>map</strong></td>
<td>Map</td>
</tr>
<tr>
<td><strong>hashmap</strong></td>
<td>HashMap</td>
</tr>
<tr>
<td><strong>list</strong></td>
<td>List</td>
</tr>
<tr>
<td><strong>arraylist</strong></td>
<td>ArrayList</td>
</tr>
<tr>
<td><strong>collection</strong></td>
<td>Collection</td>
</tr>
<tr>
<td><strong>iterator</strong></td>
<td>Iterator</td>
</tr>
</tbody></table>
<hr>
<p><strong>方式一</strong></p>
<p>单个别名 typeAlias</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    typeAlias :</span></span><br><span class="line"><span class="comment">    1. type：指定实体类全名</span></span><br><span class="line"><span class="comment">    2. alias: 指定别名，如果省略这个属性，默认使用类名字做为别名，</span></span><br><span class="line"><span class="comment">	别名不区分大小写，通常别名使用小写。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.itheima.entity.User&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 或者 如下方式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.itheima.entity.User&quot;</span>,<span class="attr">alias</span>=<span class="string">&quot;user&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>方式二</strong></p>
<p>包扫描配置别名package</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    package指定包名</span></span><br><span class="line"><span class="comment">    1. 自动将这个包下所有的实体类定义别名，别名就是类的名字。</span></span><br><span class="line"><span class="comment">	(在日志输出中会有乱码，不用理会，不影响使用，这是mybatis的bug)</span></span><br><span class="line"><span class="comment">    2. 如果有多个子包，只需要指定父包即可。</span></span><br><span class="line"><span class="comment">    3. 可以使用多个package标签，指定不同的包名</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.itheima.entity&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="4-3-environments标签"><a href="#4-3-environments标签" class="headerlink" title="4.3 environments标签"></a>4.3 environments标签</h2><p><strong>作用</strong></p>
<hr>
<p>MyBatis可以配置多种环境，有助于将SQL映射应用于多种数据库之中，如dev(开发环境)、uat(测试环境)、prd(生成环境)</p>
<p>尽管可以配置多个环境，但是每个环境只能有一个SqlSessionFactory实例</p>
<p><strong>transactionManager事务管理器</strong></p>
<table>
<thead>
<tr>
<th>类型</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>JDBC</td>
<td>由JDBC进行事务的管理</td>
</tr>
<tr>
<td>MANAGED</td>
<td>事务由容器来管理，后期学习Spring框架的时候，所有的事务由容器管理</td>
</tr>
</tbody></table>
<p><strong>dataSource数据源</strong></p>
<table>
<thead>
<tr>
<th>类型</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>UNPOOLED</td>
<td>不使用连接池，每次自己创建连接</td>
</tr>
<tr>
<td>POOLED</td>
<td>使用mybatis创建的连接池</td>
</tr>
<tr>
<td>JNDI</td>
<td>由应用服务器提供连接池的资源，我们通过JNDI指定的名字去访问连接池资源</td>
</tr>
</tbody></table>
<p><strong>应用</strong></p>
<hr>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--定义属性文件</span></span><br><span class="line"><span class="comment">    resource：从类路径下面读取外部文件</span></span><br><span class="line"><span class="comment">    url：从一个地址来读取配置文件</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;db.properties&quot;</span> &gt;</span></span><br><span class="line">        <span class="comment">&lt;!--先读取内部属性，后读取外部属性，在属性名一样时，外部属性起作用--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhangjie&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.itheima.entity.User&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;user&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--mybatis环境的配置--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 一个核心配置文件，可以配置多个运行环境，default默认使用哪个运行环境 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;default&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 其中的一个运行环境，通过id来进行标识--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;default&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            事务管理器type的取值：</span></span><br><span class="line"><span class="comment">            1. JDBC：由JDBC进行事务的管理</span></span><br><span class="line"><span class="comment">            2. MANAGED：事务由容器来管理，后期学习Spring框架的时候，所有的事务由容器管理</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            数据源：</span></span><br><span class="line"><span class="comment">            1. POOLED：使用mybatis创建的连接池</span></span><br><span class="line"><span class="comment">            2. UNPOOLED：不使用连接池，每次自己创建连接</span></span><br><span class="line"><span class="comment">            3. JNDI：由服务器提供连接池的资源，我们通过JNDI指定的名字去访问服务器中资源</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--加载映射文件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/itheima/dao/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-4-mappers标签"><a href="#4-4-mappers标签" class="headerlink" title="4.4 mappers标签"></a>4.4 mappers标签</h2><p><strong>作用</strong>:加载外部的映射文件</p>
<p>如下四种方式，我们一般采用第四种：</p>
<hr>
<ol>
<li><p>使用相对于类路径的资源引用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--加载映射文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/itheima/dao/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>使用完全限定资源定位符（URL）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--加载映射文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///E:/projects/IdeaWordspace/JavaEE01/mybatis/src/com/itheima/dao/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>使用映射器接口实现类的完全限定类名</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--加载映射文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.UserMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>将包内的映射器接口实现全部注册为映射器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--加载映射文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.itheima.dao&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">高明辉</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/01/24/Day08-MyBatis/">http://example.com/2022/01/24/Day08-MyBatis/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Jason</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MyBatis/">MyBatis</a></div><div class="post_share"><div class="social-share" data-image="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day08-Mybatis/Mybatis.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="添加微信"/></a><div class="post-qr-code-desc">添加微信</div></li><li class="reward-item"><a href="/img/pay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/pay.jpg" alt="付款码"/></a><div class="post-qr-code-desc">付款码</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/01/24/Mybatis%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E6%96%B9%E5%BC%8F%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/"><img class="prev-cover" src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day08-Mybatis/Mybatis.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Mybatis动态代理方式原理解析</div></div></a></div><div class="next-post pull-right"><a href="/2022/01/24/Day07-JDBC%E8%BF%9E%E6%8E%A5%E6%B1%A0/"><img class="next-cover" src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day07-Mybatis/%E5%B0%81%E9%9D%A2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Day07-JDBC连接池</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/03/15/Day09-%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F%E5%AE%9E%E7%8E%B0Mybatis/" title="Day09-注解方式实现Mybatis"><img class="cover" src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day09-Mybatis/Mybatis.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-15</div><div class="title">Day09-注解方式实现Mybatis</div></div></a></div><div><a href="/2022/01/24/Mybatis%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E6%96%B9%E5%BC%8F%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/" title="Mybatis动态代理方式原理解析"><img class="cover" src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day08-Mybatis/Mybatis.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-24</div><div class="title">Mybatis动态代理方式原理解析</div></div></a></div><div><a href="/2022/03/15/Day09-Mybatis/" title="Day09-Mybatis"><img class="cover" src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day09-Mybatis/Mybatis.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-15</div><div class="title">Day09-Mybatis</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E5%89%8D%E5%85%88%E6%9D%A5%E4%B8%AA%E5%B0%8F%E7%BB%93-%E2%98%85"><span class="toc-number">1.</span> <span class="toc-text">学习前先来个小结 ★</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-%E6%A1%86%E6%9E%B6"><span class="toc-number"></span> <span class="toc-text">第一章 框架</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E6%A1%86%E6%9E%B6%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">1.1 框架概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">1.2 项目的三层架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-MyBatis%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.</span> <span class="toc-text">1.3 MyBatis框架介绍</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-MyBatis%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="toc-number"></span> <span class="toc-text">第二章 MyBatis入门案例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E6%96%B9%E5%BC%8F%E6%BC%94%E7%A4%BA"><span class="toc-number">1.</span> <span class="toc-text">动态代理方式演示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">2.</span> <span class="toc-text">2.1 环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82"><span class="toc-number">2.1.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.</span> <span class="toc-text">准备数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.3.</span> <span class="toc-text">步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%8C%85%E5%BC%80%E5%8F%91%E6%80%9D%E6%83%B3"><span class="toc-number">2.4.</span> <span class="toc-text">分包开发思想</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E5%AF%B9%E5%BA%94%E5%AE%9E%E4%BD%93"><span class="toc-number">2.5.</span> <span class="toc-text">数据库表对应实体</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%92%8C%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.</span> <span class="toc-text">2.2 配置文件和接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6sqlMapConfig-xml"><span class="toc-number">3.1.</span> <span class="toc-text">2.2.1 核心配置文件sqlMapConfig.xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-UserMapper%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.2.</span> <span class="toc-text">2.2.2 UserMapper接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-%E7%94%A8%E6%88%B7%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="toc-number">3.3.</span> <span class="toc-text">2.2.3 用户映射文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-4-%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6-log4j-properties"><span class="toc-number">3.4.</span> <span class="toc-text">2.2.4 日志文件 log4j.properties</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E6%B5%8B%E8%AF%95%E7%B1%BB"><span class="toc-number">4.</span> <span class="toc-text">2.3 测试类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mybatis%E4%B8%AD%E7%9A%84%E6%A0%B8%E5%BF%83api%E4%BB%8B%E7%BB%8D"><span class="toc-number">5.</span> <span class="toc-text">Mybatis中的核心api介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SqlSessionFactoryBuilder"><span class="toc-number">5.1.</span> <span class="toc-text">SqlSessionFactoryBuilder:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SqlSessionFactory"><span class="toc-number">5.2.</span> <span class="toc-text">SqlSessionFactory:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SqlSession%E6%8E%A5%E5%8F%A3"><span class="toc-number">5.3.</span> <span class="toc-text">SqlSession接口:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B%E6%80%BB%E7%BB%93%E5%88%86%E6%9E%90"><span class="toc-number">6.</span> <span class="toc-text">2.4 入门案例总结分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E6%96%B9%E5%BC%8F%E6%BC%94%E7%A4%BAMybatis"><span class="toc-number">7.</span> <span class="toc-text">传统方式演示Mybatis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E6%96%B9%E5%BC%8F%E8%B7%9F%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E6%96%B9%E5%BC%8F%E7%9A%84%E4%B8%8D%E5%90%8C%E7%82%B9%EF%BC%9A"><span class="toc-number">7.1.</span> <span class="toc-text">传统方式跟动态代理方式的不同点：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%B7%B1%E6%8F%8F%E8%BF%B0%EF%BC%9A%EF%BC%88%E6%95%B2%E9%87%8D%E7%82%B9%EF%BC%89"><span class="toc-number">8.</span> <span class="toc-text">自己描述：（敲重点）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-MyBatis%E7%BB%BC%E5%90%88%E5%BA%94%E7%94%A8"><span class="toc-number"></span> <span class="toc-text">第三章 MyBatis综合应用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E9%9C%80%E6%B1%82"><span class="toc-number">1.</span> <span class="toc-text">3.1 需求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E6%95%B0%E6%8D%AE%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">2.</span> <span class="toc-text">3.2 数据环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#user%E8%A1%A8%E7%BB%93%E6%9E%84%E5%92%8C%E6%95%B0%E6%8D%AE"><span class="toc-number">2.1.</span> <span class="toc-text">user表结构和数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis%E4%BA%8B%E5%8A%A1%E6%8F%90%E4%BA%A4"><span class="toc-number">2.2.</span> <span class="toc-text">MyBatis事务提交</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E6%AD%A5%E9%AA%A4"><span class="toc-number">3.</span> <span class="toc-text">3.3 步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E4%BB%A3%E7%A0%81"><span class="toc-number">4.</span> <span class="toc-text">3.4 代码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%A0%87%E7%AD%BE"><span class="toc-number"></span> <span class="toc-text">第四章 核心配置文件标签</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-properties%E6%A0%87%E7%AD%BE"><span class="toc-number">1.</span> <span class="toc-text">4.1 properties标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-typeAliases%E6%A0%87%E7%AD%BE"><span class="toc-number">2.</span> <span class="toc-text">4.2 typeAliases标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-environments%E6%A0%87%E7%AD%BE"><span class="toc-number">3.</span> <span class="toc-text">4.3 environments标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-mappers%E6%A0%87%E7%AD%BE"><span class="toc-number">4.</span> <span class="toc-text">4.4 mappers标签</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 高明辉</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'Aaee0Vekhg5KbLhMOJQrEU6A-gzGzoHsz',
      appKey: 'mmLHPEEtqvOSJhsqWra8Sq6K',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script type="text/javascript" src="/js/fairyDustCursor.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>