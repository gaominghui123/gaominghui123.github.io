<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Day04-mysql基础-范式-多表查询-常用函数-事务 | Jason</title><meta name="keywords" content="数据库范式,多表查询,MySQL常用函数,事务"><meta name="author" content="高明辉"><meta name="copyright" content="高明辉"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="在阅读本文章之前可以先看下面的思维导图会更好哦  第一章 数据库范式1.1 什么是范式范式是指:设计数据库表的规则(Normal Form)​    好的数据库设计对数据的存储性能和后期的程序开发，都会产生重要的影响。建立科学的，规范的数据库就需要满足一些规则来优化数据的设计和存储 学之前先来个小结；总结的非常好！ 1234567891 范式的出现：为的是优化数据库,降低数据冗余,保证数据的有效性">
<meta property="og:type" content="article">
<meta property="og:title" content="Day04-mysql基础-范式-多表查询-常用函数-事务">
<meta property="og:url" content="http://example.com/2022/01/21/Day04-mysql%E5%9F%BA%E7%A1%80-%E8%8C%83%E5%BC%8F-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2-%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0-%E4%BA%8B%E5%8A%A1/index.html">
<meta property="og:site_name" content="Jason">
<meta property="og:description" content="在阅读本文章之前可以先看下面的思维导图会更好哦  第一章 数据库范式1.1 什么是范式范式是指:设计数据库表的规则(Normal Form)​    好的数据库设计对数据的存储性能和后期的程序开发，都会产生重要的影响。建立科学的，规范的数据库就需要满足一些规则来优化数据的设计和存储 学之前先来个小结；总结的非常好！ 1234567891 范式的出现：为的是优化数据库,降低数据冗余,保证数据的有效性">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%B0%81%E9%9D%A2.jpg">
<meta property="article:published_time" content="2022-01-21T12:54:47.000Z">
<meta property="article:modified_time" content="2022-03-11T12:48:41.166Z">
<meta property="article:author" content="高明辉">
<meta property="article:tag" content="数据库范式">
<meta property="article:tag" content="多表查询">
<meta property="article:tag" content="MySQL常用函数">
<meta property="article:tag" content="事务">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%B0%81%E9%9D%A2.jpg"><link rel="shortcut icon" href="/img/%E7%BD%91%E7%AB%99%E5%9B%BE%E6%A0%87.png"><link rel="canonical" href="http://example.com/2022/01/21/Day04-mysql%E5%9F%BA%E7%A1%80-%E8%8C%83%E5%BC%8F-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2-%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0-%E4%BA%8B%E5%8A%A1/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Day04-mysql基础-范式-多表查询-常用函数-事务',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-03-11 20:48:41'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Jason" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/%E5%A4%B4%E5%83%8F.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">175</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">206</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">34</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E5%85%B3%E4%BA%8E"><i class="fa-fw /about/"></i><span> 0</span></a></li><li><a class="site-page child" href="/myself"><i class="fa-fw /myself/"></i><span> 1</span></a></li><li><a class="site-page child" href="/butterfly%E4%B8%BB%E9%A2%98"><i class="fa-fw https://github.com/jerryc127/hexo-theme-butterfly/"></i><span> 2</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%B0%81%E9%9D%A2.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Jason</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E5%85%B3%E4%BA%8E"><i class="fa-fw /about/"></i><span> 0</span></a></li><li><a class="site-page child" href="/myself"><i class="fa-fw /myself/"></i><span> 1</span></a></li><li><a class="site-page child" href="/butterfly%E4%B8%BB%E9%A2%98"><i class="fa-fw https://github.com/jerryc127/hexo-theme-butterfly/"></i><span> 2</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Day04-mysql基础-范式-多表查询-常用函数-事务</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-21T12:54:47.000Z" title="发表于 2022-01-21 20:54:47">2022-01-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-03-11T12:48:41.166Z" title="更新于 2022-03-11 20:48:41">2022-03-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/mysql/">mysql</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Day04-mysql基础-范式-多表查询-常用函数-事务"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>在阅读本文章之前可以先看下面的思维导图会更好哦</p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/Day04-%E8%8C%83%E5%BC%8F-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2-%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0-%E4%BA%8B%E5%8A%A1.png"></p>
<h1 id="第一章-数据库范式"><a href="#第一章-数据库范式" class="headerlink" title="第一章 数据库范式"></a>第一章 数据库范式</h1><h2 id="1-1-什么是范式"><a href="#1-1-什么是范式" class="headerlink" title="1.1 什么是范式"></a>1.1 什么是范式</h2><p><strong>范式是指</strong>:设计数据库<strong>表的规则</strong>(Normal Form)<br>​    好的数据库设计对数据的存储性能和后期的程序开发，都会产生重要的影响。建立科学的，规范的数据库就需要满足一些规则来优化数据的设计和存储</p>
<p>学之前先来个小结；总结的非常好！</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1</span> <span class="string">范式的出现：为的是优化数据库,降低数据冗余,保证数据的有效性和一致性</span></span><br><span class="line"><span class="attr">2</span> <span class="string">反三范式的出现：随着互联网时代的蓬勃发展,用户更加注重的是执行效率,</span></span><br><span class="line"><span class="attr">反三范式,虽然会给数据库带来数据冗余(重复)问题,但也可以提高执行效率。</span></span><br><span class="line">  </span><br><span class="line"><span class="meta">第一范式</span>: <span class="string">表中的每一列不可再拆分,查询结果可以直接使用</span></span><br><span class="line"><span class="meta">第二范式</span>: <span class="string">一张表只描述一件事情,表中的数据直接依赖主键字段(每张表都应该有一个主键字段)</span></span><br><span class="line"><span class="meta">第三范式</span>: <span class="string">从表的外键字段,必须使用主表的主键字段</span></span><br><span class="line"><span class="meta">反三方式</span>: <span class="string">随着互联网时代的蓬勃发展,用户更加注重的是执行效率,反三范式,</span></span><br><span class="line">		<span class="attr">虽然会给数据库带来数据冗余(重复)问题,但也可以提高执行效率</span></span><br></pre></td></tr></table></figure>



<h2 id="1-2-范式的基本分类"><a href="#1-2-范式的基本分类" class="headerlink" title="1.2 范式的基本分类"></a>1.2 范式的基本分类</h2><p>​    目前关系数据库有六种范式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">第一范式（1NF）</span><br><span class="line">第二范式（2NF）</span><br><span class="line">第三范式（3NF）</span><br><span class="line">巴斯-科德范式（BCNF）</span><br><span class="line">第四范式(4NF）</span><br><span class="line">第五范式（5NF，又称完美范式）</span><br></pre></td></tr></table></figure>

<p>满足最低要求的范式是第一范式（1NF）。在第一范式的基础上进一步满足更多规范要求的称为第二范式（2NF），其余范式以次类推。<strong>一般说来，数据库只需满足第三范式(3NF）就行了。</strong></p>
<h2 id="1-3-第一范式"><a href="#1-3-第一范式" class="headerlink" title="1.3 第一范式"></a>1.3 第一范式</h2><p>​    即数据库表的<strong>每一列都是不可分割的原子数据项</strong>，而不能是集合、数组、记录等非原子数据项。即实体中的某个属性有多个值时，必须拆分为不同的属性。在符合第一范式（1NF）表中每个列的值只能是表的一个属性或一个属性的一部分。简而言之，第一范式每一列不可再拆分，称为<strong>原子性</strong>。<br><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E8%8C%83%E5%BC%8F01.png" alt="范式01"></p>
<blockquote>
<p>总结：如果不遵守第一范式，查询出数据还需要进一步处理（查询不方便）。遵守第一范式，需要什么字段的数据就查询什么数据（方便查询）。</p>
</blockquote>
<h2 id="1-4-第二范式"><a href="#1-4-第二范式" class="headerlink" title="1.4 第二范式"></a>1.4 第二范式</h2><p>​    第二范式（2NF）<strong>要求数据库表中的每个实例或记录必须可以被唯一地区分；或者说实体的属性完全依赖于主关键字</strong>。简而言之，第二范式就是<strong>在第一范式的基础上</strong>属性完全依赖于主键。</p>
<p><strong>第二范式</strong>：</p>
<ol>
<li>一张表只描述一件事情</li>
<li>表中的每一个字段都依赖于主键<br><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E8%8C%83%E5%BC%8F03.png" alt="范式03"></li>
</ol>
<blockquote>
<p>总结：如果不遵守第二范式，数据冗余，相同数据无法区分。遵守第二范式减少数据冗余，通过<strong>主键区分</strong>相同数据。</p>
</blockquote>
<h2 id="1-5-第三范式"><a href="#1-5-第三范式" class="headerlink" title="1.5 第三范式"></a>1.5 第三范式</h2><p>​    在2NF基础上，<strong>任何非主属性不依赖于其它非主属性</strong>（<strong>在2NF基础上</strong>消除传递依赖）。简而言之，<strong>从表的外键必须使用主表的主键</strong>。结合上一张图，因为第二范式把一张大的表拆分了几张表格，然后<strong>用一张从表来维护具有联系的几张主表</strong>；然后<strong>从表的外键必须使用主表的主键</strong>；这是为了<strong>方便维护</strong>，如下图所示：<br><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E8%8C%83%E5%BC%8F04.png" alt="范式04"></p>
<blockquote>
<p>总结：如果不准守第三范式，<strong>可能会有相同数据无法区分</strong>，修改数据的时候多张表都需要修改（<strong>不方便修改</strong>）。遵守第三范式通过id<strong>可以区分相同数据</strong>，修改数据的时候<strong>只需要修改一张表</strong>（方便修改）。</p>
</blockquote>
<h2 id="1-6-反三范式"><a href="#1-6-反三范式" class="headerlink" title="1.6 反三范式"></a>1.6 反三范式</h2><p>反三范式相对于三范式的，没有冗余的数据库未必是最好的数据库，有时<strong>为了提高数据库的运行效率，就必须降低范式标准，适当保留冗余数据</strong>。</p>
<p>具体做法是（了解即可）： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在概念数据模型设计时遵守第三范式，</span><br><span class="line">降低范式标准的工作放到物理数据模型设计时考虑。</span><br><span class="line">降低范式就是增加适当的字段，减少了查询时的关联，提高查询效率，</span><br><span class="line">因为在数据库的操作中查询的比例要远远大于DML的比例。</span><br><span class="line">但是反范式化一定要适度，并且在原本已满足三范式的基础上再做调整。</span><br></pre></td></tr></table></figure>

<h1 id="第二章-多表查询"><a href="#第二章-多表查询" class="headerlink" title="第二章 多表查询"></a>第二章 多表查询</h1><p>同时查询多张表获取到需要的数据。<br>比如：我们想查询到开发部有多少人，需要将<strong>部门表</strong>和<strong>员工表</strong>同时进行查询。<br><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A201.png" alt="表连接查询01"></p>
<p>查询某员工在哪个部门该如何操作？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 首先只查询一张表不能查询出员工名字和部门名字，需要使用多表查询。</span><br><span class="line">-- 多表查询分类见下图，下面会有示范该怎么查询。</span><br></pre></td></tr></table></figure>

<p><strong>多表查询的分类</strong>：<br><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A202.png" alt="表连接查询02"></p>
<p>在讲解如何查找多表数据时先介绍一下笛卡尔积：</p>
<h2 id="2-1-笛卡尔积"><a href="#2-1-笛卡尔积" class="headerlink" title="2.1 笛卡尔积"></a>2.1 笛卡尔积</h2><p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/image-20210427093119194.png" alt="image-20210427093119194"></p>
<p>我们发现不是所有的数据组合都是有用的，只有员工表.dept_id = 部门表.id 的数据才是有用的。所以<strong>需要通过条件过滤掉没用数据</strong></p>
<h2 id="讲解多表查询方式前先来个小结："><a href="#讲解多表查询方式前先来个小结：" class="headerlink" title="讲解多表查询方式前先来个小结："></a>讲解多表查询方式前先来个小结：</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">一</span> <span class="string">： 连接查询:</span></span><br><span class="line"><span class="attr">1</span> <span class="string">内连接查询:</span></span><br><span class="line"><span class="attr">1</span> <span class="string">隐式内连接查询: </span></span><br><span class="line"><span class="attr">select</span> <span class="string">* from 表1,表2 where 条件;</span></span><br><span class="line"><span class="attr">2</span> <span class="string">显示内连接查询: </span></span><br><span class="line"><span class="attr">select</span> <span class="string">* from 表1 inner join 表2 on 关联条件 where 筛选条件 </span></span><br><span class="line"><span class="attr">2</span> <span class="string">外连接查询:</span></span><br><span class="line"><span class="attr">1</span> <span class="string">左外连接查询:</span></span><br><span class="line"><span class="attr">以join左边的表为主,查询其所有内容,</span></span><br><span class="line"><span class="attr">根据条件查询右边的表,将满足条件的数据查询出来,</span></span><br><span class="line"><span class="attr">如果没有满足条件的数据,则填充null</span></span><br><span class="line"><span class="attr">select</span> <span class="string">* </span></span><br><span class="line"><span class="attr">from</span> <span class="string">表1 left join 表2 on 关联条件 </span></span><br><span class="line"><span class="attr">where</span> <span class="string">筛选条件 </span></span><br><span class="line"><span class="attr">2</span> <span class="string">右外连接查询:</span></span><br><span class="line"><span class="attr">以join右边的表为主,查询其所有内容,</span></span><br><span class="line"><span class="attr">根据条件查询左边的表,将满足条件的数据查询出来,</span></span><br><span class="line"><span class="attr">如果没有满足条件的数据,则填充null</span></span><br><span class="line"><span class="attr">select</span> <span class="string">* </span></span><br><span class="line"><span class="attr">from</span> <span class="string">表1 left join 表2 on 关联条件 </span></span><br><span class="line"><span class="attr">where</span> <span class="string">筛选条件</span></span><br><span class="line"><span class="meta">二</span> <span class="string">：子查询:</span></span><br><span class="line"><span class="meta">概念</span>: <span class="string">一条sql执行的结果为另一条sql执行时的条件</span></span><br><span class="line"><span class="meta">子查询结果</span>:<span class="string"></span></span><br><span class="line"><span class="attr">1</span> <span class="string">单行单列:直接在where后拼接子查询即可</span></span><br><span class="line"><span class="attr">select</span> <span class="string">* from 表名 where 字段 &gt; (子查询)</span></span><br><span class="line"><span class="attr">2</span> <span class="string">多行单列:直接在where后拼接子查询即可</span></span><br><span class="line"><span class="attr">select</span> <span class="string">* from 表名 where 字段 in/all/any (子查询)</span></span><br><span class="line"><span class="attr">3</span> <span class="string">多行多列 注意:将子查询的结果作为临时表查询,</span></span><br><span class="line"><span class="attr">临时表是临时存在的,必须起别名</span></span><br></pre></td></tr></table></figure>

<h2 id="2-2-内连接"><a href="#2-2-内连接" class="headerlink" title="2.2 内连接"></a>2.2 内连接</h2><p><strong>内连接分类</strong></p>
<hr>
<ol>
<li><p>隐式内连接</p>
</li>
<li><p>显示内连接</p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/1567928226926.png" alt="1567928226926"></p>
</li>
</ol>
<p><strong>语法</strong></p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">内连接查询:</span><br><span class="line">	隐式内连接查询:</span><br><span class="line">		select * from 表1,表2 where 条件;（这里的条件包含关联条件以及筛选条件）</span><br><span class="line">	显示内连接查询</span><br><span class="line">		select * from 表1 inner join 表2 on 关联条件 where 筛选条件;</span><br><span class="line">		select * </span><br><span class="line">			from 表1 inner join 表2 on 关联条件 </span><br><span class="line">			inner join 表3 on 关联条件</span><br><span class="line">			where 筛选条件;</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<p>下面示例是<strong>内连接</strong>的 <strong>隐式内连接</strong>和<strong>显示内连接</strong>查询</p>
<p>1 准备数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE db3;</span><br><span class="line"><span class="comment">-- 创建部门表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dept(</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dept (`name`) <span class="keyword">VALUES</span> (&quot;开发部&quot;),(&quot;市场部&quot;),(&quot;财务部&quot;); </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建员工表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">  NAME <span class="type">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">  gender <span class="type">CHAR</span>(<span class="number">1</span>),   <span class="comment">-- 性别</span></span><br><span class="line">  salary <span class="keyword">DOUBLE</span>,   <span class="comment">-- 工资</span></span><br><span class="line">  join_date <span class="type">DATE</span>,  <span class="comment">-- 入职日期</span></span><br><span class="line">  dept_id <span class="type">INT</span>,</span><br><span class="line">  <span class="keyword">FOREIGN</span> KEY (dept_id) <span class="keyword">REFERENCES</span> dept(id) <span class="comment">-- 外键，关联部门表(部门表的主键)</span></span><br><span class="line">);  </span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp(NAME,gender,salary,join_date,dept_id) <span class="keyword">VALUES</span>(<span class="string">&#x27;孙悟空&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">7200</span>,<span class="string">&#x27;2013-02-24&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp(NAME,gender,salary,join_date,dept_id) <span class="keyword">VALUES</span>(<span class="string">&#x27;猪八戒&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">3600</span>,<span class="string">&#x27;2010-12-02&#x27;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp(NAME,gender,salary,join_date,dept_id) <span class="keyword">VALUES</span>(<span class="string">&#x27;唐僧&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">9000</span>,<span class="string">&#x27;2008-08-08&#x27;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp(NAME,gender,salary,join_date,dept_id) <span class="keyword">VALUES</span>(<span class="string">&#x27;白骨精&#x27;</span>,<span class="string">&#x27;女&#x27;</span>,<span class="number">5000</span>,<span class="string">&#x27;2015-10-07&#x27;</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp(NAME,gender,salary,join_date,dept_id) <span class="keyword">VALUES</span>(<span class="string">&#x27;蜘蛛精&#x27;</span>,<span class="string">&#x27;女&#x27;</span>,<span class="number">4500</span>,<span class="string">&#x27;2011-03-14&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<p>2 需求：查询唐僧的信息，显示员工id，姓名，性别，工资和所在的部门名称</p>
<ol>
<li>确定查询哪些表</li>
<li>确定表连接条件，员工表.dept_id = 部门表.id 的数据才是有效的</li>
<li>确定查询条件，我们查询的是唐僧的信息，员工表.name=’唐僧’</li>
<li>确定查询字段，查询唐僧的信息，显示员工id，姓名，性别，工资和所在的部门名称</li>
<li>我们发现写表名有点长，可以给表取别名，显示的字段名也使用别名</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--1 隐式内连接查询</span></span><br><span class="line">#<span class="number">1.</span>确定查询的表 emp dept</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp,dept;</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>确定表与表的关联条件  emp.dept_id <span class="operator">=</span> dept.id</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp,dept <span class="keyword">WHERE</span> emp.dept_id <span class="operator">=</span> dept.id;</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>确定查询条件</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp,dept <span class="keyword">WHERE</span> emp.dept_id <span class="operator">=</span> dept.id <span class="keyword">AND</span> emp.name<span class="operator">=</span>&quot;唐僧&quot;;</span><br><span class="line"></span><br><span class="line">#<span class="number">4.</span>确定查询结果字段  员工id，姓名，性别，工资和所在的部门名称</span><br><span class="line"><span class="keyword">SELECT</span> emp.id,emp.name,emp.`salary`,emp.`gender`,dept.`name` </span><br><span class="line">	<span class="keyword">FROM</span> emp,dept <span class="keyword">WHERE</span> emp.dept_id <span class="operator">=</span> dept.id <span class="keyword">AND</span> emp.name<span class="operator">=</span>&quot;唐僧&quot;;</span><br><span class="line">#<span class="number">5.</span>别名优化<span class="keyword">sql</span></span><br><span class="line"><span class="keyword">SELECT</span> e.id,e.name,e.`salary`,e.`gender`,d.`name` </span><br><span class="line">	<span class="keyword">FROM</span> emp e,dept d </span><br><span class="line">	<span class="keyword">WHERE</span> e.dept_id <span class="operator">=</span> d.id <span class="keyword">AND</span> e.name<span class="operator">=</span>&quot;唐僧&quot;;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="comment">--2 显示内连接查询</span></span><br><span class="line">#<span class="number">1.</span>确定查询的表 emp dept</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">INNER</span> <span class="keyword">JOIN</span> dept;</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>确定表与表的关联条件  emp.dept_id <span class="operator">=</span> dept.id <span class="comment">--隐式内连是用where关键字哈</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">INNER</span> <span class="keyword">JOIN</span> dept <span class="keyword">ON</span> emp.dept_id <span class="operator">=</span> dept.id;</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>确定查询条件</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line">	<span class="keyword">FROM</span> emp <span class="keyword">INNER</span> <span class="keyword">JOIN</span> dept </span><br><span class="line">	<span class="keyword">ON</span> emp.dept_id <span class="operator">=</span> dept.id </span><br><span class="line">	<span class="keyword">WHERE</span> emp.name<span class="operator">=</span>&quot;唐僧&quot;;</span><br><span class="line"></span><br><span class="line">#<span class="number">4.</span>确定查询结果字段  员工id，姓名，性别，工资和所在的部门名称</span><br><span class="line"><span class="keyword">SELECT</span> emp.id,emp.name,emp.`salary`,emp.`gender`,dept.`name` </span><br><span class="line">	<span class="keyword">FROM</span> emp <span class="keyword">INNER</span> <span class="keyword">JOIN</span> dept </span><br><span class="line">	<span class="keyword">ON</span> emp.dept_id <span class="operator">=</span> dept.id </span><br><span class="line">	<span class="keyword">WHERE</span> emp.name<span class="operator">=</span>&quot;唐僧&quot;;</span><br><span class="line"></span><br><span class="line"># 别名优化<span class="keyword">sql</span>，表别名，筛选字段也有别名</span><br><span class="line"><span class="keyword">SELECT</span> e.id 号码,e.name 名字,e.`salary` 工资,e.`gender` 性别,d.`name`  部门</span><br><span class="line">	<span class="keyword">FROM</span> emp e <span class="keyword">INNER</span> <span class="keyword">JOIN</span> dept d </span><br><span class="line">	<span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id </span><br><span class="line">	<span class="keyword">WHERE</span> e.name<span class="operator">=</span>&quot;唐僧&quot;;</span><br></pre></td></tr></table></figure>



<h2 id="2-3-外连接"><a href="#2-3-外连接" class="headerlink" title="2.3 外连接"></a>2.3 外连接</h2><p><strong>外连接分类</strong></p>
<hr>
<ol>
<li><p>左外连接</p>
<p>左表中所有的记录都出现在结果中，如果右表没有匹配的记录，使用NULL填充</p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/1567928263577.png" alt="1567928263577"></p>
</li>
<li><p>右外连接</p>
<p>右表中所有的记录都出现在结果中，如果左表没有对应的记录，使用NULL填充</p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/1567928322473.png" alt="1567928322473"></p>
</li>
</ol>
<p><strong>语法</strong></p>
<hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">外连接查询:（无论是哪边的表为主，反正左边表显示在左边，右边表显示在右边）</span><br><span class="line">	左外连接查询:</span><br><span class="line">		以<span class="keyword">join</span>左边的表为主,查询其所有内容,根据条件查询右边的表,</span><br><span class="line">		将满足条件的右表数据查询出来,如果没有满足条件的数据则填充<span class="keyword">null</span></span><br><span class="line">		<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 表<span class="number">1</span> <span class="keyword">left</span> <span class="keyword">join</span> 表<span class="number">2</span> <span class="keyword">on</span> 关联条件 <span class="keyword">where</span> 筛选条件;</span><br><span class="line">	右外连接查询:</span><br><span class="line">		以<span class="keyword">join</span>右边的表为主,查询其所有内容,根据条件查询左边的表,</span><br><span class="line">		将满足条件的左边数据查询出来,如果没有满足条件的数据则填充<span class="keyword">null</span></span><br><span class="line">		<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 表<span class="number">1</span> <span class="keyword">right</span> <span class="keyword">join</span> 表<span class="number">2</span> <span class="keyword">on</span> 关联条件 <span class="keyword">where</span> 筛选条件;</span><br></pre></td></tr></table></figure>

<p><strong>应用</strong></p>
<hr>
<p><strong>左外连接</strong></p>
<p>需求：查询所有的部门（<strong>部门表为主表，用的左外连接，因此部门表放在左边</strong>），以及该部门下面的员工</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 添加一个销售部，暂时还没有员工（dept的id自增，为4）</span></span><br><span class="line"><span class="comment">-- 而员工表中的dept_id没有4哈，因此销售部没人。</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept (name) <span class="keyword">values</span> (<span class="string">&#x27;销售部&#x27;</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用内连接查询，缺少销售部</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept d <span class="keyword">inner</span> <span class="keyword">join</span> emp e <span class="keyword">on</span> d.id <span class="operator">=</span> e.dept_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用左外连接查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept d <span class="keyword">left</span> <span class="keyword">join</span> emp e <span class="keyword">on</span> d.id <span class="operator">=</span> e.dept_id;</span><br><span class="line"><span class="comment">-- 跟内连接的不同：虽然主表中的销售部没人，但是依然把数据展现出来。</span></span><br></pre></td></tr></table></figure>



<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/Snipaste_2019-08-15_10-47-04.png" alt="Snipaste_2019-08-15_10-47-04"></p>
<p><strong>右外连接</strong></p>
<p>需求：查询所有员工，以及员工所属的部门</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 在员工表中增加一个员工:&#x27;沙僧&#x27;,&#x27;男&#x27;,6666,&#x27;2013-02-24&#x27;,null</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;沙僧&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">6666</span>,<span class="string">&#x27;2013-02-24&#x27;</span>,<span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用内连接查询 </span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept d <span class="keyword">inner</span> <span class="keyword">join</span> emp e <span class="keyword">on</span> d.id <span class="operator">=</span> e.dept_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用右外连接查询 </span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept d <span class="keyword">right</span> <span class="keyword">join</span> emp e <span class="keyword">on</span> d.id <span class="operator">=</span> e.dept_id;</span><br></pre></td></tr></table></figure>

<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/Snipaste_2019-08-15_10-53-12.png" alt="Snipaste_2019-08-15_10-53-12"></p>
<p><strong>代码练习</strong> </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需求:查询所有的部门，以及该部门下面的员工</span></span><br><span class="line"><span class="comment">-- 左外连</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dept d <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> emp e <span class="keyword">ON</span> d.`id`<span class="operator">=</span>e.`dept_id`;</span><br><span class="line"><span class="comment">-- 右外连</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp e <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> dept d <span class="keyword">ON</span> d.`id`<span class="operator">=</span>e.`dept_id`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 需求:查询所有的员工信息，以及该员工所在的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> dept d <span class="keyword">ON</span> d.`id`<span class="operator">=</span>e.`dept_id`;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dept d <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> emp e <span class="keyword">ON</span> d.`id`<span class="operator">=</span>e.`dept_id`;</span><br></pre></td></tr></table></figure>



<h2 id="2-4-子查询"><a href="#2-4-子查询" class="headerlink" title="2.4 子查询"></a>2.4 子查询</h2><p><strong>什么是子查询</strong>：<strong>将一个查询的结果做为另一个查询的条件</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这是一种查询语句的**嵌套**，嵌套的SQL查询称为子查询。</span><br><span class="line">如果使用子查询必须要**使用括号**</span><br></pre></td></tr></table></figure>

<p><strong>子查询分类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>单行单列</span><br><span class="line"><span class="number">2</span>多行单列</span><br><span class="line"><span class="number">3</span>多行多列</span><br></pre></td></tr></table></figure>



<h3 id="2-4-1-单行单列"><a href="#2-4-1-单行单列" class="headerlink" title="2.4.1 单行单列"></a>2.4.1 单行单列</h3><p><strong>效果图</strong></p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/Snipaste_2019-08-15_10-56-26.png" alt="Snipaste_2019-08-15_10-56-26"></p>
<p><strong>语法</strong></p>
<hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 如果子查询是单行单列，父查询使用比较运算符：&gt; &lt; = (子查询的结果)</span></span><br></pre></td></tr></table></figure>

<p><strong>应用</strong></p>
<hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1 查询工资最高的员工信息</span></span><br><span class="line">    <span class="comment">--  查询最高工资是多少</span></span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">max</span>(salary) <span class="keyword">from</span> emp; </span><br><span class="line"></span><br><span class="line">    <span class="comment">--  查询最高工资的员工信息</span></span><br><span class="line">    <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> salary<span class="operator">=</span></span><br><span class="line">    (<span class="keyword">select</span> <span class="built_in">max</span>(salary) <span class="keyword">from</span> emp);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2 查询工资大于&quot;蜘蛛精&quot;的员工</span></span><br><span class="line">    <span class="comment">--  查询蜘蛛精的工资是多少</span></span><br><span class="line">    <span class="keyword">select</span> salary <span class="keyword">from</span> emp <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;蜘蛛精&#x27;</span>;</span><br><span class="line">    <span class="comment">--  查询大于这个工资的员工</span></span><br><span class="line">    <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> salary <span class="operator">&gt;</span> </span><br><span class="line">    (<span class="keyword">select</span> salary <span class="keyword">from</span> emp <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;蜘蛛精&#x27;</span>);</span><br></pre></td></tr></table></figure>



<h3 id="2-4-2-多行单列"><a href="#2-4-2-多行单列" class="headerlink" title="2.4.2 多行单列"></a>2.4.2 多行单列</h3><p><strong>效果图</strong></p>
<hr>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/Snipaste_2019-08-15_11-01-16.png" alt="Snipaste_2019-08-15_11-01-16"></p>
<p><strong>语法</strong></p>
<hr>
<p>多行单列认为是一个数组，父查询一般使用<strong>in、any 、all</strong>关键字</p>
<table>
<thead>
<tr>
<th>关键字</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>in</td>
<td>查询包含在in条件中的所有数据</td>
</tr>
<tr>
<td>all</td>
<td>可以与&gt;、&lt;结合起来使用，分别表示大于、小于其中的<strong>所有数据</strong>时条件为真</td>
</tr>
<tr>
<td>any</td>
<td>可以与&gt;、&lt;结合起来使用，分别表示大于、小于其中的<strong>任何一个数据</strong>时条件为真</td>
</tr>
</tbody></table>
<p>体会一下all  跟 any的区别哈！！！比如：</p>
<blockquote>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&lt;all()</span>:<span class="string">小于全部，则小于最低那个数。</span></span><br><span class="line"><span class="meta">&gt;&gt;all()</span>:<span class="string">则表示大于最大那个。</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&lt;any()</span>:<span class="string">小于任意一个就够了，则边界条件为：小于最大那个。</span></span><br><span class="line"><span class="meta">&gt;&gt;any()</span>:<span class="string">大于任意一个就够了，则边界条件为：大于最小那个。</span></span><br><span class="line"></span><br><span class="line"><span class="attr">&gt;感觉可以用单行单列来替换这里的多行单列的两个关键字。</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>应用</strong></p>
<hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- </span></span><br><span class="line"><span class="comment">-- 1 in 关键字：查询工资大于5000的员工，来自于哪些部门，得到部门的名字</span></span><br><span class="line">    <span class="comment">--  先查询大于5000的员工所在的部门id</span></span><br><span class="line">    <span class="keyword">select</span> dept_id <span class="keyword">from</span> emp <span class="keyword">where</span> salary <span class="operator">&gt;</span> <span class="number">5000</span>;</span><br><span class="line">    <span class="comment">--  再查询在这些部门id中部门的名字</span></span><br><span class="line">    <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept <span class="keyword">where</span> id </span><br><span class="line">    <span class="keyword">in</span>(<span class="keyword">select</span> dept_id <span class="keyword">from</span> emp <span class="keyword">where</span> salary <span class="operator">&gt;</span> <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2 all关键字：查询工资高于在1号部门工作的所有员工的员工信息</span></span><br><span class="line">    <span class="comment">--  查询1号部门所有员工的工资，得到多行单列</span></span><br><span class="line">    <span class="keyword">select</span> salary <span class="keyword">from</span> emp <span class="keyword">where</span> dept_id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line">    <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> salary <span class="operator">&gt;</span> </span><br><span class="line">    <span class="keyword">all</span>(<span class="keyword">select</span> salary <span class="keyword">from</span> emp <span class="keyword">where</span> dept_id<span class="operator">=</span><span class="number">1</span>);</span><br><span class="line">	<span class="comment">-- 也可以用如下的单行单列替换哈。</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> salary <span class="operator">&gt;</span></span><br><span class="line">	(<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> dept_id<span class="operator">=</span><span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3 any关键字：查询工资高于在1号部门工作的所有员工最低工资的员工信息</span></span><br><span class="line">    <span class="comment">-- 查询1号部门所有员工的工资，得到多行单列</span></span><br><span class="line">    <span class="keyword">select</span> salary <span class="keyword">from</span> emp <span class="keyword">where</span> dept_id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line">    <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> salary <span class="operator">&gt;</span> </span><br><span class="line">    <span class="keyword">any</span> (<span class="keyword">select</span> salary <span class="keyword">from</span> emp <span class="keyword">where</span> dept_id<span class="operator">=</span><span class="number">1</span>);</span><br><span class="line">    <span class="comment">-- 也可以用如下的单行单列来查询哈！</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> </span><br><span class="line">	(<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary)<span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h3 id="2-4-3-多行多列"><a href="#2-4-3-多行多列" class="headerlink" title="2.4.3 多行多列"></a>2.4.3 多行多列</h3><p><strong>效果图</strong></p>
<hr>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/Snipaste_2019-08-15_11-16-14.png" alt="Snipaste_2019-08-15_11-16-14"></p>
<p><strong>特点</strong></p>
<hr>
<p>子查询可以认为它是一张虚拟表，<strong>可以使用表连接再次进行多表查询</strong></p>
<p>如果访问子查询表字段，<strong>必须为子查询表取别名</strong>(为方便记忆或者为简介，建议都取别名吧），否则无法访问表中的字段。</p>
<p><strong>应用</strong></p>
<hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询出2011年以后入职的员工信息，包括部门名称</span></span><br><span class="line"><span class="comment">-- 1. 在员工表中查询2011-1-1以后入职的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> join_date <span class="operator">&gt;</span> <span class="string">&#x27;2011-1-1&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 查询出2011年以后入职的员工信息，包括部门名称</span></span><br><span class="line">	<span class="comment">-- 内部显示连接</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dept d <span class="keyword">INNER</span> <span class="keyword">JOIN</span> </span><br><span class="line">(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> join_date <span class="operator">&gt;</span> <span class="string">&#x27;2011-1-1&#x27;</span>) emp_ls </span><br><span class="line"><span class="keyword">ON</span> d.id <span class="operator">=</span> emp_ls.dept_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 使用右连接，</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dept d <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> </span><br><span class="line">(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> join_date <span class="operator">&gt;</span> <span class="string">&#x27;2011-1-1&#x27;</span>) emp_ls </span><br><span class="line"><span class="keyword">ON</span> d.id <span class="operator">=</span> emp_ls.dept_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4 使用左连接。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> </span><br><span class="line">(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> join_date <span class="operator">&gt;</span> &quot;2011-01-01&quot;) <span class="keyword">AS</span> emp_ls</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> dept d</span><br><span class="line"><span class="keyword">ON</span> emp_ls.dept_id <span class="operator">=</span> d.id;</span><br></pre></td></tr></table></figure>

<h1 id="第三章-多表查询案例"><a href="#第三章-多表查询案例" class="headerlink" title="第三章 多表查询案例"></a>第三章 多表查询案例</h1><p>​    我们在公司开发中，根据不同的业务需求往往需要通过2张及以上的表中去查询需要的数据。所以我们有必要学习2张及以上的表的查询。其实不管是几张表的查询，都是有规律可循的。</p>
<h2 id="3-1-准备数据"><a href="#3-1-准备数据" class="headerlink" title="3.1 准备数据"></a>3.1 准备数据</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1 部门表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dept (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY <span class="keyword">PRIMARY</span> KEY, <span class="comment">-- 部门id</span></span><br><span class="line">  dname <span class="type">VARCHAR</span>(<span class="number">50</span>), <span class="comment">-- 部门名称</span></span><br><span class="line">  loc <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="comment">-- 部门位置</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加4个部门</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dept(id,dname,loc) <span class="keyword">VALUES</span> </span><br><span class="line">(<span class="number">10</span>,<span class="string">&#x27;教研部&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">(<span class="number">20</span>,<span class="string">&#x27;学工部&#x27;</span>,<span class="string">&#x27;上海&#x27;</span>),</span><br><span class="line">(<span class="number">30</span>,<span class="string">&#x27;销售部&#x27;</span>,<span class="string">&#x27;广州&#x27;</span>),</span><br><span class="line">(<span class="number">40</span>,<span class="string">&#x27;财务部&#x27;</span>,<span class="string">&#x27;深圳&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2 职务表，职务名称，职务描述</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> job (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  jname <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  description <span class="type">VARCHAR</span>(<span class="number">50</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加4个职务</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> job (id, jname, description) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;董事长&#x27;</span>, <span class="string">&#x27;管理整个公司，接单&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;经理&#x27;</span>, <span class="string">&#x27;管理部门员工&#x27;</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;销售员&#x27;</span>, <span class="string">&#x27;向客人推销产品&#x27;</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;文员&#x27;</span>, <span class="string">&#x27;使用办公软件&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3 员工表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY, <span class="comment">-- 员工id</span></span><br><span class="line">  ename <span class="type">VARCHAR</span>(<span class="number">50</span>), <span class="comment">-- 员工姓名</span></span><br><span class="line">  job_id <span class="type">INT</span>, <span class="comment">-- 职务id</span></span><br><span class="line">  mgr <span class="type">INT</span> , <span class="comment">-- 上级领导</span></span><br><span class="line">  joindate <span class="type">DATE</span>, <span class="comment">-- 入职日期</span></span><br><span class="line">  salary <span class="type">DECIMAL</span>(<span class="number">7</span>,<span class="number">2</span>), <span class="comment">-- 工资</span></span><br><span class="line">  bonus <span class="type">DECIMAL</span>(<span class="number">7</span>,<span class="number">2</span>), <span class="comment">-- 奖金</span></span><br><span class="line">  dept_id <span class="type">INT</span>, <span class="comment">-- 所在部门编号</span></span><br><span class="line">  <span class="keyword">CONSTRAINT</span> emp_jobid_ref_job_id_fk <span class="keyword">FOREIGN</span> KEY (job_id) <span class="keyword">REFERENCES</span> job (id),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> emp_deptid_ref_dept_id_fk <span class="keyword">FOREIGN</span> KEY (dept_id) <span class="keyword">REFERENCES</span> dept (id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加员工</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp(id,ename,job_id,mgr,joindate,salary,bonus,dept_id) <span class="keyword">VALUES</span> </span><br><span class="line">(<span class="number">1001</span>,<span class="string">&#x27;孙悟空&#x27;</span>,<span class="number">4</span>,<span class="number">1004</span>,<span class="string">&#x27;2000-12-17&#x27;</span>,<span class="string">&#x27;8000.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">1002</span>,<span class="string">&#x27;卢俊义&#x27;</span>,<span class="number">3</span>,<span class="number">1006</span>,<span class="string">&#x27;2001-02-20&#x27;</span>,<span class="string">&#x27;16000.00&#x27;</span>,<span class="string">&#x27;3000.00&#x27;</span>,<span class="number">30</span>),</span><br><span class="line">(<span class="number">1003</span>,<span class="string">&#x27;林冲&#x27;</span>,<span class="number">3</span>,<span class="number">1006</span>,<span class="string">&#x27;2001-02-22&#x27;</span>,<span class="string">&#x27;12500.00&#x27;</span>,<span class="string">&#x27;5000.00&#x27;</span>,<span class="number">30</span>),</span><br><span class="line">(<span class="number">1004</span>,<span class="string">&#x27;唐僧&#x27;</span>,<span class="number">2</span>,<span class="number">1009</span>,<span class="string">&#x27;2001-04-02&#x27;</span>,<span class="string">&#x27;29750.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">1005</span>,<span class="string">&#x27;李逵&#x27;</span>,<span class="number">4</span>,<span class="number">1006</span>,<span class="string">&#x27;2001-09-28&#x27;</span>,<span class="string">&#x27;12500.00&#x27;</span>,<span class="string">&#x27;14000.00&#x27;</span>,<span class="number">30</span>),</span><br><span class="line">(<span class="number">1006</span>,<span class="string">&#x27;宋江&#x27;</span>,<span class="number">2</span>,<span class="number">1009</span>,<span class="string">&#x27;2001-05-01&#x27;</span>,<span class="string">&#x27;28500.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">30</span>),</span><br><span class="line">(<span class="number">1007</span>,<span class="string">&#x27;刘备&#x27;</span>,<span class="number">2</span>,<span class="number">1009</span>,<span class="string">&#x27;2001-09-01&#x27;</span>,<span class="string">&#x27;24500.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">10</span>),</span><br><span class="line">(<span class="number">1008</span>,<span class="string">&#x27;猪八戒&#x27;</span>,<span class="number">4</span>,<span class="number">1004</span>,<span class="string">&#x27;2007-04-19&#x27;</span>,<span class="string">&#x27;30000.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">1009</span>,<span class="string">&#x27;罗贯中&#x27;</span>,<span class="number">1</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;2001-11-17&#x27;</span>,<span class="string">&#x27;50000.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">10</span>),</span><br><span class="line">(<span class="number">1010</span>,<span class="string">&#x27;吴用&#x27;</span>,<span class="number">3</span>,<span class="number">1006</span>,<span class="string">&#x27;2001-09-08&#x27;</span>,<span class="string">&#x27;15000.00&#x27;</span>,<span class="string">&#x27;0.00&#x27;</span>,<span class="number">30</span>),</span><br><span class="line">(<span class="number">1011</span>,<span class="string">&#x27;沙僧&#x27;</span>,<span class="number">4</span>,<span class="number">1004</span>,<span class="string">&#x27;2007-05-23&#x27;</span>,<span class="string">&#x27;11000.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">1012</span>,<span class="string">&#x27;李逵&#x27;</span>,<span class="number">4</span>,<span class="number">1006</span>,<span class="string">&#x27;2001-12-03&#x27;</span>,<span class="string">&#x27;9500.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">30</span>),</span><br><span class="line">(<span class="number">1013</span>,<span class="string">&#x27;小白龙&#x27;</span>,<span class="number">4</span>,<span class="number">1004</span>,<span class="string">&#x27;2001-12-03&#x27;</span>,<span class="string">&#x27;30000.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">1014</span>,<span class="string">&#x27;关羽&#x27;</span>,<span class="number">4</span>,<span class="number">1007</span>,<span class="string">&#x27;2002-01-23&#x27;</span>,<span class="string">&#x27;13000.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4 工资等级表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> salarygrade (</span><br><span class="line">  grade <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  losalary <span class="type">INT</span>,</span><br><span class="line">  hisalary <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加5个工资等级</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> salarygrade(grade,losalary,hisalary) <span class="keyword">VALUES</span> </span><br><span class="line">(<span class="number">1</span>,<span class="number">7000</span>,<span class="number">12000</span>),</span><br><span class="line">(<span class="number">2</span>,<span class="number">12010</span>,<span class="number">14000</span>),</span><br><span class="line">(<span class="number">3</span>,<span class="number">14010</span>,<span class="number">20000</span>),</span><br><span class="line">(<span class="number">4</span>,<span class="number">20010</span>,<span class="number">30000</span>),</span><br><span class="line">(<span class="number">5</span>,<span class="number">30010</span>,<span class="number">99990</span>);</span><br></pre></td></tr></table></figure>

<p>分析4张表的关系：通过4张表可以查出一个员工的所有信息<br><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A201.png" alt="多表查询01"></p>
<h2 id="3-2-练习"><a href="#3-2-练习" class="headerlink" title="3.2 练习"></a>3.2 练习</h2><h3 id="3-2-1-练习1"><a href="#3-2-1-练习1" class="headerlink" title="3.2.1 练习1"></a>3.2.1 练习1</h3><p>查询所有员工信息。显示员工编号，员工姓名，工资，职务名称，职务描述</p>
<p>具体操作：<br>   1.确定要查询哪些表：emp e, job j</p>
   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp e <span class="keyword">INNER</span> <span class="keyword">JOIN</span> job j;</span><br></pre></td></tr></table></figure>

<p>   <img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A202.png"></p>
<p>   2.确定表连接条件： e.job_id=j.id</p>
   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp e <span class="keyword">INNER</span> <span class="keyword">JOIN</span> job j <span class="keyword">ON</span> e.job_id<span class="operator">=</span>j.id;</span><br></pre></td></tr></table></figure>


<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A204.png" alt="多表查询04"></p>
<p>   3.确定查询字段：员工编号，员工姓名，工资，职务名称，职务描述</p>
   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.`id`, e.`ename`, e.`salary`, j.`jname`, j.`description` <span class="keyword">FROM</span> emp e <span class="keyword">INNER</span> <span class="keyword">JOIN</span> job j <span class="keyword">ON</span> e.job_id<span class="operator">=</span>j.id;</span><br></pre></td></tr></table></figure>




<h3 id="3-2-2-练习2"><a href="#3-2-2-练习2" class="headerlink" title="3.2.2 练习2"></a>3.2.2 练习2</h3><p>查询所有员工信息。显示员工编号，员工姓名，工资，职务名称，职务描述，部门名称，部门位置</p>
<p>具体操作：<br>      1. 确定要查询哪些表，emp e, job j, dept d</p>
   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp e <span class="keyword">INNER</span> <span class="keyword">JOIN</span> job j <span class="keyword">INNER</span> <span class="keyword">JOIN</span> dept d;</span><br></pre></td></tr></table></figure>

<p>   <img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A206.png" alt="多表查询06"></p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A207.png" alt="多表查询07"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span> 确定表连接条件 e.job_id<span class="operator">=</span>j.id <span class="keyword">and</span> e.dept_id<span class="operator">=</span>d.id</span><br></pre></td></tr></table></figure>

   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp e <span class="keyword">INNER</span> <span class="keyword">JOIN</span> job j <span class="keyword">INNER</span> <span class="keyword">JOIN</span> dept d <span class="keyword">ON</span> e.job_id<span class="operator">=</span>j.id <span class="keyword">AND</span> e.dept_id<span class="operator">=</span>d.id;</span><br></pre></td></tr></table></figure>

<p>  <img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A208.png" alt="多表查询08"></p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A209.png" alt="多表查询09"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.</span> 确定查询字段：员工编号，员工姓名，工资，职务名称，职务描述，部门名称，部门位置</span><br></pre></td></tr></table></figure>

   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.`id`, e.`ename`, e.`salary`, j.`jname`, j.`description`, d.`dname`, d.`loc` <span class="keyword">FROM</span> emp e <span class="keyword">INNER</span> <span class="keyword">JOIN</span> job j <span class="keyword">INNER</span> <span class="keyword">JOIN</span> dept d <span class="keyword">ON</span> e.job_id<span class="operator">=</span>j.id <span class="keyword">AND</span> e.dept_id<span class="operator">=</span>d.id;</span><br></pre></td></tr></table></figure>



<h3 id="3-2-3-练习3"><a href="#3-2-3-练习3" class="headerlink" title="3.2.3 练习3"></a>3.2.3 练习3</h3><p>查询所有员工信息。显示员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级</p>
<p>具体操作：<br>      1. 确定要查询哪些表，emp e, job j, dept d, salarygrade s</p>
   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp e <span class="keyword">INNER</span> <span class="keyword">JOIN</span> job j <span class="keyword">INNER</span> <span class="keyword">JOIN</span> dept d <span class="keyword">INNER</span> <span class="keyword">JOIN</span> salarygrade s;</span><br></pre></td></tr></table></figure>

<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A211.png" alt="多表查询11"></p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A212.png" alt="多表查询12"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span> 确定表连接条件 e.job_id=j.id and e.dept_id=d.id and e.salary between s.losalary and hisalary</span><br></pre></td></tr></table></figure>

   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp e <span class="keyword">INNER</span> </span><br><span class="line"><span class="keyword">JOIN</span> job j <span class="keyword">INNER</span> <span class="keyword">JOIN</span> dept d <span class="keyword">INNER</span> <span class="keyword">JOIN</span> salarygrade s </span><br><span class="line"><span class="keyword">ON</span> e.job_id<span class="operator">=</span>j.id <span class="keyword">AND</span> e.dept_id<span class="operator">=</span>d.id <span class="keyword">AND</span> e.salary </span><br><span class="line"><span class="keyword">BETWEEN</span> s.losalary <span class="keyword">AND</span> hisalary;</span><br></pre></td></tr></table></figure>

<p>   <img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A213.png" alt="多表查询13"></p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A214.png" alt="多表查询14"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.</span> 确定查询字段：员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级</span><br></pre></td></tr></table></figure>

   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.`ename`, e.`salary`, j.`jname`, j.`description`, d.`dname`, d.`loc`, s.`grade` </span><br><span class="line"><span class="keyword">FROM</span> emp e <span class="keyword">INNER</span> <span class="keyword">JOIN</span> job j <span class="keyword">INNER</span> <span class="keyword">JOIN</span> dept d <span class="keyword">INNER</span> <span class="keyword">JOIN</span> salarygrade s </span><br><span class="line"><span class="keyword">ON</span> e.job_id<span class="operator">=</span>j.id <span class="keyword">AND</span> e.dept_id<span class="operator">=</span>d.id <span class="keyword">AND</span> e.salary </span><br><span class="line"><span class="keyword">BETWEEN</span> s.losalary <span class="keyword">AND</span> hisalary;</span><br></pre></td></tr></table></figure>

<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A215.png" alt="多表查询15"></p>
<h4 id="3-2-3-1-多表查询规律总结"><a href="#3-2-3-1-多表查询规律总结" class="headerlink" title="3.2.3.1 多表查询规律总结"></a>3.2.3.1 多表查询规律总结</h4><ol>
<li>不管我们查询几张表，表连接查询会产出笛卡尔积，我们需要消除笛卡尔积，拿到正确的数据。我们需要找到表与表之间通过哪个字段关联起来的（通常是<code>外键=主键</code>）</li>
<li>消除笛卡尔积规律：2张表需要1个条件，3张表需要2个条件，4张表需要3个条件。（条件数量=表的数量-1），每张表都要参与进来</li>
<li>多表连接查询步骤：<br>3.1. 确定要查询哪些表<br>3.2. 确定表连接条件<br>3.3. 确定查询字段</li>
</ol>
<h3 id="3-2-4-练习4"><a href="#3-2-4-练习4" class="headerlink" title="3.2.4 练习4"></a>3.2.4 练习4</h3><p>查询经理的信息。显示员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级</p>
<p>具体操作：<br>      1. 确定要查询哪些表，emp e, job j, dept d, salarygrade s</p>
   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp e <span class="keyword">INNER</span> <span class="keyword">JOIN</span> job j <span class="keyword">INNER</span> <span class="keyword">JOIN</span> dept d <span class="keyword">INNER</span> <span class="keyword">JOIN</span> salarygrade s;</span><br></pre></td></tr></table></figure>

<p>   <img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A211.png" alt="多表查询11"></p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A212.png" alt="多表查询12"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span> 确定表连接条件 e.job_id<span class="operator">=</span>j.id <span class="keyword">and</span> e.dept_id<span class="operator">=</span>d.id <span class="keyword">and</span> e.salary <span class="keyword">between</span> s.losalary <span class="keyword">and</span> hisalary</span><br></pre></td></tr></table></figure>

   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp e <span class="keyword">INNER</span> <span class="keyword">JOIN</span> job j <span class="keyword">INNER</span> <span class="keyword">JOIN</span> dept d <span class="keyword">INNER</span> <span class="keyword">JOIN</span> salarygrade s <span class="keyword">ON</span> e.job_id<span class="operator">=</span>j.id <span class="keyword">AND</span> e.dept_id<span class="operator">=</span>d.id <span class="keyword">AND</span> e.salary <span class="keyword">BETWEEN</span> s.losalary <span class="keyword">AND</span> hisalary;</span><br></pre></td></tr></table></figure>

<p>   <img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A213.png" alt="多表查询13"></p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A214.png" alt="多表查询14"></p>
<p>   额外条件：只需要查询经理的信息（j.jname=’经理’）<br>   <img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A216.png" alt="多表查询16"></p>
<pre><code>  3. 确定查询字段：员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级
</code></pre>
   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.`ename`, e.`salary`, j.`jname`, j.`description`, d.`dname`, d.`loc`, s.`grade` </span><br><span class="line"><span class="keyword">FROM</span> emp e <span class="keyword">INNER</span> <span class="keyword">JOIN</span> job j <span class="keyword">INNER</span> <span class="keyword">JOIN</span> dept d <span class="keyword">INNER</span> <span class="keyword">JOIN</span> salarygrade s </span><br><span class="line"><span class="keyword">ON</span> e.job_id<span class="operator">=</span>j.id <span class="keyword">AND</span> e.dept_id<span class="operator">=</span>d.id <span class="keyword">AND</span> e.salary </span><br><span class="line"><span class="keyword">BETWEEN</span> s.losalary <span class="keyword">AND</span> hisalary <span class="keyword">AND</span> j.jname<span class="operator">=</span><span class="string">&#x27;经理&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A217.png" alt="多表查询17"></p>
<h3 id="3-2-5-练习5"><a href="#3-2-5-练习5" class="headerlink" title="3.2.5 练习5"></a>3.2.5 练习5</h3><p>查询出部门编号、部门名称、部门位置、部门人数</p>
<p>具体操作：<br>      1. 去员工表中找到每个部门的人数和部门id</p>
   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> dept_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> emp <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id;</span><br></pre></td></tr></table></figure>

<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A218.png" alt="多表查询18"></p>
<pre><code>  2. 再和部门表连接查询
</code></pre>
   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dept d <span class="keyword">INNER</span> <span class="keyword">JOIN</span> (<span class="keyword">SELECT</span> dept_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> emp <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id) e <span class="keyword">ON</span> e.dept_id<span class="operator">=</span>d.`id`;</span><br></pre></td></tr></table></figure>

<p>  <img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A219.png" alt="多表查询19"><br>   <img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A220.png" alt="多表查询20"></p>
<pre><code>  3. 显示对应的字段
</code></pre>
   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> d.`id`, d.dname, d.`loc`, e.total 部门人数 </span><br><span class="line"><span class="keyword">FROM</span> dept d <span class="keyword">INNER</span> <span class="keyword">JOIN</span> (<span class="keyword">SELECT</span> dept_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) total </span><br><span class="line"><span class="keyword">FROM</span> emp <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id) e <span class="keyword">ON</span> e.dept_id<span class="operator">=</span>d.`id`;</span><br></pre></td></tr></table></figure>

<p> <img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A221.png" alt="多表查询21"><br>   最终效果：<br>  <img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A222.png" alt="多表查询22"></p>
<h2 id="代码整合"><a href="#代码整合" class="headerlink" title="代码整合"></a>代码整合</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 部门表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dept (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY <span class="keyword">PRIMARY</span> KEY, <span class="comment">-- 部门id</span></span><br><span class="line">  dname <span class="type">VARCHAR</span>(<span class="number">50</span>), <span class="comment">-- 部门名称</span></span><br><span class="line">  loc <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="comment">-- 部门位置</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加4个部门</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dept(id,dname,loc) <span class="keyword">VALUES</span> </span><br><span class="line">(<span class="number">10</span>,<span class="string">&#x27;教研部&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">(<span class="number">20</span>,<span class="string">&#x27;学工部&#x27;</span>,<span class="string">&#x27;上海&#x27;</span>),</span><br><span class="line">(<span class="number">30</span>,<span class="string">&#x27;销售部&#x27;</span>,<span class="string">&#x27;广州&#x27;</span>),</span><br><span class="line">(<span class="number">40</span>,<span class="string">&#x27;财务部&#x27;</span>,<span class="string">&#x27;深圳&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 职务表，职务名称，职务描述</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> job (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  jname <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  description <span class="type">VARCHAR</span>(<span class="number">50</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加4个职务</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> job (id, jname, description) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;董事长&#x27;</span>, <span class="string">&#x27;管理整个公司，接单&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;经理&#x27;</span>, <span class="string">&#x27;管理部门员工&#x27;</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;销售员&#x27;</span>, <span class="string">&#x27;向客人推销产品&#x27;</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;文员&#x27;</span>, <span class="string">&#x27;使用办公软件&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 员工表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY, <span class="comment">-- 员工id</span></span><br><span class="line">  ename <span class="type">VARCHAR</span>(<span class="number">50</span>), <span class="comment">-- 员工姓名</span></span><br><span class="line">  job_id <span class="type">INT</span>, <span class="comment">-- 职务id</span></span><br><span class="line">  mgr <span class="type">INT</span> , <span class="comment">-- 上级领导</span></span><br><span class="line">  joindate <span class="type">DATE</span>, <span class="comment">-- 入职日期</span></span><br><span class="line">  salary <span class="type">DECIMAL</span>(<span class="number">7</span>,<span class="number">2</span>), <span class="comment">-- 工资</span></span><br><span class="line">  bonus <span class="type">DECIMAL</span>(<span class="number">7</span>,<span class="number">2</span>), <span class="comment">-- 奖金</span></span><br><span class="line">  dept_id <span class="type">INT</span>, <span class="comment">-- 所在部门编号</span></span><br><span class="line">  <span class="keyword">CONSTRAINT</span> emp_jobid_ref_job_id_fk <span class="keyword">FOREIGN</span> KEY (job_id) <span class="keyword">REFERENCES</span> job (id),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> emp_deptid_ref_dept_id_fk <span class="keyword">FOREIGN</span> KEY (dept_id) <span class="keyword">REFERENCES</span> dept (id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加员工</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp(id,ename,job_id,mgr,joindate,salary,bonus,dept_id) <span class="keyword">VALUES</span> </span><br><span class="line">(<span class="number">1001</span>,<span class="string">&#x27;孙悟空&#x27;</span>,<span class="number">4</span>,<span class="number">1004</span>,<span class="string">&#x27;2000-12-17&#x27;</span>,<span class="string">&#x27;8000.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">1002</span>,<span class="string">&#x27;卢俊义&#x27;</span>,<span class="number">3</span>,<span class="number">1006</span>,<span class="string">&#x27;2001-02-20&#x27;</span>,<span class="string">&#x27;16000.00&#x27;</span>,<span class="string">&#x27;3000.00&#x27;</span>,<span class="number">30</span>),</span><br><span class="line">(<span class="number">1003</span>,<span class="string">&#x27;林冲&#x27;</span>,<span class="number">3</span>,<span class="number">1006</span>,<span class="string">&#x27;2001-02-22&#x27;</span>,<span class="string">&#x27;12500.00&#x27;</span>,<span class="string">&#x27;5000.00&#x27;</span>,<span class="number">30</span>),</span><br><span class="line">(<span class="number">1004</span>,<span class="string">&#x27;唐僧&#x27;</span>,<span class="number">2</span>,<span class="number">1009</span>,<span class="string">&#x27;2001-04-02&#x27;</span>,<span class="string">&#x27;29750.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">1005</span>,<span class="string">&#x27;李逵&#x27;</span>,<span class="number">4</span>,<span class="number">1006</span>,<span class="string">&#x27;2001-09-28&#x27;</span>,<span class="string">&#x27;12500.00&#x27;</span>,<span class="string">&#x27;14000.00&#x27;</span>,<span class="number">30</span>),</span><br><span class="line">(<span class="number">1006</span>,<span class="string">&#x27;宋江&#x27;</span>,<span class="number">2</span>,<span class="number">1009</span>,<span class="string">&#x27;2001-05-01&#x27;</span>,<span class="string">&#x27;28500.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">30</span>),</span><br><span class="line">(<span class="number">1007</span>,<span class="string">&#x27;刘备&#x27;</span>,<span class="number">2</span>,<span class="number">1009</span>,<span class="string">&#x27;2001-09-01&#x27;</span>,<span class="string">&#x27;24500.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">10</span>),</span><br><span class="line">(<span class="number">1008</span>,<span class="string">&#x27;猪八戒&#x27;</span>,<span class="number">4</span>,<span class="number">1004</span>,<span class="string">&#x27;2007-04-19&#x27;</span>,<span class="string">&#x27;30000.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">1009</span>,<span class="string">&#x27;罗贯中&#x27;</span>,<span class="number">1</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;2001-11-17&#x27;</span>,<span class="string">&#x27;50000.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">10</span>),</span><br><span class="line">(<span class="number">1010</span>,<span class="string">&#x27;吴用&#x27;</span>,<span class="number">3</span>,<span class="number">1006</span>,<span class="string">&#x27;2001-09-08&#x27;</span>,<span class="string">&#x27;15000.00&#x27;</span>,<span class="string">&#x27;0.00&#x27;</span>,<span class="number">30</span>),</span><br><span class="line">(<span class="number">1011</span>,<span class="string">&#x27;沙僧&#x27;</span>,<span class="number">4</span>,<span class="number">1004</span>,<span class="string">&#x27;2007-05-23&#x27;</span>,<span class="string">&#x27;11000.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">1012</span>,<span class="string">&#x27;李逵&#x27;</span>,<span class="number">4</span>,<span class="number">1006</span>,<span class="string">&#x27;2001-12-03&#x27;</span>,<span class="string">&#x27;9500.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">30</span>),</span><br><span class="line">(<span class="number">1013</span>,<span class="string">&#x27;小白龙&#x27;</span>,<span class="number">4</span>,<span class="number">1004</span>,<span class="string">&#x27;2001-12-03&#x27;</span>,<span class="string">&#x27;30000.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">1014</span>,<span class="string">&#x27;关羽&#x27;</span>,<span class="number">4</span>,<span class="number">1007</span>,<span class="string">&#x27;2002-01-23&#x27;</span>,<span class="string">&#x27;13000.00&#x27;</span>,<span class="keyword">NULL</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 工资等级表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> salarygrade (</span><br><span class="line">  grade <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  losalary <span class="type">INT</span>,</span><br><span class="line">  hisalary <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加5个工资等级</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> salarygrade(grade,losalary,hisalary) <span class="keyword">VALUES</span> </span><br><span class="line">(<span class="number">1</span>,<span class="number">7000</span>,<span class="number">12000</span>),</span><br><span class="line">(<span class="number">2</span>,<span class="number">12010</span>,<span class="number">14000</span>),</span><br><span class="line">(<span class="number">3</span>,<span class="number">14010</span>,<span class="number">20000</span>),</span><br><span class="line">(<span class="number">4</span>,<span class="number">20010</span>,<span class="number">30000</span>),</span><br><span class="line">(<span class="number">5</span>,<span class="number">30010</span>,<span class="number">99990</span>);</span><br><span class="line"></span><br><span class="line">练习<span class="number">1</span>:查询所有员工信息。显示员工编号，员工姓名，工资，职务名称，职务描述</span><br><span class="line">#<span class="number">1.</span>确定要查询的表 emp job</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp,job;</span><br><span class="line">#<span class="number">2.</span>确定表之间的关联条件 emp.job_id <span class="operator">=</span> job.id</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp,job <span class="keyword">WHERE</span> emp.job_id <span class="operator">=</span> job.id;</span><br><span class="line">#<span class="number">3.</span>确定查询结果</span><br><span class="line"><span class="keyword">SELECT</span> emp.`id`,emp.`ename`,emp.`salary`,job.`jname`,job.`description` </span><br><span class="line">	<span class="keyword">FROM</span> emp,job <span class="keyword">WHERE</span> emp.job_id <span class="operator">=</span> job.id;</span><br><span class="line"># 别名优化	</span><br><span class="line"><span class="keyword">SELECT</span> e.`id`,e.`ename`,e.`salary`,j.`jname`,j.`description` </span><br><span class="line">	<span class="keyword">FROM</span> emp e,job j <span class="keyword">WHERE</span> e.job_id <span class="operator">=</span> j.id;</span><br><span class="line"># 使用外连接查询</span><br><span class="line"><span class="keyword">SELECT</span> e.`id`,e.`ename`,e.`salary`,j.`jname`,j.`description` </span><br><span class="line">	<span class="keyword">FROM</span> emp e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> job j <span class="keyword">ON</span> e.job_id <span class="operator">=</span> j.id;</span><br><span class="line"></span><br><span class="line">题目<span class="number">2</span>:查询所有员工信息。显示员工编号，员工姓名，工资，职务名称，职务描述，部门名称，部门位置</span><br><span class="line">#<span class="number">1.</span>确定要查询的表 emp job dept</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp,job,dept;</span><br><span class="line">#<span class="number">2.</span>确定表之间的关联条件 emp.job_id <span class="operator">=</span> job.id  emp.dept_id <span class="operator">=</span> dept.id</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp,job,dept <span class="keyword">WHERE</span> emp.job_id <span class="operator">=</span> job.id <span class="keyword">AND</span> emp.dept_id <span class="operator">=</span> dept.id;</span><br><span class="line">#<span class="number">3.</span>确定查询结果</span><br><span class="line"><span class="keyword">SELECT</span> emp.`id`,emp.`ename`,emp.`salary`,job.`jname`,job.`description`,dept.`dname`,dept.`loc`</span><br><span class="line">	<span class="keyword">FROM</span> emp,job,dept <span class="keyword">WHERE</span> emp.job_id <span class="operator">=</span> job.id <span class="keyword">AND</span> emp.dept_id <span class="operator">=</span> dept.id;</span><br><span class="line"># 别名优化</span><br><span class="line"><span class="keyword">SELECT</span> e.`id`,e.`ename`,e.`salary`,j.`jname`,j.`description`,d.`dname`,d.`loc`</span><br><span class="line">	<span class="keyword">FROM</span> emp e,job j,dept d <span class="keyword">WHERE</span> e.job_id <span class="operator">=</span> j.id <span class="keyword">AND</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"># 左外连接</span><br><span class="line"><span class="keyword">SELECT</span> e.`id`,e.`ename`,e.`salary`,j.`jname`,j.`description`,d.`dname`,d.`loc`</span><br><span class="line">	<span class="keyword">FROM</span> emp e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> job j <span class="keyword">ON</span> e.job_id <span class="operator">=</span> j.id</span><br><span class="line">		   <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> dept d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line">题目<span class="number">3</span>:查询所有员工信息。显示员工姓名，工资，职务名称，职务描述，</span><br><span class="line"><span class="comment">--		部门名称，部门位置，工资等级</span></span><br><span class="line">#<span class="number">1.</span>确定要查询的表 emp job dept salarygrade</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp,job,dept,salarygrade;</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>确定表之间的关联条件 emp.job_id <span class="operator">=</span> job.id  emp.dept_id <span class="operator">=</span> dept.id </span><br><span class="line">#   emp.salary <span class="keyword">between</span> salarygrade.losalary <span class="keyword">and</span> salarygrade.hisalary</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp,job,dept,salarygrade </span><br><span class="line">	<span class="keyword">WHERE</span> emp.job_id <span class="operator">=</span> job.id <span class="keyword">AND</span> emp.dept_id <span class="operator">=</span> dept.id</span><br><span class="line">	<span class="keyword">AND</span> emp.salary <span class="keyword">BETWEEN</span> salarygrade.losalary <span class="keyword">AND</span> salarygrade.hisalary;</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>确定查询结果</span><br><span class="line"><span class="keyword">SELECT</span> emp.`id`,emp.`ename`,emp.`salary`,job.`jname`,job.`description`,</span><br><span class="line">	dept.`dname`,dept.`loc`,salarygrade.`grade`</span><br><span class="line">	<span class="keyword">FROM</span> emp,job,dept,salarygrade </span><br><span class="line">	<span class="keyword">WHERE</span> emp.job_id <span class="operator">=</span> job.id <span class="keyword">AND</span> emp.dept_id <span class="operator">=</span> dept.id</span><br><span class="line">	<span class="keyword">AND</span> emp.salary <span class="keyword">BETWEEN</span> salarygrade.losalary <span class="keyword">AND</span> salarygrade.hisalary;</span><br><span class="line"># 别名优化</span><br><span class="line"><span class="keyword">SELECT</span> e.`id`,e.`ename`,e.`salary`,j.`jname`,j.`description`,d.`dname`,d.`loc`,s.`grade`</span><br><span class="line">	<span class="keyword">FROM</span> emp e,job j,dept d,salarygrade s </span><br><span class="line">	<span class="keyword">WHERE</span> e.job_id <span class="operator">=</span> j.id <span class="keyword">AND</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line">	<span class="keyword">AND</span> e.salary <span class="keyword">BETWEEN</span> s.losalary <span class="keyword">AND</span> s.hisalary;	</span><br><span class="line">	</span><br><span class="line"># 左外连接</span><br><span class="line"><span class="keyword">SELECT</span> e.`id`,e.`ename`,e.`salary`,j.`jname`,j.`description`,d.`dname`,d.`loc`,s.`grade`</span><br><span class="line">	<span class="keyword">FROM</span> emp e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> job j <span class="keyword">ON</span> e.job_id <span class="operator">=</span> j.id</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> dept d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> salarygrade s <span class="keyword">ON</span> e.salary <span class="keyword">BETWEEN</span> s.losalary <span class="keyword">AND</span> s.hisalary</span><br><span class="line"></span><br><span class="line">题目<span class="number">4</span>:查询经理的信息。显示员工姓名，工资，职务名称，职务描述，</span><br><span class="line"><span class="comment">--	部门名称，部门位置，工资等级</span></span><br><span class="line"><span class="keyword">SELECT</span> e.`id`,e.`ename`,e.`salary`,j.`jname`,j.`description`,d.`dname`,d.`loc`,s.`grade`</span><br><span class="line">	<span class="keyword">FROM</span> emp e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> job j <span class="keyword">ON</span> e.job_id <span class="operator">=</span> j.id</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> dept d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> salarygrade s <span class="keyword">ON</span> e.salary <span class="keyword">BETWEEN</span> s.losalary <span class="keyword">AND</span> s.hisalary</span><br><span class="line">	<span class="keyword">WHERE</span> j.`jname`<span class="operator">=</span>&quot;经理&quot;;</span><br><span class="line"></span><br><span class="line">题目<span class="number">5</span>: 查询出部门编号、部门名称、部门位置、部门人数</span><br><span class="line"># 将所有的员工进行分组</span><br><span class="line"><span class="keyword">SELECT</span> dept_id,<span class="built_in">COUNT</span>(<span class="operator">*</span>) c <span class="keyword">FROM</span> emp <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id;</span><br><span class="line"></span><br><span class="line"># 查询部门基本信息</span><br><span class="line"><span class="keyword">SELECT</span> dept.`id`,dept.`dname`,dept.`loc`,IFNULL(emp_ls.c ,<span class="number">0</span>) con</span><br><span class="line">	<span class="keyword">FROM</span> dept <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> (<span class="keyword">SELECT</span> dept_id,<span class="built_in">COUNT</span>(<span class="operator">*</span>) c <span class="keyword">FROM</span> emp <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id) emp_ls</span><br><span class="line">	<span class="keyword">ON</span> dept.`id` <span class="operator">=</span> emp_ls.dept_id;</span><br></pre></td></tr></table></figure>

<h1 id="第四章-MySQL常用函数"><a href="#第四章-MySQL常用函数" class="headerlink" title="第四章 MySQL常用函数"></a>第四章 MySQL常用函数</h1><h2 id="4-1-字符串函数"><a href="#4-1-字符串函数" class="headerlink" title="4.1 字符串函数"></a>4.1 字符串函数</h2><table>
<thead>
<tr>
<th>函数</th>
<th>描述</th>
<th>实例</th>
</tr>
</thead>
<tbody><tr>
<td>CHAR_LENGTH(s)</td>
<td>返回字符串 s 的<strong>字符数</strong></td>
<td>SELECT CHAR_LENGTH(‘itheima’) AS ‘长度’;</td>
</tr>
<tr>
<td>CONCAT(s1,s2…sn)</td>
<td>字符串 s1,s2 等多个字符串<strong>合并为一个字符串</strong></td>
<td>SELECT CONCAT(‘I’,’love’,’you’);</td>
</tr>
<tr>
<td>LOWER(s)</td>
<td>将字符串 s 的所有字母变成<strong>小写字母</strong></td>
<td>SELECT LOWER(‘ITHEIMA’);</td>
</tr>
<tr>
<td>UPPER(s)</td>
<td>将字符串转换为<strong>大写字母</strong></td>
<td>SELECT UPPER(“itheima”);</td>
</tr>
<tr>
<td>SUBSTR(s,  start,length)</td>
<td><strong>从字符串 s 的 start 位置截取长度为 length 的子字符串</strong></td>
<td>SELECT SUBSTR(“itheima”,1,2);</td>
</tr>
<tr>
<td>TRIM(s)</td>
<td><strong>去掉字符串 s 开始和结尾处的空格</strong></td>
<td>SELECT TRIM(‘ itheima ‘)</td>
</tr>
</tbody></table>
<div style='background-color:#42C0A3;'>示例: </div>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># <span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span>字符串函数<span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br><span class="line"><span class="comment">-- 计算字符串长度</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CHAR_LENGTH</span>(&quot;abc&quot;);</span><br><span class="line"><span class="keyword">SELECT</span> NAME,<span class="keyword">CHAR_LENGTH</span>(NAME) <span class="string">&#x27;长度&#x27;</span> <span class="keyword">FROM</span> emp;</span><br><span class="line"><span class="comment">-- 拼接字符串 CONCAT(s1,s2...sn) ★</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(&quot;hello &quot;,NAME,&quot;!&quot;) <span class="keyword">FROM</span> emp;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> CONCAT(&quot;%&quot;,&quot;唐&quot;,&quot;%&quot;);</span><br><span class="line"><span class="comment">-- 转小写</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LOWER</span>(&quot;HELLO&quot;);</span><br><span class="line"><span class="comment">-- 转大写</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">UPPER</span>(&quot;hello&quot;);</span><br><span class="line"><span class="comment">-- 字符串截取 SUBSTR(s,  start,length)</span></span><br><span class="line"><span class="keyword">SELECT</span> SUBSTR(&quot;abcdef&quot;,<span class="number">2</span>,<span class="number">2</span>);<span class="comment">-- 字符下标从1开始</span></span><br><span class="line"><span class="comment">-- 去开头和结尾的空格 TRIM(s)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CHAR_LENGTH</span>(&quot;  hello  &quot;);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CHAR_LENGTH</span>(<span class="built_in">TRIM</span>(&quot;  hello  &quot;)) s;</span><br></pre></td></tr></table></figure>

<h2 id="4-2-数字函数"><a href="#4-2-数字函数" class="headerlink" title="4.2 数字函数"></a>4.2 数字函数</h2><table>
<thead>
<tr>
<th>函数</th>
<th>描述</th>
<th>实例</th>
</tr>
</thead>
<tbody><tr>
<td>RAND()</td>
<td><strong>返回 0 到 1 的随机数</strong></td>
<td>SELECT RAND();</td>
</tr>
<tr>
<td>ROUND(小数, 保留几位)</td>
<td>四舍五入保留几位小数</td>
<td>SELECT ROUND(3.1415926,2) ;</td>
</tr>
<tr>
<td>LEAST(expr1, expr2, expr3, …)</td>
<td><strong>返回列表中的最小值</strong></td>
<td>SELECT LEAST(13, 14, 521, 74, 1)</td>
</tr>
<tr>
<td>GREATEST(expr1,  expr2,expr3, …)</td>
<td>返回列表中的最大值</td>
<td>SELECT GREATEST(13, 14, 521, 74, 1)</td>
</tr>
</tbody></table>
<div style='background-color:#42C0A3;'>示例: </div>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> RAND();	<span class="comment">-- 返回0-1之间的随机数 0.21809973867433122</span></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">3.1415926</span>,<span class="number">2</span>) ; <span class="comment">-- 执行结果: 3.14</span></span><br><span class="line"><span class="keyword">SELECT</span> LEAST(<span class="number">13</span>, <span class="number">14</span>, <span class="number">521</span>, <span class="number">74</span>, <span class="number">1</span>);	<span class="comment">-- 执行结果: 1</span></span><br><span class="line"><span class="keyword">SELECT</span> GREATEST(<span class="number">13</span>, <span class="number">14</span>, <span class="number">521</span>, <span class="number">74</span>, <span class="number">1</span>); <span class="comment">-- 执行结果: 521</span></span><br></pre></td></tr></table></figure>

<h2 id="4-3-日期函数"><a href="#4-3-日期函数" class="headerlink" title="4.3 日期函数"></a>4.3 日期函数</h2><table>
<thead>
<tr>
<th align="left">函数名</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">NOW() 和 SYSDATE()</td>
<td align="left">返回系统的当前<strong>日期和时间</strong></td>
<td align="left">SELECT NOW(); 或 SELECT SYSDATE();</td>
</tr>
<tr>
<td align="left">CURDATE()</td>
<td align="left">返回当前<strong>日期</strong></td>
<td align="left">SELECT CURDATE();</td>
</tr>
<tr>
<td align="left">CURTIME()</td>
<td align="left">返回当前系统<strong>时间</strong></td>
<td align="left">SELECT CURTIME();</td>
</tr>
<tr>
<td align="left">YEAR(d)</td>
<td align="left">返回d的中的<strong>年</strong>份</td>
<td align="left">SELECT YEAR(NOW());</td>
</tr>
<tr>
<td align="left">MONTH(d)</td>
<td align="left">返回d的中的<strong>月</strong>份</td>
<td align="left">SELECT MONTH(NOW());</td>
</tr>
<tr>
<td align="left">DAY(d)</td>
<td align="left">返回d中的<strong>日</strong></td>
<td align="left">SELECT DAY(NOW());</td>
</tr>
</tbody></table>
<div style='background-color:#42C0A3;'>示例: </div>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> NOW(); 或 <span class="keyword">SELECT</span> SYSDATE(); <span class="comment">-- 返回系统的当前时间: 年-月-日 时:分:秒 </span></span><br><span class="line"><span class="keyword">SELECT</span> CURDATE(); <span class="comment">-- 返回系统当前日期: 年-月-日</span></span><br><span class="line"><span class="keyword">SELECT</span> CURTIME(); <span class="comment">-- 返回系统当前时间: 时:分:秒</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(NOW()); <span class="comment">-- 返回当前日期中的年份</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MONTH</span>(NOW()); <span class="comment">-- 返回当前日期中的月份</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(NOW()); <span class="comment">-- 返回当前日期中的日</span></span><br></pre></td></tr></table></figure>

<h2 id="4-4-高级函数"><a href="#4-4-高级函数" class="headerlink" title="4.4 高级函数"></a>4.4 高级函数</h2><table>
<thead>
<tr>
<th align="left">函数名</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CURRENT_USER()</td>
<td align="left"><strong>返回当前用户</strong></td>
<td align="left">SELECT CURRENT_USER();</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/mysql/mysql-func-ifnull.html">IFNULL(v1,v2)</a></td>
<td align="left"><strong>如果 v1 的值不为 NULL，则返回 v1，否则返回 v2</strong>。</td>
<td align="left">SELECT IFNULL(null,’Hello Word’)</td>
</tr>
<tr>
<td align="left">ISNULL(expression)</td>
<td align="left"><strong>判断表达式是否为 NULL</strong></td>
<td align="left">SELECT ISNULL(NULL);</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_USER</span>();</span><br><span class="line"><span class="keyword">SELECT</span> ISNULL(<span class="keyword">NULL</span>);</span><br><span class="line"><span class="keyword">SELECT</span> IFNULL(<span class="keyword">NULL</span>,&quot;hello&quot;);</span><br><span class="line">	<span class="comment">-- 之前在显示字段时看过哈，IFNULL(price,0)+10</span></span><br></pre></td></tr></table></figure>

<h2 id="代码整合，示范："><a href="#代码整合，示范：" class="headerlink" title="代码整合，示范："></a>代码整合，示范：</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"># <span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span>字符串函数<span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br><span class="line"><span class="comment">-- 计算字符串长度</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CHAR_LENGTH</span>(&quot;abc&quot;);</span><br><span class="line"><span class="keyword">SELECT</span> NAME,<span class="keyword">CHAR_LENGTH</span>(NAME) <span class="string">&#x27;长度&#x27;</span> <span class="keyword">FROM</span> emp;</span><br><span class="line"><span class="comment">-- 拼接字符串 CONCAT(s1,s2...sn) ★</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(&quot;hello &quot;,NAME,&quot;!&quot;) <span class="keyword">FROM</span> emp;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> CONCAT(&quot;%&quot;,&quot;唐&quot;,&quot;%&quot;);</span><br><span class="line"><span class="comment">-- 转小写</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LOWER</span>(&quot;HELLO&quot;);</span><br><span class="line"><span class="comment">-- 转大写</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">UPPER</span>(&quot;hello&quot;);</span><br><span class="line"><span class="comment">-- 字符串截取 SUBSTR(s,  start,length)</span></span><br><span class="line"><span class="keyword">SELECT</span> SUBSTR(&quot;abcdef&quot;,<span class="number">2</span>,<span class="number">2</span>);<span class="comment">-- 字符下标从1开始</span></span><br><span class="line"><span class="comment">-- 去开头和结尾的空格 TRIM(s)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CHAR_LENGTH</span>(&quot;  hello  &quot;);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CHAR_LENGTH</span>(<span class="built_in">TRIM</span>(&quot;  hello  &quot;)) s;</span><br><span class="line"></span><br><span class="line"># <span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span>数字函数<span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br><span class="line"><span class="keyword">SELECT</span> RAND();	<span class="comment">-- 返回0-1之间的随机数 0.21809973867433122</span></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">3.1415926</span>,<span class="number">2</span>) ; <span class="comment">-- 执行结果: 3.14</span></span><br><span class="line"><span class="keyword">SELECT</span> LEAST(<span class="number">13</span>, <span class="number">14</span>, <span class="number">521</span>, <span class="number">74</span>, <span class="number">1</span>);	<span class="comment">-- 执行结果: 1</span></span><br><span class="line"><span class="keyword">SELECT</span> GREATEST(<span class="number">13</span>, <span class="number">14</span>, <span class="number">521</span>, <span class="number">74</span>, <span class="number">1</span>); <span class="comment">-- 执行结果: 521</span></span><br><span class="line"># <span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span>日期函数<span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br><span class="line"><span class="keyword">SELECT</span> NOW(); <span class="comment">-- 或 SELECT SYSDATE(); -- 返回系统的当前时间: 年-月-日 时:分:秒 </span></span><br><span class="line"><span class="keyword">SELECT</span> CURDATE(); <span class="comment">-- 返回系统当前日期: 年-月-日</span></span><br><span class="line"><span class="keyword">SELECT</span> CURTIME(); <span class="comment">-- 返回系统当前时间: 时:分:秒</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(NOW()); <span class="comment">-- 返回当前日期中的年份</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MONTH</span>(NOW()); <span class="comment">-- 返回当前日期中的月份</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(NOW()); <span class="comment">-- 返回当前日期中的日</span></span><br><span class="line"># <span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span>高级函数<span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_USER</span>();</span><br><span class="line"><span class="keyword">SELECT</span> IFNULL(<span class="keyword">NULL</span>,&quot;hello&quot;);</span><br><span class="line"><span class="keyword">SELECT</span> ISNULL(<span class="keyword">NULL</span>);</span><br><span class="line"><span class="comment">-- 之前在显示字段时看过哈，IFNULL(price,0)+10</span></span><br></pre></td></tr></table></figure>

<h1 id="第五章-事务-★★"><a href="#第五章-事务-★★" class="headerlink" title="第五章 事务 ★★"></a>第五章 事务 ★★</h1><h3 id="5-1-事务的概述"><a href="#5-1-事务的概述" class="headerlink" title="5.1 事务的概述"></a>5.1 事务的概述</h3><p><strong>业务场景</strong></p>
<hr>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/1566694672043-1619508948292.png" alt="1566694672043-1619508948292"></p>
<p><strong>什么是事务</strong></p>
<hr>
<p>如果在执行一个业务操作的时候，需要执行多条SQL语句，必须保证所有的SQL语句都执行成功。<strong>只要其中有一条执行失败，则所有的SQL语句都要进行回滚</strong></p>
<p>事务必须是<strong>所有的SQL语句都执行成功，或者都执行失败</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">事务: 组成事务的各个单元,要么都成功,要么都失败</span><br><span class="line"></span><br><span class="line">转账业务: 一个业务就是一个完整的事务</span><br><span class="line">	扣钱: update account set money=money-<span class="number">1000</span> where name = <span class="string">&quot;jack&quot;</span>;</span><br><span class="line">	加钱: update account set money=money+<span class="number">1000</span> where name = <span class="string">&quot;rose&quot;</span>;</span><br><span class="line">事务的四大特性:</span><br><span class="line"><span class="number">1</span>原子性: 组成事务的各个单元不可再拆分</span><br><span class="line"><span class="number">2</span>一致性: 事务执行前后,数据的状态是一致的(要么都执行成功,要么都执行失败)</span><br><span class="line"><span class="number">3</span>隔离性: 事务和事务之间相互隔离,互不干扰</span><br><span class="line"><span class="number">4</span>持久性: 事务一旦提交对数据库的影响是持久的</span><br></pre></td></tr></table></figure>

<p><strong>事务的四大特性ACID</strong></p>
<hr>
<table>
<thead>
<tr>
<th><strong>事务特性</strong></th>
<th><strong>含义</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>原子性（Atomicity）</strong></td>
<td>所有的SQL操作是一个整体，不可再拆分。事务是应该是最小的执行单元</td>
</tr>
<tr>
<td><strong>一致性（Consistency）</strong></td>
<td>事务执行前，执行后。数据库的状态应该是一致的。<br />如：转账前2个人总额与转换后2个人总额应该是一样的</td>
</tr>
<tr>
<td><strong>隔离性（Isolation）</strong></td>
<td>事务是可以<strong>并发</strong>执行的，理想的情况应该是所有的事务之间不能相互影响</td>
</tr>
<tr>
<td><strong>持久性（Durability）</strong></td>
<td>如果事务对数据库进行了操作，对数据库中数据影响是持久的</td>
</tr>
</tbody></table>
<p><strong>前导实例</strong>：不使用事务，用SQL模拟Jack给Rose转账500？</p>
<hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建数据表account（id 整型 自增主键，name 变长字符串30，balance 整型）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> account (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">    balance <span class="type">decimal</span></span><br><span class="line">);</span><br><span class="line"> </span><br><span class="line"><span class="comment">-- 添加数据（Jack，1000）、（Rose，1000）</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> account (name, balance) <span class="keyword">VALUES</span> (<span class="string">&#x27;Jack&#x27;</span>, <span class="number">1000</span>), (<span class="string">&#x27;Rose&#x27;</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果要完成Jack转账给Rose : 500</span></span><br><span class="line"><span class="comment">-- 至少2条，Jack扣钱，Rose加钱，要有2条update语句</span></span><br><span class="line">update account <span class="keyword">set</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">500</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;Jack&#x27;</span>;</span><br><span class="line">update account <span class="keyword">set</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">500</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;Rose&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 账户全部还原成1000</span></span><br><span class="line">update account <span class="keyword">set</span> balance <span class="operator">=</span> <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<p>假设当Jack账号上-500元,服务器崩溃了。Rose的账号并没有+500元，数据就出现问题了</p>
<p>我们需要保证其中一条SQL语句出现问题，整个转账就算失败</p>
<p><strong>只有两条SQL都成功了转账才算成功。这个时候就需要用到事务</strong></p>
<h3 id="5-2-事务的开启，提交以及回滚"><a href="#5-2-事务的开启，提交以及回滚" class="headerlink" title="5.2 事务的开启，提交以及回滚"></a>5.2 事务的开启，提交以及回滚</h3><p><strong>提交事务</strong>: 将sql的执行结果写入数据库<br><strong>回滚事务</strong>: 将数据库中的数据,回到事务开启前的状态</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Mysql中的事务控制:</span><br><span class="line">	<span class="number">1</span> 手动事务:</span><br><span class="line">		手动开启事务: start transaction 或 begin</span><br><span class="line">      				编写sql语句....</span><br><span class="line">      				提交事务: commit</span><br><span class="line">      				回滚事务: rollback</span><br><span class="line">	<span class="number">2</span> 自动事务: mysql的事务默认情况下是自动的</span><br><span class="line">    		一条sql就是一个事务,在sql执行前mysql会自动开启事务,</span><br><span class="line">			sql执行完毕后mysql会自动提交或回滚事务</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="1-2-1-手动开启事务与提交"><a href="#1-2-1-手动开启事务与提交" class="headerlink" title="1.2.1 手动开启事务与提交"></a>1.2.1 手动开启事务与提交</h5><p><strong>SQL语句</strong></p>
<hr>
<table>
<thead>
<tr>
<th><strong>功能</strong></th>
<th><strong>SQL语句</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>开启手动事务</strong></td>
<td>start transaction 或 begin</td>
</tr>
<tr>
<td><strong>手动提交事务</strong></td>
<td>commit</td>
</tr>
<tr>
<td><strong>手动回滚事务</strong></td>
<td>rollback</td>
</tr>
</tbody></table>
<p><strong>提交事务的过程</strong></p>
<hr>
<ol>
<li>开启事务</li>
<li>执行SQL语句</li>
<li>提交或回滚事务</li>
</ol>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/Snipaste_2019-08-20_11-39-27-1619508948292.png" alt="Snipaste_2019-08-20_11-39-27-1619508948292"></p>
<p><strong>案例：事务提交</strong></p>
<hr>
<p>模拟Jack给Rose转500元钱成功的情况</p>
<ol>
<li>使用DOS控制台进入MySQL</li>
<li>执行以下SQL语句： <ul>
<li>开启事务 </li>
<li>Jack账号-500 </li>
<li>Rose账号+500 </li>
</ul>
</li>
<li>使用Sqlyog查看数据库：发现数据并没有改变</li>
<li>在控制台执行commit提交任务：</li>
<li>使用Sqlyog查看数据库：发现数据改变</li>
</ol>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/Snipaste_2019-08-20_11-51-06-1619508948293.png" alt="Snipaste_2019-08-20_11-51-06-1619508948293"></p>
<p><strong>案例：事务回滚</strong></p>
<hr>
<p>模拟Jack给Rose转500元钱失败的情况，在控制台执行以下SQL语句：</p>
<ol>
<li><p>开启事务</p>
</li>
<li><p>Jack账号-500，Rose账户+500</p>
</li>
<li><p>使用Sqlyog查看数据库：发现数据<strong>没有改变</strong></p>
</li>
<li><p>但是在控制台执行rollback回滚事务</p>
</li>
<li><p>使用Sqlyog查看数据库：发现<strong>数据没有改变</strong>。</p>
</li>
</ol>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/Snipaste_2019-08-20_11-56-44-1619508948293.png" alt="Snipaste_2019-08-20_11-56-44-1619508948293"></p>
<p>总结：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1</span> <span class="string">无论是怎么样，只有在commit之后数据才会变化，</span></span><br><span class="line"><span class="attr">2</span> <span class="string">中间系统崩溃自动执行rollback或自己写rollback语句被执行，都会不改变数据，</span></span><br><span class="line"><span class="attr">3</span> <span class="string">尽管在start和commit之间查看数据似乎已经改变了，但实际上是不变的。。</span></span><br></pre></td></tr></table></figure>



<h5 id="1-2-2-自动开启事务"><a href="#1-2-2-自动开启事务" class="headerlink" title="1.2.2 自动开启事务"></a>1.2.2 自动开启事务</h5><p>事务自动开启时，<strong>提交有两种模式</strong>，利用<strong>autocommit</strong>关键字来实现</p>
<hr>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1表示自动提交，</span></span><br><span class="line"><span class="attr">0表示手动提交</span></span><br><span class="line"><span class="attr">解释：</span></span><br><span class="line"><span class="attr">当autocommit的值为1时，一条sql语句执行完之后会自动提交，修改数据</span></span><br><span class="line"><span class="attr">当autocommit的值为0时，虽然自动开启了事务，但是并不会提交，所以数据并没有被改变。</span></span><br></pre></td></tr></table></figure>

<p>在默认情况下，<strong>MySQL中每条SQL语句执行前都会创建一个事务，执行结束后就关闭事务</strong>，<strong>autocommit一直为1.</strong></p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/1566695270031-1619508948293.png" alt="1566695270031-1619508948293"></p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/1566522035599-1619508948293.png" alt="1566522035599-1619508948293"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1 查询事务提交模式</span></span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@autocommit</span>;</span><br><span class="line"><span class="comment">-- 2 修改事务提交模式</span></span><br><span class="line"><span class="keyword">set</span> @<span class="variable">@autocommit</span><span class="operator">=</span><span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p><strong>案例1 ：自动提交事务</strong>（默认会自动开启以及关闭事务，autocommit一直为1，在关闭时会自动提交）</p>
<hr>
<ol>
<li>将账户金额重置为1000</li>
<li>更新Jack的账户</li>
<li>使用Sqlyog查看数据库：发现数据已经改变 </li>
</ol>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/1566282049536-1619508948293.png" alt="1566282049536-1619508948293"></p>
<p><strong>案例2 ：取消自动提交事务</strong></p>
<p>（默认会自动开启以及关闭事务，autocommit设为1，在关闭事务时不会自动提交，这时需手动来执行commit语句）</p>
<hr>
<ol>
<li>查看MySQL是否开启自动提交事务</li>
<li>如果是自动提交，就取消自动提交事务</li>
<li>Jack账户扣款500</li>
<li>使用Sqlyog查看数据库，发现数据并没有改变</li>
<li>执行commit提交任务</li>
<li>使用Sqlyog查看数据库，发现数据已经改变</li>
</ol>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/1566282918868-1619508948293.png" alt="1566282918868-1619508948293"></p>
<p><strong>但是Sqlyog里面看到，Jack账户金额依然是1000</strong>######################哈哈哈</p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/1566282966442.png" alt="1566282966442"></p>
<p>继续，在命令行里提交事务（########################<strong>需要手动提交</strong>）</p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/1566282581122.png" alt="1566282581122"></p>
<p>最后，在Sqlyog里可以看到，Jack的账户金额被修改了。说明，事务被修改成了手动模式</p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/1566283059762.png" alt="1566283059762"></p>
<h3 id="5-3-事务的回滚点和执行原理"><a href="#5-3-事务的回滚点和执行原理" class="headerlink" title="5.3 事务的回滚点和执行原理"></a>5.3 事务的回滚点和执行原理</h3><p><strong>什么是回滚点</strong></p>
<hr>
<p>上面的操作，如果回滚，直接回滚到事务开始前。</p>
<p>有时我们并不需要回滚到最开始的状态，可能<strong>只需要回滚到中间的某个位置，就可以设置回滚点</strong></p>
<p><strong>语法</strong></p>
<hr>
<table>
<thead>
<tr>
<th><strong>回滚点的操作语句</strong></th>
<th><strong>语句</strong></th>
</tr>
</thead>
<tbody><tr>
<td>设置回滚点</td>
<td>savepoint 名字</td>
</tr>
<tr>
<td>回到回滚点</td>
<td>rollback to 名字</td>
</tr>
</tbody></table>
<p><strong>应用</strong></p>
<hr>
<ol>
<li>将账户数据还原到1000</li>
<li>开启事务</li>
<li>让Jack账号减2次钱，每次10块</li>
<li>设置回滚点：savepoint two_times; </li>
<li>让Jack账号减2次钱，每次10块</li>
<li>回到回滚点：rollback to two_times; </li>
<li>最后commit提交事务</li>
</ol>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/1566284028530.png" alt="1566284028530"></p>
<p>可以看到，最终Jack账户金额是980，表示虽然转账4此，但是又回滚了2次，因此一共减去了20</p>
<p><strong>注意：这里rollback to 之后，不用再次commit，事务就已经结束了，就可以真正修改数据了。</strong></p>
<p><strong>执行原理</strong></p>
<hr>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/1566286392652.png" alt="1566286392652"></p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/image-20210427165001028.png" alt="image-20210427165001028"></p>
<ol>
<li>一个用户登录成功以后，服务器会创建一个临时日志文件。日志文件用来保存用户事务状态</li>
<li>如果没有使用事务，则所有的操作直接写到数据库中，不会使用日志文件</li>
<li>如果开启事务，将所有的写操作写到日志文件中</li>
<li>如果这时用户提交了事务，则将日志文件中所有的操作写到数据库中</li>
<li>如果用户回滚事务，则日志文件会被清空，不会影响到数据库的操作</li>
</ol>
<h3 id="第五章-事务5-1–5-3总结"><a href="#第五章-事务5-1–5-3总结" class="headerlink" title="第五章 事务5.1–5.3总结"></a>第五章 事务5.1–5.3总结</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">事务</span>:<span class="string"></span></span><br><span class="line">	<span class="meta">概述</span>: <span class="string">事务描述的就是一个完整的业务,组成这个业务的各个单元(sql)</span></span><br><span class="line">		<span class="attr">要么同时成功,要么同时失败.</span></span><br><span class="line"><span class="meta">事务特征</span>: <span class="string">四大特性</span></span><br><span class="line">    <span class="attr">A</span>: <span class="string">原子性,事务是一个独立的整体,不可再拆分</span></span><br><span class="line">    <span class="attr">B</span>: <span class="string">一致性,组成事务的各个单元要么同时成功,要么同时失败</span></span><br><span class="line">    <span class="attr">C</span>: <span class="string">隔离性,多个事务操作数据库时,事务之间相互隔离,互不干扰</span></span><br><span class="line">    <span class="attr">D</span>: <span class="string">持久性,事务一旦提交,对数据库的影响是持久的</span></span><br><span class="line">	<span class="attr">1</span> <span class="string">自动事务: mysql的事务是自动的(默认 @@autocommit为1)</span></span><br><span class="line">		<span class="meta">查询事务自动提交状态：select</span> <span class="string">@@autocommit; </span></span><br><span class="line"></span><br><span class="line">		<span class="attr">在mysql中事务是自动的,默认情况下一条sql就是一个事务,</span></span><br><span class="line">		<span class="attr">sql执行完毕后,mysql会自动提交事务</span></span><br><span class="line"></span><br><span class="line">		<span class="meta">关闭自动事务提交</span>: <span class="string">set @@autocommit=0;</span></span><br><span class="line">		<span class="meta">然后需要手动提交</span>: <span class="string">commit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2</span> <span class="string">手动事务:</span></span><br><span class="line">	<span class="meta">开启事务</span>: <span class="string">begin;  start transaction;</span></span><br><span class="line">	<span class="meta">编写sql</span> : <span class="string">...</span></span><br><span class="line">	<span class="meta">提交事务</span>: <span class="string">commit</span></span><br><span class="line">	<span class="meta">回滚事务</span>: <span class="string">rollback</span></span><br><span class="line">		</span><br><span class="line"><span class="meta">回滚点以及回滚到回滚点</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">savepoint</span> <span class="string">名称</span></span><br><span class="line">    <span class="attr">rollback</span> <span class="string">to 名称</span></span><br></pre></td></tr></table></figure>



<h3 id="5-4-并发访问的问题（了解）"><a href="#5-4-并发访问的问题（了解）" class="headerlink" title="5.4 并发访问的问题（了解）"></a>5.4 并发访问的问题（了解）</h3><p><strong>并发访问的问题</strong></p>
<hr>
<p>在不考虑隔离性的前提下: 并发访问mysql</p>
<p>因为<strong>一张表可以同时有多个用户在访问，相互之间会有影响</strong>，会引发以下三种并发访问的问题:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 脏读: 在一个事务中读取到了另一个事务未提交的数据</span><br><span class="line"><span class="number">2</span> 不可重复读: 在一个事务中,执行同一条sql查询到的结果不同(其他事务对数据进行了修改)</span><br><span class="line"><span class="number">3</span> 幻读/虚度: 在一个事务中,执行同一条sql查询到的结果不同(其他事务对数据进行的添加或删除)</span><br></pre></td></tr></table></figure>

<p>并发访问的问题可以<strong>通过数据库隔离级别</strong>来解决</p>
<h5 id="1-4-1-事务的隔离级别"><a href="#1-4-1-事务的隔离级别" class="headerlink" title="1.4.1 事务的隔离级别"></a>1.4.1 事务的隔离级别</h5><p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/1566287181083.png" alt="1566287181083"></p>
<ol>
<li><p>隔离级别的特点：</p>
<ol>
<li>级别1最低，级别4最高</li>
<li><strong>隔离级别越高，性能越低，安全性越高</strong></li>
</ol>
<p>我们一般使用的是mysql默认的隔离级别：<strong>Repeatable</strong>就好啦。串行化隔离高，但是效率太低了。四种隔离级别解读如下：</p>
<p><strong>四种隔离级别起的作用</strong></p>
<ol>
<li><p>Read uncommitted (读未提交)： 级别最低，会同时出现三种问题</p>
<p>（<strong>读取的数据跟另一个事务数据实时同步，未提交时也同步）</strong></p>
</li>
<li><p>Read committed (读已提交)：可以解决脏读的问题</p>
<p>（<strong>读取的数据是另一个事务开启前或提交后的数据</strong>）</p>
</li>
<li><p>Repeatable read (可重复读)：可以解决脏读和不可重复读的问题</p>
<p><strong>（事务开始后数据就已经定下来，就算另一个事务修改并提交后，本事务读取到的还是本事务开启前的数据）</strong>；</p>
<p>但如果另一个事务删除或者添加，那该事务的查询就受影响了（幻读）</p>
</li>
<li><p>Serializable (串行化)： 所有的事务都是以串行的方式执行，没有并发执行的事务</p>
<p><strong>（这个好理解，本事务操作时把表锁定了，本事务结束后其他事务才能访问操作相同的表）</strong></p>
</li>
</ol>
<p><strong>MySQL与隔离级别相关的命令</strong></p>
<hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询事务隔离级别</span></span><br><span class="line">   <span class="keyword">select</span> @<span class="variable">@tx</span>_isolation;</span><br><span class="line"></span><br><span class="line">   <span class="comment">-- 设置全局事务隔离级别</span></span><br><span class="line">   <span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level 四种级别名字;</span><br></pre></td></tr></table></figure>

<p>下面将演示每一种并行操作时查询出现的问题（脏读，不可重复读，幻读），</p>
<p>以及添加隔离技术（读已提交，可重复读，串行）来解决。其中最低级别的读未提交不能解决上述一个问题哈！！！</p>
</li>
</ol>
<h5 id="1-4-2-脏读"><a href="#1-4-2-脏读" class="headerlink" title="1.4.2 脏读"></a>1.4.2 脏读</h5><p><strong>准备数据</strong></p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-- 创建数据表，账户表</span><br><span class="line">CREATE TABLE account (</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	NAME VARCHAR(10),</span><br><span class="line">	balance DOUBLE  -- 金额</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- 添加数据</span><br><span class="line">INSERT INTO account (NAME, balance) VALUES (&#x27;Jack&#x27;, 1000), (&#x27;Rose&#x27;, 1000);</span><br><span class="line"></span><br><span class="line">select * from account;</span><br><span class="line"></span><br><span class="line">-- 还原</span><br><span class="line">update account set balance = 1000;</span><br></pre></td></tr></table></figure>

<p><strong>脏读演示</strong></p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- 1. 打开一个命令行Jack，设置全局的隔离级别为最低：</span><br><span class="line">set global transaction isolation level read uncommitted;</span><br><span class="line">-- 2. 选择数据库，开启事务</span><br><span class="line">use db;</span><br><span class="line">start transaction;</span><br><span class="line">-- 3. 更新2个人的账户，未提交</span><br><span class="line">update account set balance = balance - 500 where name = &#x27;Jack&#x27;;</span><br><span class="line">update account set balance = balance + 500 where name = &#x27;Rose&#x27;;</span><br><span class="line">-- 4. 打开另一个命令行Rose，选择数据库，开启事务</span><br><span class="line">use db;</span><br><span class="line">start transaction;</span><br><span class="line">-- 5. 查询账户，发现钱已经到账，发货</span><br><span class="line">select * from account;</span><br><span class="line">-- 6. 命令行Jack，回滚</span><br><span class="line">rollback;</span><br><span class="line">-- 7. 命令行Rose，查询账户，钱没了</span><br><span class="line">select * from account;</span><br></pre></td></tr></table></figure>

<p><strong>解决办法</strong></p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 1. 打开命令行Jack，设置全局的隔离级别为 read committed</span><br><span class="line">set global transaction isolation level read committed; </span><br><span class="line">-- 2. 重复上面的操作：需要重新登录。命令行Jack在没有提交和回滚之前，Rose账户看到的金额不变</span><br><span class="line">会发现命令行Jack在没有提交和回滚之前，命令行Rose看不到账户发生任何变化</span><br><span class="line">-- 3. 命令行Jack。使用commit提交以后，Rose账户看到的金额变化</span><br><span class="line">命令行Rose，可以看到账户发生了变化</span><br></pre></td></tr></table></figure>

<h5 id="1-4-3-不可重复读"><a href="#1-4-3-不可重复读" class="headerlink" title="1.4.3 不可重复读"></a>1.4.3 不可重复读</h5><p><strong>不可重复读演示</strong></p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">-- 1.将数据进行恢复，并关闭窗口重新登录。</span><br><span class="line">update account set balance=1000;</span><br><span class="line">-- 2.开启一个命令行Jack，确保当前的事务隔离是read committed</span><br><span class="line">select @@tx_isolation;</span><br><span class="line">-- 3.选择数据库，开启一个事务</span><br><span class="line">use db;</span><br><span class="line">start transaction;</span><br><span class="line">-- 4.查询用户Jack的账户，查到是1000块</span><br><span class="line">select * from account where name=&#x27;Jack&#x27;;</span><br><span class="line">-- 5.开启另一个命令行Rose，选择数据库，开启一个事务</span><br><span class="line">use db;</span><br><span class="line">start transaction;</span><br><span class="line">-- 6.更新Jack账户，减500元</span><br><span class="line">update account set balance=balance-500 where name=&#x27;Jack&#x27;;</span><br><span class="line">-- 7.提交事务</span><br><span class="line">commit;</span><br><span class="line">-- 8.命令行Jack再次查询Jack的账户，查到是500块</span><br><span class="line">select * from account where name=&#x27;Jack&#x27;;</span><br><span class="line">-- 9.提交事务</span><br><span class="line">commit; </span><br></pre></td></tr></table></figure>

<p>两次查询输出的结果不同，到底哪次是对的？</p>
<p><strong>解决办法</strong></p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 1. 打开命令行Jack，设置全局的隔离级别为 repeatable read</span><br><span class="line">set global transaction isolation level repeatable read;</span><br><span class="line">-- 2. 重复上面的操作：需要重新登录</span><br><span class="line">会发现命令行Rose事务提交后，命令行Jack依然读到1000，表示可以重复读</span><br><span class="line">这是我们mysql默认的实际情况！</span><br></pre></td></tr></table></figure>

<h5 id="1-4-4-幻读"><a href="#1-4-4-幻读" class="headerlink" title="1.4.4 幻读"></a>1.4.4 幻读</h5><p><strong>幻读演示</strong></p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">-- 1.将数据恢复成1000，并关闭窗口重新登录。</span><br><span class="line">update account set balance=1000;</span><br><span class="line">-- 2.开启一个命令行Jack，确保当前的事务隔离是repeatable read</span><br><span class="line">select @@tx_isolation; </span><br><span class="line">-- 3.选择数据库，开启一个事务</span><br><span class="line">use db;</span><br><span class="line">start transaction;</span><br><span class="line">-- 4.查询id大于1的账户信息，查到1条记录</span><br><span class="line">select * from account where id &gt; 1;</span><br><span class="line">-- 5.开启另一个命令行Rose，选择数据库，开启事务</span><br><span class="line">use db;</span><br><span class="line">start transaction</span><br><span class="line">-- 6.新增一条记录</span><br><span class="line">insert into account values (null, &#x27;Tom&#x27;, 300);</span><br><span class="line">-- 7.提交事务</span><br><span class="line">commit;</span><br><span class="line">-- 8.命令行Jack再次查询id大于1的账户信息，查到1条记录</span><br><span class="line">select * from account where id &gt; 1;</span><br><span class="line">-- 9.修改id大于1的账户金额为200，发现修改了2条记录</span><br><span class="line">update account set balance = 200 where id &gt; 1; </span><br><span class="line">-- 10.再次查询id大于1的账户信息，查到2条记录，出现幻觉</span><br><span class="line">select * from account where id &gt; 1;</span><br></pre></td></tr></table></figure>

<p>查到2条记录，出现幻觉？</p>
<p><strong>解决办法</strong></p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 1. 打开命令行Jack，设置全局的隔离级别为 serializable</span><br><span class="line">set global transaction isolation level serializable; </span><br><span class="line">-- 2. 重复上面的操作：需要重新登录</span><br><span class="line">会发现命令行Rose新增SQL提交后，没有立即执行，而是在等待Jack的事务结束</span><br><span class="line">我们提交了Jack事务后，Rose新增SQL才执行完成，表示目前事务是串行化的</span><br></pre></td></tr></table></figure>

<h1 id="练习"><a href="#练习" class="headerlink" title="练习:"></a>练习:</h1><h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><p><strong>sql脚本与表关系</strong></p>
<p><img src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/image-20200617173911215.png" alt="image-20200617173911215"></p>
<p>1 数据准备：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE demo3;</span><br><span class="line">USE demo3;</span><br><span class="line">##部门表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dept(</span><br><span class="line">	deptno <span class="type">INT</span>  <span class="keyword">PRIMARY</span> KEY,##部门编号</span><br><span class="line">	dname <span class="type">VARCHAR</span>(<span class="number">14</span>) ,	##部门名称</span><br><span class="line">	loc <span class="type">VARCHAR</span>(<span class="number">13</span>)  	##部门地址</span><br><span class="line">);</span><br><span class="line">#部门表数据</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dept <span class="keyword">VALUES</span>	(<span class="number">10</span>,<span class="string">&#x27;财务部&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>),(<span class="number">20</span>,<span class="string">&#x27;市场部&#x27;</span>,<span class="string">&#x27;上海&#x27;</span>),(<span class="number">30</span>,<span class="string">&#x27;销售部&#x27;</span>,<span class="string">&#x27;广州&#x27;</span>),(<span class="number">40</span>,<span class="string">&#x27;运营部&#x27;</span>,<span class="string">&#x27;深圳&#x27;</span>); </span><br><span class="line">	</span><br><span class="line">##员工表	</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp(</span><br><span class="line">	empno <span class="type">INT</span>  <span class="keyword">PRIMARY</span> KEY,	#员工编号</span><br><span class="line">	ename <span class="type">VARCHAR</span>(<span class="number">10</span>),		#员工姓名</span><br><span class="line">	job <span class="type">VARCHAR</span>(<span class="number">20</span>),			#员工工作</span><br><span class="line">	mgr <span class="type">INT</span>, 				#员工直属领导编号</span><br><span class="line">	hiredate <span class="type">DATE</span>, 			#入职时间</span><br><span class="line">	sal <span class="keyword">DOUBLE</span>,				#工资</span><br><span class="line">	comm <span class="keyword">DOUBLE</span>,			#奖金</span><br><span class="line">	deptno <span class="type">INT</span>				#对应dept表的外键</span><br><span class="line">);  </span><br><span class="line">## 添加 部门 和 员工 之间的主外键关系</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> <span class="keyword">FOREIGN</span> KEY emp(deptno) <span class="keyword">REFERENCES</span> dept (deptno);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span>(<span class="number">7369</span>,<span class="string">&#x27;smith&#x27;</span>,<span class="string">&#x27;保洁工作&#x27;</span>,<span class="number">7902</span>,&quot;1980-12-17&quot;,<span class="number">800</span>,<span class="keyword">NULL</span>,<span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span>(<span class="number">7499</span>,<span class="string">&#x27;allen&#x27;</span>,<span class="string">&#x27;销售工作&#x27;</span>,<span class="number">7698</span>,<span class="string">&#x27;1981-02-20&#x27;</span>,<span class="number">1600</span>,<span class="number">300</span>,<span class="number">30</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span>(<span class="number">7521</span>,<span class="string">&#x27;ward&#x27;</span>,<span class="string">&#x27;销售工作&#x27;</span>,<span class="number">7698</span>,<span class="string">&#x27;1981-02-22&#x27;</span>,<span class="number">1250</span>,<span class="number">500</span>,<span class="number">30</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span>(<span class="number">7566</span>,<span class="string">&#x27;jones&#x27;</span>,<span class="string">&#x27;管理工作&#x27;</span>,<span class="number">7839</span>,<span class="string">&#x27;1981-04-02&#x27;</span>,<span class="number">2975</span>,<span class="keyword">NULL</span>,<span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span>(<span class="number">7654</span>,<span class="string">&#x27;martin&#x27;</span>,<span class="string">&#x27;销售工作&#x27;</span>,<span class="number">7698</span>,<span class="string">&#x27;1981-09-28&#x27;</span>,<span class="number">1250</span>,<span class="number">1400</span>,<span class="number">30</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span>(<span class="number">7698</span>,<span class="string">&#x27;blake&#x27;</span>,<span class="string">&#x27;管理工作&#x27;</span>,<span class="number">7839</span>,<span class="string">&#x27;1981-05-01&#x27;</span>,<span class="number">2850</span>,<span class="keyword">NULL</span>,<span class="number">30</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span>(<span class="number">7782</span>,<span class="string">&#x27;clark&#x27;</span>,<span class="string">&#x27;管理工作&#x27;</span>,<span class="number">7839</span>,<span class="string">&#x27;1981-06-09&#x27;</span>,<span class="number">2450</span>,<span class="keyword">NULL</span>,<span class="number">10</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span>(<span class="number">7788</span>,<span class="string">&#x27;scott&#x27;</span>,<span class="string">&#x27;策划工作&#x27;</span>,<span class="number">7566</span>,<span class="string">&#x27;1987-07-03&#x27;</span>,<span class="number">3000</span>,<span class="keyword">NULL</span>,<span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span>(<span class="number">7839</span>,<span class="string">&#x27;king&#x27;</span>,<span class="string">&#x27;大BOSS&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;1981-11-17&#x27;</span>,<span class="number">5000</span>,<span class="keyword">NULL</span>,<span class="number">10</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span>(<span class="number">7844</span>,<span class="string">&#x27;turner&#x27;</span>,<span class="string">&#x27;销售工作&#x27;</span>,<span class="number">7698</span>,<span class="string">&#x27;1981-09-08&#x27;</span>,<span class="number">1500</span>,<span class="number">0</span>,<span class="number">30</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span>(<span class="number">7876</span>,<span class="string">&#x27;adams&#x27;</span>,<span class="string">&#x27;保洁工作&#x27;</span>,<span class="number">7788</span>,<span class="string">&#x27;1987-07-13&#x27;</span>,<span class="number">1100</span>,<span class="keyword">NULL</span>,<span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span>(<span class="number">7900</span>,<span class="string">&#x27;james&#x27;</span>,<span class="string">&#x27;保洁工作&#x27;</span>,<span class="number">7698</span>,<span class="string">&#x27;1981-12-03&#x27;</span>,<span class="number">950</span>,<span class="keyword">NULL</span>,<span class="number">30</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span>(<span class="number">7902</span>,<span class="string">&#x27;ford&#x27;</span>,<span class="string">&#x27;策划工作&#x27;</span>,<span class="number">7566</span>,<span class="string">&#x27;1981-12-03&#x27;</span>,<span class="number">3000</span>,<span class="keyword">NULL</span>,<span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span>(<span class="number">7934</span>,<span class="string">&#x27;miller&#x27;</span>,<span class="string">&#x27;保洁工作&#x27;</span>,<span class="number">7782</span>,<span class="string">&#x27;1981-01-23&#x27;</span>,<span class="number">1300</span>,<span class="keyword">NULL</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"># 工资等级表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> salgrade( </span><br><span class="line">	grade <span class="type">INT</span>,	#等级</span><br><span class="line">	losal <span class="keyword">DOUBLE</span>,	#最低工资</span><br><span class="line">	hisal <span class="keyword">DOUBLE</span> 	#最高工资</span><br><span class="line">);	</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> salgrade <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">700</span>,<span class="number">1200</span>),(<span class="number">2</span>,<span class="number">1201</span>,<span class="number">1400</span>),(<span class="number">3</span>,<span class="number">1401</span>,<span class="number">2000</span>),(<span class="number">4</span>,<span class="number">2001</span>,<span class="number">3000</span>),(<span class="number">5</span>,<span class="number">3001</span>,<span class="number">9999</span>);</span><br></pre></td></tr></table></figure>

<p>2 题目:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>返回拥有员工的部门名、部门号。</span><br><span class="line">	</span><br><span class="line">#<span class="number">2.</span>工资水平多于smith的员工信息。</span><br><span class="line">	</span><br><span class="line">#<span class="number">3.</span>返回员工和所属经理的姓名。</span><br><span class="line"></span><br><span class="line">#<span class="number">4.</span>返回雇员的雇佣日期早于其经理雇佣日期的员工及其经理姓名</span><br><span class="line">	</span><br><span class="line">#<span class="number">5.</span>返回员工姓名及其所在的部门名称。</span><br><span class="line">	</span><br><span class="line">#<span class="number">6.</span>返回从事&quot;保洁工作&quot;的员工姓名和所在部门名称。</span><br><span class="line">	</span><br><span class="line">#<span class="number">7.</span>返回部门号及其本部门的最低工资。</span><br><span class="line">	</span><br><span class="line">#<span class="number">8.</span>返回&quot;销售部&quot;所有员工的姓名。</span><br><span class="line">	</span><br><span class="line">#<span class="number">9.</span>返回工资水平多于平均工资的员工。</span><br><span class="line">	</span><br><span class="line">#<span class="number">10.</span>返回与SCOTT从事相同工作的员工。</span><br><span class="line">	</span><br><span class="line">#<span class="number">11.</span>返回与<span class="number">30</span>部门员工工资相同的员工姓名与工资。</span><br><span class="line">	</span><br><span class="line">#<span class="number">12.</span>返回工资高于<span class="number">30</span>部门所有员工工资的员工信息。	</span><br><span class="line">	</span><br><span class="line">#<span class="number">13.</span>返回部门号、部门名、部门所在位置及其每个部门的员工总数。</span><br><span class="line">	</span><br><span class="line">#<span class="number">14.</span>返回员工的姓名、所在部门名及其工资。</span><br><span class="line">	</span><br><span class="line">#<span class="number">15.</span>返回员工的详细信息。(包括部门名)</span><br><span class="line"></span><br><span class="line">#<span class="number">16.</span>返回员工工作及其从事此工作的最低工资。</span><br><span class="line">	</span><br><span class="line">#<span class="number">17.</span>计算出员工的年薪，并且以年薪排序。</span><br><span class="line">	</span><br><span class="line">#<span class="number">18.</span>返回工资处于第四级别的员工的姓名。</span><br><span class="line">	</span><br><span class="line">#<span class="number">19.</span>返回工资为二等级的职员名字、部门所在地、和二等级的最低工资和最高工资</span><br><span class="line">	</span><br><span class="line">#<span class="number">20.</span>工资等级多于smith的员工信息。</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">高明辉</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/01/21/Day04-mysql%E5%9F%BA%E7%A1%80-%E8%8C%83%E5%BC%8F-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2-%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0-%E4%BA%8B%E5%8A%A1/">http://example.com/2022/01/21/Day04-mysql%E5%9F%BA%E7%A1%80-%E8%8C%83%E5%BC%8F-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2-%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0-%E4%BA%8B%E5%8A%A1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Jason</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%8C%83%E5%BC%8F/">数据库范式</a><a class="post-meta__tags" href="/tags/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2/">多表查询</a><a class="post-meta__tags" href="/tags/MySQL%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/">MySQL常用函数</a><a class="post-meta__tags" href="/tags/%E4%BA%8B%E5%8A%A1/">事务</a></div><div class="post_share"><div class="social-share" data-image="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day04-mysql%E5%9F%BA%E7%A1%80/%E5%B0%81%E9%9D%A2.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="添加微信"/></a><div class="post-qr-code-desc">添加微信</div></li><li class="reward-item"><a href="/img/pay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/pay.jpg" alt="付款码"/></a><div class="post-qr-code-desc">付款码</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/01/22/Day05-mysql%E9%AB%98%E7%BA%A7-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95-%E8%A7%86%E5%9B%BE-%E8%A7%A6%E5%8F%91%E5%99%A8-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/"><img class="prev-cover" src="/img/java/02%E9%98%B6%E6%AE%B5mysql%E6%95%B0%E6%8D%AE%E5%BA%93/day05-mysql%E9%AB%98%E7%BA%A7/%E5%B0%81%E9%9D%A2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Day05-mysql高级-数据库索引-视图-触发器-存储过程</div></div></a></div><div class="next-post pull-right"><a href="/2022/01/21/hexo%E5%8D%9A%E5%AE%A2%E7%9A%84%E8%BF%81%E7%A7%BB/"><img class="next-cover" src="/img/hexo/%E5%B0%81%E9%9D%A2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">hexo博客的迁移</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%8C%83%E5%BC%8F"><span class="toc-number">1.</span> <span class="toc-text">第一章 数据库范式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AF%E8%8C%83%E5%BC%8F"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 什么是范式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E8%8C%83%E5%BC%8F%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 范式的基本分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E7%AC%AC%E4%B8%80%E8%8C%83%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 第一范式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E7%AC%AC%E4%BA%8C%E8%8C%83%E5%BC%8F"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 第二范式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-%E7%AC%AC%E4%B8%89%E8%8C%83%E5%BC%8F"><span class="toc-number">1.5.</span> <span class="toc-text">1.5 第三范式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-%E5%8F%8D%E4%B8%89%E8%8C%83%E5%BC%8F"><span class="toc-number">1.6.</span> <span class="toc-text">1.6 反三范式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.</span> <span class="toc-text">第二章 多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 笛卡尔积</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%B2%E8%A7%A3%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F%E5%89%8D%E5%85%88%E6%9D%A5%E4%B8%AA%E5%B0%8F%E7%BB%93%EF%BC%9A"><span class="toc-number">2.2.</span> <span class="toc-text">讲解多表查询方式前先来个小结：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.3.</span> <span class="toc-text">2.2 内连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.4.</span> <span class="toc-text">2.3 外连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.5.</span> <span class="toc-text">2.4 子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-%E5%8D%95%E8%A1%8C%E5%8D%95%E5%88%97"><span class="toc-number">2.5.1.</span> <span class="toc-text">2.4.1 单行单列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-%E5%A4%9A%E8%A1%8C%E5%8D%95%E5%88%97"><span class="toc-number">2.5.2.</span> <span class="toc-text">2.4.2 多行单列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-3-%E5%A4%9A%E8%A1%8C%E5%A4%9A%E5%88%97"><span class="toc-number">2.5.3.</span> <span class="toc-text">2.4.3 多行多列</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E6%A1%88%E4%BE%8B"><span class="toc-number">3.</span> <span class="toc-text">第三章 多表查询案例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 准备数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E7%BB%83%E4%B9%A0"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 练习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E7%BB%83%E4%B9%A01"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 练习1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-%E7%BB%83%E4%B9%A02"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 练习2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3-%E7%BB%83%E4%B9%A03"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.2.3 练习3</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-1-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E8%A7%84%E5%BE%8B%E6%80%BB%E7%BB%93"><span class="toc-number">3.2.3.1.</span> <span class="toc-text">3.2.3.1 多表查询规律总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-4-%E7%BB%83%E4%B9%A04"><span class="toc-number">3.2.4.</span> <span class="toc-text">3.2.4 练习4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-5-%E7%BB%83%E4%B9%A05"><span class="toc-number">3.2.5.</span> <span class="toc-text">3.2.5 练习5</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%95%B4%E5%90%88"><span class="toc-number">3.3.</span> <span class="toc-text">代码整合</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-MySQL%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">4.</span> <span class="toc-text">第四章 MySQL常用函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 字符串函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E6%95%B0%E5%AD%97%E5%87%BD%E6%95%B0"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 数字函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 日期函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E9%AB%98%E7%BA%A7%E5%87%BD%E6%95%B0"><span class="toc-number">4.4.</span> <span class="toc-text">4.4 高级函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%95%B4%E5%90%88%EF%BC%8C%E7%A4%BA%E8%8C%83%EF%BC%9A"><span class="toc-number">4.5.</span> <span class="toc-text">代码整合，示范：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E4%BA%8B%E5%8A%A1-%E2%98%85%E2%98%85"><span class="toc-number">5.</span> <span class="toc-text">第五章 事务 ★★</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%A6%82%E8%BF%B0"><span class="toc-number">5.0.1.</span> <span class="toc-text">5.1 事务的概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%BC%80%E5%90%AF%EF%BC%8C%E6%8F%90%E4%BA%A4%E4%BB%A5%E5%8F%8A%E5%9B%9E%E6%BB%9A"><span class="toc-number">5.0.2.</span> <span class="toc-text">5.2 事务的开启，提交以及回滚</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-1-%E6%89%8B%E5%8A%A8%E5%BC%80%E5%90%AF%E4%BA%8B%E5%8A%A1%E4%B8%8E%E6%8F%90%E4%BA%A4"><span class="toc-number">5.0.2.0.1.</span> <span class="toc-text">1.2.1 手动开启事务与提交</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-%E8%87%AA%E5%8A%A8%E5%BC%80%E5%90%AF%E4%BA%8B%E5%8A%A1"><span class="toc-number">5.0.2.0.2.</span> <span class="toc-text">1.2.2 自动开启事务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%9B%9E%E6%BB%9A%E7%82%B9%E5%92%8C%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86"><span class="toc-number">5.0.3.</span> <span class="toc-text">5.3 事务的回滚点和执行原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E4%BA%8B%E5%8A%A15-1%E2%80%935-3%E6%80%BB%E7%BB%93"><span class="toc-number">5.0.4.</span> <span class="toc-text">第五章 事务5.1–5.3总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E5%B9%B6%E5%8F%91%E8%AE%BF%E9%97%AE%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%89"><span class="toc-number">5.0.5.</span> <span class="toc-text">5.4 并发访问的问题（了解）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-1-%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">5.0.5.0.1.</span> <span class="toc-text">1.4.1 事务的隔离级别</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-2-%E8%84%8F%E8%AF%BB"><span class="toc-number">5.0.5.0.2.</span> <span class="toc-text">1.4.2 脏读</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-3-%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB"><span class="toc-number">5.0.5.0.3.</span> <span class="toc-text">1.4.3 不可重复读</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-4-%E5%B9%BB%E8%AF%BB"><span class="toc-number">5.0.5.0.4.</span> <span class="toc-text">1.4.4 幻读</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc-number">6.</span> <span class="toc-text">练习:</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.1.</span> <span class="toc-text">多表查询</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 高明辉</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'Aaee0Vekhg5KbLhMOJQrEU6A-gzGzoHsz',
      appKey: 'mmLHPEEtqvOSJhsqWra8Sq6K',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script type="text/javascript" src="/js/fairyDustCursor.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>