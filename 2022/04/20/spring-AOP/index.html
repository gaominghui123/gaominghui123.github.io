<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>spring-AOP | Jason</title><meta name="keywords" content="spring-AOP"><meta name="author" content="高明辉"><meta name="copyright" content="高明辉"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="第一章 动态代理1.1 基于接口的动态代理1234567动态代理: jdk     生成被代理类的代理类,代理类与被代理类为兄弟关系,实现了相同的接口     API: Proxy          static Object newProxyInstance(              ClassLoader loader,  &#x2F;&#x2F; 类加载器,将生成的代理类加载到内存">
<meta property="og:type" content="article">
<meta property="og:title" content="spring-AOP">
<meta property="og:url" content="http://example.com/2022/04/20/spring-AOP/index.html">
<meta property="og:site_name" content="Jason">
<meta property="og:description" content="第一章 动态代理1.1 基于接口的动态代理1234567动态代理: jdk     生成被代理类的代理类,代理类与被代理类为兄弟关系,实现了相同的接口     API: Proxy          static Object newProxyInstance(              ClassLoader loader,  &#x2F;&#x2F; 类加载器,将生成的代理类加载到内存">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/java/04%E9%98%B6%E6%AE%B5%E7%83%AD%E9%97%A8%E6%A1%86%E6%9E%B6/day03-spring-AOP/%E5%B0%81%E9%9D%A2.png">
<meta property="article:published_time" content="2022-04-20T15:31:46.000Z">
<meta property="article:modified_time" content="2022-08-04T15:30:33.405Z">
<meta property="article:author" content="高明辉">
<meta property="article:tag" content="spring-AOP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/java/04%E9%98%B6%E6%AE%B5%E7%83%AD%E9%97%A8%E6%A1%86%E6%9E%B6/day03-spring-AOP/%E5%B0%81%E9%9D%A2.png"><link rel="shortcut icon" href="/img/%E7%BD%91%E7%AB%99%E5%9B%BE%E6%A0%87.png"><link rel="canonical" href="http://example.com/2022/04/20/spring-AOP/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'spring-AOP',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-08-04 23:30:33'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Jason" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/%E5%A4%B4%E5%83%8F.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">176</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">206</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">34</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E5%85%B3%E4%BA%8E"><i class="fa-fw /about/"></i><span> 0</span></a></li><li><a class="site-page child" href="/myself"><i class="fa-fw /myself/"></i><span> 1</span></a></li><li><a class="site-page child" href="/butterfly%E4%B8%BB%E9%A2%98"><i class="fa-fw https://github.com/jerryc127/hexo-theme-butterfly/"></i><span> 2</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/java/04%E9%98%B6%E6%AE%B5%E7%83%AD%E9%97%A8%E6%A1%86%E6%9E%B6/day03-spring-AOP/%E5%B0%81%E9%9D%A2.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Jason</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E5%85%B3%E4%BA%8E"><i class="fa-fw /about/"></i><span> 0</span></a></li><li><a class="site-page child" href="/myself"><i class="fa-fw /myself/"></i><span> 1</span></a></li><li><a class="site-page child" href="/butterfly%E4%B8%BB%E9%A2%98"><i class="fa-fw https://github.com/jerryc127/hexo-theme-butterfly/"></i><span> 2</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">spring-AOP</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-04-20T15:31:46.000Z" title="发表于 2022-04-20 23:31:46">2022-04-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-08-04T15:30:33.405Z" title="更新于 2022-08-04 23:30:33">2022-08-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/spring/">spring</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="spring-AOP"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="第一章-动态代理"><a href="#第一章-动态代理" class="headerlink" title="第一章 动态代理"></a>第一章 动态代理</h1><h2 id="1-1-基于接口的动态代理"><a href="#1-1-基于接口的动态代理" class="headerlink" title="1.1 基于接口的动态代理"></a>1.1 基于接口的动态代理</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">动态代理: jdk</span><br><span class="line">     生成被代理类的代理类,代理类与被代理类为兄弟关系,实现了相同的接口</span><br><span class="line">     API: <span class="function">Proxy</span></span><br><span class="line"><span class="function">          <span class="keyword">static</span> Object <span class="title">newProxyInstance</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">              ClassLoader loader,  // 类加载器,将生成的代理类加载到内存</span></span></span><br><span class="line"><span class="params"><span class="function">              Class&lt;?&gt;[] interfaces, // 代理类需要实现的接口字节码(被代理类的接口)</span></span></span><br><span class="line"><span class="function">              InvocationHandler h)  <span class="comment">// 调用处理,在代理类中对方法进行增强</span></span></span><br></pre></td></tr></table></figure>



<h2 id="1-2-基于子类的动态代理-cglib第三方"><a href="#1-2-基于子类的动态代理-cglib第三方" class="headerlink" title="1.2 基于子类的动态代理(cglib第三方):"></a>1.2 基于子类的动态代理(cglib第三方):</h2><p>​    作用: 方法增强</p>
<p>​    要求: 导入cglib的jar包,但<strong>cglib已经被Spring整合了,所以导入Spring-context包即可</strong></p>
<h3 id="两种动态代理总结："><a href="#两种动态代理总结：" class="headerlink" title="两种动态代理总结："></a>两种动态代理总结：</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">Proxy基于接口</span> : <span class="string">JDK</span></span><br><span class="line">	<span class="attr">被代理类对象至少实现一个接口</span></span><br><span class="line">	<span class="attr">代理类和被代理类为兄弟关系</span></span><br><span class="line"><span class="meta">cglib基于子类</span> : <span class="string">cglib</span></span><br><span class="line">	<span class="attr">导入jar包坐标</span></span><br><span class="line">	<span class="meta">Enhancer.create(...);</span>  <span class="string"></span></span><br><span class="line">	<span class="attr">被代理类和代理类为父子关系</span></span><br><span class="line">	</span><br><span class="line"><span class="attr">Spring会自动抉择;Spring默认使用的是jdk</span></span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">动态代理的应用场景：</span></span><br><span class="line"><span class="meta">1.事务</span> :<span class="string">100w方法（手动控制事务）</span></span><br><span class="line">   <span class="attr">start</span> <span class="string">transaction</span></span><br><span class="line">      <span class="attr">逻辑；</span></span><br><span class="line">   <span class="meta">commit;/rollback;</span>   <span class="string"></span></span><br><span class="line"><span class="meta">2.统计方法执行的时间；--》需求：获取servie层中中每个方法执行的时间；</span>   <span class="string"></span></span><br><span class="line"><span class="attr">3.添加日志；</span></span><br><span class="line"><span class="attr">总之,动态代理应用于一些【共性代码--只开发一次】的抽取，并动态插入目标方法中；</span></span><br></pre></td></tr></table></figure>

<p>延申：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">Spring的AOP</span>: <span class="string">对方法进行增强</span></span><br><span class="line">	<span class="attr">AOP</span>:<span class="string">面向切面编程</span></span><br><span class="line">	<span class="attr">底层使用的是动态代理技术</span></span><br><span class="line">	<span class="meta">最终的目的</span>: <span class="string">让spring管理整个项目中的事务</span></span><br></pre></td></tr></table></figure>

<h1 id="第二章-Spring-AOP"><a href="#第二章-Spring-AOP" class="headerlink" title="第二章 Spring-AOP"></a>第二章 Spring-AOP</h1><h2 id="2-1-AOP概述"><a href="#2-1-AOP概述" class="headerlink" title="2.1 AOP概述"></a>2.1 AOP概述</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">AOP</span>:<span class="string">全称是 Aspect Oriented Programming</span></span><br><span class="line">    <span class="meta">即</span>:<span class="string">面向切面编程，是一种【编程范式】。（可以看成是OOP的一种补充吧）</span></span><br><span class="line">	<span class="meta">作用</span>:<span class="string">在程序【运行期间】,不修改源码的基础上对已有方法进行增强。</span></span><br><span class="line">	<span class="attr">优势：</span></span><br><span class="line">		<span class="attr">减少重复代码</span></span><br><span class="line">		<span class="attr">提高开发效率</span></span><br><span class="line">		<span class="attr">维护方便</span></span><br><span class="line">	<span class="attr">AOP</span> <span class="string">的实现方式: 动态代理(回顾前面博客，方法的前后增强)</span></span><br><span class="line">  	<span class="attr">依赖jdk的Proxy</span></span><br><span class="line">  	<span class="attr">依赖cglib的Enhancer</span></span><br></pre></td></tr></table></figure>

<h2 id="2-2-Spring的AOP"><a href="#2-2-Spring的AOP" class="headerlink" title="2.2 Spring的AOP"></a>2.2 Spring的AOP</h2><h3 id="【1】AOP相关术语-面试点"><a href="#【1】AOP相关术语-面试点" class="headerlink" title="【1】AOP相关术语: 面试点"></a>【1】AOP相关术语: 面试点</h3><ul>
<li><p><strong>Target</strong>（目标对象）:   要增强的对象(被代理的类对象)</p>
</li>
<li><p><strong>Proxy</strong>（代理对象） :  对目标对象的增强的对象 (生成的代理类对象)</p>
</li>
<li><p><strong>Joinpoint</strong>（连接点）:  目标对象中的所有方法(被代理类中的所有方法)—-&gt;可以被增强的方法</p>
</li>
</ul>
<p><img src="/img/java/04%E9%98%B6%E6%AE%B5%E7%83%AD%E9%97%A8%E6%A1%86%E6%9E%B6/day03-spring-AOP/1591281889446.png" alt="1591281889446"></p>
<ul>
<li><p><strong>Pointcut</strong>（切入点）:   要被增强的方法(被代理类中要增强的方法)</p>
</li>
<li><p><strong>Advice</strong>（通知/增强）:  增强的那段【代码方法】以及代码切入的位置</p>
<p>​                通知包含了2个维度内容：<strong>在增强方法的什么位置，切入什么代码；</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1</span> <span class="string">前置通知：在方法之前进行增强</span></span><br><span class="line"><span class="attr">2</span> <span class="string">后置通知 ：在方法之后进行增强</span></span><br><span class="line"><span class="attr">3</span> <span class="string">异常通知：在方法异常进行增强</span></span><br><span class="line"><span class="attr">4</span> <span class="string">最终通知 ：最终执行的方法进行增强</span></span><br><span class="line"><span class="attr">5</span> <span class="string">环绕通知：  单独使用（以上所有通知）</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>Aspect(切面):</strong> 切入点+通知=切面</p>
<p><strong>目标方法和增强方法</strong>合到在一起 叫做<strong>切面</strong>;  说白了切面描述了<strong>在什么样的目标方法下(切入点)的什么位置（通知类型）切入了什么样的(增强代码）</strong></p>
</li>
<li><p><strong>Weaving</strong>（织入）：</p>
<p>将增强的代码（方法）合并到目标方法的过程 叫织入过程;    </p>
</li>
</ul>
<p><strong>Spring AOP底层实现技术就是动态代理</strong></p>
<p>spring底层会<strong>自动抉择使用Jdk Proxy或Enhancer(cglib)</strong></p>
<p><img src="/img/java/04%E9%98%B6%E6%AE%B5%E7%83%AD%E9%97%A8%E6%A1%86%E6%9E%B6/day03-spring-AOP/image-20201201104721630.png" alt="image-20201201104721630"></p>
<h3 id="【2】AOP开发方式"><a href="#【2】AOP开发方式" class="headerlink" title="【2】AOP开发方式"></a>【2】AOP开发方式</h3><ul>
<li><p>XML方式</p>
</li>
<li><p>XML+注解方式</p>
</li>
<li><p>注解方式</p>
</li>
</ul>
<h3 id="【3】全xml方式实现AOP【最繁琐的】"><a href="#【3】全xml方式实现AOP【最繁琐的】" class="headerlink" title="【3】全xml方式实现AOP【最繁琐的】"></a>【3】全xml方式实现AOP【最繁琐的】</h3><h4 id="①入门案例制作分析"><a href="#①入门案例制作分析" class="headerlink" title="①入门案例制作分析"></a>①入门案例制作分析</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">案例: 对AccountServiceImpl下的方法进行增强;</span><br><span class="line">步骤如下：</span><br><span class="line"><span class="number">1.</span>导入相关jar坐标;  </span><br><span class="line"><span class="number">2.</span>自己封装要增强方法，并保存在某个专用类中【切面类/通知类/增强类】</span><br><span class="line"><span class="number">3.</span>将所有进行AOP操作的资源【切面类+目标对象】加载到IOC容器中；    </span><br><span class="line"><span class="number">4.</span>编写配置文件</span><br><span class="line">	告诉spring【切面类中的增强方法】在哪个对象的哪个方法上增强使用（配置切面）；</span><br></pre></td></tr></table></figure>

<h4 id="②具体步骤"><a href="#②具体步骤" class="headerlink" title="②具体步骤"></a>②具体步骤</h4><p><strong>1.导入jar包坐标</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- spring核心jar包,已经依赖的AOP的jar --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- spring整合单元测试的jar --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 单元测试的jar --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 切入点表达式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2.搭建目标对象</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.service.AccountService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;findAll....&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;findAll&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;save....&quot;</span>+str);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;update....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;delete....&quot;</span>);</span><br><span class="line">        System.out.println(<span class="number">1</span>/<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>3.编写通知类(切面类)</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 此类我们称之为切面类,在切面类中存放有各种通知</span></span><br><span class="line"><span class="comment"> * 切面 = 切入点 + 通知</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前置通知调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置通知:11111111111111&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 后置通知调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;后置通知:22222222222222&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常通知调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;异常通知:33333333333333&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最终通知调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;最终通知:44444444444444&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 环绕通知</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint 连接点 ---&gt; 切入点</span></span><br><span class="line"><span class="comment">     *        ProceedingJoinPoint: method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span></span>&#123;</span><br><span class="line">        Object result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;前置增强啊--111111111111&quot;</span>);</span><br><span class="line">            <span class="comment">// 让原方法执行  method.invoke()</span></span><br><span class="line">            result = joinPoint.proceed();</span><br><span class="line">            System.out.println(<span class="string">&quot;后置增强啊--222222222222&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            <span class="comment">//throwable.printStackTrace();</span></span><br><span class="line">            System.out.println(<span class="string">&quot;异常增强啊--333333333333&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;最终增强啊--444444444444&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4.applicationContext.xml配置</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 将目标类(被增强的类)存放到IOC容器中 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.service.impl.AccountServiceImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 将切面类加载到IOC容器中 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myAspect&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.aspect.MyAspect&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 面向切面编程====织入 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 切入点表达式 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定切面类 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;myAspect&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 前置通知 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- method: 调用的通知方法  pointcut: 切入点是什么 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--&lt;aop:before method=&quot;before&quot; pointcut=&quot;execution(public * </span></span><br><span class="line"><span class="comment">			com.itheima.service.impl.AccountServiceImpl.*(..))&quot;&gt;&lt;/aop:before&gt;</span></span><br><span class="line"><span class="comment">            &lt;aop:after-returning method=&quot;afterReturning&quot; pointcut=&quot;execution(public * </span></span><br><span class="line"><span class="comment">			com.itheima.service.impl.AccountServiceImpl.*(..))&quot;&gt;&lt;/aop:after-returning&gt;</span></span><br><span class="line"><span class="comment">            &lt;aop:after-throwing method=&quot;afterThrowing&quot; pointcut=&quot;execution(public * </span></span><br><span class="line"><span class="comment">			com.itheima.service.impl.AccountServiceImpl.*(..))&quot;&gt;&lt;/aop:after-throwing&gt;</span></span><br><span class="line"><span class="comment">            &lt;aop:after method=&quot;after&quot; pointcut=&quot;execution(public * </span></span><br><span class="line"><span class="comment">			com.itheima.service.impl.AccountServiceImpl.*(..))&quot;&gt;&lt;/aop:after&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;around&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(public * com.itheima.service.impl.AccountServiceImpl.*(..))&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:around</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line">解析：</span><br><span class="line"><span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;around&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution。。。&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:around</span>&gt;</span></span><br><span class="line">1 aop:around 中的around表示通知类型，</span><br><span class="line">2 method=&quot;around&quot; 中指明的是切面类的around方法，指定了当需要通知时，调用该方法代码进行增强通知！</span><br><span class="line">3 pointcut=...表示的及时切点了，表示那些切点方法被调用时会触发通知！</span><br><span class="line">    也就是说：</span><br><span class="line">    AccountServiceImpl 表示目标类，*表示该目标类的所有方法都添加了环绕通知（环绕增强）</span><br><span class="line">    只要目标类的目标方法（切入点）调用，</span><br><span class="line">    那么就会对该方法运进行前置，后置，异常（如果有的话），以及最终增强。</span><br></pre></td></tr></table></figure>

<p><strong>5.编写测试类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(&quot;classpath:applicationContext.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test01</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountService service;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        service.delete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="③切入点表达式"><a href="#③切入点表达式" class="headerlink" title="③切入点表达式"></a>③切入点表达式</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">切入点表达式:</span><br><span class="line">作用: 找到那些被增强的方法,类似正则表达式</span><br><span class="line">格式:</span><br><span class="line">    修饰符 返回值 方法的全限定名(参数列表)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> com.itheima.service.impl.AccountServiceImpl.delete()</span><br><span class="line">    说明：修饰符可省略不写，默认<span class="keyword">public</span>    </span><br><span class="line">支持通配符的写法：</span><br><span class="line">    *   ： 表示任意字符串</span><br><span class="line">    ..  ： 任意重复次数</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">阅读练习：</span><br><span class="line">    <span class="comment">//说明：第一个*表示任意返回值类型，第一个*匹配任意类，..匹配任意参数，</span></span><br><span class="line">    <span class="comment">//该表达式表示匹配任意类的任意方法（简化书写方式，很少用到）</span></span><br><span class="line">execution(* *(..)) </span><br><span class="line">    </span><br><span class="line">execution(* *..*(..))<span class="comment">//同上</span></span><br><span class="line">execution(* *..*.*(..))<span class="comment">//同上，更符合书写习惯，第一个*表示匹配任意返回值类型，*..表示匹配任意包名称及其任意子包，第三个*匹配任意类，第四个匹配任意方法</span></span><br><span class="line">execution(<span class="keyword">public</span> * *..*.*(..))<span class="comment">//表示匹配任意public修饰符的方法</span></span><br><span class="line">execution(<span class="keyword">public</span> <span class="keyword">int</span> *..*.*(..))<span class="comment">//表示陪陪任意返回值是int类型且修饰符是public的方法</span></span><br><span class="line">execution(<span class="keyword">public</span> <span class="keyword">void</span> *..*.*(..))<span class="comment">//匹配任意返回值是void且修饰符是public的方法</span></span><br><span class="line">execution(<span class="keyword">public</span> <span class="keyword">void</span> com..*.*(..))<span class="comment">//匹配com包及其任意子包下的被pulic修饰的返回值是void的方法</span></span><br><span class="line">execution(<span class="keyword">public</span> <span class="keyword">void</span> com..service.*.*(..))<span class="comment">//匹配com包下任意子包下存在service包下的任意类的任意方法，且方法为void 被public修饰</span></span><br><span class="line">execution(<span class="keyword">public</span> <span class="keyword">void</span> com.itheima.service.*.*(..))</span><br><span class="line">execution(<span class="keyword">public</span> <span class="keyword">void</span> com.itheima.service.User*.*(..))<span class="comment">//侧重点：任意一User开头的类下的任意void且被public修饰的方法</span></span><br><span class="line">execution(<span class="keyword">public</span> <span class="keyword">void</span> com.itheima.service.*Service.*(..))<span class="comment">//侧重点：任意一Service结尾的类下的任意方法</span></span><br><span class="line">execution(<span class="keyword">public</span> <span class="keyword">void</span> com.itheima.service.UserService.*(..))<span class="comment">//匹配UserService类下的任意方法...</span></span><br><span class="line">execution(<span class="keyword">public</span> User com.itheima.service.UserService.find*(..))<span class="comment">//侧重点：匹配UserService类下的任意以find开头的任意方法...</span></span><br><span class="line">execution(<span class="keyword">public</span> User com.itheima.service.UserService.*Id(..))<span class="comment">//侧点：匹配UserService类下的任意以id结尾的任意方法...</span></span><br><span class="line">execution(<span class="keyword">public</span> User com.itheima.service.UserService.findById(..))<span class="comment">//侧重点：匹配UserService类下方法名为findById的任意参数的方法....</span></span><br><span class="line">execution(<span class="keyword">public</span> User com.itheima.service.UserService.findById(<span class="keyword">int</span>))<span class="comment">//精准匹配，方法入参只有一个int类型</span></span><br><span class="line">execution(<span class="keyword">public</span> User com.itheima.service.UserService.findById(<span class="keyword">int</span>,<span class="keyword">int</span>))<span class="comment">//精准匹配，方法入参包含2个int类型</span></span><br><span class="line">execution(<span class="keyword">public</span> User com.itheima.service.UserService.findById(<span class="keyword">int</span>,*))<span class="comment">//2个入参，第一个必须int，第二个任意类型</span></span><br><span class="line">execution(<span class="keyword">public</span> User com.itheima.service.UserService.findById(*,<span class="keyword">int</span>))<span class="comment">//2个入参，第一个任意类型，第二个必须int类型</span></span><br><span class="line">execution(<span class="keyword">public</span> User com.itheima.service.UserService.findById())<span class="comment">//精准匹配无参</span></span><br><span class="line">execution(List com.itheima.service.*Service+.findAll(..))<span class="comment">//匹配任意以Service结尾的接口或者实现类下方法名为findAll的任意入参方法</span></span><br></pre></td></tr></table></figure>



<h3 id="【4】半xml半注解实现AOP"><a href="#【4】半xml半注解实现AOP" class="headerlink" title="【4】半xml半注解实现AOP"></a>【4】半xml半注解实现AOP</h3><p>xml:  jar包中的类使用xml</p>
<p>注解: 我们自己写的类使用注解</p>
<h4 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤:"></a>使用步骤:</h4><div style='background-color:orange;'>1.开启包扫描</div>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开启需要扫描的包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itheima&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 声明当前项目可以使用AOP的注解 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br></pre></td></tr></table></figure>

<div style='background-color:orange;'>2.在切面类中添加相关注解</div>    

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">注解：</span><br><span class="line">	<span class="meta">@Aspect</span> ： 声明切面类</span><br><span class="line">	<span class="meta">@PonitCut</span>：定义公共的切入点</span><br><span class="line">			配置到空方法上，value：切入点表达式</span><br><span class="line">			引用：方法名()</span><br><span class="line">配置通知类型：</span><br><span class="line">    <span class="meta">@Before()</span> : 前置通知</span><br><span class="line">    <span class="meta">@AfterReturning()</span> ： 后置通知</span><br><span class="line">    <span class="meta">@AfterThrowing()</span>  ：异常通知</span><br><span class="line">    <span class="meta">@After()</span>			：最终通知</span><br><span class="line">    <span class="meta">@Around()</span>			：环绕通知</span><br></pre></td></tr></table></figure>

<h4 id="相关代码"><a href="#相关代码" class="headerlink" title="相关代码:"></a>相关代码:</h4><p><strong>1.导入jar包坐标</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- spring核心jar包,已经依赖的AOP的jar --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- spring整合单元测试的jar --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 单元测试的jar --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 切入点表达式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2.搭建环境</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">------------------ 接口</span><br><span class="line"><span class="keyword">package</span> com.itheima.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">(String str)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">------------------ 实现类</span><br><span class="line"><span class="keyword">package</span> com.itheima.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.service.AccountService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="comment">//实现类跟切面类要先交给容器管理哦。</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;findAll....&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;findAll&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;save....&quot;</span>+str);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;update....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;delete....&quot;</span>);</span><br><span class="line">        <span class="comment">//System.out.println(1/0);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>3.编写通知类(切面类)</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 此类我们称之为切面类,在切面类中存放有各种通知</span></span><br><span class="line"><span class="comment"> * 切面 = 切入点 + 通知</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Aspect</span> : 声明此类为切面类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//实现类跟切面类要交给容器管理哦。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置切入点表达式</span></span><br><span class="line"><span class="comment">     * 调用切入点表单时,直接使用 方法名称()</span></span><br><span class="line"><span class="comment">     *      pt()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.itheima.service.*.AccountServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pt</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前置通知调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//@Before(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置通知:11111111111111&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 后置通知调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//@AfterReturning(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;后置通知:22222222222222&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常通知调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//@AfterThrowing(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;异常通知:33333333333333&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最终通知调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//@After(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;最终通知:44444444444444&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 环绕通知</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint 连接点 ---&gt; 切入点</span></span><br><span class="line"><span class="comment">     *        ProceedingJoinPoint: method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span></span>&#123;</span><br><span class="line">        Object result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;前置增强啊--111111111111&quot;</span>);</span><br><span class="line">            <span class="comment">// 让原方法执行  method.invoke()</span></span><br><span class="line">            result = joinPoint.proceed();</span><br><span class="line">            System.out.println(<span class="string">&quot;后置增强啊--222222222222&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            <span class="comment">//throwable.printStackTrace();</span></span><br><span class="line">            System.out.println(<span class="string">&quot;异常增强啊--333333333333&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;最终增强啊--444444444444&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4.applicationContext.xml配置</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 开启组件扫描 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itheima&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 开启对Spring-AOP注解的支持 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>5.编写测试类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.service.AccountService;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:applicationContext.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebClient</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountService service;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span></span>&#123;</span><br><span class="line">        service.delete();</span><br><span class="line">       <span class="comment">// service.update();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="【5】全注解实现AOP"><a href="#【5】全注解实现AOP" class="headerlink" title="【5】全注解实现AOP"></a>【5】全注解实现AOP</h3><p>@<strong>EnableAspectJAutoProxy</strong> ： 开启对AOP注解的支持</p>
<h5 id="aop全注解代码"><a href="#aop全注解代码" class="headerlink" title="aop全注解代码"></a>aop全注解代码</h5><p><strong>配置类代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 声明此类为Spring的配置类</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima&quot;)</span> <span class="comment">// 设置需要扫描的包(开启对Spring注解的支持)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span> <span class="comment">// 开启对AOP注解的支持</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>切面类代码</strong>（跟上面的一样）</p>
<p>目标类也是跟上面的一样（添加注解交给IOC就好了）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 此类我们称之为切面类,在切面类中存放有各种通知</span></span><br><span class="line"><span class="comment"> * 切面 = 切入点 + 通知</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Aspect</span> : 声明此类为切面类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置切入点表达式</span></span><br><span class="line"><span class="comment">     * 调用切入点表单时,直接使用 方法名称()</span></span><br><span class="line"><span class="comment">     *      pt()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.itheima.service.*.AccountServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pt</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前置通知调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//@Before(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置通知:11111111111111&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 后置通知调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//@AfterReturning(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;后置通知:22222222222222&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常通知调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//@AfterThrowing(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;异常通知:33333333333333&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最终通知调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//@After(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;最终通知:44444444444444&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 环绕通知</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint 连接点 ---&gt; 切入点</span></span><br><span class="line"><span class="comment">     *        ProceedingJoinPoint: method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span></span>&#123;</span><br><span class="line">        Object result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;前置增强啊--111111111111&quot;</span>);</span><br><span class="line">            <span class="comment">// 让原方法执行  method.invoke()</span></span><br><span class="line">            result = joinPoint.proceed();</span><br><span class="line">            System.out.println(<span class="string">&quot;后置增强啊--222222222222&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            <span class="comment">//throwable.printStackTrace();</span></span><br><span class="line">            System.out.println(<span class="string">&quot;异常增强啊--333333333333&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;最终增强啊--444444444444&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试类，有点不一样，<strong>引入xml配置文件改为引入 配置类</strong>！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.heima;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.heima.config.SpringConfig;</span><br><span class="line"><span class="keyword">import</span> com.heima.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> laofang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-06-12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="comment">//@ContextConfiguration(locations = &quot;classpath:applicationContext.xml.bak&quot;)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = SpringConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestAdvice</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span>  </span>&#123;</span><br><span class="line">        userService.query(<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="第三章-声明式事务★"><a href="#第三章-声明式事务★" class="headerlink" title="第三章 声明式事务★"></a>第三章 声明式事务★</h1><h2 id="3-1-事务须知"><a href="#3-1-事务须知" class="headerlink" title="3.1 事务须知"></a>3.1 事务须知</h2><p>【1】声明式事务介绍</p>
<p><strong>编程式事务：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">当我们的项目中没有集成进spring 仅仅使用mybatis的话 都会自己进行事务的管理，例如：</span><br><span class="line">     <span class="keyword">try</span> &#123; </span><br><span class="line">         sqlSessionFactory.openSession(<span class="keyword">false</span>);<span class="comment">//开启手动提交事务【前置通知】</span></span><br><span class="line">         update();</span><br><span class="line">         find();</span><br><span class="line">         delete();</span><br><span class="line">         <span class="comment">//业务逻辑</span></span><br><span class="line">         sqlSession.commit();<span class="comment">//提交事务【后置通知】</span></span><br><span class="line">     &#125;<span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">     	sqlSession.rollback();<span class="comment">//回滚事务【异常通知】</span></span><br><span class="line">     &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">         sqlsession.close;<span class="comment">//释放资源或者归还资源【最终通知】 </span></span><br><span class="line">     &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>声明式事务：</strong>（牛）相当AOP的环绕通知了！所以归根结底，声明式事务最底层还是利用到了动态代理！</p>
<pre><code>在spring中有声明式事务的概念。
我们可以利用xml配置文件的方法，或者使用Annotation的方法，
将需要加入事务控制的方法声明一下就可以了。

这样spring容器就会自动的扫描声明过的方法，自动的加入事务的开启 提交 回滚 资源释放等操作。
我们可以更加【专注于我们的业务逻辑】。这就是声明式事务的概念
</code></pre>
<p>【2】事务相关须知</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">事务:逻辑上的一组操作要么同时成功，要么同时失败</span><br><span class="line">javaEE采用分层思想,我们一般将事务放在service层(业务层)</span><br><span class="line">在业务开始之前开启手动事务,在业务执行完毕后提交或回滚事务,最终归还连接到连接池</span><br><span class="line">    </span><br><span class="line">Spring框架为我们提供了一组事务操作方法,存放这些方法的类,我们称之为切面类.</span><br><span class="line">也就是说Spring 为我们提供好了事务切面类，我们直接使用这个切面来对我们的业务进行事务控制就好！</span><br></pre></td></tr></table></figure>

<p>小结：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>什么是事务?</span><br><span class="line">  	逻辑上的一组操作要么同时成功，要么同时失败</span><br><span class="line"><span class="number">2.</span>事务在java代码中使用在service层</span><br><span class="line"><span class="number">3.</span>AOP事务控制时,Spring提供了切面类,在切面类中存放有事务的相关通知</span><br><span class="line">   </span><br></pre></td></tr></table></figure>

<p>至此可以总结到 Spring AOP的一些应用：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1</span> <span class="string">可以统计方法的运算时间（前后增强）</span></span><br><span class="line"><span class="attr">2</span> <span class="string">统计日志</span></span><br><span class="line"><span class="attr">3</span> <span class="string">声明式事务！</span></span><br></pre></td></tr></table></figure>



<h2 id="3-2-转账环境搭建（这里还没有使用事务控制）"><a href="#3-2-转账环境搭建（这里还没有使用事务控制）" class="headerlink" title="3.2 转账环境搭建（这里还没有使用事务控制）"></a>3.2 转账环境搭建（这里还没有使用事务控制）</h2><p>数据准备：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> account(</span><br><span class="line">	id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">	NAME <span class="type">VARCHAR</span>(<span class="number">40</span>),</span><br><span class="line">	money <span class="type">FLOAT</span></span><br><span class="line">)<span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> account(NAME,money) <span class="keyword">VALUES</span>(<span class="string">&#x27;aaa&#x27;</span>,<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> account(NAME,money) <span class="keyword">VALUES</span>(<span class="string">&#x27;bbb&#x27;</span>,<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> account(NAME,money) <span class="keyword">VALUES</span>(<span class="string">&#x27;ccc&#x27;</span>,<span class="number">1000</span>);</span><br></pre></td></tr></table></figure>





<h3 id="1-pom-xml"><a href="#1-pom-xml" class="headerlink" title="1.pom.xml"></a>1.pom.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>day03_05_spring_aop_transaction_xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- spring核心jar包,已经依赖的AOP的jar --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- jdbcTemplate --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.37<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- spring整合单元测试的jar --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 单元测试的jar --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 切入点表达式 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-java代码"><a href="#2-java代码" class="headerlink" title="2.java代码"></a>2.java代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">---------------------dao接口</span><br><span class="line"><span class="keyword">package</span> com.itheima.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Account;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line">    <span class="function">Account <span class="title">findAccountByName</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">jianQian</span><span class="params">(String fromSub, <span class="keyword">float</span> money)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">jiaQian</span><span class="params">(String toSub, <span class="keyword">float</span> money)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---------------------dao实现类</span><br><span class="line"><span class="keyword">package</span> com.itheima.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.dao.AccountDao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Account;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.BeanPropertyRowMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate template;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根基账户名查询账户详情</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Account <span class="title">findAccountByName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;select * from account where name = ? &quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> template.queryForObject(sql,<span class="keyword">new</span> BeanPropertyRowMapper&lt;Account&gt;(Account.class),name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从转出人账户上减钱</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fromSub</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">jianQian</span><span class="params">(String fromSub, <span class="keyword">float</span> money)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;update account set money=money-? where name = ? &quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> template.update(sql,money, fromSub);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 给转入人账户上加钱</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> toSub</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">jiaQian</span><span class="params">(String toSub, <span class="keyword">float</span> money)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;update account set money=money+? where name = ? &quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> template.update(sql,money, toSub);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTemplate</span><span class="params">(JdbcTemplate template)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.template = template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---------------------service接口</span><br><span class="line"><span class="keyword">package</span> com.itheima.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">transfer</span><span class="params">(String fromSub, String toSub, <span class="keyword">float</span> money)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---------------------service实现类</span><br><span class="line"><span class="keyword">package</span> com.itheima.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.dao.AccountDao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Account;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.AccountService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">transfer</span><span class="params">(String fromSub, String toSub, <span class="keyword">float</span> money)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 完成转账业务</span></span><br><span class="line">        <span class="comment">// 账户余额查询</span></span><br><span class="line">        Account fromAccount = accountDao.findAccountByName(fromSub);</span><br><span class="line">        Account toAccount =accountDao.findAccountByName(toSub);</span><br><span class="line">        System.out.println(<span class="string">&quot;=====================&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;转出人: &quot;</span>+ fromAccount);</span><br><span class="line">        System.out.println(<span class="string">&quot;转入人: &quot;</span>+ toAccount);</span><br><span class="line">        System.out.println(<span class="string">&quot;=====================&quot;</span>);</span><br><span class="line">        <span class="comment">// 转账</span></span><br><span class="line">        <span class="comment">// 从转出人账户上扣钱</span></span><br><span class="line">        <span class="keyword">int</span> i = accountDao.jianQian(fromSub,money);</span><br><span class="line">        <span class="comment">// 默认错误</span></span><br><span class="line">        <span class="comment">//System.out.println(1/0);</span></span><br><span class="line">        <span class="comment">// 给转入人账户上加钱</span></span><br><span class="line">        <span class="keyword">int</span> j = accountDao.jiaQian(toSub,money);</span><br><span class="line">        <span class="keyword">return</span> i&gt;<span class="number">0</span>&amp;&amp;j&gt;<span class="number">0</span> ? <span class="keyword">true</span> : <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccountDao</span><span class="params">(AccountDao accountDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.accountDao = accountDao;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-applicationContext-xml配置文件"><a href="#3-applicationContext-xml配置文件" class="headerlink" title="3.applicationContext.xml配置文件"></a>3.applicationContext.xml配置文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span> <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">         http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">         http://www.springframework.org/schema/tx/spring-tx.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 目标对象: 创建Service层对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;AccountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.service.impl.AccountServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;accountDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;AccountDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 创建dao层对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;AccountDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.AccountDaoImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;template&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;JdbcTemplate&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 创建JdbcTemplate对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;JdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 创建连接池 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 解析propries配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置数据源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-jdbc-properties"><a href="#4-jdbc-properties" class="headerlink" title="4.jdbc.properties"></a>4.jdbc.properties</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/itheima118_spring</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>

<h4 id="5-测试类"><a href="#5-测试类" class="headerlink" title="5.测试类"></a>5.测试类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.service.AccountService;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:applicationContext.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTransfer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String fromSub = <span class="string">&quot;tom&quot;</span>; <span class="comment">// 转出人</span></span><br><span class="line">        String toSub = <span class="string">&quot;rose&quot;</span>; <span class="comment">// 转入人</span></span><br><span class="line">        <span class="keyword">float</span> money = <span class="number">100f</span>; <span class="comment">// 转账金额</span></span><br><span class="line">        <span class="keyword">boolean</span> flag = service.transfer(fromSub, toSub, money);</span><br><span class="line">        <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;转账成功...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-3-事务相关API介绍"><a href="#3-3-事务相关API介绍" class="headerlink" title="3.3 事务相关API介绍"></a>3.3 事务相关API介绍</h2><h3 id="【1】PlatformTransactionManager"><a href="#【1】PlatformTransactionManager" class="headerlink" title="【1】PlatformTransactionManager"></a>【1】PlatformTransactionManager</h3><p>此接口是 spring 的事务管理器，它里面提供了我们常用的操作事务的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">PlatformTransactionManager: 接口,控制事务的提交或回滚</span><br><span class="line">    <span class="comment">// 获取事务的状态</span></span><br><span class="line">	<span class="function">TransactionStatus <span class="title">getTransaction</span><span class="params">(TransactionDefinition definition)</span></span>;</span><br><span class="line">    <span class="comment">// 提交事务</span></span><br><span class="line">	commit(TransactionStatus status);</span><br><span class="line">    <span class="comment">// 回滚事务</span></span><br><span class="line">	rollback(TransactionStatus status);</span><br><span class="line"></span><br><span class="line">实现类: 真正管理实务的对象</span><br><span class="line">    ★★DatasourceTransactionManager：		对jdbc操作的事务管理器（mybatis，jdbctemplate）</span><br><span class="line">    HibernateTransactionManager： 		对hibernate操作的事务管理器（hibernate）</span><br><span class="line">    JPATransactionManager：		 	   对jpa操作的事务管理器（jpa）</span><br><span class="line">    </span><br><span class="line">封装JDBC的框架:</span><br><span class="line">  JdbcTemplate</span><br><span class="line">  Mybatis</span><br><span class="line">  Hibernate</span><br><span class="line">  JPA  </span><br></pre></td></tr></table></figure>

<h3 id="【2】TransactionDefinition【了解】"><a href="#【2】TransactionDefinition【了解】" class="headerlink" title="【2】TransactionDefinition【了解】"></a>【2】TransactionDefinition【了解】</h3><p>此接口定义了事务的基本信息</p>
<ul>
<li><p>获取事务定义名称</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">String <span class="title">getName</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>获取事务的读写属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isReadOnly</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>获取事务隔离级别</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getIsolationLevel</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>获取事务超时时间</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getTimeout</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>获取事务传播行为特征</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getPropagationBehavior</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="①事务4大隔离级别"><a href="#①事务4大隔离级别" class="headerlink" title="①事务4大隔离级别"></a>①事务4大隔离级别</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">事务：逻辑上的一组操作要么同时成功，要么同时失败</span><br><span class="line">特性：ACID 原子性，一致性，隔离性，持久性</span><br><span class="line">在不考虑隔离性的前提下：</span><br><span class="line">  ​	脏读: 一个事务读取到了另一个事务中尚未提交的数据</span><br><span class="line">  ​	不可重复度: 一个事务中两次读取的数据内容不一致，要求的是一个事务中多次读取时数据是一致的，这是事务update时引发的问题</span><br><span class="line">  ​	虚读，幻读: 一个事务中两次读取的数据的数量不一致，要求在一个事务多次读取的数据的数量是一致的，这是insert或delete时引发的问题</span><br><span class="line">---------</span><br><span class="line">解决：设置隔离级别</span><br><span class="line">  ​	Read unCommitted	：什么都解决不了</span><br><span class="line">  ​	Read committed		：解决脏读  Oracle</span><br><span class="line">  ​	Repeatable Read		：解决脏读和不可重复读 Mysql</span><br><span class="line">  ​	Serializable		：解决所有但是不用</span><br><span class="line">一般使用默认值</span><br></pre></td></tr></table></figure>

<h4 id="②超时时间"><a href="#②超时时间" class="headerlink" title="②超时时间"></a>②超时时间</h4><p>​    使用默认值 -1</p>
<p>​    意思为,什么时候执行完,什么时候提交或回滚事务</p>
<h4 id="③事务的7大传播行为"><a href="#③事务的7大传播行为" class="headerlink" title="③事务的7大传播行为"></a>③事务的7大传播行为</h4><p>在一个业务中事务是可以相互传播的</p>
<p>​    1 <strong>REQUIRED</strong>:如果当前没有事务，就新建一个事务，如果已经存在一个事务，加入到这个事务中。一般的选择（默认值）  <strong>针对增删改</strong> (如果没有事务，那么自己就创建一个事务，如果有事务，就加入这个事务)</p>
<p>​    2 <strong>SUPPORTS</strong>:支持当前事务，如果当前没有事务，就以非事务方式执行（没有事务）     <strong>针对查询</strong></p>
<p><img src="/img/java/04%E9%98%B6%E6%AE%B5%E7%83%AD%E9%97%A8%E6%A1%86%E6%9E%B6/day03-spring-AOP/image-20210522235110099.png" alt="image-20210522235110099"></p>
<h4 id="④是否是只读事务（readOnly-：true（只读事务）或-false（非只读事务））"><a href="#④是否是只读事务（readOnly-：true（只读事务）或-false（非只读事务））" class="headerlink" title="④是否是只读事务（readOnly ：true（只读事务）或  false（非只读事务））"></a>④是否是只读事务（<strong>readOnly</strong> ：true（只读事务）或  false（非只读事务））</h4><p>​    <strong>只读事务</strong>        ：适用于查询操作；</p>
<p>​    <strong>非只读事务</strong>    ：适用于增删改操作；</p>
<p>说明：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring中readOnly的定义，并不是不能在事务中进行修改等DML操作;</span><br><span class="line">它只是一个“暗示”，提示数据库驱动程序和数据库系统，这个事务并不包含更改数据的操作，</span><br><span class="line">那么JDBC驱动程序和数据库就有可能根据这种情况对该事务进行一些特定的优化，</span><br><span class="line">比方说不安排相应的数据库锁，以减轻事务对数据库的压力，毕竟事务也是要消耗数据库的资源的;</span><br></pre></td></tr></table></figure>

<p>参考链接：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.spring.io/spring-framework/docs/3.2.x/javadoc-api/org/springframework/transaction/annotation/Transactional.html</span><br></pre></td></tr></table></figure>

<p><strong>通过如下几个例子，理解事务的传播特性，已经增删改，查，readonly 之间的关系：</strong></p>
<p><img src="/img/java/04%E9%98%B6%E6%AE%B5%E7%83%AD%E9%97%A8%E6%A1%86%E6%9E%B6/day03-spring-AOP/image-20201201160459516.png" alt="image-20201201160459516"></p>
<h4 id="重要★★"><a href="#重要★★" class="headerlink" title="重要★★:"></a><strong>重要★★:</strong></h4><p><strong>1 增删改</strong>操作配置：</p>
<p>​        <strong>传播行为：REQUIRED</strong></p>
<p>​        <strong>是否只读：false</strong></p>
<p><strong>2  查询</strong>操作配置:</p>
<p>​        <strong>传播行为：SUPPORTS</strong></p>
<p>​        <strong>是否只读：true</strong></p>
<h2 id="3-4-声明式事务实现"><a href="#3-4-声明式事务实现" class="headerlink" title="3.4 声明式事务实现"></a>3.4 声明式事务实现</h2><h4 id="【1】全xml配置"><a href="#【1】全xml配置" class="headerlink" title="【1】全xml配置:"></a>【1】全xml配置:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DatasourceTransactionManager: 事务管理器,Spring提供的</span><br><span class="line">	控制事务,相当于我们自己写的MyAspect</span><br><span class="line"><span class="number">1.</span>将事务管理器交给spring容器管理(创建DatasourceTransactionManager对象放入IOC容器中)</span><br><span class="line"><span class="number">2.</span>配置事务相关属性（不同的方法对事务的支持情况）</span><br><span class="line">	在执行 增删改 时必须要有事务控制</span><br><span class="line">		传播行为：REQUIRED</span><br><span class="line">		是否只读：<span class="keyword">false</span></span><br><span class="line">	在执行 查询 时可有可无事务</span><br><span class="line">		传播行为：SUPPORTS</span><br><span class="line">		是否只读：<span class="keyword">true</span></span><br><span class="line"><span class="number">3.</span>配置事务AOP（切入点，切入点和事务通知的对应关系）</span><br></pre></td></tr></table></figure>

<h5 id="配置文件代码"><a href="#配置文件代码" class="headerlink" title="配置文件代码"></a>配置文件代码</h5><p>在以上环境的基础上修改配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span> <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">         http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">         http://www.springframework.org/schema/tx/spring-tx.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 目标对象: 创建Service层对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;AccountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.service.impl.AccountServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;accountDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;AccountDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 创建dao层对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;AccountDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.dao.impl.AccountDaoImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;template&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;JdbcTemplate&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 创建JdbcTemplate对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;JdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 创建连接池 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 解析propries配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置数据源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ============配置声明式事务=============== --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  TODO 1 :将事务管理器交给spring容器管理(创建对象放入IOC容器中)--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 事务管理对象中存放有各种通知:开启手动事务,提交事务,回滚事务.... --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- TODO2:配置事务管理平台的 顾问 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注意: 约束别导错了 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;myAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 在执行对应的方法时,采用此处的配置 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                1 read-only: 设置是否为只读事务</span></span><br><span class="line"><span class="comment">                    false</span></span><br><span class="line"><span class="comment">                2 timeout: 设置超时时间(秒)</span></span><br><span class="line"><span class="comment">                    -1</span></span><br><span class="line"><span class="comment">                3 propagation: 传播行为</span></span><br><span class="line"><span class="comment">                    REQUIRED 或者 SUPPORTS</span></span><br><span class="line"><span class="comment">                4 isolation: 隔离级别</span></span><br><span class="line"><span class="comment">                    REPEATABLE_READ</span></span><br><span class="line"><span class="comment">			下面的aop:pointcut id=&quot;pt&quot;标签内容只是指明那些方法时切入点，而这里根据name表达式，</span></span><br><span class="line"><span class="comment">			更确切的指明不同方法使用具体不同的事务传播特性！</span></span><br><span class="line"><span class="comment">              --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;false&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;find*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span> <span class="attr">timeout</span>=<span class="string">&quot;-1&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;SUPPORTS&quot;</span> <span class="attr">isolation</span>=<span class="string">&quot;REPEATABLE_READ&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;query*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;SUPPORTS&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- TODO3 :配置织入 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置切入点 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.itheima.service.impl.*.*(..))&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:pointcut</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 方法增强时找顾问 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;myAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="测试类-跟上面使用JDBCTemplate-转账的代码完全一样，不同的是添加上面的配置文件就好啦，其他代码完全不变，看，是不是只用在xml文件中“声明”什么方法使用什么样的事务，这就是声明式事务！"><a href="#测试类-跟上面使用JDBCTemplate-转账的代码完全一样，不同的是添加上面的配置文件就好啦，其他代码完全不变，看，是不是只用在xml文件中“声明”什么方法使用什么样的事务，这就是声明式事务！" class="headerlink" title="测试类(跟上面使用JDBCTemplate 转账的代码完全一样，不同的是添加上面的配置文件就好啦，其他代码完全不变，看，是不是只用在xml文件中“声明”什么方法使用什么样的事务，这就是声明式事务！)"></a>测试类(跟上面使用JDBCTemplate 转账的代码完全一样，不同的是添加上面的配置文件就好啦，其他代码完全不变，看，是不是只用在xml文件中“声明”什么方法使用什么样的事务，这就是声明式事务！)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.service.AccountService;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:applicationContext.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTransfer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String fromSub = <span class="string">&quot;tom&quot;</span>; <span class="comment">// 转出人</span></span><br><span class="line">        String toSub = <span class="string">&quot;rose&quot;</span>; <span class="comment">// 转入人</span></span><br><span class="line">        <span class="keyword">float</span> money = <span class="number">100f</span>; <span class="comment">// 转账金额</span></span><br><span class="line">        <span class="keyword">boolean</span> flag = service.transfer(fromSub, toSub, money);</span><br><span class="line">        <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;转账成功...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>至此来个小总结</strong>：转账业务，是要开启事务，保障转账这个业务的事务完整性。以前是直接使用Mybatis 封装的方法，sqlSessionFactory.openSession(false);开启手动提交事务【前置通知】；sqlSession.commit();//提交事务【后置通知】来手动提交；这称为 <strong>编程式事务</strong>。而这里的前置跟后置相当于动态代理的前后增强，因此我们需要写切面类，切面方法，然后添加到切点方法（目标方法，也就是转账方法）来完成前后置；但由于<strong>spring已经帮我们写好了针对事务问题的切面类</strong>，我们只需要在配置文件（或注解方式）按照规则声明，就可以给目标方法添加前后置内容，来完成事务的自动提交（先设为手动提交，再手动提交），这种方式称为 <strong>声明式事务</strong>。</p>
<h4 id="【2】半xml和半注解配置"><a href="#【2】半xml和半注解配置" class="headerlink" title="【2】半xml和半注解配置:"></a>【2】半xml和半注解配置:</h4><p>​    相比全xml方式,只修改了配置文件</p>
<p>​    将配置文件中我们自己的类使用注解,其他不变</p>
<p>​    需要在我们的类上添加相关注解(不在提供代码)</p>
<h5 id="配置文件代码-1"><a href="#配置文件代码-1" class="headerlink" title="配置文件代码"></a>配置文件代码</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span> <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">         http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">         http://www.springframework.org/schema/tx/spring-tx.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 开启包扫描 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itheima&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 解析propries配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 创建JdbcTemplate对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;JdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 创建连接池 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置数据源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ============配置声明式事务=============== --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  <span class="doctag">TODO:</span>配置事务管理平台,在事务管理平台对象中存放有各种通知 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  开启手动事务,提交事务,回滚事务.... --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 一下两个标签，区别 全xml方式 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 开启AOP自动代理支持 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 开启事务注解支持 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:annotation-driven</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="service层代码（上面已经讲过了，在service层-使用事务！！！！！！！！！！！！！！！！！！）"><a href="#service层代码（上面已经讲过了，在service层-使用事务！！！！！！！！！！！！！！！！！！）" class="headerlink" title="service层代码（上面已经讲过了，在service层 使用事务！！！！！！！！！！！！！！！！！！）"></a>service层代码（上面已经讲过了，在service层 使用事务！！！！！！！！！！！！！！！！！！）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.dao.AccountDao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Account;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.AccountService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Propagation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	（相比较xml配置，给类或方法添加事务时，注解方式更灵活，xml方式更统一）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Transactional</span>: 可以使用在类上或方法上</span></span><br><span class="line"><span class="comment"> *      1 类上: 当前类中所有的方法都需要事务控制,并遵循类上的相关配置</span></span><br><span class="line"><span class="comment"> *      2 方法上: 当前方法需要事务控制,并遵循方法上的相关配置</span></span><br><span class="line"><span class="comment"> *      	注意: 如果类上和方法上都有,则听方法的（局部优先级最大）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional(readOnly = false,propagation = Propagation.REQUIRED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(readOnly = false,propagation = Propagation.REQUIRED)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">transfer</span><span class="params">(String fromSub, String toSub, <span class="keyword">float</span> money)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 完成转账业务</span></span><br><span class="line">        <span class="comment">// 账户余额查询</span></span><br><span class="line">        Account fromAccount = accountDao.findAccountByName(fromSub);</span><br><span class="line">        Account toAccount =accountDao.findAccountByName(toSub);</span><br><span class="line">        System.out.println(<span class="string">&quot;=====================&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;转出人: &quot;</span>+ fromAccount);</span><br><span class="line">        System.out.println(<span class="string">&quot;转入人: &quot;</span>+ toAccount);</span><br><span class="line">        System.out.println(<span class="string">&quot;=====================&quot;</span>);</span><br><span class="line">        <span class="comment">// 转账</span></span><br><span class="line">        <span class="comment">// 从转出人账户上扣钱</span></span><br><span class="line">        <span class="keyword">int</span> i = accountDao.jianQian(fromSub,money);</span><br><span class="line">        <span class="comment">// 默认错误</span></span><br><span class="line">        System.out.println(<span class="number">1</span>/<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 给转入人账户上加钱</span></span><br><span class="line">        <span class="keyword">int</span> j = accountDao.jiaQian(toSub,money);</span><br><span class="line">        <span class="keyword">return</span> i&gt;<span class="number">0</span>&amp;&amp;j&gt;<span class="number">0</span> ? <span class="keyword">true</span> : <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:applicationContext.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTransfer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String fromSub = <span class="string">&quot;tom&quot;</span>; <span class="comment">// 转出人</span></span><br><span class="line">        String toSub = <span class="string">&quot;rose&quot;</span>; <span class="comment">// 转入人</span></span><br><span class="line">        <span class="keyword">float</span> money = <span class="number">100f</span>; <span class="comment">// 转账金额</span></span><br><span class="line">        <span class="keyword">boolean</span> flag = service.transfer(fromSub, toSub, money);</span><br><span class="line">        <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;转账成功...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="【3】全注解配置"><a href="#【3】全注解配置" class="headerlink" title="【3】全注解配置:"></a>【3】全注解配置:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">需要用到的相关注解:</span><br><span class="line">    <span class="meta">@Configuration</span> <span class="comment">// 声明此类为Spring的核心配置类</span></span><br><span class="line">    <span class="meta">@ComponentScan(&quot;com.itheima&quot;)</span> <span class="comment">// 开启包扫描</span></span><br><span class="line">    <span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span> <span class="comment">// 加载properties配置文件</span></span><br><span class="line">    <span class="meta">@EnableAspectJAutoProxy</span> <span class="comment">// 开启AOP代理支持</span></span><br><span class="line">    <span class="meta">@EnableTransactionManagement</span> <span class="comment">// 开启事务注解支持</span></span><br><span class="line">设置类或方法需要事务增强（相比较xml配置，注解方式更灵活，xml更统一）</span><br><span class="line">    <span class="meta">@Transactional(propagation =Propagation.REQUIRED,readOnly = false)</span></span><br></pre></td></tr></table></figure>

<div style='background-color:orange;'>配置类</div>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span> <span class="comment">// 开启AOP代理支持</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span> <span class="comment">// 开启事务注解的支持</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.driver&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">getJdbcTemplate</span><span class="params">(<span class="meta">@Qualifier(&quot;dataSource&quot;)</span> DataSource dataSource)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;dataSource&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">getDataSource</span><span class="params">()</span> <span class="keyword">throws</span> PropertyVetoException </span>&#123;</span><br><span class="line">        ComboPooledDataSource dataSource = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">        dataSource.setDriverClass(driver);</span><br><span class="line">        dataSource.setJdbcUrl(url);</span><br><span class="line">        dataSource.setUser(username);</span><br><span class="line">        dataSource.setPassword(password);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSourceTransactionManager </span></span><br><span class="line"><span class="function">        <span class="title">getDataSourceTransactionManager</span><span class="params">(<span class="meta">@Qualifier(&quot;dataSource&quot;)</span> DataSource dataSource)</span></span>&#123;</span><br><span class="line">        DataSourceTransactionManager transactionManager = <span class="keyword">new</span> 	</span><br><span class="line">            DataSourceTransactionManager();</span><br><span class="line">        transactionManager.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> transactionManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<div style='background-color:orange;'>service层的代码</div>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Transactional</span>: 可以使用在类上或方法上</span></span><br><span class="line"><span class="comment"> *      类上: 当前类中所有的方法都需要事务控制,并遵循类上的相关配置</span></span><br><span class="line"><span class="comment"> *      方法上: 当前方法需要事务控制,并遵循方法上的相关配置</span></span><br><span class="line"><span class="comment"> *      注意: 如果类上和方法上都有,则听方法的. 作用域越小，权利越大。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional(readOnly = false,propagation = Propagation.REQUIRED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(readOnly = false,propagation = Propagation.REQUIRED)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">transfer</span><span class="params">(String fromSub, String toSub, <span class="keyword">float</span> money)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 完成转账业务</span></span><br><span class="line">        <span class="comment">// 账户余额查询</span></span><br><span class="line">        Account fromAccount = accountDao.findAccountByName(fromSub);</span><br><span class="line">        Account toAccount =accountDao.findAccountByName(toSub);</span><br><span class="line">        System.out.println(<span class="string">&quot;=====================&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;转出人: &quot;</span>+ fromAccount);</span><br><span class="line">        System.out.println(<span class="string">&quot;转入人: &quot;</span>+ toAccount);</span><br><span class="line">        System.out.println(<span class="string">&quot;=====================&quot;</span>);</span><br><span class="line">        <span class="comment">// 转账</span></span><br><span class="line">        <span class="comment">// 从转出人账户上扣钱</span></span><br><span class="line">        <span class="keyword">int</span> i = accountDao.jianQian(fromSub,money);</span><br><span class="line">        <span class="comment">// 默认错误</span></span><br><span class="line">        System.out.println(<span class="number">1</span>/<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 给转入人账户上加钱</span></span><br><span class="line">        <span class="keyword">int</span> j = accountDao.jiaQian(toSub,money);</span><br><span class="line">        <span class="keyword">return</span> i&gt;<span class="number">0</span>&amp;&amp;j&gt;<span class="number">0</span> ? <span class="keyword">true</span> : <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<div style='background-color:orange;'>测试类</div>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = SpringConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTransfer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String fromSub = <span class="string">&quot;tom&quot;</span>; <span class="comment">// 转出人</span></span><br><span class="line">        String toSub = <span class="string">&quot;rose&quot;</span>; <span class="comment">// 转入人</span></span><br><span class="line">        <span class="keyword">float</span> money = <span class="number">100f</span>; <span class="comment">// 转账金额</span></span><br><span class="line">        <span class="keyword">boolean</span> flag = service.transfer(fromSub, toSub, money);</span><br><span class="line">        <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;转账成功...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">动态代理</span>:<span class="string"></span></span><br><span class="line">	<span class="meta">作用</span>: <span class="string">在不改变源码的基础上,对方法增强</span></span><br><span class="line">	<span class="meta">实现方式</span>:<span class="string"></span></span><br><span class="line">		<span class="meta">基于接口</span>: <span class="string">jdk提供的   Proxy</span></span><br><span class="line">		<span class="meta">基于子类</span>: <span class="string">cglib   Enhancer</span></span><br><span class="line"><span class="meta">Spring-AOP</span>:<span class="string"></span></span><br><span class="line">	<span class="attr">AOP</span>: <span class="string">面向切面编程</span></span><br><span class="line">	<span class="meta">作用</span>: <span class="string">在不改变源码的基础上,对方法增强</span></span><br><span class="line">    <span class="meta">优势</span>:<span class="string"></span></span><br><span class="line">        <span class="attr">降低代码冗余</span></span><br><span class="line">        <span class="attr">提高开发效率</span></span><br><span class="line">        <span class="attr">方便维护</span></span><br><span class="line"><span class="meta">名词解释</span>:<span class="string"></span></span><br><span class="line">    <span class="meta">目标对象</span>: <span class="string">被代理的类对象</span></span><br><span class="line">    <span class="meta">代理对象</span>: <span class="string">生成的代理类</span></span><br><span class="line">    <span class="meta">连接点</span>: <span class="string">被代理类中所有的方法</span></span><br><span class="line">    <span class="meta">切入点</span>: <span class="string">正在被增强的方法</span></span><br><span class="line">    <span class="meta">通知/增强</span>: <span class="string">增强的代码或方法</span></span><br><span class="line">        <span class="attr">前置增强</span></span><br><span class="line">        <span class="attr">后置增强</span></span><br><span class="line">        <span class="attr">异常增强</span></span><br><span class="line">        <span class="attr">最终增强</span></span><br><span class="line">        <span class="attr">环绕通知</span></span><br><span class="line"></span><br><span class="line">	<span class="meta">切面</span>: <span class="string">= 切入点 + 通知/增强</span></span><br><span class="line">	<span class="meta">织入</span>: <span class="string">织入是一个过程;将连接点转换成切入点加入通知的过程叫做---织入</span></span><br><span class="line">	</span><br><span class="line"><span class="meta">底层实现</span>:<span class="string"></span></span><br><span class="line">	<span class="attr">AOP底层就是动态代理,AOP分别使用了Proxy和Cglib,</span></span><br><span class="line">	<span class="attr">Spring在方法增强时,会自动选择所使用的动态代理方式.</span></span><br><span class="line">	<span class="attr">如果被代理类实现接口,则使用Proxy代理,</span></span><br><span class="line">	<span class="attr">如果被代理类没有实现接口,则使用Cglib</span></span><br><span class="line"></span><br><span class="line"><span class="meta">使用Spring的AOP实现方法增强有如下两种</span>:<span class="string"></span></span><br><span class="line"><span class="attr">1</span> <span class="string">使用我们自定义的切面类； 在这种方式实现时,增强的内容（切面类里面的通知方法）是由我们自己定义的.</span></span><br><span class="line"><span class="attr">可以实现诸如：方法执行时间统计，方法的一些日志记录。</span></span><br><span class="line">    <span class="attr">1</span> <span class="string">纯XML方式实现</span></span><br><span class="line">    <span class="attr">2</span> <span class="string">半XML半注解</span></span><br><span class="line">    <span class="attr">3</span> <span class="string">纯注解方式实现</span></span><br><span class="line"><span class="attr">2</span>  <span class="string">使用Spring的AOP实现自动事务控制（声明式事务）</span></span><br><span class="line"><span class="meta">注</span>: <span class="string">切面类不再由我们自己提供,Spring已经封装好了切面类，切面类里面定义了一套管理事务的增强方法</span></span><br><span class="line">	<span class="meta">我们根据一定规则进行配置，就能使得指定的方法执行时加入事务！（一般在service</span> <span class="string">业务层添加事务）</span></span><br><span class="line">    <span class="attr">纯XML方式实现</span></span><br><span class="line">    <span class="attr">半XML半注解</span></span><br><span class="line">    <span class="attr">纯注解方式实现</span></span><br></pre></td></tr></table></figure>

<h2 id="面试可能会问到的问题："><a href="#面试可能会问到的问题：" class="headerlink" title="面试可能会问到的问题："></a>面试可能会问到的问题：</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">问答题:</span><br><span class="line">	<span class="number">1.</span>动态代理的作用是什么?</span><br><span class="line">    <span class="number">2.</span>动态代理实现方式有哪些?有什么区别?</span><br><span class="line">    <span class="number">3.</span>AOP是什么?</span><br><span class="line">	<span class="number">4.</span>AOP相关名词?</span><br><span class="line">    <span class="number">5.</span>声明式事务管理器的API有哪些?</span><br><span class="line">    <span class="number">6.</span>事务定义信息对象中都能定义哪些内容?</span><br><span class="line">    <span class="number">7.</span>简述事务传播行为和常用的配置?</span><br></pre></td></tr></table></figure>

<p>答案：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1.动态代理的作用是什么?</span></span><br><span class="line">	<span class="attr">在不改变源码的基础上对方法进行增强</span></span><br><span class="line">	</span><br><span class="line"><span class="attr">2.动态代理实现方式有哪些?有什么区别?</span></span><br><span class="line">	<span class="meta">2种</span>:<span class="string"></span></span><br><span class="line">	<span class="attr">1</span> <span class="string">jdk的动态代理,基于接口: proxy</span></span><br><span class="line">		<span class="attr">proxy生成的代理类与被代理类之间为兄弟关系</span></span><br><span class="line">	<span class="attr">2</span> <span class="string">cglib的动态代理,基于子类: Enhancer</span></span><br><span class="line">		<span class="attr">cglib生成的代理类与被代理类之间为父子关系</span></span><br><span class="line">		<span class="attr">因此目标对象不能被final修饰</span></span><br><span class="line"><span class="attr">3.AOP是什么?</span></span><br><span class="line">	<span class="attr">面向切面编程,本质上就是动态代理实现的方法增强</span></span><br><span class="line"></span><br><span class="line">	<span class="attr">OOP</span>:<span class="string">面向对象编程，而AOP是面向切面编程，</span></span><br><span class="line">	<span class="attr">本质上就是对oop的补充，就是将OOP开发中的一些共性代码抽取出来</span></span><br><span class="line">	<span class="meta">然后动态织入需要这些代码的地方；</span> <span class="string">切面 = 切入点 + 通知       </span></span><br><span class="line"></span><br><span class="line"><span class="attr">4.AOP相关名词?</span></span><br><span class="line">	<span class="meta">目标对象</span>: <span class="string">被代理的类对象</span></span><br><span class="line">	<span class="meta">代理对象</span>: <span class="string">生成的代理类对象</span></span><br><span class="line">	<span class="meta">连接点</span>: <span class="string">目标对象中的所有方法(一切目标对象中可被增强的方法)</span></span><br><span class="line">	<span class="meta">切入点</span>: <span class="string">要被增强的方法</span></span><br><span class="line">	<span class="meta">通知</span>: <span class="string"></span></span><br><span class="line">		<span class="attr">在增强方法的什么位置+添加什么代码----》通知/增强代码放到某个位置</span></span><br><span class="line">		<span class="attr">根据位置划分，分为5中通知类型：</span></span><br><span class="line">			<span class="attr">1.前置通知：代理方法执行之前，进行增强</span></span><br><span class="line">			<span class="attr">2.后置通知：代理方法执行之后，进行增强</span></span><br><span class="line">			<span class="attr">3.异常通知：代理方法执行发生异常之后，进行增强</span></span><br><span class="line">			<span class="attr">4.最终通知：代理方法执行完毕后，无论是否出现异常，都会被执行</span></span><br><span class="line">			<span class="attr">5.环绕通知：一般单独使用，【可以】包含上述所有；</span></span><br><span class="line">	<span class="attr">切面：通知与切入点的结合；</span></span><br><span class="line">	<span class="attr">切入点：决定了向那些类的那些方法增强代码；</span></span><br><span class="line">	<span class="meta">织入</span>: <span class="string">将连接点转成切入点并加入通知的过程</span></span><br><span class="line">	</span><br><span class="line"><span class="attr">5.声明式事务管理器的API有哪些?</span></span><br><span class="line">	<span class="attr">PlatformTransactionManager</span>: <span class="string">事务管理器接口</span></span><br><span class="line">		<span class="attr">在顶层接口中制定了事务操作的相关方法(规范)</span></span><br><span class="line">	<span class="attr">DataSourceTransactionManager</span>: <span class="string">实现类</span></span><br><span class="line">		<span class="attr">解决JdbcTemplate与Mybatis的事务管理</span></span><br><span class="line">		<span class="attr">这个类就是我们所说的切面类,在该类中存放有各种通知,</span></span><br><span class="line">		<span class="meta">这些通知方法中完成了事务的开启,提交,回滚,归还连接等方法.</span>  <span class="string"></span></span><br><span class="line"><span class="meta">注意事项：</span> <span class="string"></span></span><br><span class="line">	<span class="meta">1.如果纯xml配置，那么对应bean的名称随便定义；</span> <span class="string"></span></span><br><span class="line">	<span class="meta">2.如果基于注解@Transactional,那么配置的bean名称最好叫：transactionManager</span> <span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="attr">6.事务定义信息对象中都能定义哪些内容?</span></span><br><span class="line"><span class="attr">TransactionDefinition</span>: <span class="string">事务定义信息对象</span></span><br><span class="line"><span class="attr">在该对象中定义有事务的各种行为</span></span><br><span class="line">	<span class="meta">隔离级别</span> <span class="string">超时时间 传播行为 是否只读</span></span><br><span class="line">	<span class="attr">事务的7大传播特性;4大隔离级别;</span></span><br><span class="line">	<span class="meta">(1)</span> <span class="string">写操作：REQUIRED  readonly=fase</span></span><br><span class="line">		<span class="attr">意思：A方法调用B方法，此时B方法的事务传播行为是REQUIRED的话，</span></span><br><span class="line">		<span class="attr">此时如果A有事务，那么B加入A的事务，如果A没有事务，B就创建一个新的事务；</span></span><br><span class="line">	<span class="meta">(2)</span> <span class="string">读操作：SUPPORTS readonly=true</span></span><br><span class="line">		<span class="attr">意思：A方法调用B方法，此时B方法的事务传播行为是SUPPORTS的话，</span></span><br><span class="line">		<span class="attr">此时如果A有事务，那么B加入A的事务，如果A没有事务，B就以非事务状态运行；</span></span><br><span class="line"></span><br><span class="line"><span class="attr">7.简述事务传播行为和常用的配置?</span></span><br><span class="line">	<span class="attr">REQUIRED</span>: <span class="string">增删改</span></span><br><span class="line">	<span class="attr">SUPPORTS</span>: <span class="string">查</span></span><br><span class="line"><span class="attr">------------------------------</span></span><br><span class="line"><span class="attr">8.xml的本质作用是什么?</span></span><br><span class="line">	<span class="attr">做配置文件；可以达到动静分离效果。</span></span><br><span class="line">		<span class="attr">动态代码：java代码，一有变动，就重新编译；</span></span><br><span class="line">		<span class="attr">静态资源：配置文件（xml,properties文件）</span></span><br><span class="line">		<span class="attr">好处：静态资源有修改，无需重新编译java代码，只需重启即可；</span></span><br><span class="line"></span><br><span class="line"><span class="meta">9.xml文件对于java代码的意义?</span>  <span class="string">-----&gt;松耦合</span></span><br><span class="line">    <span class="meta">编码时</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">xml做配置文件,为的是将动态数据与java代码相分离.(松耦合)</span></span><br><span class="line">    <span class="meta">执行时</span>:<span class="string"></span></span><br><span class="line">    <span class="meta">优先解析xml配置文件,将配置文件中的相关配置转存到java对象中,方便后续java代码直接调用</span>  <span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="attr">10.给类打注解的记忆窍门？</span></span><br><span class="line"><span class="attr">当前资源属于那一层，就使用那一层的注解</span></span><br><span class="line">    <span class="meta">1.@Repository</span>:<span class="string">数据访问层/持久层/数据层</span></span><br><span class="line">    <span class="meta">2.@Service</span>:<span class="string">业务逻辑层/服务层</span></span><br><span class="line">    <span class="meta">3.@Controller</span>:<span class="string">web层  </span></span><br><span class="line">    <span class="meta">4.@Configuration</span>:<span class="string">给配置配的注解，等价于xml</span></span><br><span class="line">    <span class="meta">5.@Component</span>:<span class="string">组件层（不属于上述任何一层） </span></span><br><span class="line">		<span class="attr">以上是我们自定义的资源，可以使用的注解；</span></span><br><span class="line">		<span class="attr">如果使用了第三方的资源，建议在配置类中使用Bean注解</span></span><br><span class="line">	<span class="attr">6.@Bean注解，作用某个方法下，且方法必须有返回值</span></span><br><span class="line">		<span class="meta">（方法的返回值作为一个bean被ioc容器管理）</span> <span class="string"></span></span><br></pre></td></tr></table></figure>









</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">高明辉</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/04/20/spring-AOP/">http://example.com/2022/04/20/spring-AOP/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Jason</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/spring-AOP/">spring-AOP</a></div><div class="post_share"><div class="social-share" data-image="/img/java/04%E9%98%B6%E6%AE%B5%E7%83%AD%E9%97%A8%E6%A1%86%E6%9E%B6/day03-spring-AOP/%E5%B0%81%E9%9D%A2.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="添加微信"/></a><div class="post-qr-code-desc">添加微信</div></li><li class="reward-item"><a href="/img/pay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/pay.jpg" alt="付款码"/></a><div class="post-qr-code-desc">付款码</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/04/22/springmvc-1/"><img class="prev-cover" src="/img/java/04%E9%98%B6%E6%AE%B5%E7%83%AD%E9%97%A8%E6%A1%86%E6%9E%B6/day04-springmvc-1/%E5%B0%81%E9%9D%A2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">springmvc-1</div></div></a></div><div class="next-post pull-right"><a href="/2022/04/20/spring-IOC-2/"><img class="next-cover" src="/img/java/04%E9%98%B6%E6%AE%B5%E7%83%AD%E9%97%A8%E6%A1%86%E6%9E%B6/day02-spring-IOC-2/%E5%B0%81%E9%9D%A2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">spring-IOC-2</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">第一章 动态代理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%9F%BA%E4%BA%8E%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 基于接口的动态代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%9F%BA%E4%BA%8E%E5%AD%90%E7%B1%BB%E7%9A%84%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86-cglib%E7%AC%AC%E4%B8%89%E6%96%B9"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 基于子类的动态代理(cglib第三方):</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%A4%E7%A7%8D%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-number">1.2.1.</span> <span class="toc-text">两种动态代理总结：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-Spring-AOP"><span class="toc-number">2.</span> <span class="toc-text">第二章 Spring-AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-AOP%E6%A6%82%E8%BF%B0"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 AOP概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-Spring%E7%9A%84AOP"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 Spring的AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%901%E3%80%91AOP%E7%9B%B8%E5%85%B3%E6%9C%AF%E8%AF%AD-%E9%9D%A2%E8%AF%95%E7%82%B9"><span class="toc-number">2.2.1.</span> <span class="toc-text">【1】AOP相关术语: 面试点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%902%E3%80%91AOP%E5%BC%80%E5%8F%91%E6%96%B9%E5%BC%8F"><span class="toc-number">2.2.2.</span> <span class="toc-text">【2】AOP开发方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%903%E3%80%91%E5%85%A8xml%E6%96%B9%E5%BC%8F%E5%AE%9E%E7%8E%B0AOP%E3%80%90%E6%9C%80%E7%B9%81%E7%90%90%E7%9A%84%E3%80%91"><span class="toc-number">2.2.3.</span> <span class="toc-text">【3】全xml方式实现AOP【最繁琐的】</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B%E5%88%B6%E4%BD%9C%E5%88%86%E6%9E%90"><span class="toc-number">2.2.3.1.</span> <span class="toc-text">①入门案例制作分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E5%85%B7%E4%BD%93%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.2.3.2.</span> <span class="toc-text">②具体步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2%E5%88%87%E5%85%A5%E7%82%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">2.2.3.3.</span> <span class="toc-text">③切入点表达式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%904%E3%80%91%E5%8D%8Axml%E5%8D%8A%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0AOP"><span class="toc-number">2.2.4.</span> <span class="toc-text">【4】半xml半注解实现AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">使用步骤:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81"><span class="toc-number">2.2.4.2.</span> <span class="toc-text">相关代码:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%905%E3%80%91%E5%85%A8%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0AOP"><span class="toc-number">2.2.5.</span> <span class="toc-text">【5】全注解实现AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#aop%E5%85%A8%E6%B3%A8%E8%A7%A3%E4%BB%A3%E7%A0%81"><span class="toc-number">2.2.5.0.1.</span> <span class="toc-text">aop全注解代码</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E2%98%85"><span class="toc-number">3.</span> <span class="toc-text">第三章 声明式事务★</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E4%BA%8B%E5%8A%A1%E9%A1%BB%E7%9F%A5"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 事务须知</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E8%BD%AC%E8%B4%A6%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%EF%BC%88%E8%BF%99%E9%87%8C%E8%BF%98%E6%B2%A1%E6%9C%89%E4%BD%BF%E7%94%A8%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 转账环境搭建（这里还没有使用事务控制）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-pom-xml"><span class="toc-number">3.2.1.</span> <span class="toc-text">1.pom.xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-java%E4%BB%A3%E7%A0%81"><span class="toc-number">3.2.2.</span> <span class="toc-text">2.java代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-applicationContext-xml%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.applicationContext.xml配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-jdbc-properties"><span class="toc-number">3.2.4.</span> <span class="toc-text">4.jdbc.properties</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%B5%8B%E8%AF%95%E7%B1%BB"><span class="toc-number">3.2.4.1.</span> <span class="toc-text">5.测试类</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E4%BA%8B%E5%8A%A1%E7%9B%B8%E5%85%B3API%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 事务相关API介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%901%E3%80%91PlatformTransactionManager"><span class="toc-number">3.3.1.</span> <span class="toc-text">【1】PlatformTransactionManager</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%902%E3%80%91TransactionDefinition%E3%80%90%E4%BA%86%E8%A7%A3%E3%80%91"><span class="toc-number">3.3.2.</span> <span class="toc-text">【2】TransactionDefinition【了解】</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E4%BA%8B%E5%8A%A14%E5%A4%A7%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">3.3.2.1.</span> <span class="toc-text">①事务4大隔离级别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4"><span class="toc-number">3.3.2.2.</span> <span class="toc-text">②超时时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2%E4%BA%8B%E5%8A%A1%E7%9A%847%E5%A4%A7%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BA"><span class="toc-number">3.3.2.3.</span> <span class="toc-text">③事务的7大传播行为</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A3%E6%98%AF%E5%90%A6%E6%98%AF%E5%8F%AA%E8%AF%BB%E4%BA%8B%E5%8A%A1%EF%BC%88readOnly-%EF%BC%9Atrue%EF%BC%88%E5%8F%AA%E8%AF%BB%E4%BA%8B%E5%8A%A1%EF%BC%89%E6%88%96-false%EF%BC%88%E9%9D%9E%E5%8F%AA%E8%AF%BB%E4%BA%8B%E5%8A%A1%EF%BC%89%EF%BC%89"><span class="toc-number">3.3.2.4.</span> <span class="toc-text">④是否是只读事务（readOnly ：true（只读事务）或  false（非只读事务））</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E8%A6%81%E2%98%85%E2%98%85"><span class="toc-number">3.3.2.5.</span> <span class="toc-text">重要★★:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 声明式事务实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%901%E3%80%91%E5%85%A8xml%E9%85%8D%E7%BD%AE"><span class="toc-number">3.4.0.1.</span> <span class="toc-text">【1】全xml配置:</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%A3%E7%A0%81"><span class="toc-number">3.4.0.1.1.</span> <span class="toc-text">配置文件代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%B1%BB-%E8%B7%9F%E4%B8%8A%E9%9D%A2%E4%BD%BF%E7%94%A8JDBCTemplate-%E8%BD%AC%E8%B4%A6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%8C%E5%85%A8%E4%B8%80%E6%A0%B7%EF%BC%8C%E4%B8%8D%E5%90%8C%E7%9A%84%E6%98%AF%E6%B7%BB%E5%8A%A0%E4%B8%8A%E9%9D%A2%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%B0%B1%E5%A5%BD%E5%95%A6%EF%BC%8C%E5%85%B6%E4%BB%96%E4%BB%A3%E7%A0%81%E5%AE%8C%E5%85%A8%E4%B8%8D%E5%8F%98%EF%BC%8C%E7%9C%8B%EF%BC%8C%E6%98%AF%E4%B8%8D%E6%98%AF%E5%8F%AA%E7%94%A8%E5%9C%A8xml%E6%96%87%E4%BB%B6%E4%B8%AD%E2%80%9C%E5%A3%B0%E6%98%8E%E2%80%9D%E4%BB%80%E4%B9%88%E6%96%B9%E6%B3%95%E4%BD%BF%E7%94%A8%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84%E4%BA%8B%E5%8A%A1%EF%BC%8C%E8%BF%99%E5%B0%B1%E6%98%AF%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%EF%BC%81"><span class="toc-number">3.4.0.1.2.</span> <span class="toc-text">测试类(跟上面使用JDBCTemplate 转账的代码完全一样，不同的是添加上面的配置文件就好啦，其他代码完全不变，看，是不是只用在xml文件中“声明”什么方法使用什么样的事务，这就是声明式事务！)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%902%E3%80%91%E5%8D%8Axml%E5%92%8C%E5%8D%8A%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE"><span class="toc-number">3.4.0.2.</span> <span class="toc-text">【2】半xml和半注解配置:</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%A3%E7%A0%81-1"><span class="toc-number">3.4.0.2.1.</span> <span class="toc-text">配置文件代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#service%E5%B1%82%E4%BB%A3%E7%A0%81%EF%BC%88%E4%B8%8A%E9%9D%A2%E5%B7%B2%E7%BB%8F%E8%AE%B2%E8%BF%87%E4%BA%86%EF%BC%8C%E5%9C%A8service%E5%B1%82-%E4%BD%BF%E7%94%A8%E4%BA%8B%E5%8A%A1%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%89"><span class="toc-number">3.4.0.2.2.</span> <span class="toc-text">service层代码（上面已经讲过了，在service层 使用事务！！！！！！！！！！！！！！！！！！）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%B1%BB"><span class="toc-number">3.4.0.2.3.</span> <span class="toc-text">测试类</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%903%E3%80%91%E5%85%A8%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE"><span class="toc-number">3.4.0.3.</span> <span class="toc-text">【3】全注解配置:</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%8F%AF%E8%83%BD%E4%BC%9A%E9%97%AE%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%9A"><span class="toc-number">4.1.</span> <span class="toc-text">面试可能会问到的问题：</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 高明辉</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'Aaee0Vekhg5KbLhMOJQrEU6A-gzGzoHsz',
      appKey: 'mmLHPEEtqvOSJhsqWra8Sq6K',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script type="text/javascript" src="/js/fairyDustCursor.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>