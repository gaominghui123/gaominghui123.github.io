<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>乐优商城项目-商品数据结构设计 | Jason</title><meta name="keywords" content="乐优商城项目"><meta name="author" content="高明辉"><meta name="copyright" content="高明辉"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="乐优商城项目-商品数据结构设计0.学习目标1234- 理解商品规格参数数据结构- 理解商品SPU和SKU数据结构- 完成规格参数的业务接口- 完成商品的业务接口  本篇博客总结写在前面：12345678910111213141516171819202122232425262728293031323334351 商品数据结构设计	一种商品类型有多个规格参数（规格参数表）	每一种规格参数都有一个组id">
<meta property="og:type" content="article">
<meta property="og:title" content="乐优商城项目-商品数据结构设计">
<meta property="og:url" content="http://example.com/2022/06/20/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-%E5%95%86%E5%93%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1/index.html">
<meta property="og:site_name" content="Jason">
<meta property="og:description" content="乐优商城项目-商品数据结构设计0.学习目标1234- 理解商品规格参数数据结构- 理解商品SPU和SKU数据结构- 完成规格参数的业务接口- 完成商品的业务接口  本篇博客总结写在前面：12345678910111213141516171819202122232425262728293031323334351 商品数据结构设计	一种商品类型有多个规格参数（规格参数表）	每一种规格参数都有一个组id">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/%E5%B0%81%E9%9D%A2.png">
<meta property="article:published_time" content="2022-06-20T07:37:39.000Z">
<meta property="article:modified_time" content="2022-08-16T03:13:01.341Z">
<meta property="article:author" content="高明辉">
<meta property="article:tag" content="乐优商城项目">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/%E5%B0%81%E9%9D%A2.png"><link rel="shortcut icon" href="/img/%E7%BD%91%E7%AB%99%E5%9B%BE%E6%A0%87.png"><link rel="canonical" href="http://example.com/2022/06/20/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-%E5%95%86%E5%93%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '乐优商城项目-商品数据结构设计',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-08-16 11:13:01'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Jason" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/%E5%A4%B4%E5%83%8F.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">186</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">206</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">36</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E5%85%B3%E4%BA%8E"><i class="fa-fw /about/"></i><span> 0</span></a></li><li><a class="site-page child" href="/myself"><i class="fa-fw /myself/"></i><span> 1</span></a></li><li><a class="site-page child" href="/butterfly%E4%B8%BB%E9%A2%98"><i class="fa-fw https://github.com/jerryc127/hexo-theme-butterfly/"></i><span> 2</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/%E5%B0%81%E9%9D%A2.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Jason</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E5%85%B3%E4%BA%8E"><i class="fa-fw /about/"></i><span> 0</span></a></li><li><a class="site-page child" href="/myself"><i class="fa-fw /myself/"></i><span> 1</span></a></li><li><a class="site-page child" href="/butterfly%E4%B8%BB%E9%A2%98"><i class="fa-fw https://github.com/jerryc127/hexo-theme-butterfly/"></i><span> 2</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">乐优商城项目-商品数据结构设计</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-06-20T07:37:39.000Z" title="发表于 2022-06-20 15:37:39">2022-06-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-08-16T03:13:01.341Z" title="更新于 2022-08-16 11:13:01">2022-08-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/">乐优商城项目</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="乐优商城项目-商品数据结构设计"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="乐优商城项目-商品数据结构设计"><a href="#乐优商城项目-商品数据结构设计" class="headerlink" title="乐优商城项目-商品数据结构设计"></a>乐优商城项目-商品数据结构设计</h1><h1 id="0-学习目标"><a href="#0-学习目标" class="headerlink" title="0.学习目标"></a>0.学习目标</h1><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">-</span> <span class="string">理解商品规格参数数据结构</span></span><br><span class="line"><span class="meta">-</span> <span class="string">理解商品SPU和SKU数据结构</span></span><br><span class="line"><span class="meta">-</span> <span class="string">完成规格参数的业务接口</span></span><br><span class="line"><span class="meta">-</span> <span class="string">完成商品的业务接口</span></span><br></pre></td></tr></table></figure>

<h1 id="本篇博客总结写在前面："><a href="#本篇博客总结写在前面：" class="headerlink" title="本篇博客总结写在前面："></a>本篇博客总结写在前面：</h1><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1</span> <span class="string">商品数据结构设计</span></span><br><span class="line">	<span class="attr">一种商品类型有多个规格参数（规格参数表）</span></span><br><span class="line">	<span class="attr">每一种规格参数都有一个组id，规格参数组（规格参数组表）</span></span><br><span class="line"></span><br><span class="line">	<span class="attr">规格参数有四种类型：</span></span><br><span class="line">	<span class="attr">1</span> <span class="string">是否是数值类型</span></span><br><span class="line">	<span class="attr">2</span> <span class="string">是否是搜索字段</span></span><br><span class="line">	<span class="attr">3</span> <span class="string">是否是通用属性</span></span><br><span class="line">	<span class="attr">4</span> <span class="string">待选项</span></span><br><span class="line"></span><br><span class="line">	<span class="attr">有了减少表格的冗余，因此将商品表格表格分为spu表和sku表，他们是一对多的关系。</span></span><br><span class="line">	<span class="attr">sku有一个spuid字段，用来关联spu</span></span><br><span class="line">	<span class="attr">1</span> <span class="string">spu  共性数据  抽象  有一个字段specification，表明属性有哪些可选值</span></span><br><span class="line">	<span class="attr">2</span> <span class="string">sku  特有数据  具体  有一个字段special，表明属性具体的值</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2</span> <span class="string">商品的规格参数业务</span></span><br><span class="line">	<span class="attr">根据分类查询规格组</span></span><br><span class="line">	<span class="attr">查询规格参数集合</span></span><br><span class="line">	<span class="attr">新增规格组</span></span><br><span class="line">	<span class="attr">修改规格组</span></span><br><span class="line">	<span class="attr">新增规格参数</span></span><br><span class="line">	<span class="attr">修改规格参数</span></span><br><span class="line">	<span class="attr">查询规格组及规格参数</span></span><br><span class="line"></span><br><span class="line"><span class="attr">3</span> <span class="string">商品业务</span></span><br><span class="line">	<span class="attr">商品分页查询</span></span><br><span class="line">	<span class="attr">商品新增</span></span><br><span class="line">	<span class="attr">商品上下架</span></span><br><span class="line">	<span class="attr">根据id查询商品</span></span><br><span class="line">	<span class="attr">商品修改</span></span><br><span class="line">	<span class="attr">根据id查询SpuDetail</span></span><br><span class="line">	<span class="attr">根据SpuId查询SKU集合</span></span><br><span class="line">	<span class="attr">根据id集合查询SKU集合</span></span><br><span class="line">	<span class="attr">查询商品规格参数键值对</span></span><br><span class="line">	<span class="attr">根据Id查询商品Spu</span></span><br></pre></td></tr></table></figure>



<h1 id="1-商品数据结构设计"><a href="#1-商品数据结构设计" class="headerlink" title="1.商品数据结构设计"></a>1.商品数据结构设计</h1><p>商品是电商的核心，而商品数据结构的设计也决定了一个电商网站的很多业务走向。</p>
<h2 id="1-1-商品数据分析"><a href="#1-1-商品数据分析" class="headerlink" title="1.1.商品数据分析"></a>1.1.商品数据分析</h2><p>我们先看一下我们乐优商城的商品页面结构：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200214184852185.png" alt="image-20200214184852185"></p>
<p>包括的数据：</p>
<ul>
<li>①：商品分类信息</li>
<li>②：商品品牌信息</li>
<li>③：商品名称</li>
<li>④：商品图片</li>
<li>⑤：商品标题</li>
<li>⑥：商品价格</li>
<li>⑦：商品库存</li>
<li>⑧：商品属性<ul>
<li>颜色</li>
<li>内存</li>
<li>机身存储</li>
</ul>
</li>
</ul>
<p>我们是不是可以这样设计商品表，把商品的内容都作为商品表的字段：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>分类</th>
<th>品牌</th>
<th>名称</th>
<th>图片</th>
<th>价格</th>
<th>库存</th>
<th>颜色</th>
<th>内存</th>
<th>存储</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>手机</td>
<td>小米</td>
<td>红米5</td>
<td>xx.jpg</td>
<td>1099</td>
<td>99</td>
<td>玫瑰金</td>
<td>3G</td>
<td>32G</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>但是如果这个商品不是手机，而是一个空调呢？</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200214185719167.png" alt="image-20200214185719167"></p>
<p>空调中会多出两个属性：</p>
<ul>
<li>匹数</li>
<li>系列</li>
</ul>
<p>电视呢？可能会多出：尺寸、型号这样的属性</p>
<p>衣服呢？可能会多出：尺码、颜色这样的属性</p>
<p>水果呢？可能会多出：重量、品种这样的属性</p>
<p>于是，商品表设计就会变成这样：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>分类</th>
<th>品牌</th>
<th>名称</th>
<th>图片</th>
<th>价格</th>
<th>库存</th>
<th>颜色</th>
<th>内存</th>
<th>存储</th>
<th>尺寸</th>
<th>型号</th>
<th>尺码</th>
<th>重量</th>
<th>品种</th>
<th>..</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>手机</td>
<td>小米</td>
<td>红米5</td>
<td>xx.jpg</td>
<td>1099</td>
<td>99</td>
<td>玫瑰金</td>
<td>3G</td>
<td>32G</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>电视</td>
<td>TCL</td>
<td>TCL55V6</td>
<td>yy.jpg</td>
<td>2399</td>
<td>12</td>
<td></td>
<td></td>
<td></td>
<td>55</td>
<td>55英寸声控v6</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>卫衣</td>
<td>ED.HD</td>
<td>ED.HD卫衣男</td>
<td>zz.jpg</td>
<td>109</td>
<td>99</td>
<td>黄色</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>XL</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>苹果</td>
<td>京觅</td>
<td>京觅烟台红富士</td>
<td>11.jpg</td>
<td>38.80</td>
<td>66</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>190~240g</td>
<td>红富士</td>
<td></td>
</tr>
</tbody></table>
<p>发现问题了吗？</p>
<p><strong>不同种类的商品，有不同的属性，如果这样设计表，那么表中的字段会存在问题</strong>：</p>
<ul>
<li><strong>字段过多</strong>：随着商品分类越来越多，表的字段数量越来越多，达到数万个字段</li>
<li><strong>字段不确定</strong>：商品分类是会改变的，因此属性也会变，字段就要跟着变</li>
<li><strong>字段利用率低</strong>：如果商品是手机，只会用到跟手机有关字段，其他字段就无用</li>
</ul>
<p>那么我们该怎么设计商品表呢？</p>
<p>既然不同分类商品，其属性不同，说明属性是与商品无关的字段，应该与商品分类有关。</p>
<p>这样商品表的设计就不包含属性字段，就简化了：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>分类</th>
<th>品牌</th>
<th>名称</th>
<th>图片</th>
<th>价格</th>
<th>库存</th>
<th>..</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>手机</td>
<td>小米</td>
<td>红米5</td>
<td>xx.jpg</td>
<td>1099</td>
<td>99</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>那么商品的属性怎么办？</p>
<p>每一个种类的商品，就有一套对应的属性。我们把这个分类对应的一套属性，称为一套规格参数（specification）模板，设计一张独立的表，而后与商品分类关联。</p>
<p>当需要知道一个商品的属性有哪些，只要知道商品属于哪个商品分类，然后找到该商品分类对应的规格参数模板即可！</p>
<h2 id="1-2-商品规格参数设计"><a href="#1-2-商品规格参数设计" class="headerlink" title="1.2.商品规格参数设计"></a>1.2.商品规格参数设计</h2><p>规格参数模板与<code>分类</code>有关，我们可以<strong>设计规格参数表</strong>，然后与<strong>商品分类关联</strong>。一个分类，对应多个规格参数，形成一对多关系，让商品规格与商品分类关联即可。</p>
<p>商品规格表设计如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tb_spec_param` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">  `category_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品分类id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;规格参数所属的组id&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;参数名&#x27;</span>,</span><br><span class="line">  `<span class="type">numeric</span>` tinyint(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;是否是数字类型参数，true或false&#x27;</span>,</span><br><span class="line">  `unit` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;数字类型参数的单位，非数字类型可以为空&#x27;</span>,</span><br><span class="line">  `generic` tinyint(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;是否是sku通用属性，true或false&#x27;</span>,</span><br><span class="line">  `searching` tinyint(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;是否用于搜索过滤，true或false&#x27;</span>,</span><br><span class="line">  `segments` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;数值类型参数，如果需要搜索，则添加分段间隔值，如CPU频率区间：0.5-1.0,1.1~1.5&#x27;</span>,</span><br><span class="line">  `options` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;参数的可选值，不允许用户自己填值&#x27;</span>,</span><br><span class="line">  `create_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `update_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> UPDATE <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `key_group` (`group_id`),</span><br><span class="line">  KEY `key_category` (`category_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">42</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;规格参数组下的参数名&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>这张表中，除了id、name、category_id外，还多出了一些字段，我们一一解释。</p>
<h3 id="1-2-1-规格组"><a href="#1-2-1-规格组" class="headerlink" title="1.2.1.规格组"></a>1.2.1.规格组</h3><p>一个商品分类，包含的规格参数其实远不止3个，例如：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200214201947118.png" alt="image-20200214201947118"> </p>
<p>为了方便管理，我们需要<strong>对规格参数分组</strong>，定义了一个**规格组表(tb_spec_group)**。一个规格组对应多个规格参数，一对多关系，在规格参数中持有规格组的id：</p>
<ul>
<li>group_id：当前规格参数所属的规格组的id</li>
</ul>
<p>规格组与分类有关，表结构如下：</p>
<p>tb_spec_group:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tb_spec_group` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">  `category_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品分类id,一个分类包含多个规格组&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;规格组的名称&#x27;</span>,</span><br><span class="line">  `create_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `update_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> UPDATE <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `key_category` (`category_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">19</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;规格参数的分组表,每个商品分类下有多个规格参数组&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h3 id="1-2-2-数值类型"><a href="#1-2-2-数值类型" class="headerlink" title="1.2.2.数值类型"></a>1.2.2.数值类型</h3><p>某些规格参数可能为数值类型，我们需要标记出来，并且记录单位：</p>
<p>​     <img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/1534636623281.png" alt="1534636623281"></p>
<p>我们有两个字段来描述：</p>
<ul>
<li><strong>numberic：是否为数值类型</strong><ul>
<li>true：数值类型</li>
<li>false：不是数值类型</li>
</ul>
</li>
<li><strong>unit：参数的单位</strong></li>
</ul>
<h3 id="1-2-3-搜索字段"><a href="#1-2-3-搜索字段" class="headerlink" title="1.2.3.搜索字段"></a>1.2.3.搜索字段</h3><p>打开一个搜索页，我们来看看过滤的条件：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/1526090072535.png" alt="1526090072535"></p>
<p>你会发现，过滤条件中的屏幕尺寸、运行内存、网路、机身内存、电池容量、CPU核数等，在规格参数中都能找到：</p>
<p> <img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/1526090228171.png" alt="1526090228171"></p>
<p>也就是说，<strong>规格参数中的数据，将来会有一部分作为搜索条件来使用</strong>。我们可以在设计时，将这部分属性标记出来，将来做搜索的时候，作为过滤条件。</p>
<p>与搜索相关的有两个字段：</p>
<ul>
<li><strong>searching：标记是否用作过滤</strong><ul>
<li>true：用于过滤搜索</li>
<li>false：不用于过滤</li>
</ul>
</li>
<li><strong>segments：某些数值类型的参数，在搜索时需要按区间划分</strong>，这里提前确定好划分区间<ul>
<li>比如电池容量，0<del>2000mAh，2000mAh</del>3000mAh，3000mAh~4000mAh</li>
</ul>
</li>
</ul>
<h3 id="1-2-4-通用属性"><a href="#1-2-4-通用属性" class="headerlink" title="1.2.4.通用属性"></a>1.2.4.通用属性</h3><p>商品的规格属性有很多：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200214201947118.png" alt="image-20200214201947118"> </p>
<p>但是，大部分属性都是比较通用的属性，但是有少数属性，用于区分商品，例如手机颜色、内存等。这样的属性会出现在页面上供用户选择：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200214202614364.png" alt="image-20200214202614364"> </p>
<p>这种是特殊属性。</p>
<p>为了区分通用属性和特殊属性，我们定义了一个字段：</p>
<ul>
<li><strong>generic：是否是通用属性</strong>，布尔类型。true：通用属性，false：特殊属性。</li>
</ul>
<h3 id="1-2-5-待选项"><a href="#1-2-5-待选项" class="headerlink" title="1.2.5.待选项"></a>1.2.5.待选项</h3><p>有一些规格属性，<strong>在用户填写属性值时，不能任意填写，需要在规定的数据内选择</strong>。所以我们可以定义一些供选择待选项。</p>
<ul>
<li>options：规格参数的值的待选项</li>
</ul>
<p>例如，手机的机身存储，我们给出了下列待选项：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200214202956982.png" alt="image-20200214202956982"></p>
<h2 id="1-3-商品设计"><a href="#1-3-商品设计" class="headerlink" title="1.3.商品设计"></a>1.3.商品设计</h2><p>现在，每个种类的商品，都有了自己的一套规格参数。不过，该分类下的具体每个商品，其规格参数的值不同，这个值显然是跟商品有关的，需要记录在商品表中。</p>
<p>不过，我们需要先设计商品表才可以。而商品，离不开SPU和SKU这两个概念。</p>
<h3 id="1-3-1-什么是SPU和SKU"><a href="#1-3-1-什么是SPU和SKU" class="headerlink" title="1.3.1.什么是SPU和SKU"></a>1.3.1.什么是SPU和SKU</h3><p><strong>SPU：</strong>Standard Product Unit <strong>（标准产品单位）</strong> ，一组具有共同属性的商品集</p>
<p><strong>SKU：</strong>Stock Keeping Unit（<strong>库存量单位</strong>），SPU商品集因具体特性不同而细分的每个商品</p>
<p>以图为例来看：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/1526085541996.png" alt="1526085541996"></p>
<ul>
<li>本页的 华为Mate10 就是一个商品集，即SPU。</li>
<li>因为颜色、内存等不同，而细分出不同的Mate10，如亮黑色128G版、亮黑色64G版本。这就是不同的SKU。</li>
</ul>
<p>可以看出：</p>
<ul>
<li><p>一个SPU中包含多个SKU</p>
</li>
<li><p>SPU是一个抽象的商品集概念，为了方便后台的管理。</p>
</li>
<li><p>SKU才是具体要销售的商品，每一个SKU的价格、库存可能会不一样，<strong>用户购买的是SKU而不是SPU</strong></p>
</li>
</ul>
<h3 id="1-3-2-为什么需要SPU和SKU"><a href="#1-3-2-为什么需要SPU和SKU" class="headerlink" title="1.3.2.为什么需要SPU和SKU"></a>1.3.2.为什么需要SPU和SKU</h3><p>虽然一个SPU中包含多个SKU，例如亮黑色128G版Mate10、亮黑色64G版本的Mate10。但是，不同SKU的属性其实大部分是相同的，例如：</p>
<ul>
<li>商品所属分类</li>
<li>商品品牌</li>
<li>商品名称</li>
<li>商品描述</li>
<li>商品包装</li>
<li>商品售后</li>
<li>商品重量、CPU、屏幕尺寸、电池容量等规格参数值信息</li>
</ul>
<p>如果只有sku表，那么每个SKU都保存自己的一份数据，将会有大量的数据重复，而且不方便后期的维护和管理。因此，我们用SPU来整合一组SKU，方便管理SKU的共性数据，<strong>SKU表只记录每个SKU的特有属性</strong>。</p>
<p>因此，SPU和SKU表保存的数据也不一样：</p>
<ul>
<li><strong>SPU：一组SKU的共性数据</strong></li>
<li><strong>SKU：每个SKU的特有数据</strong></li>
</ul>
<h3 id="1-3-3-SPU数据结构"><a href="#1-3-3-SPU数据结构" class="headerlink" title="1.3.3.SPU数据结构"></a>1.3.3.SPU数据结构</h3><p>spu保存的是一组SKU的共性数据，例如：</p>
<ul>
<li>商品所属分类</li>
<li>商品品牌</li>
<li>商品名称</li>
<li>商品描述</li>
<li>商品包装</li>
<li>商品售后</li>
<li>商品重量、CPU、屏幕尺寸、电池容量等规格参数值信息</li>
</ul>
<p>其数据结构如下：</p>
<p><code>tb_spu</code>表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tb_spu` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;spu id&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;商品名称&#x27;</span>,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;商品标签,搜索关键字信息&#x27;</span>,</span><br><span class="line">  `cid1` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;1级类目id&#x27;</span>,</span><br><span class="line">  `cid2` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;2级类目id&#x27;</span>,</span><br><span class="line">  `cid3` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;3级类目id&#x27;</span>,</span><br><span class="line">  `brand_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品所属品牌id&#x27;</span>,</span><br><span class="line">  `saleable` tinyint(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;是否上架，0下架，1上架&#x27;</span>,</span><br><span class="line">  `create_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;添加时间&#x27;</span>,</span><br><span class="line">  `update_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> UPDATE <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;最后修改时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">190</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;spu表;</span></span><br></pre></td></tr></table></figure>

<p>与我们前面分析的基本类似，但是似乎少了一些字段，比如:</p>
<ul>
<li>商品描述</li>
<li>包装清单</li>
<li>售后服务</li>
<li>规格参数值信息</li>
</ul>
<p>我们做了表的垂直拆分，<strong>将SPU的详情放到了另一张表</strong>：<code>tb_spu_detail</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tb_spu_detail` (</span><br><span class="line">  `spu_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品spu的id，与spu表一对一&#x27;</span>,</span><br><span class="line">  `description` text COMMENT <span class="string">&#x27;商品描述信息&#x27;</span>,</span><br><span class="line">  `specification` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;规格参数值&#x27;</span>,</span><br><span class="line">  `packing_list` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;包装清单&#x27;</span>,</span><br><span class="line">  `after_service` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;售后服务&#x27;</span>,</span><br><span class="line">  `create_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `update_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> UPDATE <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`spu_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>

<p>这张表中的数据都比较大，为了不影响主表的查询效率我们拆分出这张表。</p>
<p>需要注意的字段是<code>specification</code>字段，其中保存的是该商品对应的规格参数值。</p>
<p>例如：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;1&quot;</span>: <span class="string">&quot;OPPO&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;2&quot;</span>: <span class="string">&quot;V20&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;3&quot;</span>: <span class="string">&quot;2018&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;5&quot;</span>: <span class="string">&quot;189&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;6&quot;</span>: <span class="string">&quot;陶瓷&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;7&quot;</span>: <span class="string">&quot;安卓&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;8&quot;</span>: <span class="string">&quot;骁龙&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;9&quot;</span>: <span class="string">&quot;骁龙970&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;10&quot;</span>: <span class="string">&quot;6&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;11&quot;</span>: <span class="string">&quot;2.0&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;14&quot;</span>: <span class="string">&quot;5.5&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;15&quot;</span>: <span class="string">&quot;2180*1280&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;16&quot;</span>: <span class="string">&quot;1200&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;17&quot;</span>: <span class="string">&quot;2000&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;18&quot;</span>: <span class="string">&quot;3250&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;4&quot;</span>: [<span class="string">&quot;炫丽红&quot;</span>, <span class="string">&quot;极夜黑&quot;</span>],</span><br><span class="line">	<span class="attr">&quot;12&quot;</span>: [<span class="string">&quot;4GB&quot;</span>, <span class="string">&quot;6GB&quot;</span>],</span><br><span class="line">	<span class="attr">&quot;13&quot;</span>: [<span class="string">&quot;64GB&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>json结构，其中都是键值对：</p>
<ul>
<li>key：该商品所属商品分类的规格参数的id</li>
<li>value：对应规格参数的值</li>
</ul>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200214212536380.png" alt="image-20200214212536380"></p>
<h3 id="1-3-4-SKU数据结构"><a href="#1-3-4-SKU数据结构" class="headerlink" title="1.3.4.SKU数据结构"></a>1.3.4.SKU数据结构</h3><p>sku中保存的是每个SKU不同的属性，包括：</p>
<ul>
<li>商品标题</li>
<li>商品价格</li>
<li>商品库存</li>
<li>商品图片</li>
<li>商品特有的规格属性，比如具体的颜色、内存等</li>
<li>spu表id，要与SPU表关联</li>
</ul>
<p>表结构如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tb_sku` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">  `spu_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;spu表的id&#x27;</span>,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;商品sku的标题&#x27;</span>,</span><br><span class="line">  `images` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;商品的图片，多个图片以‘,’分割&#x27;</span>,</span><br><span class="line">  `stock` <span class="type">int</span>(<span class="number">8</span>) unsigned <span class="keyword">DEFAULT</span> <span class="string">&#x27;9999&#x27;</span> COMMENT <span class="string">&#x27;库存&#x27;</span>,</span><br><span class="line">  `price` <span class="type">bigint</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;销售价格，单位为分&#x27;</span>,</span><br><span class="line">  `indexes` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;属性下标&#x27;</span>,</span><br><span class="line">  `sold` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;销量&#x27;</span>,</span><br><span class="line">  `special_spec` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;sku的特有规格参数键值对，json格式&#x27;</span>,</span><br><span class="line">  `saleable` tinyint(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;是否上架，0下架，1上架&#x27;</span>,</span><br><span class="line">  `create_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;添加时间&#x27;</span>,</span><br><span class="line">  `update_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> UPDATE <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;最后修改时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `key_spu_id` (`spu_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">27359021573</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;sku表,该表表示具体的商品实体,如黑色的 64g的iphone 8&#x27;</span>;</span><br></pre></td></tr></table></figure>



<p>其中，比较特殊的字段是：<code>special_spec</code>，其数据结构如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;4&quot;</span>:<span class="string">&quot;炫丽红&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;12&quot;</span>:<span class="string">&quot;4GB&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;13&quot;</span>:<span class="string">&quot;64GB&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们与SPU中的Specification对比：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200214213020889.png" alt="image-20200214213020889"> </p>
<p>spu记录的是这个spu下的<strong>sku具备的所有颜色、内存的可能性</strong></p>
<p>sku记录的是<strong>当前sku的具体颜色、内存值</strong></p>
<h2 id="1-4-导入商品图片数据"><a href="#1-4-导入商品图片数据" class="headerlink" title="1.4.导入商品图片数据"></a>1.4.导入商品图片数据</h2><p>我们的商品表中，有很多的商品图片信息</p>
<p>将准备的如下资料导入：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200318165920905.png" alt="image-20200318165920905"> </p>
<p>我们可以把这些图片解压出来，放到一个web服务器，对外开放即可。</p>
<p>这里，我们可以选择Nginx作为web服务器，把images解压到nginx的html目录：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200318170450325.png" alt="image-20200318170450325"> </p>
<p>接下来，就是让 image.leyou.com 能够指向nginx下的html目录：</p>
<ul>
<li><p>让image.leyou.com 指向127.0.0.1，域名解析</p>
</li>
<li><p>在nginx中配置反向代理，指向HTML目录：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">	<span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">	<span class="attribute">server_name</span>  image.leyou.com;</span><br><span class="line"></span><br><span class="line">	<span class="attribute">location</span> / &#123;</span><br><span class="line">		<span class="comment"># 默认资源去nginx目录下的html目录寻找</span></span><br><span class="line">		<span class="attribute">root</span>   html;</span><br><span class="line">		<span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>例如：访问 <a target="_blank" rel="noopener" href="http://image.leyou.com/images/8/11/1524297319952.jpg">http://image.leyou.com/images/8/11/1524297319952.jpg</a> 可以在网页中正常显示</p>
<h1 id="2-规格参数业务"><a href="#2-规格参数业务" class="headerlink" title="2.规格参数业务"></a>2.规格参数业务</h1><p>查看规格参数相关接口：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200214221612350.png" alt="image-20200214221612350"> </p>
<h2 id="2-1-基本代码"><a href="#2-1-基本代码" class="headerlink" title="2.1.基本代码"></a>2.1.基本代码</h2><h3 id="2-1-1-实体类"><a href="#2-1-1-实体类" class="headerlink" title="2.1.1.实体类"></a>2.1.1.实体类</h3><p>在<code>ly-item-servicce</code>的<code>com.leyou.item.entity</code>包下，添加实体类</p>
<p>规格组：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.BaseEntity;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableName(&quot;tb_spec_group&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpecGroup</span> <span class="keyword">extends</span> <span class="title">BaseEntity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>规格参数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.BaseEntity;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableName(&quot;tb_spec_param&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpecParam</span> <span class="keyword">extends</span> <span class="title">BaseEntity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line">    <span class="keyword">private</span> Long groupId;</span><br><span class="line">    <span class="meta">@TableField(&quot;`name`&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@TableField(&quot;`numeric`&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean numeric;</span><br><span class="line">    <span class="keyword">private</span> String unit;</span><br><span class="line">    <span class="keyword">private</span> Boolean generic;</span><br><span class="line">    <span class="keyword">private</span> Boolean searching;</span><br><span class="line">    <span class="keyword">private</span> String segments;</span><br><span class="line">    <span class="keyword">private</span> String options;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，<strong>numeric是数据库关键字</strong>，为了防止查询语句出错，需要给字段加上转义字符：==`==</p>
<h3 id="2-1-2-DTO"><a href="#2-1-2-DTO" class="headerlink" title="2.1.2.DTO"></a>2.1.2.DTO</h3><p>在<code>ly-item-pojo</code>的<code>com.leyou.item.dto</code>包下，添加DTO</p>
<p>规格组的DTO</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.dto.BaseDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.BaseEntity;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpecGroupDTO</span> <span class="keyword">extends</span> <span class="title">BaseDTO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;SpecParamDTO&gt; params;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpecGroupDTO</span><span class="params">(BaseEntity entity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(entity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//工具类。</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends BaseEntity&gt; <span class="function">List&lt;SpecGroupDTO&gt; <span class="title">convertEntityList</span><span class="params">(Collection&lt;T&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(list == <span class="keyword">null</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="keyword">return</span> list.stream().map(SpecGroupDTO::<span class="keyword">new</span>).collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>规格参数DTO：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.dto.BaseDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.BaseEntity;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpecParamDTO</span> <span class="keyword">extends</span> <span class="title">BaseDTO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line">    <span class="keyword">private</span> Long groupId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Boolean numeric;</span><br><span class="line">    <span class="keyword">private</span> String unit;</span><br><span class="line">    <span class="keyword">private</span> Boolean generic;</span><br><span class="line">    <span class="keyword">private</span> Boolean searching;</span><br><span class="line">    <span class="keyword">private</span> String segments;</span><br><span class="line">    <span class="keyword">private</span> String options;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpecParamDTO</span><span class="params">(BaseEntity entity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(entity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends BaseEntity&gt; <span class="function">List&lt;SpecParamDTO&gt; <span class="title">convertEntityList</span><span class="params">(Collection&lt;T&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(list == <span class="keyword">null</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="keyword">return</span> list.stream().map(SpecParamDTO::<span class="keyword">new</span>).collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-1-3-mapper"><a href="#2-1-3-mapper" class="headerlink" title="2.1.3.mapper"></a>2.1.3.mapper</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.mapper</code>包下，添加mapper。</p>
<p>规格组mapper：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.SpecGroup;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpecGroupMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">SpecGroup</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>规格参数Mapper：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.SpecParam;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpecParamMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">SpecParam</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-1-4-service"><a href="#2-1-4-service" class="headerlink" title="2.1.4.service"></a>2.1.4.service</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.service</code>包中，添加<code>service</code>接口：</p>
<p>规格组：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.SpecGroup;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpecGroupService</span> <span class="keyword">extends</span> <span class="title">IService</span>&lt;<span class="title">SpecGroup</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>规格参数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.SpecParam;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpecParamService</span> <span class="keyword">extends</span> <span class="title">IService</span>&lt;<span class="title">SpecParam</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在<code>ly-item-service</code>的<code>com.leyou.item.service.impl</code>包中，添加<code>service</code>的实现类：</p>
<p>规格组：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.SpecGroup;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.mapper.SpecGroupMapper;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.service.SpecGroupService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpecGroupServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">SpecGroupMapper</span>, <span class="title">SpecGroup</span>&gt; <span class="keyword">implements</span> <span class="title">SpecGroupService</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>规格参数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.SpecParam;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.mapper.SpecParamMapper;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.service.SpecParamService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpecParamServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">SpecParamMapper</span>, <span class="title">SpecParam</span>&gt; <span class="keyword">implements</span> <span class="title">SpecParamService</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-1-5-controller"><a href="#2-1-5-controller" class="headerlink" title="2.1.5.controller"></a>2.1.5.controller</h3><p>在<code>ly-item-service</code>的<code> com.leyou.item.web</code>包中，添加controller代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.exception.LyException;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.dto.SpecGroupDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.dto.SpecParamDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.SpecGroup;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.SpecParam;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.service.SpecGroupService;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.service.SpecParamService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;spec&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpecController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SpecGroupService groupService;</span><br><span class="line">    <span class="keyword">private</span> SpecParamService paramService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpecController</span><span class="params">(SpecGroupService groupService, SpecParamService paramService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.groupService = groupService;</span><br><span class="line">        <span class="keyword">this</span>.paramService = paramService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="2-2-根据分类查询规格组"><a href="#2-2-根据分类查询规格组" class="headerlink" title="2.2.根据分类查询规格组"></a>2.2.根据分类查询规格组</h2><p><strong>这里的分类指的是商品的id哈！</strong>，向<strong>规格组表格</strong>查询！</p>
<h3 id="2-2-1接口声明"><a href="#2-2-1接口声明" class="headerlink" title="2.2.1接口声明"></a>2.2.1接口声明</h3><ul>
<li>接口地址： <code>/spec/groups/of/category</code></li>
<li>请求方式 ：<code>GET</code></li>
<li>请求参数 ：<code>long</code>，商品分类id</li>
<li>返回值类型 ：<code>[&quot;application/json&quot;]</code></li>
</ul>
<p><strong>请求参数</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>请求类型</th>
<th>是否必须</th>
<th>数据类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>商品分类id</td>
<td>query</td>
<td>true</td>
<td>integer</td>
<td></td>
</tr>
</tbody></table>
<p><strong>实体</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>categoryId</td>
<td>商品分类id</td>
<td>integer(int64)</td>
<td>integer(int64)</td>
</tr>
<tr>
<td>id</td>
<td>规格租id</td>
<td>integer(int64)</td>
<td>integer(int64)</td>
</tr>
<tr>
<td>name</td>
<td>规格组名称</td>
<td>string</td>
<td></td>
</tr>
</tbody></table>
<p><strong>响应示例</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">&quot;categoryId&quot;</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">&quot;id&quot;</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<h3 id="2-2-2-业务实现"><a href="#2-2-2-业务实现" class="headerlink" title="2.2.2.业务实现"></a>2.2.2.业务实现</h3><p>在<code>ly-item-service</code>的<code> com.leyou.item.web</code>包的<code>SpecController</code>中添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据商品分类查询规格组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 商品分类id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 规格组集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/groups/of/category&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;List&lt;SpecGroupDTO&gt;&gt; queryGroupByCategory(</span><br><span class="line">    <span class="meta">@RequestParam(&quot;id&quot;)</span> Long id)&#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(</span><br><span class="line">        SpecGroupDTO.convertEntityList(</span><br><span class="line">            groupService.query().eq(<span class="string">&quot;category_id&quot;</span>, id).list()</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-3-查询规格参数集合"><a href="#2-3-查询规格参数集合" class="headerlink" title="2.3.查询规格参数集合"></a>2.3.查询规格参数集合</h2><h3 id="2-3-1接口声明"><a href="#2-3-1接口声明" class="headerlink" title="2.3.1接口声明"></a>2.3.1接口声明</h3><ul>
<li>接口地址： <code>/spec/params</code></li>
<li>请求方式 ：<code>GET</code></li>
<li>请求参数类型：<code>基本类型包装类</code></li>
<li>返回值类型 ：<code>[&quot;application/json&quot;]</code></li>
</ul>
<p><strong>请求参数</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>请求类型</th>
<th>是否必须</th>
<th>数据类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>categoryId</td>
<td>商品分类id</td>
<td>query</td>
<td>false</td>
<td>integer</td>
<td></td>
</tr>
<tr>
<td>groupId</td>
<td>规格租id</td>
<td>query</td>
<td>false</td>
<td>integer</td>
<td></td>
</tr>
<tr>
<td>searching</td>
<td>是否搜索</td>
<td>query</td>
<td>false</td>
<td>boolean</td>
<td></td>
</tr>
</tbody></table>
<p><strong>响应参数</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>categoryId</td>
<td>商品分类ID</td>
<td>integer(int64)</td>
<td>integer(int64)</td>
</tr>
<tr>
<td>generic</td>
<td>是否是普通参数</td>
<td>boolean</td>
<td></td>
</tr>
<tr>
<td>groupId</td>
<td>规格组ID</td>
<td>integer(int64)</td>
<td>integer(int64)</td>
</tr>
<tr>
<td>id</td>
<td>规格参数ID</td>
<td>integer(int64)</td>
<td>integer(int64)</td>
</tr>
<tr>
<td>name</td>
<td>规格参数名称</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>numeric</td>
<td>是否是数值类型</td>
<td>boolean</td>
<td></td>
</tr>
<tr>
<td>options</td>
<td>规格参数待选项</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>searching</td>
<td>是否参与搜索</td>
<td>boolean</td>
<td></td>
</tr>
<tr>
<td>segments</td>
<td>可选数值范围</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>unit</td>
<td></td>
<td>数值单位</td>
<td>数值单位</td>
</tr>
</tbody></table>
<p><strong>响应示例</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">&quot;categoryId&quot;</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">&quot;generic&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">&quot;groupId&quot;</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">&quot;id&quot;</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;numeric&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">&quot;options&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;searching&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">&quot;segments&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;unit&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="2-3-2-业务实现"><a href="#2-3-2-业务实现" class="headerlink" title="2.3.2.业务实现"></a>2.3.2.业务实现</h3><p>在<code>ly-item-service</code>的<code> com.leyou.item.web</code>包的<code>SpecController</code>中添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询规格参数集合</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryId 分类id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> groupId 规格组id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> searching 是否搜索</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 参数集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;params&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;List&lt;SpecParamDTO&gt;&gt; querySpecParams(</span><br><span class="line">    <span class="meta">@RequestParam(value = &quot;categoryId&quot;, required = false)</span> Long categoryId,</span><br><span class="line">    <span class="meta">@RequestParam(value = &quot;groupId&quot;, required = false)</span> Long groupId,</span><br><span class="line">    <span class="meta">@RequestParam(value = &quot;searching&quot;, required = false)</span> Boolean searching</span><br><span class="line">)&#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(paramService.queryParams(categoryId, groupId, searching));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在<code>ly-item-service</code>的<code> com.leyou.item.service</code>包的<code>SpecParamService</code>接口中添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;SpecParamDTO&gt; <span class="title">queryParams</span><span class="params">(Long categoryId, Long groupId, Boolean searching)</span></span>;</span><br></pre></td></tr></table></figure>



<p>在<code>ly-item-service</code>的<code> com.leyou.item.service.impl</code>包的<code>SpecParamServiceImpl</code>中添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;SpecParamDTO&gt; <span class="title">queryParams</span><span class="params">(Long categoryId, Long groupId, Boolean searching)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 健壮性判断</span></span><br><span class="line">    <span class="keyword">if</span>(categoryId == <span class="keyword">null</span> &amp;&amp; groupId == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 条件不能都为空</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> LyException(<span class="number">400</span>, <span class="string">&quot;查询条件不能为空！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 查询</span></span><br><span class="line">    List&lt;SpecParam&gt; list = query()</span><br><span class="line">        .eq(categoryId != <span class="keyword">null</span>, <span class="string">&quot;category_id&quot;</span>, categoryId)</span><br><span class="line">        .eq(groupId != <span class="keyword">null</span>, <span class="string">&quot;group_id&quot;</span>, groupId)</span><br><span class="line">        .eq(searching != <span class="keyword">null</span>, <span class="string">&quot;searching&quot;</span>, searching)</span><br><span class="line">        .list();</span><br><span class="line">    <span class="comment">// 返回</span></span><br><span class="line">    <span class="keyword">return</span> SpecParamDTO.convertEntityList(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-4-新增规格组"><a href="#2-4-新增规格组" class="headerlink" title="2.4.新增规格组"></a>2.4.新增规格组</h2><h3 id="2-4-1接口声明"><a href="#2-4-1接口声明" class="headerlink" title="2.4.1接口声明"></a>2.4.1接口声明</h3><ul>
<li>接口地址 ： <code>/spec/group</code></li>
<li>请求方式 ：<code>POST</code></li>
<li>请求参数类型 ：<code>[&quot;application/json&quot;]</code></li>
<li>返回值类型 ：无</li>
</ul>
<p><strong>请求参数</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>请求类型</th>
<th>是否必须</th>
<th>数据类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>groupDTO</td>
<td>groupDTO</td>
<td>Object</td>
<td>true</td>
<td>SpecGroupDTO</td>
<td>SpecGroupDTO</td>
</tr>
</tbody></table>
<p><strong>SpecGroupDTO</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>请求类型</th>
<th>是否必须</th>
<th>数据类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>categoryId</td>
<td>商品分类id</td>
<td>body</td>
<td>false</td>
<td>integer(int64)</td>
<td></td>
</tr>
<tr>
<td>id</td>
<td>规格租id</td>
<td>body</td>
<td>false</td>
<td>integer(int64)</td>
<td></td>
</tr>
<tr>
<td>name</td>
<td>规格组名称</td>
<td>body</td>
<td>false</td>
<td>string</td>
<td></td>
</tr>
</tbody></table>
<p><strong>响应状态</strong></p>
<table>
<thead>
<tr>
<th>状态码</th>
<th>说明</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>201</td>
<td>新增成功</td>
<td></td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized</td>
<td></td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
<td></td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
<td></td>
</tr>
</tbody></table>
<p><strong>响应参数</strong></p>
<p>暂无</p>
<h3 id="2-4-2-业务实现"><a href="#2-4-2-业务实现" class="headerlink" title="2.4.2.业务实现"></a>2.4.2.业务实现</h3><p>在<code>ly-item-service</code>的<code> com.leyou.item.web</code>包的<code>SpecController</code>中添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增规格组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> groupDTO 规格组信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 无</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;group&quot;)</span></span><br><span class="line"><span class="comment">//这里是Void而不是void哈！</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title">saveGroup</span><span class="params">(<span class="meta">@RequestBody</span> SpecGroupDTO groupDTO)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 新增规格组</span></span><br><span class="line">    groupService.save(groupDTO.toEntity(SpecGroup.class));</span><br><span class="line">    <span class="comment">// 返回结果</span></span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-5-修改规格组"><a href="#2-5-修改规格组" class="headerlink" title="2.5.修改规格组"></a>2.5.修改规格组</h2><h3 id="2-5-1接口声明"><a href="#2-5-1接口声明" class="headerlink" title="2.5.1接口声明"></a>2.5.1接口声明</h3><ul>
<li>接口地址 ： <code>/spec/group</code></li>
<li>请求方式 ：<code>PUT</code></li>
<li>请求参数类型 ：<code>[&quot;application/json&quot;]</code></li>
<li>返回值类型 ：无</li>
</ul>
<p><strong>请求参数</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>请求类型</th>
<th>是否必须</th>
<th>数据类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>groupDTO</td>
<td>groupDTO</td>
<td>Object</td>
<td>true</td>
<td>SpecGroupDTO</td>
<td>SpecGroupDTO</td>
</tr>
</tbody></table>
<p><strong>SpecGroupDTO</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>请求类型</th>
<th>是否必须</th>
<th>数据类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>categoryId</td>
<td>商品分类id</td>
<td>body</td>
<td>false</td>
<td>integer(int64)</td>
<td></td>
</tr>
<tr>
<td>id</td>
<td>规格租id</td>
<td>body</td>
<td>false</td>
<td>integer(int64)</td>
<td></td>
</tr>
<tr>
<td>name</td>
<td>规格组名称</td>
<td>body</td>
<td>false</td>
<td>string</td>
<td></td>
</tr>
</tbody></table>
<p><strong>响应状态</strong></p>
<table>
<thead>
<tr>
<th>状态码</th>
<th>说明</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>204</td>
<td>修改成功</td>
<td></td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized</td>
<td></td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
<td></td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
<td></td>
</tr>
</tbody></table>
<p><strong>响应参数</strong></p>
<p>暂无</p>
<h3 id="2-5-2-业务实现"><a href="#2-5-2-业务实现" class="headerlink" title="2.5.2.业务实现"></a>2.5.2.业务实现</h3><p>在<code>ly-item-service</code>的<code> com.leyou.item.web</code>包的<code>SpecController</code>中添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改规格组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> groupDTO 规格组信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 无</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;group&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title">updateGroup</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@RequestBody</span> SpecGroupDTO groupDTO)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 更新规格组</span></span><br><span class="line">    groupService.updateById(groupDTO.toEntity(SpecGroup.class));</span><br><span class="line">    <span class="comment">// 返回结果</span></span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.status(HttpStatus.NO_CONTENT).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-6-新增规格参数"><a href="#2-6-新增规格参数" class="headerlink" title="2.6.新增规格参数"></a>2.6.新增规格参数</h2><h3 id="2-6-1接口声明"><a href="#2-6-1接口声明" class="headerlink" title="2.6.1接口声明"></a>2.6.1接口声明</h3><ul>
<li>接口地址：<code>/spec/param</code></li>
<li>请求方式 ： <code>POST</code></li>
<li>请求参数 ： <code>[&quot;application/json&quot;]</code></li>
<li>返回值类型 ：无</li>
</ul>
<p><strong>请求参数</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>请求类型</th>
<th>是否必须</th>
<th>数据类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>body</td>
<td>paramDTO</td>
<td>body</td>
<td>true</td>
<td>SpecParamDTO</td>
<td>SpecParamDTO</td>
</tr>
</tbody></table>
<p><strong>SpecParamDTO</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>请求类型</th>
<th>是否必须</th>
<th>数据类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>categoryId</td>
<td>商品分类ID</td>
<td>body</td>
<td>false</td>
<td>integer(int64)</td>
<td></td>
</tr>
<tr>
<td>generic</td>
<td>是否是普通参数</td>
<td>body</td>
<td>false</td>
<td>boolean</td>
<td></td>
</tr>
<tr>
<td>groupId</td>
<td>规格组ID</td>
<td>body</td>
<td>false</td>
<td>integer(int64)</td>
<td></td>
</tr>
<tr>
<td>id</td>
<td>规格参数ID</td>
<td>body</td>
<td>false</td>
<td>integer(int64)</td>
<td></td>
</tr>
<tr>
<td>name</td>
<td>规格参数名称</td>
<td>body</td>
<td>false</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>numeric</td>
<td>是否是数值类型</td>
<td>body</td>
<td>false</td>
<td>boolean</td>
<td></td>
</tr>
<tr>
<td>options</td>
<td>规格参数待选项</td>
<td>body</td>
<td>false</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>searching</td>
<td>是否参与搜索</td>
<td>body</td>
<td>false</td>
<td>boolean</td>
<td></td>
</tr>
<tr>
<td>segments</td>
<td>可选数值范围</td>
<td>body</td>
<td>false</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>unit</td>
<td></td>
<td>body</td>
<td>false</td>
<td>数值单位</td>
<td></td>
</tr>
</tbody></table>
<p><strong>响应状态</strong></p>
<table>
<thead>
<tr>
<th>状态码</th>
<th>说明</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>201</td>
<td>新增成功</td>
<td></td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized</td>
<td></td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
<td></td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
<td></td>
</tr>
</tbody></table>
<p><strong>响应参数</strong></p>
<p>暂无</p>
<h3 id="2-6-2-业务实现"><a href="#2-6-2-业务实现" class="headerlink" title="2.6.2.业务实现"></a>2.6.2.业务实现</h3><p>在<code>ly-item-service</code>的<code> com.leyou.item.web</code>包的<code>SpecController</code>中添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增规格参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> paramDTO 规格组信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 无</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;param&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title">saveParam</span><span class="params">(<span class="meta">@RequestBody</span> SpecParamDTO paramDTO)</span></span>&#123;</span><br><span class="line">    paramService.save(paramDTO.toEntity(SpecParam.class));</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-7-修改规格参数"><a href="#2-7-修改规格参数" class="headerlink" title="2.7.修改规格参数"></a>2.7.修改规格参数</h2><h3 id="2-7-1接口声明"><a href="#2-7-1接口声明" class="headerlink" title="2.7.1接口声明"></a>2.7.1接口声明</h3><ul>
<li>接口地址：<code>/spec/param</code></li>
<li>请求方式 ： <code>PUT</code></li>
<li>请求参数 ： <code>[&quot;application/json&quot;]</code></li>
<li>返回值类型 ：无</li>
</ul>
<p><strong>请求参数</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>请求类型</th>
<th>是否必须</th>
<th>数据类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>body</td>
<td>paramDTO</td>
<td>body</td>
<td>true</td>
<td>SpecParamDTO</td>
<td>SpecParamDTO</td>
</tr>
</tbody></table>
<p><strong>SpecParamDTO</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>请求类型</th>
<th>是否必须</th>
<th>数据类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>categoryId</td>
<td>商品分类ID</td>
<td>body</td>
<td>false</td>
<td>integer(int64)</td>
<td></td>
</tr>
<tr>
<td>generic</td>
<td>是否是普通参数</td>
<td>body</td>
<td>false</td>
<td>boolean</td>
<td></td>
</tr>
<tr>
<td>groupId</td>
<td>规格组ID</td>
<td>body</td>
<td>false</td>
<td>integer(int64)</td>
<td></td>
</tr>
<tr>
<td>id</td>
<td>规格参数ID</td>
<td>body</td>
<td>false</td>
<td>integer(int64)</td>
<td></td>
</tr>
<tr>
<td>name</td>
<td>规格参数名称</td>
<td>body</td>
<td>false</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>numeric</td>
<td>是否是数值类型</td>
<td>body</td>
<td>false</td>
<td>boolean</td>
<td></td>
</tr>
<tr>
<td>options</td>
<td>规格参数待选项</td>
<td>body</td>
<td>false</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>searching</td>
<td>是否参与搜索</td>
<td>body</td>
<td>false</td>
<td>boolean</td>
<td></td>
</tr>
<tr>
<td>segments</td>
<td>可选数值范围</td>
<td>body</td>
<td>false</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>unit</td>
<td></td>
<td>body</td>
<td>false</td>
<td>数值单位</td>
<td></td>
</tr>
</tbody></table>
<p><strong>响应状态</strong></p>
<table>
<thead>
<tr>
<th>状态码</th>
<th>说明</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>204</td>
<td>修改成功</td>
<td></td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized</td>
<td></td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
<td></td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
<td></td>
</tr>
</tbody></table>
<p><strong>响应参数</strong></p>
<p>暂无</p>
<h3 id="2-7-2-业务实现"><a href="#2-7-2-业务实现" class="headerlink" title="2.7.2.业务实现"></a>2.7.2.业务实现</h3><p>在<code>ly-item-service</code>的<code> com.leyou.item.web</code>包的<code>SpecController</code>中添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改规格参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> paramDTO 规格组信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 无</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;param&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title">updateParam</span><span class="params">(<span class="meta">@RequestBody</span> SpecParamDTO paramDTO)</span></span>&#123;</span><br><span class="line">    paramService.updateById(paramDTO.toEntity(SpecParam.class));</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.status(HttpStatus.NO_CONTENT).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-8-查询规格组及规格参数"><a href="#2-8-查询规格组及规格参数" class="headerlink" title="2.8.查询规格组及规格参数"></a>2.8.查询规格组及规格参数</h2><p>根据<strong>商品分类id</strong>查询<strong>规格组及组内参数</strong></p>
<h3 id="2-8-1接口声明"><a href="#2-8-1接口声明" class="headerlink" title="2.8.1接口声明"></a>2.8.1接口声明</h3><ul>
<li>接口地址： <code>/spec/list</code></li>
<li>请求方式 ：<code>GET</code></li>
<li>请求参数类型：<code>基本类型包装类</code></li>
<li>返回值类型 ：<code>[&quot;application/json&quot;]</code></li>
</ul>
<p><strong>请求参数</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>请求类型</th>
<th>是否必须</th>
<th>数据类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>商品分类id</td>
<td>query</td>
<td>false</td>
<td>integer</td>
<td></td>
</tr>
</tbody></table>
<p><strong>响应示例</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">&quot;categoryId&quot;</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">&quot;id&quot;</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;params&quot;</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">&quot;categoryId&quot;</span>: <span class="number">76</span>,</span><br><span class="line">				<span class="attr">&quot;generic&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">				<span class="attr">&quot;groupId&quot;</span>: <span class="number">5</span>,</span><br><span class="line">				<span class="attr">&quot;id&quot;</span>: <span class="number">12</span>,</span><br><span class="line">				<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;屏幕尺寸&quot;</span>,</span><br><span class="line">				<span class="attr">&quot;numeric&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">				<span class="attr">&quot;options&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">				<span class="attr">&quot;searching&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">				<span class="attr">&quot;segments&quot;</span>: <span class="string">&quot;0-3.5,3.6-4.3,4.4-4.7,4.8-5.5,5.6-5.9,6.0-&quot;</span>,</span><br><span class="line">				<span class="attr">&quot;unit&quot;</span>: <span class="string">&quot;英寸&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		]</span><br><span class="line">	&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="2-3-2-业务实现-1"><a href="#2-3-2-业务实现-1" class="headerlink" title="2.3.2.业务实现"></a>2.3.2.业务实现</h3><p>在<code>ly-item-service</code>的<code> com.leyou.item.web</code>包的<code>SpecController</code>中添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据分类id查询规格组及组内参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 规格组集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;List&lt;SpecGroupDTO&gt;&gt; querySpecList(<span class="meta">@RequestParam(&quot;id&quot;)</span> Long categoryId) &#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(groupService.querySpecList(categoryId));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在<code>ly-item-service</code>的<code> com.leyou.item.service</code>包的<code>SpecGroupService</code>接口中添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;SpecGroupDTO&gt; <span class="title">querySpecList</span><span class="params">(Long categoryId)</span></span>;</span><br></pre></td></tr></table></figure>



<p>在<code>ly-item-service</code>的<code> com.leyou.item.service.impl</code>包的<code>SpecGroupServiceImpl</code>中添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SpecParamService paramService;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;SpecGroupDTO&gt; <span class="title">querySpecList</span><span class="params">(Long categoryId)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 查询规格组</span></span><br><span class="line">    List&lt;SpecGroupDTO&gt; groupList = SpecGroupDTO.convertEntityList(query().eq(<span class="string">&quot;category_id&quot;</span>, categoryId).list());</span><br><span class="line">    <span class="keyword">if</span>(CollectionUtils.isEmpty(groupList))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> LyException(<span class="number">404</span>, <span class="string">&quot;该分类下的规格组不存在！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 查询规格参数</span></span><br><span class="line">    List&lt;SpecParamDTO&gt; paramList = paramService.queryParams(categoryId, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">    <span class="comment">// 对规格参数分组，groupId一致的在一组</span></span><br><span class="line">    Map&lt;Long, List&lt;SpecParamDTO&gt;&gt; map = paramList.stream().collect(Collectors.groupingBy(SpecParamDTO::getGroupId));</span><br><span class="line">    <span class="comment">// 把参数放入group#############这里最好用stream流来完成遍历设置参数哈！！！</span></span><br><span class="line">    <span class="keyword">for</span> (SpecGroupDTO groupDTO : groupList) &#123;</span><br><span class="line">        groupDTO.setParams(map.get(groupDTO.getId()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> groupList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据<strong>商品分类id</strong>来查询<strong>规格参数组</strong>以及组对应的<strong>组内参数</strong>的小结：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">上面的代码是比较合理的或者说是优化后的代码，普通代码(优化前代码)：</span></span><br><span class="line"><span class="attr">根据商品id查询规格组表，将查询到的数组封装到specGroupDTO中，</span></span><br><span class="line"><span class="attr">但是specGroupDTO中的params参数为空，因此还得去参数表中，根据specGroupDTO中的组id去查询参数表格，</span></span><br><span class="line"><span class="attr">得到对应的组id的所有参数（有哪些参数变量，并不是具体的参数哦，目前讲的都是spu，不是sku）</span></span><br><span class="line"></span><br><span class="line"><span class="attr">代码优化：</span></span><br><span class="line"><span class="attr">上面的查询方式是每遍历一个specGroupDTO的组id然后再查询对应的参数类型，这样子每一个组都要去查询参数表，</span></span><br><span class="line"><span class="attr">效率比较低，因此可以：先根据商品id查询参数表得到该商品的所有参数信息，</span></span><br><span class="line"><span class="meta">再通过java</span> <span class="string">se的聚合函数以及stream的映射方法，</span></span><br><span class="line"><span class="attr">就可以得到每个组对应的参数信息了。再封装到specGroupDTO的params变量中去！</span></span><br><span class="line"></span><br><span class="line"><span class="attr">普遍意义的代码优化：</span></span><br><span class="line"><span class="attr">1</span> <span class="string">代码更精简</span></span><br><span class="line"><span class="attr">2</span> <span class="string">时间，空间能达到最优，特别是面试算法题对复杂度的考察！</span></span><br><span class="line">	<span class="attr">复杂度的优化除了本身的变量所占用的内存，运行次数，还要从以下两个点进行优化：</span></span><br><span class="line">	<span class="attr">（1）减少IO，数据库的访问次数</span></span><br><span class="line">	<span class="attr">（2）加入缓存！</span></span><br></pre></td></tr></table></figure>

<p>上面所有的<strong>业务逻辑代码小结</strong>：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1</span> <span class="string">后端到底如何解析传递过来的url参数，</span></span><br><span class="line">	<span class="attr">是取决于url发起请求的请求头content-type字段的内容决定的，</span></span><br><span class="line">	<span class="attr">如果content-type是json格式，那么就以json来解析请求信息。</span></span><br><span class="line">	<span class="attr">否则就是普通k-v形式来解析参数。</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2</span> <span class="string">事务隔离</span></span><br><span class="line">	<span class="attr">service层代码属于是最底层的业务出来代码，因此尽量不要在service层调用service层的方法。</span></span><br></pre></td></tr></table></figure>



<h2 id="2-9-页面测试"><a href="#2-9-页面测试" class="headerlink" title="2.9.页面测试"></a>2.9.页面测试</h2><p>再次强调，所有的测试都是现在<strong>maven管理的test目录下先测试service层代码，然后借助标准测试工具测试web层，最后是前端的测试</strong>，这里只是为了方便做笔记，将测试环节放到一起了！</p>
<p>在首页左侧的菜单中，我们点击菜单中的<code>规格参数</code>：</p>
<p> <img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200712232701199.png" alt="image-20200712232701199"></p>
<p>可以看到页面发生了变化：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/1552659142800.png" alt="1552659142800"></p>
<p>可以看到规格参数页面的左侧是一个商品分类的树，右侧暂时是空白。那么问题来了：</p>
<p>我们这里是规格管理，为什么会显示商品分类信息呢？</p>
<p>因为规格是跟商品分类绑定的，我们在看到规格参数时，肯定希望知道接下来要管理的是哪个分类下的规格参数。</p>
<p>所以首先会展现商品分类树，并且提示你要选择商品分类，才能看到规格参数的模板。</p>
<h3 id="2-9-1-查询规格组测试"><a href="#2-9-1-查询规格组测试" class="headerlink" title="2.9.1.查询规格组测试"></a>2.9.1.查询规格组测试</h3><p>此时，我们点击分类，当点击到某个3级分类时，页面发生了变化：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/1529552321813.png" alt="1529552321813"></p>
<p>这里验证了根据分类查询规格组的接口没有问题。</p>
<h3 id="2-9-2-查询规格参数测试"><a href="#2-9-2-查询规格参数测试" class="headerlink" title="2.9.2.查询规格参数测试"></a>2.9.2.查询规格参数测试</h3><p>在刚才的表格中，只显示了规格组信息，但是却没有看到组内的规格参数，那么规格参数信息又保存在哪里呢？</p>
<p>我们在页面点击某个规格组信息，发现页面发生了变化：</p>
<p>在页面刷新：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/1529554002905.png" alt="1529554002905"></p>
<h1 id="3-商品业务"><a href="#3-商品业务" class="headerlink" title="3.商品业务"></a>3.商品业务</h1><p>查看商品业务相关接口：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200215130253735.png" alt="image-20200215130253735"> </p>
<h2 id="3-1-基本代码"><a href="#3-1-基本代码" class="headerlink" title="3.1.基本代码"></a>3.1.基本代码</h2><h3 id="3-1-1-实体类"><a href="#3-1-1-实体类" class="headerlink" title="3.1.1.实体类"></a>3.1.1.实体类</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.entity</code>包中，添加实体类。</p>
<p>商品SPU</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.BaseEntity;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = false)</span></span><br><span class="line"><span class="meta">@TableName(&quot;tb_spu&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Spu</span> <span class="keyword">extends</span> <span class="title">BaseEntity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> Long brandId;</span><br><span class="line">    <span class="keyword">private</span> Long cid1;<span class="comment">// 1级类目</span></span><br><span class="line">    <span class="keyword">private</span> Long cid2;<span class="comment">// 2级类目</span></span><br><span class="line">    <span class="keyword">private</span> Long cid3;<span class="comment">// 3级类目</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    1 三级分类，所以表格有三个cidx</span></span><br><span class="line"><span class="comment">    最终决定的是第三级分类。</span></span><br><span class="line"><span class="comment">    虽然有三个cidx看起来冗余，但是查询显示时，方便多了；</span></span><br><span class="line"><span class="comment">    因为我们最后展示是展示三个分类级别的信息，只有一个cid的话要遍历父类id。。。。。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> String name;<span class="comment">// 商品名称</span></span><br><span class="line">    <span class="keyword">private</span> String title;<span class="comment">// 搜索标题</span></span><br><span class="line">    <span class="keyword">private</span> Boolean saleable;<span class="comment">// 是否上架</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>商品详情SpuDetail</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.BaseEntity;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = false)</span></span><br><span class="line"><span class="meta">@TableName(&quot;tb_spu_detail&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpuDetail</span> <span class="keyword">extends</span> <span class="title">BaseEntity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@TableId(type = IdType.INPUT)</span></span><br><span class="line">    <span class="keyword">private</span> Long spuId;<span class="comment">// 对应的SPU的id</span></span><br><span class="line">    <span class="keyword">private</span> String description;<span class="comment">// 商品描述</span></span><br><span class="line">    <span class="keyword">private</span> String packingList;<span class="comment">// 包装清单</span></span><br><span class="line">    <span class="keyword">private</span> String afterService;<span class="comment">// 售后服务</span></span><br><span class="line">    <span class="keyword">private</span> String specification;<span class="comment">// 规格参数值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>商品SKU</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.BaseEntity;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = false)</span></span><br><span class="line"><span class="meta">@TableName(value = &quot;tb_sku&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sku</span> <span class="keyword">extends</span> <span class="title">BaseEntity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> Long spuId;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String images;</span><br><span class="line">    <span class="keyword">private</span> Long price;</span><br><span class="line">    <span class="keyword">private</span> Long sold;</span><br><span class="line">    <span class="keyword">private</span> Integer stock;</span><br><span class="line">    <span class="keyword">private</span> String specialSpec;</span><br><span class="line">    <span class="keyword">private</span> String indexes;</span><br><span class="line">    <span class="keyword">private</span> Boolean saleable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-1-2-DTO"><a href="#3-1-2-DTO" class="headerlink" title="3.1.2.DTO"></a>3.1.2.DTO</h3><p>在<code>ly-item-pojo</code>的<code>com.leyou.item.dto</code>包中，添加实体类。</p>
<p>商品SpuDTO，因为<strong>一个SPU包含多个SKU</strong>，而<strong>SPU和SpuDetail是一对一关系</strong>。所以<strong>在SPU的DTO中，持有了SkuDTO的集合，还持有了SpuDetailDTO对象</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnore;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.dto.BaseDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.BaseEntity;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpuDTO</span> <span class="keyword">extends</span> <span class="title">BaseDTO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> Long brandId;</span><br><span class="line">    <span class="keyword">private</span> Long cid1;<span class="comment">// 1级类目</span></span><br><span class="line">    <span class="keyword">private</span> Long cid2;<span class="comment">// 2级类目</span></span><br><span class="line">    <span class="keyword">private</span> Long cid3;<span class="comment">// 3级类目</span></span><br><span class="line">    <span class="keyword">private</span> String name;<span class="comment">// 名称</span></span><br><span class="line">    <span class="keyword">private</span> String title;<span class="comment">// 标题</span></span><br><span class="line">    <span class="keyword">private</span> Boolean saleable;<span class="comment">// 是否上架</span></span><br><span class="line">    <span class="keyword">private</span> String categoryName; <span class="comment">// 商品分类名称拼接#########</span></span><br><span class="line">    <span class="keyword">private</span> String brandName;<span class="comment">// 品牌名称###############</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 商品详情########################################</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> SpuDetailDTO spuDetail;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * spu下的sku的集合 ##############################</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;SkuDTO&gt; skus;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 方便同时获取3级分类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 3级分类的id集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Long&gt; <span class="title">getCategoryIds</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.asList(cid1, cid2, cid3);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpuDTO</span><span class="params">(BaseEntity entity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(entity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends BaseEntity&gt; <span class="function">List&lt;SpuDTO&gt; <span class="title">convertEntityList</span><span class="params">(Collection&lt;T&gt; list)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(list == <span class="keyword">null</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="keyword">return</span> list.stream().map(SpuDTO::<span class="keyword">new</span>).collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>商品SpuDetailDTO</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.dto.BaseDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.BaseEntity;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpuDetailDTO</span> <span class="keyword">extends</span> <span class="title">BaseDTO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long spuId;<span class="comment">// 对应的SPU的id</span></span><br><span class="line">    <span class="keyword">private</span> String description;<span class="comment">// 商品描述</span></span><br><span class="line">    <span class="keyword">private</span> String packingList;<span class="comment">// 包装清单</span></span><br><span class="line">    <span class="keyword">private</span> String afterService;<span class="comment">// 售后服务</span></span><br><span class="line">    <span class="keyword">private</span> String specification;<span class="comment">// 规格参数</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpuDetailDTO</span><span class="params">(BaseEntity entity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(entity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>商品SkuDTO</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.dto.BaseDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.BaseEntity;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SkuDTO</span> <span class="keyword">extends</span> <span class="title">BaseDTO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> Long spuId;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String images;</span><br><span class="line">    <span class="keyword">private</span> Long price;</span><br><span class="line">    <span class="keyword">private</span> String specialSpec;<span class="comment">// 商品特殊规格的键值对</span></span><br><span class="line">    <span class="keyword">private</span> String indexes;<span class="comment">// 商品特殊规格的下标</span></span><br><span class="line">    <span class="keyword">private</span> Boolean saleable;<span class="comment">// 是否有效，逻辑删除用</span></span><br><span class="line">    <span class="keyword">private</span> Integer stock; <span class="comment">// 库存</span></span><br><span class="line">    <span class="keyword">private</span> Long sold; <span class="comment">// 销量</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SkuDTO</span><span class="params">(BaseEntity entity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(entity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends BaseEntity&gt; <span class="function">List&lt;SkuDTO&gt; <span class="title">convertEntityList</span><span class="params">(Collection&lt;T&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (list == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list.stream().map(SkuDTO::<span class="keyword">new</span>).collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-1-3-mapper"><a href="#3-1-3-mapper" class="headerlink" title="3.1.3.mapper"></a>3.1.3.mapper</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.mapper</code>包中，添加mapper接口。</p>
<p>SpuMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.Spu;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpuMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">Spu</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SpuDetailMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.SpuDetail;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpuDetailMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">SpuDetail</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SkuMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.Sku;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Update;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SkuMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">Sku</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-1-4-service"><a href="#3-1-4-service" class="headerlink" title="3.1.4.service"></a>3.1.4.service</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.service</code>包中，添加Service接口。</p>
<p>SpuService:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.dto.PageDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.dto.SpuDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.Spu;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpuService</span> <span class="keyword">extends</span> <span class="title">IService</span>&lt;<span class="title">Spu</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>SpuDetailService:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.SpuDetail;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpuDetailService</span> <span class="keyword">extends</span> <span class="title">IService</span>&lt;<span class="title">SpuDetail</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>SkuService:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.Sku;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SkuService</span> <span class="keyword">extends</span> <span class="title">IService</span>&lt;<span class="title">Sku</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后在<code>ly-item-service</code>的<code>com.leyou.item.service.impl</code>包中，添加ServiceImpl实现类。</p>
<p>SpuServiceImpl:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.dto.PageDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.exception.LyException;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.dto.SkuDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.dto.SpuDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.dto.SpuDetailDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.*;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.mapper.SpuMapper;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.service.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.CollectionUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpuServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">SpuMapper</span>, <span class="title">Spu</span>&gt; <span class="keyword">implements</span> <span class="title">SpuService</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>SpuDetailServiceImpl:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.SpuDetail;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.mapper.SpuDetailMapper;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.service.SpuDetailService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpuDetailServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">SpuDetailMapper</span>, <span class="title">SpuDetail</span>&gt; <span class="keyword">implements</span> <span class="title">SpuDetailService</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>SkuServiceImpl:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.Sku;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.mapper.SkuMapper;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.service.SkuService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SkuServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">SkuMapper</span>, <span class="title">Sku</span>&gt; <span class="keyword">implements</span> <span class="title">SkuService</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="3-1-5-controller"><a href="#3-1-5-controller" class="headerlink" title="3.1.5.controller"></a>3.1.5.controller</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.web</code>包中，添加Conroller。先注入service层对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.dto.PageDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.dto.SkuDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.dto.SpuDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.dto.SpuDetailDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.service.SkuService;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.service.SpuDetailService;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.service.SpuService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;goods&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SpuService spuService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SpuDetailService detailService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SkuService skuService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GoodsController</span><span class="params">(SpuService SpuService, SpuDetailService detailService, SkuService skuService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.spuService = SpuService;</span><br><span class="line">        <span class="keyword">this</span>.detailService = detailService;</span><br><span class="line">        <span class="keyword">this</span>.skuService = skuService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-2-商品分页查询"><a href="#3-2-商品分页查询" class="headerlink" title="3.2.商品分页查询"></a>3.2.商品分页查询</h2><p>点击左侧菜单的商品列表按钮，可以看到商品的列表查询页面：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200712233759159.png" alt="image-20200712233759159"> </p>
<p>并且控制台也已经发出请求：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200215223254488.png" alt="image-20200215223254488"></p>
<h3 id="3-2-1-接口声明"><a href="#3-2-1-接口声明" class="headerlink" title="3.2.1.接口声明"></a>3.2.1.接口声明</h3><p><strong>请求信息：</strong></p>
<ul>
<li><p>接口地址： <code>/goods/spu/page</code></p>
</li>
<li><p>请求方式： <code>GET</code></p>
</li>
<li><p>请求格式：<code>form</code></p>
</li>
<li><p>响应格式： <code>application/json</code></p>
</li>
</ul>
<p><strong>请求参数</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>请求类型</th>
<th>是否必须</th>
<th>数据类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>brandId</td>
<td>品牌id</td>
<td>query</td>
<td>false</td>
<td>integer</td>
<td></td>
</tr>
<tr>
<td>categoryId</td>
<td>商品分类id</td>
<td>query</td>
<td>false</td>
<td>integer</td>
<td></td>
</tr>
<tr>
<td>id</td>
<td>商品spu的ID</td>
<td>query</td>
<td>false</td>
<td>integer</td>
<td></td>
</tr>
<tr>
<td>page</td>
<td>当前页码</td>
<td>query</td>
<td>false</td>
<td>integer</td>
<td></td>
</tr>
<tr>
<td>rows</td>
<td>每页大小</td>
<td>query</td>
<td>false</td>
<td>integer</td>
<td></td>
</tr>
<tr>
<td>saleable</td>
<td>是否上架</td>
<td>query</td>
<td>false</td>
<td>boolean</td>
<td></td>
</tr>
</tbody></table>
<p><strong>响应参数</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>items</td>
<td>当前页数据</td>
<td>array</td>
<td>PageSpuDTO</td>
</tr>
<tr>
<td>total</td>
<td>总条数</td>
<td>integer(int64)</td>
<td>integer(int64)</td>
</tr>
<tr>
<td>totalPage</td>
<td>总页数</td>
<td>integer(int64)</td>
<td>integer(int64)</td>
</tr>
</tbody></table>
<p><strong>响应示例</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;items&quot;</span>: [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">&quot;brandId&quot;</span>: <span class="number">0</span>,</span><br><span class="line">			<span class="attr">&quot;brandName&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;categoryName&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;cid1&quot;</span>: <span class="number">0</span>,</span><br><span class="line">			<span class="attr">&quot;cid2&quot;</span>: <span class="number">0</span>,</span><br><span class="line">			<span class="attr">&quot;cid3&quot;</span>: <span class="number">0</span>,</span><br><span class="line">			<span class="attr">&quot;id&quot;</span>: <span class="number">0</span>,</span><br><span class="line">			<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;saleable&quot;</span>: <span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="attr">&quot;total&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;totalPage&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应到DTO中的：<code>PageDTO&lt;SpuDTO&gt;</code></p>
<h3 id="3-2-2-controller"><a href="#3-2-2-controller" class="headerlink" title="3.2.2.controller"></a>3.2.2.controller</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.web</code>包下的<code>GoodsController</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询spu</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page     当前页</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rows     每页大小</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> saleable 上架商品或下降商品</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> brandId 品牌id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryId 分类id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id  spu的id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 当前页商品数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/spu/page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;PageDTO&lt;SpuDTO&gt;&gt; querySpuByPage(</span><br><span class="line">    <span class="meta">@RequestParam(value = &quot;page&quot;, defaultValue = &quot;1&quot;)</span> Integer page,</span><br><span class="line">    <span class="meta">@RequestParam(value = &quot;rows&quot;, defaultValue = &quot;5&quot;)</span> Integer rows,</span><br><span class="line">    <span class="meta">@RequestParam(value = &quot;saleable&quot;, required = false)</span> Boolean saleable,</span><br><span class="line">    <span class="meta">@RequestParam(value = &quot;categoryId&quot;, required = false)</span> Long categoryId,</span><br><span class="line">    <span class="meta">@RequestParam(value = &quot;brandId&quot;, required = false)</span> Long brandId,</span><br><span class="line">    <span class="meta">@RequestParam(value = &quot;id&quot;, required = false)</span> Long id) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(spuService.querySpuByPage(page, rows, saleable, categoryId, brandId, id));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-2-3-service"><a href="#3-2-3-service" class="headerlink" title="3.2.3.service"></a>3.2.3.service</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.service</code>包下的<code>SpuService</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">PageDTO&lt;SpuDTO&gt; <span class="title">querySpuByPage</span><span class="params">(Integer page, Integer rows, Boolean saleable, Long categoryId, Long brandId, Long id)</span></span>;</span><br></pre></td></tr></table></figure>

<p>在<code>ly-item-service</code>的<code>com.leyou.item.service</code>包下的<code>SpuServiceImpl</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PageDTO&lt;SpuDTO&gt; <span class="title">querySpuByPage</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">            Integer page, Integer rows, Boolean saleable, Long categoryId, Long brandId, Long id)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1.健壮性</span></span><br><span class="line">        <span class="keyword">int</span> current = Math.max(page, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> size = Math.max(rows, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.准备查询条件， SELECT * FROM tb_spu WHERE saleable = ? AND category_id = ? AND brand_id = ? AND id = ?</span></span><br><span class="line">        Page&lt;Spu&gt; result = query()</span><br><span class="line">                .eq(saleable != <span class="keyword">null</span>, <span class="string">&quot;saleable&quot;</span>, saleable)</span><br><span class="line">                .eq(categoryId != <span class="keyword">null</span>, <span class="string">&quot;cid3&quot;</span>, categoryId)</span><br><span class="line">                .eq(brandId != <span class="keyword">null</span>, <span class="string">&quot;brand_id&quot;</span>, brandId)</span><br><span class="line">                .eq(id != <span class="keyword">null</span>, <span class="string">&quot;id&quot;</span>, id)</span><br><span class="line">                <span class="comment">// 3.准备分页条件 LIMIT ?, ?</span></span><br><span class="line">                .page(<span class="keyword">new</span> Page&lt;&gt;(current, size));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.解析查询结果</span></span><br><span class="line">        <span class="keyword">long</span> total = result.getTotal();</span><br><span class="line">        <span class="keyword">long</span> pages = result.getPages();</span><br><span class="line">        List&lt;Spu&gt; list = result.getRecords();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.转换DTO</span></span><br><span class="line">        List&lt;SpuDTO&gt; dtoList = SpuDTO.convertEntityList(list);</span><br><span class="line">        <span class="keyword">for</span> (SpuDTO spuDTO : dtoList) &#123;</span><br><span class="line">            <span class="comment">// 查询spu的分类和品牌的名称</span></span><br><span class="line">            handleCategoryAndBrandName(spuDTO);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6.封装分页结果并返回</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PageDTO&lt;&gt;(total, pages, dtoList);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>其中，给SPU中添加分类和品牌名称的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleCategoryAndBrandName</span><span class="params">(SpuDTO spuDTO)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 根据品牌id查询品牌名称</span></span><br><span class="line">    Brand brand = brandService.getById(spuDTO.getBrandId());</span><br><span class="line">    <span class="keyword">if</span>(brand != <span class="keyword">null</span>) &#123;</span><br><span class="line">        spuDTO.setBrandName(brand.getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 根据三级分类id查询分类集合</span></span><br><span class="line">    List&lt;Category&gt; categories = categoryService.listByIds(spuDTO.getCategoryIds());</span><br><span class="line">    <span class="keyword">if</span>(!CollectionUtils.isEmpty(categories)) &#123;</span><br><span class="line">        <span class="comment">//注意，根据IDS查到的是CategoryDTO集合，要用Stream流映射为String，也就是只取对象名称。</span></span><br><span class="line">        <span class="comment">// 取出分类的名称，拼接起来</span></span><br><span class="line">        String names = categories.stream().map(Category::getName).collect(Collectors.joining(<span class="string">&quot;/&quot;</span>));</span><br><span class="line">        spuDTO.setCategoryName(names);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>商品分页查询总结：</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1</span> <span class="string">商品分页查询，查询到的Page&lt;Spu&gt; 还要转为PageDTO&lt;spuDTO&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">而Spu转spuDTO需要额外的商品分类名称以及品牌名称</span> <span class="string">属性值的补充！（因此利用到前面将的tb_brand跟tb_category表）</span></span><br><span class="line">    <span class="attr">前面的DTO属性都是比数据库表字段少；</span></span><br><span class="line">    <span class="attr">而这里的DTO字段比数据库表格字段多，</span></span><br><span class="line"><span class="attr">因此要额外查询然后通过set参数的方法将额外查询的商品分类名称以及品牌名称封装到DTO中！</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="3-3-商品新增"><a href="#3-3-商品新增" class="headerlink" title="3.3.商品新增"></a>3.3.商品新增</h2><p>点击商品列表页顶部的新增按钮，即可进入商品新增的表单：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200215223423294.png" alt="image-20200215223423294"></p>
<p>填写表单信息，然后报存，即可看到请求发出：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200215230043576.png" alt="image-20200215230043576"></p>
<h3 id="3-3-1-接口声明"><a href="#3-3-1-接口声明" class="headerlink" title="3.3.1.接口声明"></a>3.3.1.接口声明</h3><p><strong>请求信息：</strong></p>
<ul>
<li><p>接口地址： <code>/goods</code></p>
</li>
<li><p>请求方式： <code>POST</code></p>
</li>
<li><p>请求格式：<code>application/json</code></p>
</li>
<li><p>响应格式： 无</p>
</li>
</ul>
<p><strong>请求参数</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;brandId&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;brandName&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;categoryName&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;cid1&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;cid2&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;cid3&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;id&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;saleable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="attr">&quot;skus&quot;</span>: [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">&quot;id&quot;</span>: <span class="number">0</span>,</span><br><span class="line">			<span class="attr">&quot;images&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;indexes&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;price&quot;</span>: <span class="number">0</span>,</span><br><span class="line">			<span class="attr">&quot;saleable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">			<span class="attr">&quot;specialSpec&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;spuId&quot;</span>: <span class="number">0</span>,</span><br><span class="line">			<span class="attr">&quot;stock&quot;</span>: <span class="number">0</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="attr">&quot;spuDetail&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;afterService&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;packingList&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;specification&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;spuId&quot;</span>: <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-3-2-controller"><a href="#3-3-2-controller" class="headerlink" title="3.3.2.controller"></a>3.3.2.controller</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.web</code>包下的<code>GoodsController</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增商品</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> spuDTO 页面提交商品信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 无</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;spu&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title">saveGoods</span><span class="params">(<span class="meta">@RequestBody</span> SpuDTO spuDTO)</span> </span>&#123;</span><br><span class="line">    spuService.saveGoods(spuDTO);</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.status(HttpStatus.NO_CONTENT).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-3-3-service"><a href="#3-3-3-service" class="headerlink" title="3.3.3.service"></a>3.3.3.service</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.service</code>包下的<code>SpuService</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">saveGoods</span><span class="params">(SpuDTO spuDTO)</span></span>;</span><br></pre></td></tr></table></figure>

<p>在<code>ly-item-service</code>的<code>com.leyou.item.service</code>包下的<code>SpuServiceImpl</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SpuDetailService detailService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SkuService skuService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveGoods</span><span class="params">(SpuDTO spuDTO)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.新增Spu</span></span><br><span class="line">    Spu spu = spuDTO.toEntity(Spu.class);</span><br><span class="line">    spu.setSaleable(<span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">boolean</span> success = save(spu);</span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> LyException(<span class="number">500</span>, <span class="string">&quot;新增商品失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.新增SpuDetail</span></span><br><span class="line">    SpuDetail spuDetail = spuDTO.getSpuDetail().toEntity(SpuDetail.class);</span><br><span class="line">    spuDetail.setSpuId(spu.getId());</span><br><span class="line">    success = detailService.save(spuDetail);</span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> LyException(<span class="number">500</span>, <span class="string">&quot;新增商品详情失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.新增Sku</span></span><br><span class="line">    List&lt;Sku&gt; list = spuDTO.getSkus().stream().map(skuDTO -&gt; &#123;</span><br><span class="line">        Sku sku = skuDTO.toEntity(Sku.class);</span><br><span class="line">        sku.setSaleable(<span class="keyword">false</span>);</span><br><span class="line">        sku.setSpuId(spu.getId());</span><br><span class="line">        <span class="keyword">return</span> sku;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">// 批量新增</span></span><br><span class="line">    skuService.saveBatch(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>商品新增总结：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">新增商品，也是传递（spuDTO，spudetailDTO，skusDTO）三个对象过来，</span></span><br><span class="line"><span class="attr">但是spudetailDTO，skusDTO是封装到spuDTO里面的，</span></span><br><span class="line"><span class="attr">因此web层方法只传参spuDTO，我们将三者xxxDTO都转为xxx，然后利用API直接添加到数据库！</span></span><br><span class="line"><span class="attr">注意：后两个对象还要添加spuId值。</span></span><br><span class="line">	<span class="attr">新增商品，默认是不上架的。</span></span><br></pre></td></tr></table></figure>



<h2 id="3-4-商品上下架"><a href="#3-4-商品上下架" class="headerlink" title="3.4.商品上下架"></a>3.4.商品上下架</h2><p>商品修改前，必须先下架，因此要完成商品的上架和下架功能，再完成商品修改。</p>
<h3 id="3-4-1-接口声明"><a href="#3-4-1-接口声明" class="headerlink" title="3.4.1.接口声明"></a>3.4.1.接口声明</h3><p><strong>请求信息：</strong></p>
<ul>
<li><p>接口地址： <code>/goods/saleable</code></p>
</li>
<li><p>请求方式： <code>PUT</code></p>
</li>
<li><p>请求格式：<code>form</code></p>
</li>
<li><p>响应格式： <code>无</code></p>
</li>
</ul>
<p><strong>请求参数</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>请求类型</th>
<th>是否必须</th>
<th>数据类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>商品id</td>
<td>query</td>
<td>false</td>
<td>integer</td>
<td></td>
</tr>
<tr>
<td>saleable</td>
<td>上架或下架</td>
<td>query</td>
<td>false</td>
<td>boolean</td>
<td></td>
</tr>
</tbody></table>
<p>注意： <strong>商品的上下架是根据spiId来修改spu表格以及sku表格！因为参数id表示的是spu的id。</strong></p>
<h3 id="3-4-2-controller"><a href="#3-4-2-controller" class="headerlink" title="3.4.2.controller"></a>3.4.2.controller</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.web</code>包下的<code>GoodsController</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改商品上下架</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 商品spu的id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> saleable true：上架；false：下架</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 无</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;saleable&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title">updateSpuSaleable</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@RequestParam(&quot;id&quot;)</span> Long id,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@RequestParam(&quot;saleable&quot;)</span> Boolean saleable)</span> </span>&#123;</span><br><span class="line">    spuService.updateSaleable(id, saleable);</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.status(HttpStatus.NO_CONTENT).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-4-3-service"><a href="#3-4-3-service" class="headerlink" title="3.4.3.service"></a>3.4.3.service</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.service</code>包下的<code>SpuService</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updateSaleable</span><span class="params">(Long id, Boolean saleable)</span></span>;</span><br></pre></td></tr></table></figure>

<p>在<code>ly-item-service</code>的<code>com.leyou.item.service</code>包下的<code>SpuServiceImpl</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateSaleable</span><span class="params">(Long id, Boolean saleable)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.更新SPU</span></span><br><span class="line">    Spu spu = <span class="keyword">new</span> Spu();</span><br><span class="line">    spu.setId(id);</span><br><span class="line">    spu.setSaleable(saleable);</span><br><span class="line">    <span class="keyword">boolean</span> success = updateById(spu);</span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> LyException(<span class="number">500</span>, <span class="string">&quot;更新失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.更新sku</span></span><br><span class="line">    <span class="comment">//	update tb_sku set saleable=? where spu_id=?</span></span><br><span class="line">    success =skuService.update().eq(<span class="string">&quot;spu_id&quot;</span>, id).set(<span class="string">&quot;saleable&quot;</span>, saleable).update();</span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> LyException(<span class="number">500</span>, <span class="string">&quot;更新失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>SPU下架时，其关联的SKU也必须保持下架状态，因此这里业务中不仅更新了SPU表，也更新了SKU表。</strong></p>
<h2 id="3-5-根据id查询商品"><a href="#3-5-根据id查询商品" class="headerlink" title="3.5.根据id查询商品"></a>3.5.根据id查询商品</h2><p>商品回显时，需要先<strong>根据spu的id查询到商品的spu、sku、spuDetail等信息，商品id也就是spuid。</strong></p>
<h3 id="3-5-1-接口声明"><a href="#3-5-1-接口声明" class="headerlink" title="3.5.1.接口声明"></a>3.5.1.接口声明</h3><p><strong>请求信息：</strong></p>
<ul>
<li><p>接口地址： <code>/goods/&#123;id&#125;</code></p>
</li>
<li><p>请求方式： <code>GET</code></p>
</li>
<li><p>请求格式：<code>path</code></p>
</li>
<li><p>响应格式： <code>application/json</code></p>
</li>
</ul>
<p><strong>响应示例</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;brandId&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;brandName&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;categoryName&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;cid1&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;cid2&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;cid3&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;id&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;saleable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="attr">&quot;skus&quot;</span>: [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">&quot;id&quot;</span>: <span class="number">0</span>,</span><br><span class="line">			<span class="attr">&quot;images&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;indexes&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;price&quot;</span>: <span class="number">0</span>,</span><br><span class="line">			<span class="attr">&quot;saleable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">			<span class="attr">&quot;specialSpec&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;spuId&quot;</span>: <span class="number">0</span>,</span><br><span class="line">			<span class="attr">&quot;stock&quot;</span>: <span class="number">0</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="attr">&quot;spuDetail&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;afterService&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;packingList&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;specification&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;spuId&quot;</span>: <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-5-2-controller"><a href="#3-5-2-controller" class="headerlink" title="3.5.2.controller"></a>3.5.2.controller</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.web</code>包下的<code>GoodsController</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询商品</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 商品id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 商品信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;SpuDTO&gt; <span class="title">queryGoodsById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(spuService.queryGoodsById(id));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-5-3-service"><a href="#3-5-3-service" class="headerlink" title="3.5.3.service"></a>3.5.3.service</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.service</code>包下的<code>SpuService</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">SpuDTO <span class="title">queryGoodsById</span><span class="params">(Long id)</span></span>;</span><br></pre></td></tr></table></figure>

<p>在<code>ly-item-service</code>的<code>com.leyou.item.service</code>包下的<code>SpuServiceImpl</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">商品查询：</span></span><br><span class="line"><span class="comment">根据商品id查询商品（spu，spudetail，sku）</span></span><br><span class="line"><span class="comment">查询spu封装到spuDTO中，然后再查询spudetail，sku，封装到spuDTO中</span></span><br><span class="line"><span class="comment">注意，还是跟新增商品一样，还要将商品的品牌名称跟 拼接的三级分类商品名称 封装到spuDTO中！</span></span><br><span class="line"><span class="comment">而想要得到 商品的品牌名称跟 拼接的三级分类商品名称 需要查询tb_brand 跟tb_category表格。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SpuDTO <span class="title">queryGoodsById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.查询spu</span></span><br><span class="line">    <span class="comment">// 1.1.查询</span></span><br><span class="line">    Spu spu = getById(id);</span><br><span class="line">    <span class="keyword">if</span> (spu == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> LyException(<span class="number">400</span>, <span class="string">&quot;商品id不存在！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1.2.转换DTO</span></span><br><span class="line">    SpuDTO spuDTO = <span class="keyword">new</span> SpuDTO(spu);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.查询spuDetail</span></span><br><span class="line">    SpuDetail detail = detailService.getById(id);</span><br><span class="line">    <span class="keyword">if</span> (detail == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> LyException(<span class="number">400</span>, <span class="string">&quot;商品id不存在！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    spuDTO.setSpuDetail(<span class="keyword">new</span> SpuDetailDTO(detail));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.查询sku</span></span><br><span class="line">    List&lt;Sku&gt; list = skuService.query().eq(<span class="string">&quot;spu_id&quot;</span>, id).list();</span><br><span class="line">    <span class="keyword">if</span>(CollectionUtils.isEmpty(list))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> LyException(<span class="number">400</span>, <span class="string">&quot;商品id不存在！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    spuDTO.setSkus(SkuDTO.convertEntityList(list));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.准备商品分类和品牌名称</span></span><br><span class="line">    handleCategoryAndBrandName(spuDTO);<span class="comment">//该方法在前面“新增产品哈！！！！！！！！！</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> spuDTO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="3-6-商品修改"><a href="#3-6-商品修改" class="headerlink" title="3.6.商品修改"></a>3.6.商品修改</h2><p>在商品列表页面，点击修改后，进入商品表单，填写后保存，会发现请求已经发出。而且，如果你只修改了SKU信息，请求参数中只有sku：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200215232407944.png" alt="image-20200215232407944"></p>
<p>如果你修改了SPU，则参数中会有SPU中被修改的数据：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200215233340859.png" alt="image-20200215233340859"> </p>
<p>如果修改了SpuDetail相关数据，则参数中会有SpuDetail被修改的数据：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200215233514389.png" alt="image-20200215233514389"> </p>
<p>如果新增了SKU数据，则新增的数据不包含id，修改的数据保护ID：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200216000651955.png" alt="image-20200216000651955"></p>
<p>如果有sku的被删除，那么我们前端会获取这个sku的id，并且指定一个属性：saleable为false：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/image-20200319142641297.png" alt="image-20200319142641297"></p>
<p>要判断sku是否是删除，就看是否包含<code>saleable</code>字段</p>
<p>因此，我们需要在业务处理时，表单提交的数据做出判断：</p>
<ul>
<li><p>是否包含spu信息</p>
</li>
<li><p>是否包含spuDetail信息</p>
</li>
<li><p>是否包含sku信息</p>
<ul>
<li>sku中有没有saleable：<ul>
<li>有则删除的sku，</li>
<li>没有则是增或改的sku<ul>
<li>有id：改</li>
<li>无id：增</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>修改商品小结：</strong></p>
</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">修改商品时</span></span><br><span class="line">	<span class="attr">spu跟spudetail这两个对象是修改哪个变量就只带哪个变量给后端哦</span></span><br><span class="line">	<span class="attr">但是sku的修改就比较麻烦，可能删除，修改，新增一起来！</span></span><br><span class="line">	<span class="attr">步骤：</span></span><br><span class="line">	<span class="attr">1</span> <span class="string">先判断想要修改什么</span></span><br><span class="line">	<span class="attr">2</span> <span class="string">如果是spu，spudetail直接从DTO转为实体类，直接update修改；</span></span><br><span class="line">	  <span class="attr">如果是修改sku时，将三种情况分离，分离到三个List中；然后再分别利用对应的API修改。</span></span><br></pre></td></tr></table></figure>



<h3 id="3-6-1-接口声明"><a href="#3-6-1-接口声明" class="headerlink" title="3.6.1.接口声明"></a>3.6.1.接口声明</h3><p><strong>请求信息：</strong></p>
<ul>
<li><p>接口地址： <code>/goods</code></p>
</li>
<li><p>请求方式： <code>PUT</code></p>
</li>
<li><p>请求格式：<code>JSON</code></p>
</li>
<li><p>响应格式： <code>无</code></p>
</li>
</ul>
<p><strong>请求参数</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;brandId&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;brandName&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;categoryName&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;cid1&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;cid2&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;cid3&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;id&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;saleable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="attr">&quot;skus&quot;</span>: [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">&quot;id&quot;</span>: <span class="number">0</span>,</span><br><span class="line">			<span class="attr">&quot;images&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;indexes&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;price&quot;</span>: <span class="number">0</span>,</span><br><span class="line">			<span class="attr">&quot;saleable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">			<span class="attr">&quot;specialSpec&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;spuId&quot;</span>: <span class="number">0</span>,</span><br><span class="line">			<span class="attr">&quot;stock&quot;</span>: <span class="number">0</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="attr">&quot;spuDetail&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;afterService&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;packingList&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;specification&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;spuId&quot;</span>: <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-6-2-controller"><a href="#3-6-2-controller" class="headerlink" title="3.6.2.controller"></a>3.6.2.controller</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.web</code>包下的<code>GoodsController</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新商品</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> spuDTO 页面提交商品信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 无</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;spu&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title">updateGoods</span><span class="params">(<span class="meta">@RequestBody</span> SpuDTO spuDTO)</span> </span>&#123;</span><br><span class="line">    spuService.updateGoods(spuDTO);</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.status(HttpStatus.NO_CONTENT).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-6-3-service"><a href="#3-6-3-service" class="headerlink" title="3.6.3.service"></a>3.6.3.service</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.service</code>包下的<code>SpuService</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updateGoods</span><span class="params">(SpuDTO spuDTO)</span></span>;</span><br></pre></td></tr></table></figure>

<p>在<code>ly-item-service</code>的<code>com.leyou.item.service</code>包下的<code>SpuServiceImpl</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateGoods</span><span class="params">(SpuDTO spuDTO)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.修改spu</span></span><br><span class="line">    <span class="comment">// 1.1.判断是否存在spu的id，有说明需要修改，没有说明不需要</span></span><br><span class="line">    Long spuId = spuDTO.getId();</span><br><span class="line">    <span class="keyword">if</span>(spuId != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 1.2.spu需要修改，更新spu, 转换dto</span></span><br><span class="line">        Spu spu = spuDTO.toEntity(Spu.class);</span><br><span class="line">        <span class="comment">// 1.3.更新</span></span><br><span class="line">        <span class="keyword">boolean</span> success = updateById(spu);</span><br><span class="line">        <span class="keyword">if</span>(!success)&#123;</span><br><span class="line">            <span class="comment">// 更新失败，抛出异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> LyException(<span class="number">500</span>, <span class="string">&quot;更新商品失败！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.修改spuDetail</span></span><br><span class="line">    SpuDetailDTO detailDTO = spuDTO.getSpuDetail();</span><br><span class="line">    <span class="comment">// 2.1.判断是否为null</span></span><br><span class="line">    <span class="keyword">if</span> (detailDTO != <span class="keyword">null</span> &amp;&amp; detailDTO.getSpuId() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 2.2.spuDetail存在，需要修改，转换DTO</span></span><br><span class="line">        SpuDetail detail = detailDTO.toEntity(SpuDetail.class);</span><br><span class="line">        <span class="keyword">boolean</span> success = detailService.updateById(detail);</span><br><span class="line">        <span class="keyword">if</span>(!success)&#123;</span><br><span class="line">            <span class="comment">// 更新失败，抛出异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> LyException(<span class="number">500</span>, <span class="string">&quot;更新商品失败！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.修改sku</span></span><br><span class="line">    List&lt;SkuDTO&gt; dtoList = spuDTO.getSkus();</span><br><span class="line">    <span class="comment">// 3.1.判断是否包含sku</span></span><br><span class="line">    <span class="keyword">if</span>(CollectionUtils.isEmpty(dtoList))&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.2.转换DTO，并将sku根据saleable是否为null来分组。null，是新增或修改，不是null是删除</span></span><br><span class="line">    Map&lt;Boolean, List&lt;Sku&gt;&gt; map = dtoList.stream()</span><br><span class="line">        .map(skuDTO -&gt; skuDTO.toEntity(Sku.class))</span><br><span class="line">        .collect(Collectors.groupingBy(sku -&gt; sku.getSaleable() == <span class="keyword">null</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.3.获取要新增或修改的sku</span></span><br><span class="line">    List&lt;Sku&gt; insertOrUpdateList = map.get(<span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">// 如果不为空，则修改或新增</span></span><br><span class="line">    <span class="keyword">if</span>(!CollectionUtils.isEmpty(insertOrUpdateList)) &#123;</span><br><span class="line">        skuService.saveOrUpdateBatch(insertOrUpdateList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.4.获取要删除的sku</span></span><br><span class="line">    List&lt;Sku&gt; deleteSkuList = map.get(<span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">if</span>(!CollectionUtils.isEmpty(deleteSkuList))&#123;</span><br><span class="line">        <span class="comment">// 存在要删除的sku</span></span><br><span class="line">        List&lt;Long&gt; idList = deleteSkuList.stream().map(Sku::getId).collect(Collectors.toList());</span><br><span class="line">        <span class="comment">// 删除</span></span><br><span class="line">        skuService.removeByIds(idList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-7-根据id查询SpuDetail"><a href="#3-7-根据id查询SpuDetail" class="headerlink" title="3.7.根据id查询SpuDetail"></a>3.7.根据id查询SpuDetail</h2><h3 id="3-7-1-接口声明"><a href="#3-7-1-接口声明" class="headerlink" title="3.7.1.接口声明"></a>3.7.1.接口声明</h3><p><strong>请求信息：</strong></p>
<ul>
<li><p>接口地址： <code>/goods/spu/detail</code></p>
</li>
<li><p>请求方式： <code>GET</code></p>
</li>
<li><p>请求格式：<code>form</code></p>
</li>
<li><p>响应格式： <code>JSON</code></p>
</li>
</ul>
<p><strong>请求参数</strong></p>
<table>
<thead>
<tr>
<th align="left">参数名称</th>
<th align="left">参数说明</th>
<th align="left">请求类型</th>
<th align="left">是否必须</th>
<th align="left">数据类型</th>
<th align="left">schema</th>
</tr>
</thead>
<tbody><tr>
<td align="left">id</td>
<td align="left">商品id</td>
<td align="left">query</td>
<td align="left">true</td>
<td align="left">integer</td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>响应结果</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;afterService&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;packingList&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;specification&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;spuId&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-7-2-controller"><a href="#3-7-2-controller" class="headerlink" title="3.7.2.controller"></a>3.7.2.controller</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.web</code>包下的<code>GoodsController</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询detail</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 商品id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 商品的Detail</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/spu/detail&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;SpuDetailDTO&gt; <span class="title">querySpuDetailById</span><span class="params">(<span class="meta">@RequestParam(&quot;id&quot;)</span> Long id)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(<span class="keyword">new</span> SpuDetailDTO(detailService.getById(id)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-8-根据SpuId查询SKU集合"><a href="#3-8-根据SpuId查询SKU集合" class="headerlink" title="3.8.根据SpuId查询SKU集合"></a>3.8.根据SpuId查询SKU集合</h2><h3 id="3-8-1-接口声明"><a href="#3-8-1-接口声明" class="headerlink" title="3.8.1.接口声明"></a>3.8.1.接口声明</h3><p><strong>请求信息：</strong></p>
<ul>
<li><p>接口地址： <code>/goods/sku/of/spu</code></p>
</li>
<li><p>请求方式： <code>GET</code></p>
</li>
<li><p>请求格式：<code>form</code></p>
</li>
<li><p>响应格式： <code>JSON</code></p>
</li>
</ul>
<p><strong>请求参数</strong></p>
<table>
<thead>
<tr>
<th align="left">参数名称</th>
<th align="left">参数说明</th>
<th align="left">请求类型</th>
<th align="left">是否必须</th>
<th align="left">数据类型</th>
<th align="left">schema</th>
</tr>
</thead>
<tbody><tr>
<td align="left">id</td>
<td align="left">商品id</td>
<td align="left">query</td>
<td align="left">true</td>
<td align="left">integer</td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>响应结果</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">&quot;id&quot;</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">&quot;images&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;indexes&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;price&quot;</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">&quot;saleable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">&quot;specialSpec&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;spuId&quot;</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">&quot;stock&quot;</span>: <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>





<h3 id="3-8-2-controller"><a href="#3-8-2-controller" class="headerlink" title="3.8.2.controller"></a>3.8.2.controller</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.web</code>包下的<code>GoodsController</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据spuID查询sku</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id spuID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> sku的集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/sku/of/spu&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;List&lt;SkuDTO&gt;&gt; querySkuBySpuId(<span class="meta">@RequestParam(&quot;id&quot;)</span> Long id)&#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(</span><br><span class="line">        SkuDTO.convertEntityList(skuService.query().eq(<span class="string">&quot;spu_id&quot;</span>, id).list())</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-9-根据id集合查询SKU集合"><a href="#3-9-根据id集合查询SKU集合" class="headerlink" title="3.9.根据id集合查询SKU集合"></a>3.9.根据id集合查询SKU集合</h2><h3 id="3-9-1-接口声明"><a href="#3-9-1-接口声明" class="headerlink" title="3.9.1.接口声明"></a>3.9.1.接口声明</h3><p><strong>请求信息：</strong></p>
<ul>
<li><p>接口地址： <code>/goods/sku/list</code></p>
</li>
<li><p>请求方式： <code>GET</code></p>
</li>
<li><p>请求格式：<code>form</code></p>
</li>
<li><p>响应格式： <code>JSON</code></p>
</li>
</ul>
<p><strong>请求参数</strong></p>
<table>
<thead>
<tr>
<th align="left">参数名称</th>
<th align="left">参数说明</th>
<th align="left">请求类型</th>
<th align="left">是否必须</th>
<th align="left">数据类型</th>
<th align="left">schema</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ids</td>
<td align="left">sku的id集合</td>
<td align="left">query</td>
<td align="left">true</td>
<td align="left">array</td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>响应结果</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">&quot;id&quot;</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">&quot;images&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;indexes&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;price&quot;</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">&quot;saleable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">&quot;specialSpec&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;spuId&quot;</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">&quot;stock&quot;</span>: <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>





<h3 id="3-9-2-controller"><a href="#3-9-2-controller" class="headerlink" title="3.9.2.controller"></a>3.9.2.controller</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.web</code>包下的<code>GoodsController</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id批量查询sku</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids id的集合</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> sku的集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/sku/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;List&lt;SkuDTO&gt;&gt; querySkuBySpuId(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids)&#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(</span><br><span class="line">        SkuDTO.convertEntityList(skuService.listByIds(ids))</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-10-查询商品规格参数键值对"><a href="#3-10-查询商品规格参数键值对" class="headerlink" title="3.10.查询商品规格参数键值对"></a>3.10.查询商品规格参数键值对</h2><p>根据spuId查询spu的所有规格参数键值对</p>
<h3 id="3-10-1-接口声明"><a href="#3-10-1-接口声明" class="headerlink" title="3.10.1.接口声明"></a>3.10.1.接口声明</h3><p><strong>请求信息：</strong></p>
<ul>
<li><p>接口地址： <code>/goods/spec/value</code></p>
</li>
<li><p>请求方式： <code>GET</code></p>
</li>
<li><p>请求格式：<code>form</code></p>
</li>
<li><p>响应格式： <code>application/json</code></p>
</li>
</ul>
<p><strong>请求参数</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>请求类型</th>
<th>是否必须</th>
<th>数据类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>商品spu的ID</td>
<td>query</td>
<td>true</td>
<td>integer</td>
<td></td>
</tr>
<tr>
<td>searching</td>
<td>是否参与搜索</td>
<td>query</td>
<td>false</td>
<td>boolean</td>
<td></td>
</tr>
</tbody></table>
<p><strong>响应示例</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">&quot;categoryId&quot;</span>: <span class="number">76</span>,</span><br><span class="line">		<span class="attr">&quot;generic&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">&quot;groupId&quot;</span>: <span class="number">5</span>,</span><br><span class="line">		<span class="attr">&quot;id&quot;</span>: <span class="number">12</span>,</span><br><span class="line">		<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;屏幕尺寸&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;numeric&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">&quot;options&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;searching&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">&quot;segments&quot;</span>: <span class="string">&quot;0-3.5,3.6-4.3,4.4-4.7,4.8-5.5,5.6-5.9,6.0-&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;unit&quot;</span>: <span class="string">&quot;英寸&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;value&quot;</span>: <span class="string">&quot;5.2&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>可以看出来，这里返回的是一个集合，集合中似乎是SpecParam对象，不过仔细观察，结果中包含一个value属性，也就是规格参数的值。</p>
<p>这个需要在DTO中表示出来，我们来修改<code>SpecParamDTO</code>，添加value字段：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.dto.BaseDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.BaseEntity;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpecParamDTO</span> <span class="keyword">extends</span> <span class="title">BaseDTO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line">    <span class="keyword">private</span> Long groupId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Boolean numeric;</span><br><span class="line">    <span class="keyword">private</span> String unit;</span><br><span class="line">    <span class="keyword">private</span> Boolean generic;</span><br><span class="line">    <span class="keyword">private</span> Boolean searching;</span><br><span class="line">    <span class="keyword">private</span> String segments;</span><br><span class="line">    <span class="keyword">private</span> String options;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 规格参数值##################添加这个属性。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Object value;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpecParamDTO</span><span class="params">(BaseEntity entity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(entity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends BaseEntity&gt; <span class="function">List&lt;SpecParamDTO&gt; <span class="title">convertEntityList</span><span class="params">(Collection&lt;T&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list.stream().map(SpecParamDTO::<span class="keyword">new</span>).collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="3-2-2-controller-1"><a href="#3-2-2-controller-1" class="headerlink" title="3.2.2.controller"></a>3.2.2.controller</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.web</code>包下的<code>GoodsController</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据spuId查询spu的所有规格参数值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id spu的id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 规格参数值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/spec/value&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;List&lt;SpecParamDTO&gt;&gt; querySpecsValues(</span><br><span class="line">    <span class="meta">@RequestParam(&quot;id&quot;)</span> Long id, <span class="meta">@RequestParam(value = &quot;searching&quot;, required = false)</span> Boolean searching)&#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(detailService.querySpecValues(id, searching));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-2-3-service-1"><a href="#3-2-3-service-1" class="headerlink" title="3.2.3.service"></a>3.2.3.service</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.service</code>包下的<code>SpuDetailService</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;SpecParamDTO&gt; <span class="title">querySpecValues</span><span class="params">(Long id, Boolean searching)</span></span>;</span><br></pre></td></tr></table></figure>

<p>在<code>ly-item-service</code>的<code>com.leyou.item.service</code>包下的<code>SpuDetailServiceImpl</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.utils.JsonUtils;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.dto.SpecParamDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.Spu;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.SpuDetail;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.mapper.SpuDetailMapper;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.mapper.SpuMapper;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.service.SpecParamService;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.service.SpuDetailService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpuDetailServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">SpuDetailMapper</span>, <span class="title">SpuDetail</span>&gt; <span class="keyword">implements</span> <span class="title">SpuDetailService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SpuMapper spuMapper;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SpecParamService paramService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpuDetailServiceImpl</span><span class="params">(SpuMapper spuMapper, SpecParamService paramService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.spuMapper = spuMapper;</span><br><span class="line">        <span class="keyword">this</span>.paramService = paramService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;SpecParamDTO&gt; <span class="title">querySpecValues</span><span class="params">(Long id, Boolean searching)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1.准备规格参数value</span></span><br><span class="line">        <span class="comment">// 1.1.根据id查询spuDetail</span></span><br><span class="line">        SpuDetail detail =  getById(id);</span><br><span class="line">        <span class="comment">// 1.2.获取其中的规格参数键值对，转为一个map</span></span><br><span class="line">        Map&lt;Long, Object&gt; specValues = JsonUtils.toMap(detail.getSpecification(), Long.class, Object.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.准备规格参数对象</span></span><br><span class="line">        <span class="comment">// 2.1.根据id查询spu，获取商品分类信息</span></span><br><span class="line">        Spu spu = spuMapper.selectById(id);</span><br><span class="line">        <span class="comment">// 2.2.根据分类id查询规格参数集合，如果searching不为空，还要加上searching条件</span></span><br><span class="line">        List&lt;SpecParamDTO&gt; params = paramService.queryParams(spu.getCid3(), <span class="keyword">null</span>, searching);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.找到param的value，并存储</span></span><br><span class="line">        <span class="keyword">for</span> (SpecParamDTO param : params) &#123;</span><br><span class="line">            param.setValue(specValues.get(param.getId()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-11-根据Id查询商品Spu"><a href="#3-11-根据Id查询商品Spu" class="headerlink" title="3.11.根据Id查询商品Spu"></a>3.11.根据Id查询商品Spu</h2><p>根据spuId查询spu，不包含其它信息</p>
<h3 id="3-11-1-接口声明"><a href="#3-11-1-接口声明" class="headerlink" title="3.11.1.接口声明"></a>3.11.1.接口声明</h3><p><strong>请求信息：</strong></p>
<ul>
<li><p>接口地址： <code>/goods/spu/&#123;id&#125;</code></p>
</li>
<li><p>请求方式： <code>GET</code></p>
</li>
<li><p>请求格式：<code>path</code></p>
</li>
<li><p>响应格式： <code>application/json</code></p>
</li>
</ul>
<p><strong>请求参数</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>请求类型</th>
<th>是否必须</th>
<th>数据类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>商品spu的ID</td>
<td>path</td>
<td>true</td>
<td>integer</td>
<td></td>
</tr>
</tbody></table>
<p><strong>响应示例</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;brandId&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;cid1&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;cid2&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;cid3&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;id&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;saleable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-11-2-controller"><a href="#3-11-2-controller" class="headerlink" title="3.11.2.controller"></a>3.11.2.controller</h3><p>在<code>ly-item-service</code>的<code>com.leyou.item.web</code>包下的<code>GoodsController</code>中，添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询商品</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 商品id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 商品信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/spu/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;SpuDTO&gt; <span class="title">querySpuById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(<span class="keyword">new</span> SpuDTO(spuService.getById(id)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">高明辉</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/06/20/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-%E5%95%86%E5%93%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1/">http://example.com/2022/06/20/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-%E5%95%86%E5%93%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Jason</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/">乐优商城项目</a></div><div class="post_share"><div class="social-share" data-image="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/%E5%B0%81%E9%9D%A2.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="添加微信"/></a><div class="post-qr-code-desc">添加微信</div></li><li class="reward-item"><a href="/img/pay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/pay.jpg" alt="付款码"/></a><div class="post-qr-code-desc">付款码</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/06/23/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-ElasticSearch%E8%BF%9B%E9%98%B6%E5%92%8CWebFlux/"><img class="prev-cover" src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/6Elasticsearch%E8%BF%9B%E9%98%B6%E5%92%8CWebFlux/%E5%B0%81%E9%9D%A2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Elasticsearch进阶和WebFlux</div></div></a></div><div class="next-post pull-right"><a href="/2022/06/18/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-%E5%93%81%E7%89%8C%E7%AE%A1%E7%90%86/"><img class="next-cover" src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/3%E5%93%81%E7%89%8C%E7%AE%A1%E7%90%86/%E5%B0%81%E9%9D%A2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">乐优商城项目-品牌管理</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/06/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-ElesticSear%E6%95%B0%E6%8D%AE%E6%90%9C%E7%B4%A2%E4%BB%A5%E5%8F%8Aes%E4%B8%8Emysql%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/" title="乐优商城项目-ElesticSear数据搜索以及es与mysql数据同步"><img class="cover" src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/8%E6%90%9C%E7%B4%A2%E8%BF%87%E6%BB%A4%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/%E5%B0%81%E9%9D%A2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-26</div><div class="title">乐优商城项目-ElesticSear数据搜索以及es与mysql数据同步</div></div></a></div><div><a href="/2022/06/18/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-%E5%93%81%E7%89%8C%E7%AE%A1%E7%90%86/" title="乐优商城项目-品牌管理"><img class="cover" src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/3%E5%93%81%E7%89%8C%E7%AE%A1%E7%90%86/%E5%B0%81%E9%9D%A2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-18</div><div class="title">乐优商城项目-品牌管理</div></div></a></div><div><a href="/2022/06/15/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/" title="乐优商城项目-项目搭建"><img class="cover" src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/1%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/%E5%B0%81%E9%9D%A2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-15</div><div class="title">乐优商城项目-项目搭建</div></div></a></div><div><a href="/2022/06/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-ElesticSearch%E5%AE%9E%E7%8E%B0%E5%9F%BA%E6%9C%AC%E6%90%9C%E7%B4%A2/" title="乐优商城项目-ElesticSearch实现基本搜索"><img class="cover" src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/7Elasticsearch%E5%AE%9E%E7%8E%B0%E5%9F%BA%E6%9C%AC%E6%90%9C%E7%B4%A2/%E5%B0%81%E9%9D%A2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-26</div><div class="title">乐优商城项目-ElesticSearch实现基本搜索</div></div></a></div><div><a href="/2022/06/17/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/" title="乐优商城项目-分类管理"><img class="cover" src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/%E5%B0%81%E9%9D%A2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-17</div><div class="title">乐优商城项目-分类管理</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-%E5%95%86%E5%93%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.</span> <span class="toc-text">乐优商城项目-商品数据结构设计</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0-%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87"><span class="toc-number">2.</span> <span class="toc-text">0.学习目标</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%AC%E7%AF%87%E5%8D%9A%E5%AE%A2%E6%80%BB%E7%BB%93%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2%EF%BC%9A"><span class="toc-number">3.</span> <span class="toc-text">本篇博客总结写在前面：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E5%95%86%E5%93%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.</span> <span class="toc-text">1.商品数据结构设计</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%95%86%E5%93%81%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90"><span class="toc-number">4.1.</span> <span class="toc-text">1.1.商品数据分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%95%86%E5%93%81%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.2.</span> <span class="toc-text">1.2.商品规格参数设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-%E8%A7%84%E6%A0%BC%E7%BB%84"><span class="toc-number">4.2.1.</span> <span class="toc-text">1.2.1.规格组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.2.2.</span> <span class="toc-text">1.2.2.数值类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-%E6%90%9C%E7%B4%A2%E5%AD%97%E6%AE%B5"><span class="toc-number">4.2.3.</span> <span class="toc-text">1.2.3.搜索字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-4-%E9%80%9A%E7%94%A8%E5%B1%9E%E6%80%A7"><span class="toc-number">4.2.4.</span> <span class="toc-text">1.2.4.通用属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-5-%E5%BE%85%E9%80%89%E9%A1%B9"><span class="toc-number">4.2.5.</span> <span class="toc-text">1.2.5.待选项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.3.</span> <span class="toc-text">1.3.商品设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-1-%E4%BB%80%E4%B9%88%E6%98%AFSPU%E5%92%8CSKU"><span class="toc-number">4.3.1.</span> <span class="toc-text">1.3.1.什么是SPU和SKU</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-2-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81SPU%E5%92%8CSKU"><span class="toc-number">4.3.2.</span> <span class="toc-text">1.3.2.为什么需要SPU和SKU</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-3-SPU%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">4.3.3.</span> <span class="toc-text">1.3.3.SPU数据结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-4-SKU%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">4.3.4.</span> <span class="toc-text">1.3.4.SKU数据结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E5%AF%BC%E5%85%A5%E5%95%86%E5%93%81%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE"><span class="toc-number">4.4.</span> <span class="toc-text">1.4.导入商品图片数据</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E4%B8%9A%E5%8A%A1"><span class="toc-number">5.</span> <span class="toc-text">2.规格参数业务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E5%9F%BA%E6%9C%AC%E4%BB%A3%E7%A0%81"><span class="toc-number">5.1.</span> <span class="toc-text">2.1.基本代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">5.1.1.</span> <span class="toc-text">2.1.1.实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-DTO"><span class="toc-number">5.1.2.</span> <span class="toc-text">2.1.2.DTO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-3-mapper"><span class="toc-number">5.1.3.</span> <span class="toc-text">2.1.3.mapper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-4-service"><span class="toc-number">5.1.4.</span> <span class="toc-text">2.1.4.service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-5-controller"><span class="toc-number">5.1.5.</span> <span class="toc-text">2.1.5.controller</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E6%A0%B9%E6%8D%AE%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E8%A7%84%E6%A0%BC%E7%BB%84"><span class="toc-number">5.2.</span> <span class="toc-text">2.2.根据分类查询规格组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1%E6%8E%A5%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">5.2.1.</span> <span class="toc-text">2.2.1接口声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E4%B8%9A%E5%8A%A1%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.2.2.</span> <span class="toc-text">2.2.2.业务实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E6%9F%A5%E8%AF%A2%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E9%9B%86%E5%90%88"><span class="toc-number">5.3.</span> <span class="toc-text">2.3.查询规格参数集合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1%E6%8E%A5%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">5.3.1.</span> <span class="toc-text">2.3.1接口声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E4%B8%9A%E5%8A%A1%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.3.2.</span> <span class="toc-text">2.3.2.业务实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E6%96%B0%E5%A2%9E%E8%A7%84%E6%A0%BC%E7%BB%84"><span class="toc-number">5.4.</span> <span class="toc-text">2.4.新增规格组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1%E6%8E%A5%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">5.4.1.</span> <span class="toc-text">2.4.1接口声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-%E4%B8%9A%E5%8A%A1%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.4.2.</span> <span class="toc-text">2.4.2.业务实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E4%BF%AE%E6%94%B9%E8%A7%84%E6%A0%BC%E7%BB%84"><span class="toc-number">5.5.</span> <span class="toc-text">2.5.修改规格组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-1%E6%8E%A5%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">5.5.1.</span> <span class="toc-text">2.5.1接口声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-2-%E4%B8%9A%E5%8A%A1%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.5.2.</span> <span class="toc-text">2.5.2.业务实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-%E6%96%B0%E5%A2%9E%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0"><span class="toc-number">5.6.</span> <span class="toc-text">2.6.新增规格参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-1%E6%8E%A5%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">5.6.1.</span> <span class="toc-text">2.6.1接口声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-2-%E4%B8%9A%E5%8A%A1%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.6.2.</span> <span class="toc-text">2.6.2.业务实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-7-%E4%BF%AE%E6%94%B9%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0"><span class="toc-number">5.7.</span> <span class="toc-text">2.7.修改规格参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-1%E6%8E%A5%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">5.7.1.</span> <span class="toc-text">2.7.1接口声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-2-%E4%B8%9A%E5%8A%A1%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.7.2.</span> <span class="toc-text">2.7.2.业务实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-8-%E6%9F%A5%E8%AF%A2%E8%A7%84%E6%A0%BC%E7%BB%84%E5%8F%8A%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0"><span class="toc-number">5.8.</span> <span class="toc-text">2.8.查询规格组及规格参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8-1%E6%8E%A5%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">5.8.1.</span> <span class="toc-text">2.8.1接口声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E4%B8%9A%E5%8A%A1%E5%AE%9E%E7%8E%B0-1"><span class="toc-number">5.8.2.</span> <span class="toc-text">2.3.2.业务实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-9-%E9%A1%B5%E9%9D%A2%E6%B5%8B%E8%AF%95"><span class="toc-number">5.9.</span> <span class="toc-text">2.9.页面测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-9-1-%E6%9F%A5%E8%AF%A2%E8%A7%84%E6%A0%BC%E7%BB%84%E6%B5%8B%E8%AF%95"><span class="toc-number">5.9.1.</span> <span class="toc-text">2.9.1.查询规格组测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-9-2-%E6%9F%A5%E8%AF%A2%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E6%B5%8B%E8%AF%95"><span class="toc-number">5.9.2.</span> <span class="toc-text">2.9.2.查询规格参数测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%95%86%E5%93%81%E4%B8%9A%E5%8A%A1"><span class="toc-number">6.</span> <span class="toc-text">3.商品业务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%9F%BA%E6%9C%AC%E4%BB%A3%E7%A0%81"><span class="toc-number">6.1.</span> <span class="toc-text">3.1.基本代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">6.1.1.</span> <span class="toc-text">3.1.1.实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-DTO"><span class="toc-number">6.1.2.</span> <span class="toc-text">3.1.2.DTO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-3-mapper"><span class="toc-number">6.1.3.</span> <span class="toc-text">3.1.3.mapper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-4-service"><span class="toc-number">6.1.4.</span> <span class="toc-text">3.1.4.service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-5-controller"><span class="toc-number">6.1.5.</span> <span class="toc-text">3.1.5.controller</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E5%95%86%E5%93%81%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.2.</span> <span class="toc-text">3.2.商品分页查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E6%8E%A5%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">6.2.1.</span> <span class="toc-text">3.2.1.接口声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-controller"><span class="toc-number">6.2.2.</span> <span class="toc-text">3.2.2.controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3-service"><span class="toc-number">6.2.3.</span> <span class="toc-text">3.2.3.service</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E5%95%86%E5%93%81%E6%96%B0%E5%A2%9E"><span class="toc-number">6.3.</span> <span class="toc-text">3.3.商品新增</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E6%8E%A5%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">6.3.1.</span> <span class="toc-text">3.3.1.接口声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-controller"><span class="toc-number">6.3.2.</span> <span class="toc-text">3.3.2.controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-3-service"><span class="toc-number">6.3.3.</span> <span class="toc-text">3.3.3.service</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E5%95%86%E5%93%81%E4%B8%8A%E4%B8%8B%E6%9E%B6"><span class="toc-number">6.4.</span> <span class="toc-text">3.4.商品上下架</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-1-%E6%8E%A5%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">6.4.1.</span> <span class="toc-text">3.4.1.接口声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-controller"><span class="toc-number">6.4.2.</span> <span class="toc-text">3.4.2.controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-3-service"><span class="toc-number">6.4.3.</span> <span class="toc-text">3.4.3.service</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-%E6%A0%B9%E6%8D%AEid%E6%9F%A5%E8%AF%A2%E5%95%86%E5%93%81"><span class="toc-number">6.5.</span> <span class="toc-text">3.5.根据id查询商品</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-1-%E6%8E%A5%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">6.5.1.</span> <span class="toc-text">3.5.1.接口声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-2-controller"><span class="toc-number">6.5.2.</span> <span class="toc-text">3.5.2.controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-3-service"><span class="toc-number">6.5.3.</span> <span class="toc-text">3.5.3.service</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-%E5%95%86%E5%93%81%E4%BF%AE%E6%94%B9"><span class="toc-number">6.6.</span> <span class="toc-text">3.6.商品修改</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-1-%E6%8E%A5%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">6.6.1.</span> <span class="toc-text">3.6.1.接口声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-2-controller"><span class="toc-number">6.6.2.</span> <span class="toc-text">3.6.2.controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-3-service"><span class="toc-number">6.6.3.</span> <span class="toc-text">3.6.3.service</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7-%E6%A0%B9%E6%8D%AEid%E6%9F%A5%E8%AF%A2SpuDetail"><span class="toc-number">6.7.</span> <span class="toc-text">3.7.根据id查询SpuDetail</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-1-%E6%8E%A5%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">6.7.1.</span> <span class="toc-text">3.7.1.接口声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-2-controller"><span class="toc-number">6.7.2.</span> <span class="toc-text">3.7.2.controller</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-8-%E6%A0%B9%E6%8D%AESpuId%E6%9F%A5%E8%AF%A2SKU%E9%9B%86%E5%90%88"><span class="toc-number">6.8.</span> <span class="toc-text">3.8.根据SpuId查询SKU集合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-1-%E6%8E%A5%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">6.8.1.</span> <span class="toc-text">3.8.1.接口声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-2-controller"><span class="toc-number">6.8.2.</span> <span class="toc-text">3.8.2.controller</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-9-%E6%A0%B9%E6%8D%AEid%E9%9B%86%E5%90%88%E6%9F%A5%E8%AF%A2SKU%E9%9B%86%E5%90%88"><span class="toc-number">6.9.</span> <span class="toc-text">3.9.根据id集合查询SKU集合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-9-1-%E6%8E%A5%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">6.9.1.</span> <span class="toc-text">3.9.1.接口声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-9-2-controller"><span class="toc-number">6.9.2.</span> <span class="toc-text">3.9.2.controller</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-10-%E6%9F%A5%E8%AF%A2%E5%95%86%E5%93%81%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E9%94%AE%E5%80%BC%E5%AF%B9"><span class="toc-number">6.10.</span> <span class="toc-text">3.10.查询商品规格参数键值对</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-10-1-%E6%8E%A5%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">6.10.1.</span> <span class="toc-text">3.10.1.接口声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-controller-1"><span class="toc-number">6.10.2.</span> <span class="toc-text">3.2.2.controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3-service-1"><span class="toc-number">6.10.3.</span> <span class="toc-text">3.2.3.service</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-11-%E6%A0%B9%E6%8D%AEId%E6%9F%A5%E8%AF%A2%E5%95%86%E5%93%81Spu"><span class="toc-number">6.11.</span> <span class="toc-text">3.11.根据Id查询商品Spu</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-11-1-%E6%8E%A5%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">6.11.1.</span> <span class="toc-text">3.11.1.接口声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-11-2-controller"><span class="toc-number">6.11.2.</span> <span class="toc-text">3.11.2.controller</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 高明辉</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'Aaee0Vekhg5KbLhMOJQrEU6A-gzGzoHsz',
      appKey: 'mmLHPEEtqvOSJhsqWra8Sq6K',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script type="text/javascript" src="/js/fairyDustCursor.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>