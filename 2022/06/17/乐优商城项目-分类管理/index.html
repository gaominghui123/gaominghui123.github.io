<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>乐优商城项目-分类管理 | Jason</title><meta name="keywords" content="乐优商城项目"><meta name="author" content="高明辉"><meta name="copyright" content="高明辉"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="分类管理0.学习目标1234- 能利用Nginx实现反向代理- 能使用mybatis-plus完成数据库操作- 能实现商品分类查询业务- 能使用Gateway解决跨域问题  1.域名访问我们现在访问页面使用的是：http:&#x2F;&#x2F;localhost:9001 有没有什么问题？ 实际开发中，会有不同的环境： 1234- 开发环境：自己的电脑- 测试环境：提供给测试人员使用的环境- 预发布环境：数据是和生">
<meta property="og:type" content="article">
<meta property="og:title" content="乐优商城项目-分类管理">
<meta property="og:url" content="http://example.com/2022/06/17/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/index.html">
<meta property="og:site_name" content="Jason">
<meta property="og:description" content="分类管理0.学习目标1234- 能利用Nginx实现反向代理- 能使用mybatis-plus完成数据库操作- 能实现商品分类查询业务- 能使用Gateway解决跨域问题  1.域名访问我们现在访问页面使用的是：http:&#x2F;&#x2F;localhost:9001 有没有什么问题？ 实际开发中，会有不同的环境： 1234- 开发环境：自己的电脑- 测试环境：提供给测试人员使用的环境- 预发布环境：数据是和生">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/%E5%B0%81%E9%9D%A2.png">
<meta property="article:published_time" content="2022-06-17T12:24:29.000Z">
<meta property="article:modified_time" content="2022-08-13T07:05:29.271Z">
<meta property="article:author" content="高明辉">
<meta property="article:tag" content="乐优商城项目">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/%E5%B0%81%E9%9D%A2.png"><link rel="shortcut icon" href="/img/%E7%BD%91%E7%AB%99%E5%9B%BE%E6%A0%87.png"><link rel="canonical" href="http://example.com/2022/06/17/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '乐优商城项目-分类管理',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-08-13 15:05:29'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Jason" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/%E5%A4%B4%E5%83%8F.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">176</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">206</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">34</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E5%85%B3%E4%BA%8E"><i class="fa-fw /about/"></i><span> 0</span></a></li><li><a class="site-page child" href="/myself"><i class="fa-fw /myself/"></i><span> 1</span></a></li><li><a class="site-page child" href="/butterfly%E4%B8%BB%E9%A2%98"><i class="fa-fw https://github.com/jerryc127/hexo-theme-butterfly/"></i><span> 2</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/%E5%B0%81%E9%9D%A2.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Jason</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E5%85%B3%E4%BA%8E"><i class="fa-fw /about/"></i><span> 0</span></a></li><li><a class="site-page child" href="/myself"><i class="fa-fw /myself/"></i><span> 1</span></a></li><li><a class="site-page child" href="/butterfly%E4%B8%BB%E9%A2%98"><i class="fa-fw https://github.com/jerryc127/hexo-theme-butterfly/"></i><span> 2</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">乐优商城项目-分类管理</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-06-17T12:24:29.000Z" title="发表于 2022-06-17 20:24:29">2022-06-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-08-13T07:05:29.271Z" title="更新于 2022-08-13 15:05:29">2022-08-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/">乐优商城项目</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="乐优商城项目-分类管理"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="分类管理"><a href="#分类管理" class="headerlink" title="分类管理"></a>分类管理</h1><h1 id="0-学习目标"><a href="#0-学习目标" class="headerlink" title="0.学习目标"></a>0.学习目标</h1><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">-</span> <span class="string">能利用Nginx实现反向代理</span></span><br><span class="line"><span class="meta">-</span> <span class="string">能使用mybatis-plus完成数据库操作</span></span><br><span class="line"><span class="meta">-</span> <span class="string">能实现商品分类查询业务</span></span><br><span class="line"><span class="meta">-</span> <span class="string">能使用Gateway解决跨域问题</span></span><br></pre></td></tr></table></figure>

<h1 id="1-域名访问"><a href="#1-域名访问" class="headerlink" title="1.域名访问"></a>1.域名访问</h1><p>我们现在访问页面使用的是：<a target="_blank" rel="noopener" href="http://localhost:9001/">http://localhost:9001</a></p>
<p>有没有什么问题？</p>
<p>实际开发中，会有不同的环境：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">-</span> <span class="string">开发环境：自己的电脑</span></span><br><span class="line"><span class="meta">-</span> <span class="string">测试环境：提供给测试人员使用的环境</span></span><br><span class="line"><span class="meta">-</span> <span class="string">预发布环境：数据是和生成环境的数据一致，运行最新的项目代码进去测试</span></span><br><span class="line"><span class="meta">-</span> <span class="string">生产环境：项目最终发布上线的环境</span></span><br></pre></td></tr></table></figure>



<p>如果不同环境使用不同的ip去访问，可能会出现一些问题。为了<strong>保证所有环境的一致，我们会在各种环境下都使用域名来访问</strong>。</p>
<p>我们将使用以下域名：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">-</span> <span class="string">主域名是：www.leyou.com，</span></span><br><span class="line"><span class="meta">-</span> <span class="string">管理系统域名：manage.leyou.com</span></span><br><span class="line"><span class="meta">-</span> <span class="string">网关域名：api.leyou.com</span></span><br><span class="line"><span class="meta">-</span> <span class="string">图片的域名：image.leyou.com</span></span><br><span class="line"><span class="meta">-</span> <span class="string">...</span></span><br></pre></td></tr></table></figure>

<p>但是开发环境下，我们希望这些域名指向的还是我们本机的某个端口。</p>
<p>那么，当我们在<strong>浏览器输入一个域名时，浏览器是如何找到对应服务的ip和端口的呢？</strong></p>
<h2 id="1-1-域名解析"><a href="#1-1-域名解析" class="headerlink" title="1.1.域名解析"></a>1.1.域名解析</h2><p><strong>一个域名一定会被解析为一个或多个ip</strong>。这一般会包含两步：</p>
<ul>
<li><p><strong>本地域名解析</strong></p>
<p>浏览器会首先在本机的hosts文件中查找域名映射的IP地址，如果查找到就返回IP ，没找到则进行域名服务器解析，一般本地解析都会失败，因为默认这个文件是空的。</p>
<ul>
<li>Windows下的hosts文件地址：C:/Windows/System32/drivers/etc/hosts</li>
<li>Linux下的hosts文件所在路径： /etc/hosts </li>
</ul>
<p>样式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># My hosts</span><br><span class="line">127.0.0.1 localhost</span><br><span class="line">0.0.0.0 account.jetbrains.com</span><br><span class="line">127.0.0.1 www.xmind.net</span><br></pre></td></tr></table></figure></li>
<li><p><strong>域名服务器解析</strong></p>
<p>本地解析失败，才会进行域名服务器解析，域名服务器就是网络中的一台计算机，里面记录了所有注册备案的域名和ip映射关系，一般只要域名是正确的，并且备案通过，一定能找到。</p>
</li>
</ul>
<p>我们可以伪造本地的hosts文件，实现对域名的解析。修改本地的host为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 api.leyou.com</span><br><span class="line">127.0.0.1 manage.leyou.com</span><br><span class="line">127.0.0.1 www.leyou.com</span><br><span class="line">127.0.0.1 image.leyou.com</span><br></pre></td></tr></table></figure>

<p>这样就实现了域名的关系映射了。</p>
<p>每次在C盘寻找hosts文件并修改是非常麻烦的，给大家推荐一个快捷修改host的工具，在课前资料中可以找到：</p>
<p> <img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200111172800276.png" alt="image-20200111172800276"></p>
<p>效果：</p>
<p> <img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200710225451221.png" alt="image-20200710225451221"></p>
<p>我们添加了两个映射关系：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">-</span> <span class="string">`127.0.0.1 api.leyou.com` ：我们的网关gateway</span></span><br><span class="line"><span class="meta">-</span> <span class="string">`127.0.0.1 manage.leyou.com`：我们的后台系统地址</span></span><br><span class="line"><span class="meta">-</span> <span class="string">`127.0.0.1 www.leyou.com`：我们的首页地址</span></span><br><span class="line"><span class="meta">-</span> <span class="string">`127.0.0.1 image.leyou.com`：我们的图片地址</span></span><br></pre></td></tr></table></figure>

<p>现在，ping一下域名试试是否畅通：</p>
<p> <img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/1526015211298.png" alt="1526015211298"></p>
<p>OK！</p>
<p>如果加上上一篇博客将的加入了hosts，现在hosts是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 ly-gateway</span><br><span class="line">127.0.0.1 ly-registry</span><br><span class="line">192.168.206.99 ly-mysql</span><br><span class="line">192.168.206.99 ly-redis</span><br><span class="line">192.168.206.99 ly-mq</span><br><span class="line">192.168.206.99 ly-es</span><br><span class="line">127.0.0.1 api.leyou.com</span><br><span class="line">127.0.0.1 manage.leyou.com</span><br><span class="line">127.0.0.1 www.leyou.com</span><br><span class="line">127.0.0.1 image.leyou.com</span><br></pre></td></tr></table></figure>



<h2 id="1-2-反向代理"><a href="#1-2-反向代理" class="headerlink" title="1.2.反向代理"></a>1.2.反向代理</h2><p>虽然域名解决了，但是现在如果我们要访问<strong>，还得自己加上端口</strong>：<code>http://manage.taotao.com:9001</code>。</p>
<p>这就不够优雅了。我们希望的是<strong>直接域名访问：<code>http://manage.taotao.com</code>。这种情况下端口默认是80</strong>，如何才能把请求转移到9001端口呢？</p>
<p>这里就要用到反向代理工具：Nginx（<strong>将反向代理的端口设置为http协议的默认端口80，那么浏览器浏览是就不用输入端口了</strong>）</p>
<h3 id="1-2-1-认识Nginx"><a href="#1-2-1-认识Nginx" class="headerlink" title="1.2.1.认识Nginx"></a>1.2.1.认识Nginx</h3><p><em>Nginx</em> (engine x) 是一个高性能的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/HTTP">HTTP</a>和<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/7793488">反向代理</a>web服务器，同时也提供了IMAP/POP3/SMTP<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%9C%8D%E5%8A%A1/100571">服务</a>。</p>
<p>其特点是占有内存少，<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%B9%B6%E5%8F%91/11024806">并发</a>能力强，事实上nginx的并发能力在同类型的网页服务器中表现较好，中国大陆使用nginx网站用户有：百度、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E4%BA%AC%E4%B8%9C/210931">京东</a>、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%96%B0%E6%B5%AA/125692">新浪</a>、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%BD%91%E6%98%93/185754">网易</a>、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%85%BE%E8%AE%AF/112204">腾讯</a>、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%B7%98%E5%AE%9D/145661">淘宝</a>等。它的<strong>常见作用包括：</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">-</span> <span class="string">反向代理（反向代理多个域名+端口）</span></span><br><span class="line"><span class="meta">-</span> <span class="string">负载均衡（对集群进行负载均衡）</span></span><br><span class="line"><span class="meta">-</span> <span class="string">请求限流</span></span><br><span class="line"><span class="meta">-</span> <span class="string">...</span></span><br></pre></td></tr></table></figure>



<h3 id="1-2-2-反向代理原理"><a href="#1-2-2-反向代理原理" class="headerlink" title="1.2.2.反向代理原理"></a>1.2.2.反向代理原理</h3><p>什么是反向代理？</p>
<ul>
<li>代理：通过客户机的配置，实现让一台服务器代理客户机，客户的所有请求都交给代理服务器处理。</li>
<li>反向代理：用一台服务器，代理真实服务器，<strong>用户访问时，不再是访问真实服务器，而是代理服务器</strong>。</li>
</ul>
<p>nginx可以当做反向代理服务器来使用：</p>
<ul>
<li>我们需要提前在nginx中配置好反向代理的规则，<strong>不同的请求，交给不同的真实服务器处理</strong></li>
<li>当请求到达nginx，nginx会根据已经定义的规则进行请求的转发，从而<strong>实现路由功能</strong></li>
</ul>
<p><strong>利用反向代理，就可以解决我们前面所说的端口问题</strong>，如图：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200111175118787.png" alt="image-20200111175118787"></p>
<p>如上面，<strong>nginx根据域名的不同代理了三个服务</strong></p>
<h2 id="1-3-安装Nginx"><a href="#1-3-安装Nginx" class="headerlink" title="1.3.安装Nginx"></a>1.3.安装Nginx</h2><p>安装非常简单，将下载的安装包直接解压即可：（<strong>注意路径不能有中文路径</strong>）</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200111175232233.png" alt="image-20200111175232233"> </p>
<p>绿色免安装，舒服！</p>
<p>解压后的目录：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200111175323969.png" alt="image-20200111175323969"> </p>
<p>nginx可以通过命令行来启动，打开CMD命令行，然后输入命令：</p>
<ul>
<li><p>启动：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start nginx.exe</span><br></pre></td></tr></table></figure></li>
<li><p>停止： #########注意啊，<strong>每次启动前要先把nginx停掉，因为前面启动的在后台，你要先关闭</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx.exe -s stop   </span><br></pre></td></tr></table></figure></li>
<li><p>重新加载：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx.exe -s reload</span><br></pre></td></tr></table></figure></li>
</ul>
<p>启动后，访问：<a target="_blank" rel="noopener" href="http://localhost/">http://localhost</a> 即可访问nginx的默认页面：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200111175634260.png" alt="image-20200111175634260"></p>
<p>（<strong>为什么访问localhost就会访问nginx呢？</strong>）因为nginx配置文件那里监听的域名+端口就是localhost:80，而http协议默认端口就是80</p>
<p>小意外：当运行<strong>start nginx.exe 时发生了报错</strong>：nginx: [error] CreateFile() “D:\nginx-1.12.2/logs/nginx.pid” failed (2: The system cannot find the file specified)，从日志log目录下的error也可以看看明显的错误信息，表示没有启动成功，<strong>再运行nginx.exe 命令时报错</strong>：nginx: [emerg] bind() to 0.0.0.0:80 failed (10013: An attempt was made to access a socket in a way forbidden by its access permissions)，表示端口80被占用了，因此需要到conf目录下的conf文件，更改监听端口，改为81后，直接使用命令start nginx.exe就可以运行成功了，然后在浏览器中访问：<a target="_blank" rel="noopener" href="http://localhost:81/">http://localhost:81</a> 就可以显示nginx的默认界面了，但是发生了中文乱码问题！</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220813144402171.png" alt="image-20220813144402171"></p>
<p>还有一种方法就是找到80端口被占用的进程的pid，然后杀死这个“无关紧要的进程”，那么nginx依然可以监听80端口!</p>
<h5 id="1-找到80端口被占用的进程的pid，由图可知对应pid为-65205"><a href="#1-找到80端口被占用的进程的pid，由图可知对应pid为-65205" class="headerlink" title="1 找到80端口被占用的进程的pid，由图可知对应pid为 65205"></a>1 找到80端口被占用的进程的pid，由图可知对应pid为 65205</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 netstat -aon|findstr &quot;80&quot;              </span><br></pre></td></tr></table></figure>

<p> netstat -aon表示查看所有运行中的进程</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220813145630635.png" alt="image-20220813145630635"></p>
<h5 id="2-杀死进程"><a href="#2-杀死进程" class="headerlink" title="2 杀死进程"></a>2 杀死进程</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">taskkill /pid 6520 /F</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220813145743411.png" alt="image-20220813145743411"></p>
<h5 id="nginx中文乱码问题的解决："><a href="#nginx中文乱码问题的解决：" class="headerlink" title="nginx中文乱码问题的解决："></a>nginx中文乱码问题的解决：</h5><p>很简单，在配置文件中指定编码格式为uft-8就好</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">server</span> &#123;</span><br><span class="line">    <span class="string">listen</span>       <span class="number">80</span><span class="string">;</span></span><br><span class="line">    <span class="string">server_name</span>  <span class="string">localhost;</span></span><br><span class="line">    <span class="string">charset</span> <span class="string">utf-8;</span></span><br><span class="line">    <span class="string">...</span></span><br></pre></td></tr></table></figure>

<h2 id="1-4-配置nginx反向代理"><a href="#1-4-配置nginx反向代理" class="headerlink" title="1.4.配置nginx反向代理"></a>1.4.配置nginx反向代理</h2><p>进入nginx的配置目录：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200111181528509.png" alt="image-20200111181528509"> </p>
<h3 id="1）导入自定义配置"><a href="#1）导入自定义配置" class="headerlink" title="1）导入自定义配置"></a>1）导入自定义配置</h3><p>打开<code>nginx.conf</code>文件，然后在文件的最后一行的<code>&#125;</code>上面引入配置：</p>
<p>(可以在源配置文件修改，但是我们<strong>一般使用外部文件配置，然后导入外部文件就好！</strong>)</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">include</span> vhost/<span class="regexp">*.conf</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200113092131269.png" alt="image-20200113092131269"> </p>
<p>这个配置的意思是 导入 <strong><code>vhost</code>目录下的所有以<code>.conf</code>为后缀的文件。这样可以做到多配置文件分离，方便管理</strong>。</p>
<p>现在，我们需要在<code>conf</code>目录中新建一个名为<code>vhost</code>的目录：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200113092403750.png" alt="image-20200113092403750"> </p>
<p>并在<code>vhost</code>中创建配置文件，这里我们叫<code>leyou.conf</code>：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200113092450661.png" alt="image-20200113092450661"> </p>
<h3 id="2）配置反向代理"><a href="#2）配置反向代理" class="headerlink" title="2）配置反向代理"></a>2）配置反向代理</h3><p>在leyou.conf中写入下面配置：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">	<span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">	<span class="attribute">server_name</span>  manage.leyou.com;</span><br><span class="line">	</span><br><span class="line">	<span class="attribute">location</span> / &#123;</span><br><span class="line">	    <span class="attribute">proxy_pass</span>   http://127.0.0.1:9001;</span><br><span class="line">		<span class="attribute">proxy_connect_timeout</span> <span class="number">600</span>;</span><br><span class="line">		<span class="attribute">proxy_read_timeout</span> <span class="number">5000</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">	<span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">	<span class="attribute">server_name</span>  www.leyou.com;</span><br><span class="line">	</span><br><span class="line">	<span class="attribute">location</span> / &#123;</span><br><span class="line">	    <span class="attribute">proxy_pass</span>   http://127.0.0.1:9002;</span><br><span class="line">		<span class="attribute">proxy_connect_timeout</span> <span class="number">600</span>;</span><br><span class="line">		<span class="attribute">proxy_read_timeout</span> <span class="number">5000</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">	<span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">	<span class="attribute">server_name</span>  api.leyou.com;</span><br><span class="line">	</span><br><span class="line">	<span class="attribute">location</span> / &#123;</span><br><span class="line">	    <span class="attribute">proxy_pass</span>   http://127.0.0.1:10010;</span><br><span class="line">		<span class="attribute">proxy_connect_timeout</span> <span class="number">600</span>;</span><br><span class="line">		<span class="attribute">proxy_read_timeout</span> <span class="number">5000</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置解读：</p>
<ul>
<li><code>server</code>：定义一个监听服务配置<ul>
<li><code>listen</code>：监听的端口</li>
<li><code>server_name</code>：监听的域名，端口一致，域名不同也不会处理</li>
<li><code>location</code>：匹配当前域名下的哪个路径。例如：<code>/</code>，代表的是一切路径<ul>
<li><code>proxy_pass</code>：监听并匹配成功后，反向代理的目的地，可以指向某个ip和port</li>
<li><code>proxy_connect_timeout</code>：反向代理后的连接超时时间</li>
<li><code>proxy_read_timeout</code>：反向代理后的读取超时时间</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="3）测试"><a href="#3）测试" class="headerlink" title="3）测试"></a>3）测试</h3><p>由上面的配置可知：</p>
<ul>
<li>发送到<a target="_blank" rel="noopener" href="http://manage.leyou.com的请求,会被代理到http//127.0.0.1:9001">http://manage.leyou.com的请求，会被代理到http://127.0.0.1:9001</a></li>
<li>发送到<a target="_blank" rel="noopener" href="http://www.leyou.com的请求,会被代理到http//127.0.0.1:9002">http://www.leyou.com的请求，会被代理到http://127.0.0.1:9002</a></li>
<li>发送到<a target="_blank" rel="noopener" href="http://api.leyou.com的请求,会被代理到http//127.0.0.1:10010">http://api.leyou.com的请求，会被代理到http://127.0.0.1:10010</a></li>
</ul>
<p>现在，我们重新加载Nginx配置:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx.exe -s reload</span><br></pre></td></tr></table></figure>

<p>然后启动leyou-manage，测试用域名访问：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200113093320205.png" alt="image-20200113093320205"></p>
<h2 id="1-5-负载均衡（了解）"><a href="#1-5-负载均衡（了解）" class="headerlink" title="1.5.负载均衡（了解）"></a>1.5.负载均衡（了解）</h2><p>我们的nginx反向代理，目标服务器地址是通过IP和Port来指定，那么新的问题来了：</p>
<p>如果我们的<code>leyou-manage</code>不是单节点，而是一个<strong>服务集群</strong>，如图：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200113094533555.png" alt="image-20200113094533555"></p>
<p>此时该怎么办呢？nginx该如何配置访问集群中的哪个节点呢？</p>
<p> 这就需要<strong>负载均衡的策略配置</strong>了。</p>
<h3 id="1）负载均衡轮询策略"><a href="#1）负载均衡轮询策略" class="headerlink" title="1）负载均衡轮询策略"></a>1）负载均衡轮询策略</h3><p>首先定义负载均衡的集群节点信息，及负载均衡的策略，默认策略是轮询，顾名思义，所有请求都按照时间顺序分配到不同的服务上，如果服务Down掉，可以自动剔除，本例中配置四个节点轮询：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 负载均衡配置，默认是轮询</span></span><br><span class="line"><span class="attribute">upstream</span> leyou-manage&#123;</span><br><span class="line">	<span class="attribute">server</span>	<span class="number">127.0.0.1:9001</span>; <span class="comment"># 节点信息</span></span><br><span class="line">    <span class="comment">#server	127.0.0.1:9002; # 节点信息</span></span><br><span class="line">    <span class="comment">#server	127.0.0.1:9003; # 节点信息</span></span><br><span class="line">    <span class="comment">#server	127.0.0.1:9004; # 节点信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后<strong>在反向代理时不要指向具体IP</strong>，而是这里配置的：<code>leyou-manage</code>。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">	<span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">	<span class="attribute">server_name</span>  manage.leyou.com;</span><br><span class="line">	</span><br><span class="line">	<span class="attribute">location</span> / &#123;</span><br><span class="line">	    <span class="attribute">proxy_pass</span>   http://leyou-manage;</span><br><span class="line">		<span class="attribute">proxy_connect_timeout</span> <span class="number">600</span>;</span><br><span class="line">		<span class="attribute">proxy_read_timeout</span> <span class="number">5000</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2）加权轮询"><a href="#2）加权轮询" class="headerlink" title="2）加权轮询"></a>2）加权轮询</h3><p>指定每个服务的权重比例，weight和访问比率成正比，通常用于后端服务机器性能不统一，将性能好的分配权重高来发挥服务器最大性能，如下配置后9001服务的访问比率会是9002服务的二倍。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 负载均衡配置，默认是轮询</span></span><br><span class="line"><span class="attribute">upstream</span> leyou-manage&#123;</span><br><span class="line">	<span class="attribute">server</span>	<span class="number">127.0.0.1:9001</span> weight=<span class="number">1</span>; <span class="comment"># 节点信息</span></span><br><span class="line">    <span class="attribute">server</span>	<span class="number">127.0.0.1:9002</span> weight=<span class="number">2</span>; <span class="comment"># 节点信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3）IP哈希"><a href="#3）IP哈希" class="headerlink" title="3）IP哈希"></a>3）IP哈希</h3><p>每个请求都根据访问ip的hash结果分配，经过这样的处理，每个访客固定访问一个后端服务</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span>  leyou-manage &#123;</span><br><span class="line">    ip_hash; </span><br><span class="line">	<span class="attribute">server</span>	<span class="number">127.0.0.1:9001</span>; <span class="comment"># 节点信息</span></span><br><span class="line">    <span class="attribute">server</span>	<span class="number">127.0.0.1:9002</span>; <span class="comment"># 节点信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4）最少连接"><a href="#4）最少连接" class="headerlink" title="4）最少连接"></a>4）最少连接</h3><p>将请求分配到连接数最少的服务上。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> leyou-manage&#123;</span><br><span class="line">    least_conn;</span><br><span class="line">	<span class="attribute">server</span>	<span class="number">127.0.0.1:9001</span>; <span class="comment"># 节点信息</span></span><br><span class="line">    <span class="attribute">server</span>	<span class="number">127.0.0.1:9002</span>; <span class="comment"># 节点信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-MybatisPlus"><a href="#2-MybatisPlus" class="headerlink" title="2.MybatisPlus"></a>2.MybatisPlus</h1><p>mybatis作为持久层框架，其优势是灵活，我们可以<strong>灵活定制sql</strong>。但凡事有利有弊，<strong>灵活的带来的缺点是，很多单表的简单CRUD，依然需要我们自己来写，非常浪费时间</strong>。</p>
<p>因此我们接下来要学习一个<strong>mybatis的插件：MybatisPlus，可以大大提高Mybatis的开发效率</strong>。</p>
<h2 id="2-1-介绍"><a href="#2-1-介绍" class="headerlink" title="2.1.介绍"></a>2.1.介绍</h2><p><a target="_blank" rel="noopener" href="https://github.com/baomidou/mybatis-plus">MyBatis-Plus</a>（简称 MP）是一个 <a target="_blank" rel="noopener" href="http://www.mybatis.org/mybatis-3/">MyBatis</a> 的增强工具，在 MyBatis 的基础上只做增强不做改变，为简化开发、提高效率而生。官网：<a target="_blank" rel="noopener" href="https://mp.baomidou.com/">https://mp.baomidou.com/</a></p>
<blockquote>
<p>愿景</p>
<p>我们的愿景是成为 MyBatis 最好的搭档，就像 <a target="_blank" rel="noopener" href="https://mp.baomidou.com/img/contra.jpg">魂斗罗</a> 中的 1P、2P，基友搭配，效率翻倍。</p>
</blockquote>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200113103722297.png" alt="image-20200113103722297"></p>
<ul>
<li><strong>无侵入</strong>：只做增强不做改变，引入它不会对现有工程产生影响，如丝般顺滑</li>
<li><strong>损耗小</strong>：启动即会自动注入基本 CURD，性能基本无损耗，直接面向对象操作</li>
<li><strong>强大的 CRUD 操作</strong>：内置通用 Mapper、通用 Service，仅仅通过少量配置即可实现单表大部分 CRUD 操作，更有强大的条件构造器，满足各类使用需求</li>
<li><strong>支持 Lambda 形式调用</strong>：通过 Lambda 表达式，方便的编写各类查询条件，无需再担心字段写错</li>
<li><strong>支持主键自动生成</strong>：支持多达 4 种主键策略（内含分布式唯一 ID 生成器 - Sequence），可自由配置，完美解决主键问题</li>
<li><strong>支持 ActiveRecord 模式</strong>：支持 ActiveRecord 形式调用，实体类只需继承 Model 类即可进行强大的 CRUD 操作</li>
<li><strong>支持自定义全局通用操作</strong>：支持全局通用方法注入（ Write once, use anywhere ）</li>
<li><strong>内置代码生成器</strong>：采用代码或者 Maven 插件可快速生成 Mapper 、 Model 、 Service 、 Controller 层代码，支持模板引擎，更有超多自定义配置等您来使用</li>
<li><strong>内置分页插件</strong>：基于 MyBatis 物理分页，开发者无需关心具体操作，配置好插件之后，写分页等同于普通 List 查询</li>
<li><strong>分页插件支持多种数据库</strong>：支持 MySQL、MariaDB、Oracle、DB2、H2、HSQL、SQLite、Postgre、SQLServer 等多种数据库</li>
<li><strong>内置性能分析插件</strong>：可输出 Sql 语句以及其执行时间，建议开发测试时启用该功能，能快速揪出慢查询</li>
<li><strong>内置全局拦截插件</strong>：提供全表 delete 、 update 操作智能分析阻断，也可自定义拦截规则，预防误操作</li>
</ul>
<h2 id="2-2-快速入门"><a href="#2-2-快速入门" class="headerlink" title="2.2.快速入门"></a>2.2.快速入门</h2><h3 id="2-2-1-准备数据"><a href="#2-2-1-准备数据" class="headerlink" title="2.2.1.准备数据"></a>2.2.1.准备数据</h3><p>首先新建一个库，然后运行下面的sql：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 建表</span><br><span class="line">DROP TABLE IF EXISTS user;</span><br><span class="line"></span><br><span class="line">CREATE TABLE user</span><br><span class="line">(</span><br><span class="line">	id BIGINT(20) NOT NULL COMMENT &#x27;主键ID&#x27;,</span><br><span class="line">	name VARCHAR(30) NULL DEFAULT NULL COMMENT &#x27;姓名&#x27;,</span><br><span class="line">	age INT(11) NULL DEFAULT NULL COMMENT &#x27;年龄&#x27;,</span><br><span class="line">	email VARCHAR(50) NULL DEFAULT NULL COMMENT &#x27;邮箱&#x27;,</span><br><span class="line">	PRIMARY KEY (id)</span><br><span class="line">);</span><br><span class="line"># 准备数据</span><br><span class="line"></span><br><span class="line">INSERT INTO user (id, name, age, email) VALUES</span><br><span class="line">(1, &#x27;Jone&#x27;, 18, &#x27;test1@baomidou.com&#x27;),</span><br><span class="line">(2, &#x27;Jack&#x27;, 20, &#x27;test2@baomidou.com&#x27;),</span><br><span class="line">(3, &#x27;Tom&#x27;, 28, &#x27;test3@baomidou.com&#x27;),</span><br><span class="line">(4, &#x27;Sandy&#x27;, 21, &#x27;test4@baomidou.com&#x27;),</span><br><span class="line">(5, &#x27;Billie&#x27;, 24, &#x27;test5@baomidou.com&#x27;);</span><br></pre></td></tr></table></figure>

<h3 id="2-2-2-准备Demo工程"><a href="#2-2-2-准备Demo工程" class="headerlink" title="2.2.2.准备Demo工程"></a>2.2.2.准备Demo工程</h3><p>新建maven工程</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200113105132768.png" alt="image-20200113105132768"></p>
<p>坐标：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200113105722583.png" alt="image-20200113105722583"></p>
<p>项目位置：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200113105729539.png" alt="image-20200113105729539"></p>
<h3 id="2-2-3-引入依赖"><a href="#2-2-3-引入依赖" class="headerlink" title="2.2.3.引入依赖"></a>2.2.3.引入依赖</h3><p>在项目pom文件写入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.itcast.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.12.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mybatis-plus的springboot支持--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mysql驱动--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--简化代码的工具包--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="2-2-4-配置"><a href="#2-2-4-配置" class="headerlink" title="2.2.4.配置"></a>2.2.4.配置</h3><p>在resources目录新建application.yml文件，写入下列配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">mybatis-plus-demo</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://ly-mysql:3306/heima?useUnicode=true&amp;characterEncoding=utf8&amp;allowMultiQueries=true&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">cn.itcast:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>



<h3 id="2-2-5-实体类"><a href="#2-2-5-实体类" class="headerlink" title="2.2.5.实体类"></a>2.2.5.实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.mp.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-2-6-mapper接口"><a href="#2-2-6-mapper接口" class="headerlink" title="2.2.6.mapper接口"></a>2.2.6.mapper接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.mp.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.mp.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里继承了BaseMapper，是MybatisPlus提供的基础接口，里面准备了大量的CRUD方法。</p>
<h3 id="2-2-7-启动类"><a href="#2-2-7-启动类" class="headerlink" title="2.2.7.启动类"></a>2.2.7.启动类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;cn.itcast.mp.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MpDemoApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MpDemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-2-8-单元测试"><a href="#2-2-8-单元测试" class="headerlink" title="2.2.8.单元测试"></a>2.2.8.单元测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.mp.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.mp.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.junit.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserMapperTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println((<span class="string">&quot;----- selectAll method test ------&quot;</span>));</span><br><span class="line">        <span class="comment">// 使用BaseMapper提供的selectList方法</span></span><br><span class="line">        List&lt;User&gt; userList = userMapper.selectList(<span class="keyword">null</span>);</span><br><span class="line">        Assert.assertEquals(<span class="number">5</span>, userList.size());</span><br><span class="line">        userList.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里测试了BaseMapper提供的查询所有的方法，运行结果如下：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200113111312151.png" alt="image-20200113111312151"></p>
<h2 id="2-3-一些注解"><a href="#2-3-一些注解" class="headerlink" title="2.3.一些注解"></a>2.3.一些注解</h2><p>上面我们虽然定义了Mapper接口，但是没有写任何SQL，<strong>MybatisPlus是如何知道该查询哪张表呢？</strong></p>
<p>来看看mapper的定义方式：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200113111756204.png" alt="image-20200113111756204"> </p>
<p>我们在继承BaseMapper时，指定了泛型是<code>&lt;User&gt;</code>，BaseMapper基于反射获取到<code>User</code>的字节码，然后默认就<strong>把类的名称作为表名称</strong>、<strong>把类中的字段作为数据库字段</strong>。</p>
<p>如果<strong>类名或字段名与数据库不一致，我们可以通过注解来声明</strong>：</p>
<p>官方文档：<a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/annotation.html">https://mp.baomidou.com/guide/annotation.html</a></p>
<h3 id="2-3-1-TableName"><a href="#2-3-1-TableName" class="headerlink" title="2.3.1.@TableName"></a>2.3.1.@TableName</h3><p>这个注解用在类上，声明当前类关联的表名称，可以配置下列属性：</p>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">类型</th>
<th align="center">必须指定</th>
<th align="center">默认值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">value</td>
<td align="center">String</td>
<td align="center">否</td>
<td align="center">“”</td>
<td>表名</td>
</tr>
<tr>
<td align="center">schema</td>
<td align="center">String</td>
<td align="center">否</td>
<td align="center">“”</td>
<td>schema</td>
</tr>
<tr>
<td align="center">keepGlobalPrefix</td>
<td align="center">boolean</td>
<td align="center">否</td>
<td align="center">false</td>
<td>是否保持使用全局的 tablePrefix 的值(如果设置了全局 tablePrefix 且自行设置了 value 的值)</td>
</tr>
<tr>
<td align="center">resultMap</td>
<td align="center">String</td>
<td align="center">否</td>
<td align="center">“”</td>
<td>xml 中 resultMap 的 id</td>
</tr>
<tr>
<td align="center">autoResultMap</td>
<td align="center">boolean</td>
<td align="center">否</td>
<td align="center">false</td>
<td>是否自动构建 resultMap 并使用(如果设置 resultMap 则不会进行 resultMap 的自动构建并注入)</td>
</tr>
</tbody></table>
<h3 id="2-3-2-TableId"><a href="#2-3-2-TableId" class="headerlink" title="2.3.2.@TableId"></a>2.3.2.@TableId</h3><ul>
<li>描述：主键注解</li>
</ul>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">类型</th>
<th align="center">必须指定</th>
<th align="center">默认值</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">value</td>
<td align="center">String</td>
<td align="center">否</td>
<td align="center">“”</td>
<td align="center">主键字段名</td>
</tr>
<tr>
<td align="center">type</td>
<td align="center">Enum</td>
<td align="center">否</td>
<td align="center">IdType.NONE</td>
<td align="center"><strong>主键类型</strong>，通过IdType枚举指定</td>
</tr>
</tbody></table>
<ul>
<li>IdType的枚举项：</li>
</ul>
<table>
<thead>
<tr>
<th align="center">值</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">AUTO</td>
<td align="center"><strong>数据库ID自增</strong></td>
</tr>
<tr>
<td align="center">NONE</td>
<td align="center">无状态,该类型为未设置主键类型(注解里等于跟随全局,全局里约等于 INPUT)</td>
</tr>
<tr>
<td align="center">INPUT</td>
<td align="center">insert前自行set主键值</td>
</tr>
<tr>
<td align="center">ASSIGN_ID</td>
<td align="center">分配ID(主键类型为Number(Long和Integer)或String)(since 3.3.0),使用接口<code>IdentifierGenerator</code>的方法<code>nextId</code>(默认实现类为<code>DefaultIdentifierGenerator</code>雪花算法)</td>
</tr>
<tr>
<td align="center">ASSIGN_UUID</td>
<td align="center">分配UUID,主键类型为String(since 3.3.0),使用接口<code>IdentifierGenerator</code>的方法<code>nextUUID</code>(默认default方法)</td>
</tr>
</tbody></table>
<h3 id="2-3-3-TableField"><a href="#2-3-3-TableField" class="headerlink" title="2.3.3.@TableField"></a>2.3.3.@TableField</h3><ul>
<li>描述：字段注解(非主键)</li>
<li>属性：</li>
</ul>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">类型</th>
<th align="center">必须指定</th>
<th align="center">默认值</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">value</td>
<td align="center">String</td>
<td align="center">否</td>
<td align="center">“”</td>
<td align="center">字段名</td>
</tr>
<tr>
<td align="center">el</td>
<td align="center">String</td>
<td align="center">否</td>
<td align="center">“”</td>
<td align="center">映射为原生 <code>#&#123; ... &#125;</code> 逻辑,相当于写在 xml 里的 <code>#&#123; ... &#125;</code> 部分</td>
</tr>
<tr>
<td align="center">exist</td>
<td align="center">boolean</td>
<td align="center">否</td>
<td align="center">true</td>
<td align="center">是否为数据库表字段</td>
</tr>
<tr>
<td align="center">condition</td>
<td align="center">String</td>
<td align="center">否</td>
<td align="center">“”</td>
<td align="center">字段 <code>where</code> 实体查询比较条件,有值设置则按设置的值为准,没有则为默认全局的 <code>%s=#&#123;%s&#125;</code>,<a target="_blank" rel="noopener" href="https://github.com/baomidou/mybatis-plus/blob/3.0/mybatis-plus-annotation/src/main/java/com/baomidou/mybatisplus/annotation/SqlCondition.java">参考</a></td>
</tr>
<tr>
<td align="center">update</td>
<td align="center">String</td>
<td align="center">否</td>
<td align="center">“”</td>
<td align="center">字段 <code>update set</code> 部分注入, 例如：update=”%s+1”：表示更新时会set version=version+1(该属性优先级高于 <code>el</code> 属性)</td>
</tr>
<tr>
<td align="center">insertStrategy</td>
<td align="center">Enum</td>
<td align="center">N</td>
<td align="center">DEFAULT</td>
<td align="center">举例：NOT_NULL: <code>insert into table_a(column) values (#&#123;columnProperty&#125;)</code></td>
</tr>
<tr>
<td align="center">updateStrategy</td>
<td align="center">Enum</td>
<td align="center">N</td>
<td align="center">DEFAULT</td>
<td align="center">举例：IGNORED: <code>update table_a set column=#&#123;columnProperty&#125;</code></td>
</tr>
<tr>
<td align="center">whereStrategy</td>
<td align="center">Enum</td>
<td align="center">N</td>
<td align="center">DEFAULT</td>
<td align="center">举例：NOT_EMPTY: <code>where column=#&#123;columnProperty&#125;</code></td>
</tr>
<tr>
<td align="center">fill</td>
<td align="center">Enum</td>
<td align="center">否</td>
<td align="center">FieldFill.DEFAULT</td>
<td align="center">字段自动填充策略</td>
</tr>
<tr>
<td align="center">select</td>
<td align="center">boolean</td>
<td align="center">否</td>
<td align="center">true</td>
<td align="center">是否进行 select 查询</td>
</tr>
<tr>
<td align="center">keepGlobalFormat</td>
<td align="center">boolean</td>
<td align="center">否</td>
<td align="center">false</td>
<td align="center">是否保持使用全局的 format 进行处理</td>
</tr>
<tr>
<td align="center">jdbcType</td>
<td align="center">JdbcType</td>
<td align="center">否</td>
<td align="center">JdbcType.UNDEFINED</td>
<td align="center">JDBC类型 (该默认值不代表会按照该值生效)</td>
</tr>
<tr>
<td align="center">typeHandler</td>
<td align="center">Class&lt;? extends TypeHandler&gt;</td>
<td align="center">否</td>
<td align="center">UnknownTypeHandler.class</td>
<td align="center">类型处理器 (该默认值不代表会按照该值生效)</td>
</tr>
<tr>
<td align="center">numericScale</td>
<td align="center">String</td>
<td align="center">否</td>
<td align="center">“”</td>
<td align="center">指定小数点后保留的位数</td>
</tr>
</tbody></table>
<h2 id="2-4-常见配置"><a href="#2-4-常见配置" class="headerlink" title="2.4.常见配置"></a>2.4.常见配置</h2><p>MyBatisPlus配置整合了部分原来的Mybatis配置，都可以通过yaml文件来配置。</p>
<p>详见文档：<a target="_blank" rel="noopener" href="https://mp.baomidou.com/config/">https://mp.baomidou.com/config/</a></p>
<p>例如：mapper文件地址、别名扫描包等</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.leyou.item.entity</span> <span class="comment"># 别名扫描包</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath*:/mappers/*.xml</span> <span class="comment"># mapper的xml文件地址</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span> <span class="comment"># 全局主键策略，默认为自增长</span></span><br><span class="line">      <span class="attr">update-strategy:</span> <span class="string">not_null</span> <span class="comment"># 更新时，只更新非null字段（不会将原来的字段设置为null）</span></span><br><span class="line">      <span class="attr">insert-strategy:</span> <span class="string">not_null</span> <span class="comment"># 新增时，只新增非null字段</span></span><br></pre></td></tr></table></figure>

<p>1  id-type 默认值为 <strong>id生成器生成</strong> 策略（worker），是<strong>根据雪花算法生成的id</strong>。但是如果带给数据库的数据id本身有值，那么woker策略也很聪明，就不用雪花算法生成了，直接使用本来的id。当数据库表id本来是主键自增，但是我们这里设置了默认策略，那还是<strong>按照mybatis-plus框架设置的主键策略优先</strong>，因为数据到达库中时，id已经生成了哈！</p>
<p>2  id-type配置为auto，那么在插入时id没有被带到数据库。</p>
<p>3  id-type 配置为input，表示插入表中的id由实体类对象的id决定。</p>
<p><strong>错误的用法：</strong>代码配置了自增，但是库没有自增，那么就会报错。因为代码配置了自增，就算插入的数据本来有id，那么框架也会把id值给去掉，意思是数据<strong>到达数据库时是不带id的</strong>，而数据库又 没有自增，那就gg了！</p>
<p><strong>全局配置</strong>：在配置文件中配置。</p>
<p><strong>局部配置</strong>：到实体类中进行配置，优先级高于全局配置。</p>
<p>比如说，有十张表是主键自增的，有一张不是主键自增的，那么就可以在配置文件中，id的type配置为auto，然后到另外一张表对应的实体类中的id字段上面的TableId注解中，添加type属性为input，或者woker。</p>
<h2 id="2-5-BaseMapper的CRUD"><a href="#2-5-BaseMapper的CRUD" class="headerlink" title="2.5.BaseMapper的CRUD"></a>2.5.BaseMapper的CRUD</h2><p>在MybatisPlus中，<strong>BaseMapper中定义</strong>了一些常用的CRUD方法，当我们<strong>自定义的Mapper接口继承BaseMapper后即可拥有了这些方法</strong>。</p>
<h3 id="2-5-1-新增"><a href="#2-5-1-新增" class="headerlink" title="2.5.1.新增"></a>2.5.1.新增</h3><h4 id="方法："><a href="#方法：" class="headerlink" title="方法："></a>方法：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 插入一条记录</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(T entity)</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h4><table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">T</td>
<td align="center">entity</td>
<td align="center">实体对象</td>
</tr>
</tbody></table>
<h4 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setId(<span class="number">6L</span>);</span><br><span class="line">    user.setName(<span class="string">&quot;Amy&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">16</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;amy@itcast.cn&quot;</span>);</span><br><span class="line">    userMapper.insert(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">11:49:28.988 DEBUG 30192 --- [           main] cn.itcast.mp.mapper.UserMapper.insert    : ==&gt;  Preparing: INSERT INTO user ( id, name, email, age ) VALUES ( ?, ?, ?, ? ) </span><br><span class="line">11:49:29.004 DEBUG 30192 --- [           main] cn.itcast.mp.mapper.UserMapper.insert    : ==&gt; Parameters: 6(Long), Amy(String), amy@itcast.cn(String), 16(Integer)</span><br><span class="line">11:49:29.007 DEBUG 30192 --- [           main] cn.itcast.mp.mapper.UserMapper.insert    : &lt;==    Updates: 1</span><br></pre></td></tr></table></figure>



<h3 id="2-5-2-删除"><a href="#2-5-2-删除" class="headerlink" title="2.5.2.删除"></a>2.5.2.删除</h3><h4 id="方法：-1"><a href="#方法：-1" class="headerlink" title="方法："></a>方法：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 entity 条件，删除记录</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">delete</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; wrapper)</span></span>;</span><br><span class="line"><span class="comment">// 删除（根据ID 批量删除）</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">deleteBatchIds</span><span class="params">(<span class="meta">@Param(Constants.COLLECTION)</span> Collection&lt;? extends Serializable&gt; idList)</span></span>;</span><br><span class="line"><span class="comment">// 根据 ID 删除</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">deleteById</span><span class="params">(Serializable id)</span></span>;</span><br><span class="line"><span class="comment">// 根据 columnMap 条件，删除记录</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">deleteByMap</span><span class="params">(<span class="meta">@Param(Constants.COLUMN_MAP)</span> Map&lt;String, Object&gt; columnMap)</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="参数说明-1"><a href="#参数说明-1" class="headerlink" title="#参数说明"></a><a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/crud-interface.html#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-10">#</a>参数说明</h4><table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Wrapper<T></td>
<td align="center">wrapper</td>
<td align="center">实体对象封装操作类（可以为 null）</td>
</tr>
<tr>
<td align="center">Collection&lt;? extends Serializable&gt;</td>
<td align="center">idList</td>
<td align="center">主键ID列表(不能为 null 以及 empty)</td>
</tr>
<tr>
<td align="center">Serializable</td>
<td align="center">id</td>
<td align="center">主键ID</td>
</tr>
<tr>
<td align="center">Map&lt;String, Object&gt;</td>
<td align="center">columnMap</td>
<td align="center">表字段 map 对象</td>
</tr>
</tbody></table>
<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">int</span> count = userMapper.delete(</span><br><span class="line">              <span class="keyword">new</span> QueryWrapper&lt;User&gt;()</span><br><span class="line">                      .eq(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Amy&quot;</span>));</span><br><span class="line"></span><br><span class="line">      System.out.println(<span class="string">&quot;count = &quot;</span> + count);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2020-07-14 00:07:50.322 DEBUG 30156 --- [           main] cn.itcast.mp.mapper.UserMapper.delete    : ==&gt;  Preparing: DELETE FROM user WHERE (name = ?) </span><br><span class="line">2020-07-14 00:07:50.367 DEBUG 30156 --- [           main] cn.itcast.mp.mapper.UserMapper.delete    : ==&gt; Parameters: Amy(String)</span><br><span class="line">2020-07-14 00:07:50.371 DEBUG 30156 --- [           main] cn.itcast.mp.mapper.UserMapper.delete    : &lt;==    Updates: 1</span><br></pre></td></tr></table></figure>



<h3 id="2-5-3-修改"><a href="#2-5-3-修改" class="headerlink" title="2.5.3.修改"></a>2.5.3.修改</h3><h4 id="方法：-2"><a href="#方法：-2" class="headerlink" title="方法："></a>方法：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 whereEntity 条件，更新记录</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">(<span class="meta">@Param(Constants.ENTITY)</span> T entity, <span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; updateWrapper)</span></span>;</span><br><span class="line"><span class="comment">// 根据 ID 修改</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">updateById</span><span class="params">(<span class="meta">@Param(Constants.ENTITY)</span> T entity)</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="参数："><a href="#参数：" class="headerlink" title="参数："></a>参数：</h4><table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">T</td>
<td align="center">entity</td>
<td align="center">实体对象 (set 条件值,可为 null)</td>
</tr>
<tr>
<td align="center">Wrapper<T></td>
<td align="center">updateWrapper</td>
<td align="center">实体对象封装操作类（可以为 null,里面的 entity 用于生成 where 语句）</td>
</tr>
</tbody></table>
<h4 id="示例：-1"><a href="#示例：-1" class="headerlink" title="示例："></a>示例：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span></span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setId(<span class="number">5L</span>);</span><br><span class="line">    user.setName(<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> count = userMapper.updateById(user);</span><br><span class="line">    System.out.println(<span class="string">&quot;修改成功!, count = &quot;</span> + count );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2020-07-14 00:12:03.403 DEBUG 6188 --- [           main] cn.itcast.mp.mapper.UserMapper.update    : ==&gt;  Preparing: UPDATE user SET name=? WHERE (age = ?) </span><br><span class="line">2020-07-14 00:12:03.438 DEBUG 6188 --- [           main] cn.itcast.mp.mapper.UserMapper.update    : ==&gt; Parameters: lisi(String), 24(Integer)</span><br><span class="line">2020-07-14 00:12:03.440 DEBUG 6188 --- [           main] cn.itcast.mp.mapper.UserMapper.update    : &lt;==    Updates: 1</span><br><span class="line">修改成功!, count = 1</span><br></pre></td></tr></table></figure>



<h3 id="2-5-4-查询单个"><a href="#2-5-4-查询单个" class="headerlink" title="2.5.4.查询单个"></a>2.5.4.查询单个</h3><h4 id="方法列表"><a href="#方法列表" class="headerlink" title="方法列表:"></a>方法列表:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 ID 查询</span></span><br><span class="line"><span class="function">T <span class="title">selectById</span><span class="params">(Serializable id)</span></span>;</span><br><span class="line"><span class="comment">// 根据 entity 条件，查询一条记录</span></span><br><span class="line"><span class="function">T <span class="title">selectOne</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span></span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="参数说明-2"><a href="#参数说明-2" class="headerlink" title="#参数说明:"></a><a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/crud-interface.html#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-12">#</a>参数说明:</h4><table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Serializable</td>
<td align="center">id</td>
<td align="center">主键ID</td>
</tr>
<tr>
<td align="center">Wrapper<T></td>
<td align="center">queryWrapper</td>
<td align="center">实体对象封装操作类（可以为 null）</td>
</tr>
</tbody></table>
<h4 id="示例：-2"><a href="#示例：-2" class="headerlink" title="示例："></a>示例：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryById</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 根据ID查询</span></span><br><span class="line">    User user = userMapper.selectById(<span class="number">1L</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;user = &quot;</span> + user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-5-5-查询集合："><a href="#2-5-5-查询集合：" class="headerlink" title="2.5.5.查询集合："></a>2.5.5.查询集合：</h3><h4 id="方法列表："><a href="#方法列表：" class="headerlink" title="方法列表："></a>方法列表：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询（根据ID 批量查询）</span></span><br><span class="line"><span class="function">List&lt;T&gt; <span class="title">selectBatchIds</span><span class="params">(<span class="meta">@Param(Constants.COLLECTION)</span> Collection&lt;? extends Serializable&gt; idList)</span></span>;</span><br><span class="line"><span class="comment">// 根据 entity 条件，查询全部记录</span></span><br><span class="line"><span class="function">List&lt;T&gt; <span class="title">selectList</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span></span>;</span><br><span class="line"><span class="comment">// 查询（根据 columnMap 条件）</span></span><br><span class="line"><span class="function">List&lt;T&gt; <span class="title">selectByMap</span><span class="params">(<span class="meta">@Param(Constants.COLUMN_MAP)</span> Map&lt;String, Object&gt; columnMap)</span></span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询全部记录</span></span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; selectMaps(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper);</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询全部记录。注意： 只返回第一个字段的值</span></span><br><span class="line"><span class="function">List&lt;Object&gt; <span class="title">selectObjs</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span></span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="示例：-3"><a href="#示例：-3" class="headerlink" title="示例："></a>示例：</h4><p>1）根据id集合查询：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryByIdList</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 根据ID查询</span></span><br><span class="line">    List&lt;User&gt; list = userMapper.selectBatchIds(Arrays.asList(<span class="number">1L</span>, <span class="number">2L</span>, <span class="number">3L</span>));</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2）根据wrapper查询：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryByWrapper</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 定义wrapper</span></span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    <span class="comment">// 模糊</span></span><br><span class="line">    wrapper.like(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;o&quot;</span>)</span><br><span class="line">        <span class="comment">// 范围</span></span><br><span class="line">        .le(<span class="string">&quot;age&quot;</span>, <span class="number">30</span>)</span><br><span class="line">        <span class="comment">// 排序</span></span><br><span class="line">        .orderByAsc(<span class="string">&quot;age&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询</span></span><br><span class="line">    List&lt;User&gt; list = userMapper.selectList(wrapper);</span><br><span class="line"></span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>生成的sql：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,name,email,age <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> (name <span class="keyword">LIKE</span> ? <span class="keyword">AND</span> age <span class="operator">&lt;=</span> ?) <span class="keyword">ORDER</span> <span class="keyword">BY</span> age <span class="keyword">ASC</span></span><br></pre></td></tr></table></figure>



<h3 id="2-5-6-分页查询"><a href="#2-5-6-分页查询" class="headerlink" title="2.5.6.分页查询"></a>2.5.6.分页查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 entity 条件，查询全部记录（并翻页）</span></span><br><span class="line"><span class="function">IPage&lt;T&gt; <span class="title">selectPage</span><span class="params">(IPage&lt;T&gt; page, <span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span></span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询全部记录（并翻页）</span></span><br><span class="line">IPage&lt;Map&lt;String, Object&gt;&gt; selectMapsPage(IPage&lt;T&gt; page, <span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper);</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询总记录数</span></span><br><span class="line"><span class="function">Integer <span class="title">selectCount</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span></span>;</span><br></pre></td></tr></table></figure>



<p>分页查询需要引入额外的插件才能生效。</p>
<h4 id="1）引入分页插件"><a href="#1）引入分页插件" class="headerlink" title="1）引入分页插件"></a>1）引入分页插件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.mp.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.optimize.JsqlParserCountOptimize;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册mybatis plus的分页插件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PaginationInterceptor <span class="title">paginationInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        PaginationInterceptor paginationInterceptor = <span class="keyword">new</span> PaginationInterceptor();</span><br><span class="line">        <span class="comment">// 开启 count 的 join 优化,只针对部分 left join</span></span><br><span class="line">        paginationInterceptor.setCountSqlParser(<span class="keyword">new</span> JsqlParserCountOptimize(<span class="keyword">true</span>));</span><br><span class="line">        <span class="keyword">return</span> paginationInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2）测试分页"><a href="#2）测试分页" class="headerlink" title="2）测试分页"></a>2）测试分页</h4><p>代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPageQuery</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 分页条件</span></span><br><span class="line">    Page&lt;User&gt; page = <span class="keyword">new</span> Page&lt;&gt;();</span><br><span class="line">    <span class="comment">// 当前页</span></span><br><span class="line">    page.setCurrent(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 每页大小</span></span><br><span class="line">    page.setSize(<span class="number">3</span>);</span><br><span class="line">    <span class="comment">// 分页查询，结果会放到Page&lt;User&gt;中，因此无需返回</span></span><br><span class="line">    userMapper.selectPage(page, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 总条数</span></span><br><span class="line">    <span class="keyword">long</span> total = page.getTotal();</span><br><span class="line">    System.out.println(<span class="string">&quot;total = &quot;</span> + total);</span><br><span class="line">	<span class="comment">// 总页数</span></span><br><span class="line">    <span class="keyword">long</span> pages = page.getPages();</span><br><span class="line">    System.out.println(<span class="string">&quot;pages = &quot;</span> + pages);</span><br><span class="line">    <span class="comment">// 当前页结果</span></span><br><span class="line">    List&lt;User&gt; list = page.getRecords();</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">01</span>-<span class="number">13</span> <span class="number">13</span>:<span class="number">23</span>:<span class="number">55.761</span> DEBUG <span class="number">41364</span> --- [           main] c.i.mp.mapper.UserMapper.selectPage      : ==&gt;  Preparing: <span class="function">SELECT <span class="title">COUNT</span><span class="params">(<span class="number">1</span>)</span> FROM user </span></span><br><span class="line"><span class="function">2020-01-13 13:23:55.776 DEBUG 41364 --- [           main] c.i.mp.mapper.UserMapper.selectPage      : </span>==&gt; Parameters: </span><br><span class="line"><span class="number">2020</span>-<span class="number">01</span>-<span class="number">13</span> <span class="number">13</span>:<span class="number">23</span>:<span class="number">55.787</span> DEBUG <span class="number">41364</span> --- [           main] c.i.mp.mapper.UserMapper.selectPage      : ==&gt;  Preparing: SELECT id,name,email,age FROM user LIMIT ?,? </span><br><span class="line"><span class="number">2020</span>-<span class="number">01</span>-<span class="number">13</span> <span class="number">13</span>:<span class="number">23</span>:<span class="number">55.788</span> DEBUG <span class="number">41364</span> --- [           main] c.i.mp.mapper.UserMapper.selectPage      : ==&gt; Parameters: <span class="number">0</span>(Long), <span class="number">3</span>(Long)</span><br><span class="line"><span class="number">2020</span>-<span class="number">01</span>-<span class="number">13</span> <span class="number">13</span>:<span class="number">23</span>:<span class="number">55.791</span> DEBUG <span class="number">41364</span> --- [           main] c.i.mp.mapper.UserMapper.selectPage      : &lt;==      Total: <span class="number">3</span></span><br><span class="line">total = <span class="number">5</span></span><br><span class="line">pages = <span class="number">2</span></span><br><span class="line">User(id=<span class="number">1</span>, name=Jone, age=<span class="number">18</span>, email=test1<span class="meta">@baomidou</span>.com)</span><br><span class="line">User(id=<span class="number">2</span>, name=Jack, age=<span class="number">20</span>, email=test2<span class="meta">@baomidou</span>.com)</span><br><span class="line">User(id=<span class="number">3</span>, name=Tom, age=<span class="number">28</span>, email=test3<span class="meta">@baomidou</span>.com)</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="2-6-IService的CRUD"><a href="#2-6-IService的CRUD" class="headerlink" title="2.6.IService的CRUD"></a>2.6.IService的CRUD</h2><p>MybatisPlus除了提供BaseMapper，还提供了<strong>通用的Service接口：<code>IService</code></strong></p>
<p>也就是说：<strong>将业务前置到了service层！！！！！！！！</strong></p>
<h3 id="2-6-1-新增"><a href="#2-6-1-新增" class="headerlink" title="2.6.1.新增"></a>2.6.1.新增</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 插入一条记录（选择字段，策略插入）</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">save</span><span class="params">(T entity)</span></span>;</span><br><span class="line"><span class="comment">// 插入（批量）</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">saveBatch</span><span class="params">(Collection&lt;T&gt; entityList)</span></span>;</span><br><span class="line"><span class="comment">// 插入（批量）</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">saveBatch</span><span class="params">(Collection&lt;T&gt; entityList, <span class="keyword">int</span> batchSize)</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="参数说明-3"><a href="#参数说明-3" class="headerlink" title="#参数说明"></a><a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/crud-interface.html#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E">#</a>参数说明</h4><table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">T</td>
<td align="center">entity</td>
<td align="center">实体对象</td>
</tr>
<tr>
<td align="center">Collection<T></td>
<td align="center">entityList</td>
<td align="center">实体对象集合</td>
</tr>
<tr>
<td align="center">int</td>
<td align="center">batchSize</td>
<td align="center">插入批次数量</td>
</tr>
</tbody></table>
<h3 id="2-6-2-SaveOrUpdate"><a href="#2-6-2-SaveOrUpdate" class="headerlink" title="2.6.2.SaveOrUpdate"></a>2.6.2.SaveOrUpdate</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TableId 注解存在更新记录，否插入一条记录</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">saveOrUpdate</span><span class="params">(T entity)</span></span>;</span><br><span class="line"><span class="comment">// 根据updateWrapper尝试更新，否继续执行saveOrUpdate(T)方法</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">saveOrUpdate</span><span class="params">(T entity, Wrapper&lt;T&gt; updateWrapper)</span></span>;</span><br><span class="line"><span class="comment">// 批量修改插入</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">saveOrUpdateBatch</span><span class="params">(Collection&lt;T&gt; entityList)</span></span>;</span><br><span class="line"><span class="comment">// 批量修改插入</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">saveOrUpdateBatch</span><span class="params">(Collection&lt;T&gt; entityList, <span class="keyword">int</span> batchSize)</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="参数说明-4"><a href="#参数说明-4" class="headerlink" title="#参数说明"></a><a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/crud-interface.html#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-2">#</a>参数说明</h4><table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">T</td>
<td align="center">entity</td>
<td align="center">实体对象</td>
</tr>
<tr>
<td align="center">Wrapper<T></td>
<td align="center">updateWrapper</td>
<td align="center">实体对象封装操作类 UpdateWrapper</td>
</tr>
<tr>
<td align="center">Collection<T></td>
<td align="center">entityList</td>
<td align="center">实体对象集合</td>
</tr>
<tr>
<td align="center">int</td>
<td align="center">batchSize</td>
<td align="center">插入批次数量</td>
</tr>
</tbody></table>
<h3 id="2-6-3-删除"><a href="#2-6-3-删除" class="headerlink" title="2.6.3.删除"></a>2.6.3.删除</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 entity 条件，删除记录</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span></span>;</span><br><span class="line"><span class="comment">// 根据 ID 删除</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">removeById</span><span class="params">(Serializable id)</span></span>;</span><br><span class="line"><span class="comment">// 根据 columnMap 条件，删除记录</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">removeByMap</span><span class="params">(Map&lt;String, Object&gt; columnMap)</span></span>;</span><br><span class="line"><span class="comment">// 删除（根据ID 批量删除）</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">removeByIds</span><span class="params">(Collection&lt;? extends Serializable&gt; idList)</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="参数说明-5"><a href="#参数说明-5" class="headerlink" title="#参数说明"></a><a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/crud-interface.html#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-3">#</a>参数说明</h4><table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Wrapper<T></td>
<td align="center">queryWrapper</td>
<td align="center">实体包装类 QueryWrapper</td>
</tr>
<tr>
<td align="center">Serializable</td>
<td align="center">id</td>
<td align="center">主键ID</td>
</tr>
<tr>
<td align="center">Map&lt;String, Object&gt;</td>
<td align="center">columnMap</td>
<td align="center">表字段 map 对象</td>
</tr>
<tr>
<td align="center">Collection&lt;? extends Serializable&gt;</td>
<td align="center">idList</td>
<td align="center">主键ID列表</td>
</tr>
</tbody></table>
<h3 id="2-6-4-修改"><a href="#2-6-4-修改" class="headerlink" title="2.6.4.修改"></a>2.6.4.修改</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 UpdateWrapper 条件，更新记录 需要设置sqlset</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">update</span><span class="params">(Wrapper&lt;T&gt; updateWrapper)</span></span>;</span><br><span class="line"><span class="comment">// 根据 whereEntity 条件，更新记录</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">update</span><span class="params">(T entity, Wrapper&lt;T&gt; updateWrapper)</span></span>;</span><br><span class="line"><span class="comment">// 根据 ID 选择修改</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">updateById</span><span class="params">(T entity)</span></span>;</span><br><span class="line"><span class="comment">// 根据ID 批量更新</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">updateBatchById</span><span class="params">(Collection&lt;T&gt; entityList)</span></span>;</span><br><span class="line"><span class="comment">// 根据ID 批量更新</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">updateBatchById</span><span class="params">(Collection&lt;T&gt; entityList, <span class="keyword">int</span> batchSize)</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="参数说明-6"><a href="#参数说明-6" class="headerlink" title="#参数说明"></a><a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/crud-interface.html#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-4">#</a>参数说明</h4><table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Wrapper<T></td>
<td align="center">updateWrapper</td>
<td align="center">实体对象封装操作类 UpdateWrapper</td>
</tr>
<tr>
<td align="center">T</td>
<td align="center">entity</td>
<td align="center">实体对象</td>
</tr>
<tr>
<td align="center">Collection<T></td>
<td align="center">entityList</td>
<td align="center">实体对象集合</td>
</tr>
<tr>
<td align="center">int</td>
<td align="center">batchSize</td>
<td align="center">更新批次数量</td>
</tr>
</tbody></table>
<h3 id="2-6-5-查询单个"><a href="#2-6-5-查询单个" class="headerlink" title="2.6.5.查询单个"></a>2.6.5.查询单个</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 ID 查询</span></span><br><span class="line"><span class="function">T <span class="title">getById</span><span class="params">(Serializable id)</span></span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper，查询一条记录。结果集，如果是多个会抛出异常，随机取一条加上限制条件 wrapper.last(&quot;LIMIT 1&quot;)</span></span><br><span class="line"><span class="function">T <span class="title">getOne</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span></span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper，查询一条记录</span></span><br><span class="line"><span class="function">T <span class="title">getOne</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, <span class="keyword">boolean</span> throwEx)</span></span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper，查询一条记录</span></span><br><span class="line"><span class="function">Map&lt;String, Object&gt; <span class="title">getMap</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span></span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper，查询一条记录</span></span><br><span class="line">&lt;V&gt; <span class="function">V <span class="title">getObj</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, Function&lt;? <span class="keyword">super</span> Object, V&gt; mapper)</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="参数说明-7"><a href="#参数说明-7" class="headerlink" title="#参数说明"></a><a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/crud-interface.html#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-5">#</a>参数说明</h4><table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Serializable</td>
<td align="center">id</td>
<td align="center">主键ID</td>
</tr>
<tr>
<td align="center">Wrapper<T></td>
<td align="center">queryWrapper</td>
<td align="center">实体对象封装操作类 QueryWrapper</td>
</tr>
<tr>
<td align="center">boolean</td>
<td align="center">throwEx</td>
<td align="center">有多个 result 是否抛出异常</td>
</tr>
<tr>
<td align="center">T</td>
<td align="center">entity</td>
<td align="center">实体对象</td>
</tr>
<tr>
<td align="center">Function&lt;? super Object, V&gt;</td>
<td align="center">mapper</td>
<td align="center">转换函数</td>
</tr>
</tbody></table>
<h3 id="2-6-6-查询多个"><a href="#2-6-6-查询多个" class="headerlink" title="2.6.6.查询多个"></a>2.6.6.查询多个</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询所有</span></span><br><span class="line"><span class="function">List&lt;T&gt; <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 查询列表</span></span><br><span class="line"><span class="function">List&lt;T&gt; <span class="title">list</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span></span>;</span><br><span class="line"><span class="comment">// 查询（根据ID 批量查询）</span></span><br><span class="line"><span class="function">Collection&lt;T&gt; <span class="title">listByIds</span><span class="params">(Collection&lt;? extends Serializable&gt; idList)</span></span>;</span><br><span class="line"><span class="comment">// 查询（根据 columnMap 条件）</span></span><br><span class="line"><span class="function">Collection&lt;T&gt; <span class="title">listByMap</span><span class="params">(Map&lt;String, Object&gt; columnMap)</span></span>;</span><br><span class="line"><span class="comment">// 查询所有列表</span></span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; listMaps();</span><br><span class="line"><span class="comment">// 查询列表</span></span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; listMaps(Wrapper&lt;T&gt; queryWrapper);</span><br><span class="line"><span class="comment">// 查询全部记录</span></span><br><span class="line"><span class="function">List&lt;Object&gt; <span class="title">listObjs</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 查询全部记录</span></span><br><span class="line">&lt;V&gt; <span class="function">List&lt;V&gt; <span class="title">listObjs</span><span class="params">(Function&lt;? <span class="keyword">super</span> Object, V&gt; mapper)</span></span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询全部记录</span></span><br><span class="line"><span class="function">List&lt;Object&gt; <span class="title">listObjs</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span></span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询全部记录</span></span><br><span class="line">&lt;V&gt; <span class="function">List&lt;V&gt; <span class="title">listObjs</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, Function&lt;? <span class="keyword">super</span> Object, V&gt; mapper)</span></span>;</span><br></pre></td></tr></table></figure>

<h5 id="参数说明-8"><a href="#参数说明-8" class="headerlink" title="#参数说明"></a><a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/crud-interface.html#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-6">#</a>参数说明</h5><table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Wrapper<T></td>
<td align="center">queryWrapper</td>
<td align="center">实体对象封装操作类 QueryWrapper</td>
</tr>
<tr>
<td align="center">Collection&lt;? extends Serializable&gt;</td>
<td align="center">idList</td>
<td align="center">主键ID列表</td>
</tr>
<tr>
<td align="center">Map&lt;?String, Object&gt;</td>
<td align="center">columnMap</td>
<td align="center">表字段 map 对象</td>
</tr>
<tr>
<td align="center">Function&lt;? super Object, V&gt;</td>
<td align="center">mapper</td>
<td align="center">转换函数</td>
</tr>
</tbody></table>
<h3 id="2-6-7-分页查询"><a href="#2-6-7-分页查询" class="headerlink" title="2.6.7.分页查询"></a>2.6.7.分页查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 无条件翻页查询</span></span><br><span class="line"><span class="function">IPage&lt;T&gt; <span class="title">page</span><span class="params">(IPage&lt;T&gt; page)</span></span>;</span><br><span class="line"><span class="comment">// 翻页查询</span></span><br><span class="line"><span class="function">IPage&lt;T&gt; <span class="title">page</span><span class="params">(IPage&lt;T&gt; page, Wrapper&lt;T&gt; queryWrapper)</span></span>;</span><br><span class="line"><span class="comment">// 无条件翻页查询</span></span><br><span class="line">IPage&lt;Map&lt;String, Object&gt;&gt; pageMaps(IPage&lt;T&gt; page);</span><br><span class="line"><span class="comment">// 翻页查询</span></span><br><span class="line">IPage&lt;Map&lt;String, Object&gt;&gt; pageMaps(IPage&lt;T&gt; page, Wrapper&lt;T&gt; queryWrapper);</span><br></pre></td></tr></table></figure>

<h5 id="参数说明-9"><a href="#参数说明-9" class="headerlink" title="#参数说明"></a><a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/crud-interface.html#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-7">#</a>参数说明</h5><table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">IPage<T></td>
<td align="center">page</td>
<td align="center">翻页对象</td>
</tr>
<tr>
<td align="center">Wrapper<T></td>
<td align="center">queryWrapper</td>
<td align="center">实体对象封装操作类 QueryWrapper</td>
</tr>
</tbody></table>
<h3 id="2-6-8-查询数量"><a href="#2-6-8-查询数量" class="headerlink" title="2.6.8.查询数量"></a>2.6.8.查询数量</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询总记录数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">count</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询总记录数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">count</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="参数说明-10"><a href="#参数说明-10" class="headerlink" title="#参数说明"></a><a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/crud-interface.html#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-8">#</a>参数说明</h4><table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">参数名</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Wrapper<T></td>
<td align="center">queryWrapper</td>
<td align="center">实体对象封装操作类 QueryWrapper</td>
</tr>
</tbody></table>
<h3 id="2-6-9-链式查询"><a href="#2-6-9-链式查询" class="headerlink" title="2.6.9.链式查询"></a>2.6.9.链式查询</h3><p>query+在eq方法前面加个条件判断(一般是字段非空），当字段非空时，eq这个条件查询才算成立</p>
<p>因此，链式查询+字段非空判断组成了我们的<strong>动态查询sql</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 链式查询 普通</span></span><br><span class="line"><span class="function">QueryChainWrapper&lt;T&gt; <span class="title">query</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 链式查询 lambda 式。注意：不支持 Kotlin</span></span><br><span class="line"><span class="function">LambdaQueryChainWrapper&lt;T&gt; <span class="title">lambdaQuery</span><span class="params">()</span></span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例： （相当于select ...... where id=value)</span></span><br><span class="line">query().eq(<span class="string">&quot;column&quot;</span>, value).one();</span><br><span class="line">lambdaQuery().eq(Entity::getId, value).list();</span><br></pre></td></tr></table></figure>



<h2 id="2-7-ServiceImpl"><a href="#2-7-ServiceImpl" class="headerlink" title="2.7.ServiceImpl"></a>2.7.ServiceImpl</h2><p>**上面的<code>IService</code>提供了service的默认方法接口，而<code>ServiceImpl</code>就是对<code>IService</code>的默认实现。我们在定义service时，一般先定义接口，继承<code>IService</code>，然后在定义实现类，继承<code>ServiceImpl</code>**。</p>
<p>例如，我们定义一个UserService接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.mp.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.mp.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> <span class="keyword">extends</span> <span class="title">IService</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后是实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.mp.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.mp.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> cn.itcast.mp.pojo.User;</span><br><span class="line"><span class="keyword">import</span> cn.itcast.mp.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">UserMapper</span>, <span class="title">User</span>&gt; <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结构：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200114101828802.png" alt="image-20200114101828802"> </p>
<p>单元测试：<strong>将业务前置到了service层，直接注入UserService接口就可以使用像 注入UserMapper接口一样的各种操作数据库方法了</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.mp.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.mp.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQuery</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;User&gt; list = userService.list();</span><br><span class="line">        list.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-分类管理"><a href="#3-分类管理" class="headerlink" title="3.分类管理"></a>3.分类管理</h1><p>接下来，我们完成后台管理项目的业务内容。</p>
<h2 id="3-1-导入数据"><a href="#3-1-导入数据" class="headerlink" title="3.1.导入数据"></a>3.1.导入数据</h2><p>将课前资料中的sql文件运行，导入数据：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200113125947945.png" alt="image-20200113125947945"> </p>
<p>我们先看商品分类表：</p>
<p> <img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/1525999774439.png" alt="1525999774439"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `tb_category` (</span><br><span class="line">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;类目id&#x27;,</span><br><span class="line">  `name` varchar(32) NOT NULL COMMENT &#x27;类目名称&#x27;,</span><br><span class="line">  `parent_id` bigint(20) NOT NULL COMMENT &#x27;父类目id,顶级类目填0&#x27;,</span><br><span class="line">  `is_parent` tinyint(1) NOT NULL COMMENT &#x27;是否为父节点，0为否，1为是&#x27;,</span><br><span class="line">  `sort` tinyint(2) NOT NULL COMMENT &#x27;排序指数，越小越靠前&#x27;,</span><br><span class="line">  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;数据创建时间&#x27;,</span><br><span class="line">  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#x27;数据更新时间&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  KEY `key_parent_id` (`parent_id`) USING BTREE</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&#x27;商品类目表，类目和商品(spu)是一对多关系，类目与品牌是多对多关系&#x27;;</span><br></pre></td></tr></table></figure>

<p>1 <strong>因为商品分类会有层级关系，因此这里我们加入了<code>parent_id</code>字段</strong>，对本表中的其它分类进行自关联。</p>
<p>2 几乎所有表格<strong>都有updatetime,createtime 字段</strong>，记录商品被添加时间！！！</p>
<p>3 数据表设计原则：<strong>以空间换时间</strong>！意思是维护多个字段，那么就不用另外查询，节省时间！</p>
<h2 id="3-2-引入mybatis-plus"><a href="#3-2-引入mybatis-plus" class="headerlink" title="3.2.引入mybatis-plus"></a>3.2.引入mybatis-plus</h2><p>我们在<code>ly-item-service</code>中引入有关<code>mybatis-plus</code>的配置，便于操作数据库</p>
<h3 id="1）依赖"><a href="#1）依赖" class="headerlink" title="1）依赖"></a>1）依赖</h3><p>首先在<code>ly-item-service</code>的pom中引入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatis plus--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2）全局配置"><a href="#2）全局配置" class="headerlink" title="2）全局配置"></a>2）全局配置</h3><p>然后在<code>ly-item-service</code>的<code>application.yml</code>文件中添加配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.leyou.item.entity</span> <span class="comment"># 别名扫描包</span></span><br><span class="line">  <span class="comment"># mapper-locations: classpath*: mappers/*.xml # mapper的xml文件地址</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span> <span class="comment"># id默认为自增长（#########表中的对应id字段，必须是自增的）</span></span><br><span class="line">      <span class="attr">update-strategy:</span> <span class="string">NOT_EMPTY</span> <span class="comment"># 更新时，只更新非空字段</span></span><br><span class="line">      <span class="attr">insert-strategy:</span> <span class="string">NOT_EMPTY</span> <span class="comment"># 新增时，只新增非空字段</span></span><br></pre></td></tr></table></figure>

<h3 id="3）启动类的注解"><a href="#3）启动类的注解" class="headerlink" title="3）启动类的注解"></a>3）启动类的注解</h3><p>给<code>LyItemApplication</code>添加注解：<code>@MapperScan</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.leyou.item.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication(scanBasePackages = &#123;&quot;com.leyou.item&quot;, &quot;com.leyou.common.advice&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LyItemApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(LyItemApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4）开启分页插件"><a href="#4）开启分页插件" class="headerlink" title="4）开启分页插件"></a>4）开启分页插件</h3><p>在</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册mybatis plus的分页插件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PaginationInterceptor <span class="title">paginationInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        PaginationInterceptor paginationInterceptor = <span class="keyword">new</span> PaginationInterceptor();</span><br><span class="line">        <span class="comment">// 开启 count 的 join 优化,只针对部分 left join</span></span><br><span class="line">        paginationInterceptor.setCountSqlParser(<span class="keyword">new</span> JsqlParserCountOptimize(<span class="keyword">true</span>));</span><br><span class="line">        <span class="comment">// 设置最大单页限制数量，默认 500 条，-1 不受限制</span></span><br><span class="line">        paginationInterceptor.setLimit(<span class="number">500</span>);</span><br><span class="line">        <span class="keyword">return</span> paginationInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="5）修改日志advice的切入点语法"><a href="#5）修改日志advice的切入点语法" class="headerlink" title="5）修改日志advice的切入点语法"></a>5）修改日志advice的切入点语法</h3><p>之前的切入点语法<strong>只对Service自己的方法有效，如果是继承自ServiceImpl的方法则失效</strong>。因此需要修改CommonLogAdvice中的切入点语法：</p>
<p>详解：<strong>前面讲的日志的实现是扫描所有service层的接口方法，并添加日志，但是有些业务必须要自己写方法（是在serviceImpl中定义）才能实现逻辑，因此我们的日志添加（切入点）应该包含自定义的service层方法。这里必须引入依赖哈！</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.common.advice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.exceptios.LyException;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonLogAdvice</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;within(@org.springframework.stereotype.Service *) || within(com.baomidou.mybatisplus.extension.service.IService+)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">handleExceptionLog</span><span class="params">(ProceedingJoinPoint jp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">// .....</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>切入语法的意思是：</p>
<ul>
<li><code>within(@org.springframework.stereotype.Service *)</code>：切带有@Service注解的</li>
<li><code>within(com.baomidou.mybatisplus.extension.service.IService+)</code>：切IService的实现类</li>
<li><code>||</code> ：代表两者都可以，<code>或</code>的关系</li>
</ul>
<p>同时，在<code>ly-common</code>的<code>pom.xml</code>中<strong>引入IService的依赖</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-extension<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="3-3-基本代码"><a href="#3-3-基本代码" class="headerlink" title="3.3.基本代码"></a>3.3.基本代码</h2><p>基本代码是先添加代码框架，然后根据逻辑再在框架代码上慢慢补充！</p>
<h3 id="3-3-1-实体类"><a href="#3-3-1-实体类" class="headerlink" title="3.3.1.实体类"></a>3.3.1.实体类</h3><p>因为所有的表都会有<code>create_time</code>和<code>update_time</code>属性，因此我们会先<strong>定义一个通用的实体类</strong>，因为是通用的，因此放到<code>ly-common</code>这个项目的<code>com.leyou.common.entity</code>中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.common.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@EqualsAndHashCode(onlyExplicitlyIncluded = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseEntity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getCreateTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateTime</span><span class="params">(Date createTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createTime = createTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getUpdateTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> updateTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUpdateTime</span><span class="params">(Date updateTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.updateTime = updateTime;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>然后是商品分类对应的实体类，会继承上面的<code>BaseEntity</code>：</p>
<p><strong>继承关系，也就是说会继承父类的变量！</strong>也可以设置为不继承？？？？？？？？？？？？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.BaseEntity;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = false)</span></span><br><span class="line"><span class="meta">@TableName(&quot;tb_category&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Category</span> <span class="keyword">extends</span> <span class="title">BaseEntity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Long parentId;</span><br><span class="line">    <span class="keyword">private</span> Boolean isParent;</span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-3-2-mapper"><a href="#3-3-2-mapper" class="headerlink" title="3.3.2.mapper"></a>3.3.2.mapper</h3><p>首先是mapper接口，在<code>ly-item-service</code>中添加<code>CategoryMapper</code>接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.Category;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">Category</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-3-service"><a href="#3-3-3-service" class="headerlink" title="3.3.3.service"></a>3.3.3.service</h3><p>然后是service，在<code>ly-item-service</code>中添加<code>CategoryService</code>接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.Category;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryService</span> <span class="keyword">extends</span> <span class="title">IService</span>&lt;<span class="title">Category</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后是实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.Category;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.mapper.CategoryMapper;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">CategoryMapper</span>, <span class="title">Category</span>&gt; <span class="keyword">implements</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-3-3-controller"><a href="#3-3-3-controller" class="headerlink" title="3.3.3.controller"></a>3.3.3.controller</h3><p>然后是controller，在<code>ly-item-service</code>中添加<code>CategoryController</code>，并注入<code>CategoryService</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.item.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;category&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CategoryService categoryService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CategoryController</span><span class="params">(CategoryService categoryService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categoryService = categoryService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="3-4-接口文档"><a href="#3-4-接口文档" class="headerlink" title="3.4.接口文档"></a>3.4.接口文档</h2><p>企业开发中，都是<strong>前后端分离开发，因此需要提前编写好接口文档，方便前后端明确服务端的接口定义，同时开发</strong>。</p>
<p>在我们给大家准备的nginx中，已经准备好了静态的swagger文档。直接访问：<a target="_blank" rel="noopener" href="http://localhost/api/doc.html">http://localhost/api/doc.html</a> 即可：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200712225901445.png" alt="image-20200712225901445"></p>
<p>可以看到，跟商品分类有关的接口包括：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200121183230162.png" alt="image-20200121183230162"> </p>
<p>下面我们分别实现这四个接口。</p>
<h2 id="3-5-根据id查询分类"><a href="#3-5-根据id查询分类" class="headerlink" title="3.5.根据id查询分类"></a>3.5.根据id查询分类</h2><h3 id="3-5-1-接口规范"><a href="#3-5-1-接口规范" class="headerlink" title="3.5.1.接口规范"></a>3.5.1.接口规范</h3><h4 id="1）基本信息"><a href="#1）基本信息" class="headerlink" title="1）基本信息"></a>1）基本信息</h4><p><strong>接口地址</strong> <code>/category/&#123;id&#125;</code></p>
<p><strong>请求方式</strong> <code>GET</code></p>
<p><strong>produces</strong> <code>[&quot;application/json&quot;]</code></p>
<h4 id="2）接口描述"><a href="#2）接口描述" class="headerlink" title="2）接口描述"></a>2）<strong>接口描述</strong></h4><p><strong>请求参数</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>请求类型</th>
<th>是否必须</th>
<th>数据类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>分类的id</td>
<td>path</td>
<td>true</td>
<td>integer</td>
<td></td>
</tr>
</tbody></table>
<p><strong>响应状态</strong></p>
<table>
<thead>
<tr>
<th>状态码</th>
<th>说明</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>200</td>
<td>查询成功，返回商品分类对象</td>
<td>CategoryDTO</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized</td>
<td></td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
<td></td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
<td></td>
</tr>
</tbody></table>
<p><strong>响应参数</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
<th>类型</th>
<th>schema</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>分类ID</td>
<td>integer(int64)</td>
<td>integer(int64)</td>
</tr>
<tr>
<td>isParent</td>
<td>是否是父类目</td>
<td>boolean</td>
<td></td>
</tr>
<tr>
<td>name</td>
<td>分类名称</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>parentId</td>
<td>父类目id</td>
<td>integer(int64)</td>
<td>integer(int64)</td>
</tr>
<tr>
<td>sort</td>
<td>顺序</td>
<td>integer(int32)</td>
<td>integer(int32)</td>
</tr>
</tbody></table>
<p><strong>响应示例</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;id&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;isParent&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;parentId&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;sort&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试时，<strong>在test文件夹下测试：先service层，在controller层，然后是前端测试，使用测试工具进行测试</strong>。</p>
<p>ps:    在serviceImpl类方法中可以使用快捷方式快速在test中生成测试代码框架哦。</p>
<h3 id="3-5-2-DTO对象"><a href="#3-5-2-DTO对象" class="headerlink" title="3.5.2.DTO对象"></a>3.5.2.DTO对象</h3><p>在开发中，根据对象作用的领域不同，会把实体类划分成这样：</p>
<ul>
<li>PO：<strong>P</strong>ersistent <strong>O</strong>bject 持久层对象，与数据库的表一一对应，完全一致，出现在DAO层和Service层</li>
<li>BO：<strong>B</strong>usiness <strong>O</strong>bject 业务层对象，用来组装PO，在业务层传递</li>
<li>DTO：<strong>D</strong>ata <strong>T</strong>ransfer <strong>O</strong>bject 数据转移对象，用于<strong>服务端和客户端间的数据传输，比如服务端返回数据到浏览器</strong></li>
</ul>
<p>DTO:说白了就是<strong>前端需要对象的什么属性，就什么属性，然后进行传递给前端</strong>！！！因此serice层方法返回类型从List<Category>改为List<CategoryDTO>;</p>
<p>这里我们把商品分类的返回值用CategoryDTO来表示，放到<code>ly-item-pojo</code>的<code>com.leyou.item.dto</code>包：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.dto.BaseDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.BaseEntity;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span><span class="comment">//排除父类的属性</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryDTO</span> <span class="keyword">extends</span> <span class="title">BaseDTO</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> Long parentId;</span><br><span class="line">	<span class="keyword">private</span> Boolean isParent;</span><br><span class="line">	<span class="keyword">private</span> Integer sort;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CategoryDTO</span><span class="params">(BaseEntity entity)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(entity);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 将PO集合转为DTO集合</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> list PO对象的集合</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> &lt;T&gt; PO的类型</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> DTO集合</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends BaseEntity&gt; <span class="function">List&lt;CategoryDTO&gt; <span class="title">convertEntityList</span><span class="params">(Collection&lt;T&gt; list)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(list == <span class="keyword">null</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> list.stream().map(CategoryDTO::<span class="keyword">new</span>).collect(Collectors.toList());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为<strong>经常会碰到DTO与PO转换的情况</strong>，所以我们<strong>在DTO中定义了工具方法，方便实现实体类转换</strong>。共有两个实体类PO和DTO转换的方法：</p>
<ul>
<li><p><code>CategoryDTO</code>继承了<code>BaseDTO</code>，在<code>BaseDTO</code>中定义了通用的单个对象的转换方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.common.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.BaseEntity;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.utils.BeanHelper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 基本的DTO，提供了DTO和Entity之间的互相转换功能</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseDTO</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * DTO转PO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> entityClass PO对象的字节码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt; PO对象的类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> PO对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">toEntity</span><span class="params">(Class&lt;T&gt; entityClass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BeanHelper.copyProperties(<span class="keyword">this</span>, entityClass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从Entity转为DTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> entity 任意实体</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseDTO</span><span class="params">(BaseEntity entity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(entity != <span class="keyword">null</span>)&#123;</span><br><span class="line">            BeanUtils.copyProperties(entity, <span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseDTO</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><code>CategoryDTO</code>中定义了从PO集合转为DTO集合的功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 将PO集合转为DTO集合</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> list PO对象的集合</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> &lt;T&gt; PO的类型</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> DTO集合</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends BaseEntity&gt; <span class="function">List&lt;CategoryDTO&gt; <span class="title">convertEntityList</span><span class="params">(Collection&lt;T&gt; list)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(list == <span class="keyword">null</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">		&#125;</span><br><span class="line">  <span class="keyword">return</span> list.stream().map(CategoryDTO::<span class="keyword">new</span>).collect(Collectors.toList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>转换原理：</strong>就是在Category对象中将相对应的属性赋值给CategoryDTO对象属性。其中用到了流处理，这里我们应该是毫无压力就可以读懂代码的！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.stream().map(CategoryDTO::<span class="keyword">new</span>).collect(Collectors.toList());</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-5-3-controller"><a href="#3-5-3-controller" class="headerlink" title="3.5.3.controller"></a>3.5.3.controller</h3><p>基于接口文档，定义controller中需要知道的信息包括：</p>
<ul>
<li>请求方式：<code>GET</code></li>
<li>请求路径：<code>/category/&#123;id&#125;</code></li>
<li>请求参数：<code>id</code></li>
<li>返回值：<code>CategoryDTO</code>，不过需要用ResponseEntity来封装</li>
</ul>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询分类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 分类id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 分类对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;CategoryDTO&gt; <span class="title">queryCategoryById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(<span class="keyword">new</span> CategoryDTO(categoryService.getById(id)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码解释：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200214223031349.png" alt="image-20200214223031349"></p>
<p>注意：注入的categoryService 对象，有直接对应的方法能实现逻辑直接调用就好了，没有的话要去categoryService Impl类中定义能显示一定业务的方法来操作数据库！</p>
<h2 id="3-6-根据id集合查询分类"><a href="#3-6-根据id集合查询分类" class="headerlink" title="3.6.根据id集合查询分类"></a>3.6.根据id集合查询分类</h2><p>基于接口文档，定义controller中需要知道的信息包括：</p>
<ul>
<li>请求方式：<code>GET</code></li>
<li>请求路径：<code>/category/list</code></li>
<li>请求参数：<code>ids</code>，多个id集合</li>
<li>返回值：<code>List&lt;CategoryDTO&gt;</code>，不过需要用ResponseEntity来封装</li>
</ul>
<p>代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 根据分类id集合查询分类集合</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;List&lt;CategoryDTO&gt;&gt; queryCategoryByIds(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids)&#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(CategoryDTO.convertEntityList(categoryService.listByIds(ids)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码解释：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200122115731545.png" alt="image-20200122115731545"></p>
<p>上面使用了<strong>转换工具类方法</strong></p>
<h2 id="3-7-根据父类目id查询子分类"><a href="#3-7-根据父类目id查询子分类" class="headerlink" title="3.7.根据父类目id查询子分类"></a>3.7.根据父类目id查询子分类</h2><p>基于接口文档，定义controller中需要知道的信息包括：</p>
<ul>
<li>请求方式：<code>GET</code></li>
<li>请求路径：<code>/category/of/parent</code></li>
<li>请求参数：<code> pid</code>，父类目id，就是商品分类表中的<code>parent_id</code>字段</li>
<li>返回值：<code>List&lt;CategoryDTO&gt;</code>，不过需要用ResponseEntity来封装</li>
</ul>
<p>parent_id是分类表中的普通字段，并不是主键，因此查询要选用 queryByWrapper。</p>
<p>代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据父类目id查询子类目的集合</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pid 父类目的id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 子类目的集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/of/parent&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;List&lt;CategoryDTO&gt;&gt; queryCategoryByParentId(<span class="meta">@RequestParam(&quot;pid&quot;)</span> Long pid)&#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(<span class="comment">// 封装并返回</span></span><br><span class="line">        CategoryDTO.convertEntityList(<span class="comment">// 把PO集合转为DTO集合</span></span><br><span class="line">            categoryService.query().eq(<span class="string">&quot;parent_id&quot;</span>, pid).list()<span class="comment">// 根据父类目id查询集合</span></span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-8-根据品牌id查询分类"><a href="#3-8-根据品牌id查询分类" class="headerlink" title="3.8.根据品牌id查询分类"></a>3.8.根据品牌id查询分类</h2><h3 id="3-8-1-业务分析"><a href="#3-8-1-业务分析" class="headerlink" title="3.8.1.业务分析"></a>3.8.1.业务分析</h3><p> 商品品牌和商品分类之间是多对多关系，在我们的数据库中有一个<strong>中间表来维护关系</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `tb_category_brand` (</span><br><span class="line">  `category_id` bigint(20) NOT NULL COMMENT &#x27;商品类目id&#x27;,</span><br><span class="line">  `brand_id` bigint(20) NOT NULL COMMENT &#x27;品牌id&#x27;,</span><br><span class="line">  PRIMARY KEY (`category_id`,`brand_id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&#x27;商品分类和品牌的中间表，两者是多对多关系&#x27;;</span><br></pre></td></tr></table></figure>

<p>因此，要根据品牌id查询分类，有两种选择：</p>
<ul>
<li>方案一：先根据品牌id到中间表查询，得到分类id的集合，然后再根据分类id，到分类表查询</li>
<li>方案二：利用关联查询，一次查询完成。（<strong>需要我们自己在xml映射文件中写sql语句，mapper层代码，紧接着是service方法，将查询结果转DTO返回给controller</strong>，其实就是使用mybatis框架）</li>
</ul>
<p><strong>mybatis-plus并不支持多表关联查询</strong>，因此这里我们可以采用方案一。</p>
<p>解析：因为mybatis-plus是封装好的框架，查询代码自动生成，<strong>既然是框架，那么约定肯定比较多</strong>，不过好在能自己编写sql，自己扩展编写相关方法，在框架实现不了的逻辑下依然能够自定义业务逻辑代码。</p>
<h3 id="3-8-2-中间表代码"><a href="#3-8-2-中间表代码" class="headerlink" title="3.8.2.中间表代码"></a>3.8.2.中间表代码</h3><p>定义中间表的实体类、mapper、service等。</p>
<h4 id="实体类"><a href="#实体类" class="headerlink" title="实体类"></a>实体类</h4><p>在<code>ly-item-service</code>的<code>com.leyou.item.entity</code>包下定义中间表的实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor(staticName = &quot;of&quot;)</span></span><br><span class="line"><span class="meta">@TableName(&quot;tb_category_brand&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryBrand</span> </span>&#123;</span><br><span class="line">    <span class="comment">// IdType.INPUT，代表主键采用自己填写而不是自增长。</span></span><br><span class="line">    <span class="meta">@TableId(type = IdType.INPUT)</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line">    <span class="meta">@TableId(type = IdType.INPUT)</span></span><br><span class="line">    <span class="keyword">private</span> Long brandId;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="mapper"><a href="#mapper" class="headerlink" title="mapper"></a>mapper</h4><p>在<code>ly-item-service</code>的<code>com.leyou.item.mapper</code>包下定义中间表的mapper代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.CategoryBrand;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryBrandMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">CategoryBrand</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><p>在<code>ly-item-service</code>的<code>com.leyou.item.service</code>包下定义中间表的service代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.CategoryBrand;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryBrandService</span> <span class="keyword">extends</span> <span class="title">IService</span>&lt;<span class="title">CategoryBrand</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service实现类，先根据品牌id去中间表查询，得到分类id集合，再到分类表查询：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.entity.CategoryBrand;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.mapper.CategoryBrandMapper;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.service.CategoryBrandService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryBrandServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">CategoryBrandMapper</span>, <span class="title">CategoryBrand</span>&gt; <span class="keyword">implements</span> <span class="title">CategoryBrandService</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-8-3-接口声明"><a href="#3-8-3-接口声明" class="headerlink" title="3.8.3.接口声明"></a>3.8.3.接口声明</h3><p>基于接口文档，定义controller中需要知道的信息包括：</p>
<ul>
<li>请求方式：<code>GET</code></li>
<li>请求路径：<code>/category/of/brand</code></li>
<li>请求参数：<code> id</code>，品牌id</li>
<li>返回值：<code>List&lt;CategoryDTO&gt;</code>，不过需要用ResponseEntity来封装</li>
</ul>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据品牌id查询分类集合</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> brandId 品牌id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 分类集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/of/brand&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;List&lt;CategoryDTO&gt;&gt; queryCategoryByBrandId(<span class="meta">@RequestParam(&quot;id&quot;)</span> Long brandId)&#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(categoryService.queryCategoryByBrandId(brandId));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-8-4-业务实现"><a href="#3-8-4-业务实现" class="headerlink" title="3.8.4.业务实现"></a>3.8.4.业务实现</h3><p>先在CategoryService中定义方法声明：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryService</span> <span class="keyword">extends</span> <span class="title">IService</span>&lt;<span class="title">Category</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;CategoryDTO&gt; <span class="title">queryCategoryByBrandId</span><span class="params">(Long brandId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在CategoryServiceImpl中编写方法实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">CategoryMapper</span>, <span class="title">Category</span>&gt; <span class="keyword">implements</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CategoryBrandService categoryBrandService;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//这里采用了构造注入，也可以像以前那样，使用注解注入哈！</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CategoryServiceImpl</span><span class="params">(CategoryBrandService categoryBrandService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.categoryBrandService = categoryBrandService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;CategoryDTO&gt; <span class="title">queryCategoryByBrandId</span><span class="params">(Long brandId)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 1.根据品牌id，查询中间表，得到中间表对象集合</span></span><br><span class="line">        List&lt;CategoryBrand&gt; categoryBrandList = categoryBrandService.query().eq(<span class="string">&quot;brand_id&quot;</span>, brandId).list();</span><br><span class="line">        <span class="keyword">if</span>(CollectionUtils.isEmpty(categoryBrandList))&#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.获取分类id集合</span></span><br><span class="line">        List&lt;Long&gt; categoryIdList = categoryBrandList.stream()</span><br><span class="line">                .map(CategoryBrand::getCategoryId).collect(Collectors.toList());</span><br><span class="line">        <span class="comment">// 3.根据分类id集合，查询分类对象集合</span></span><br><span class="line">        List&lt;Category&gt; categories = listByIds(categoryIdList);</span><br><span class="line">        <span class="comment">// 4.转换DTO</span></span><br><span class="line">        <span class="keyword">return</span> CategoryDTO.convertEntityList(categories);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-9-测试"><a href="#3-9-测试" class="headerlink" title="3.9.测试"></a>3.9.测试</h2><p>我们重启商品微服务，然后测试接口。</p>
<p>注意事项：<strong>启动项目后立马访问url，可能会响应超时</strong>，因为<strong>网关是周期性去注册中心拉取服务地址以及端口的信息的</strong>，启动成功只能表示微服务将地址端口注册到尤里克注册中心，网关并不一定有微服务的ip端口信息，因此需要等待30-60s时间才能正常访问url资源哈！</p>
<h3 id="3-9-1-接口测试"><a href="#3-9-1-接口测试" class="headerlink" title="3.9.1.接口测试"></a>3.9.1.接口测试</h3><p>例如查询商品分类的接口，地址：</p>
<p><a target="_blank" rel="noopener" href="http://localhost:8081/category/of/parent?pid=0">http://localhost:8081/category/of/parent?pid=0</a></p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200122135005285.png" alt="image-20200122135005285"> </p>
<h3 id="3-9-2-页面测试"><a href="#3-9-2-页面测试" class="headerlink" title="3.9.2.页面测试"></a>3.9.2.页面测试</h3><p>我们访问后台管理项目，点击商品管理下面的分类管理：</p>
<p> <img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200711000945643.png" alt="image-20200711000945643"> </p>
<p>可以看到页面并未出现商品分类信息，打开浏览器控制台，发现这样的错误提示：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200122135552725.png" alt="image-20200122135552725"></p>
<p>发现页面发起的请求地址是：<a target="_blank" rel="noopener" href="http://api.leyou.com/item/category/of/parent?pid=0%EF%BC%8C%E5%B9%B6%E4%B8%94**%E5%87%BA%E7%8E%B0%E4%BA%86%60blocked">http://api.leyou.com/item/category/of/parent?pid=0，并且**出现了`blocked</a> by CORS`这样的提示<strong>，这是怎么回事呢？</strong>浏览器不允许跨域请求呗！！！**</p>
<h1 id="4-CORS跨域"><a href="#4-CORS跨域" class="headerlink" title="4.CORS跨域"></a>4.CORS跨域</h1><h2 id="4-1-跨域问题"><a href="#4-1-跨域问题" class="headerlink" title="4.1.跨域问题"></a>4.1.跨域问题</h2><h3 id="4-1-1-什么是跨域"><a href="#4-1-1-什么是跨域" class="headerlink" title="4.1.1.什么是跨域"></a>4.1.1.什么是跨域</h3><p>跨域是指跨域名及端口的访问，以下情况都属于跨域：</p>
<table>
<thead>
<tr>
<th>跨域原因说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>一级或二级域名不同</td>
<td><code>www.jd.com</code> 与 <code>www.taobao.com</code></td>
</tr>
<tr>
<td>域名相同，端口不同</td>
<td><code>www.jd.com:8080</code> 与 <code>www.jd.com:8081</code></td>
</tr>
<tr>
<td>三级域名不同</td>
<td><code>item.jd.com</code> 与 <code>miaosha.jd.com</code></td>
</tr>
</tbody></table>
<p>如果<strong>域名和端口都相同，但是请求路径不同</strong>，不属于跨域，如：</p>
<p><code>www.jd.com/item</code> </p>
<p><code>www.jd.com/goods</code></p>
<p>而我们刚才是从<code>manage.leyou.com</code>去访问<code>api.leyou.com</code>，这<strong>属于三级域名不同，跨域了</strong>。</p>
<h3 id="4-1-2-为什么有跨域问题？"><a href="#4-1-2-为什么有跨域问题？" class="headerlink" title="4.1.2.为什么有跨域问题？"></a>4.1.2.为什么有跨域问题？</h3><p><strong>跨域不一定会有跨域问题</strong>。</p>
<p>因为跨域问题是浏览器对于ajax请求的一种安全限制：<strong>一个页面发起的ajax请求，只能是于当前页同域名的路径</strong>，这能<strong>有效的阻止跨站攻击</strong>。</p>
<p>因此：<strong>跨域问题 是针对ajax的一种限制</strong>。</p>
<p>但是这却<strong>给我们的开发带来了不便</strong>，而且<strong>在实际生成环境中，肯定会有很多台服务器之间交互，地址和端口都可能不同</strong>，怎么办？</p>
<p>注意：<strong>跨域请求只是浏览器对响应结果的一种限制（为了阻止跨域攻击），服务器还是能被正常访问并返回资源的，只是浏览器不允许我们将跨域资源进行显示而已</strong>！！！</p>
<h3 id="4-1-3-解决跨域问题的方案"><a href="#4-1-3-解决跨域问题的方案" class="headerlink" title="4.1.3.解决跨域问题的方案"></a>4.1.3.解决跨域问题的方案</h3><p>浏览器虽然会限制跨域请求，但是也给出了解决方案。<strong>如果你确实需要发送跨域的ajax，必须通过被访问的服务端同意才可以</strong>。浏览器与服务器间<strong>协商是否允许跨域，这样的方式就是CORS</strong>。</p>
<p>参考文档：<a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2016/04/cors.html">https://www.ruanyifeng.com/blog/2016/04/cors.html</a></p>
<h2 id="4-2-CORS介绍"><a href="#4-2-CORS介绍" class="headerlink" title="4.2.CORS介绍"></a>4.2.CORS介绍</h2><p>CORS是一个W3C标准，全称是”跨域资源共享”（Cross-origin resource sharing）。</p>
<p>它允许浏览器向跨源服务器，发出<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2012/09/xmlhttprequest_level_2.html"><code>XMLHttpRequest</code></a>请求，从而克服了AJAX只能<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html">同源</a>使用的限制。</p>
<p>CORS需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE浏览器不能低于IE10。</p>
<ul>
<li><p><strong>浏览器端：</strong></p>
<p>目前，所有浏览器都支持该功能（IE10以下不行）。整个CORS通信过程，都是浏览器自动完成，不需要用户参与。浏览器会在发出ajax时询问服务端是否允许当前网站的跨域请求，并根据服务端响应做出拦截或放行的处理。</p>
</li>
<li><p><strong>服务端：</strong></p>
<p>CORS通信与AJAX没有任何差别，因此你不需要改变以前的业务逻辑。只不过，浏览器会在请求中携带一些头信息，表明请求者的身份。服务端接收到以后，需要对这些信息做出判断，如果允许则需要在返回的头信息中携带一些许可的声明。</p>
</li>
</ul>
<p>总结：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">要想进行跨域请求，</span></span><br><span class="line"><span class="attr">浏览器需要发送跨域请求（浏览器自动完成，在请求头添加信息，标明请求身份），</span></span><br><span class="line"><span class="attr">服务器根据这个身份，在作出响应时标明该资源是否能进行跨域请求</span></span><br><span class="line">	<span class="meta">（在响应头添加：Access-Control-Allow-Origin</span>: <span class="string">http://manage.leyou.com),</span></span><br><span class="line"><span class="attr">浏览器根据响应头的Access-Control-Allow-Origin字段信息，决定是否展示资源！</span></span><br></pre></td></tr></table></figure>

<p>注意：<strong>跨域请求只是浏览器对响应结果的一种限制（为了阻止跨域攻击），服务器还是能被正常访问并返回资源的，只是浏览器不允许我们将跨域资源进行显示而已</strong>！！！</p>
<h2 id="4-3-SpringCloudGateway的CORS"><a href="#4-3-SpringCloudGateway的CORS" class="headerlink" title="4.3.SpringCloudGateway的CORS"></a>4.3.SpringCloudGateway的CORS</h2><p>在SpringCloudGateway中，已经提供了默认的CORS实现，我们只需要通过application.yml做简单配置即可。我们在<code>ly-gateway</code>中的<code>application.yml</code>中添加一些配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="comment"># 。。。</span></span><br><span class="line">      <span class="attr">globalcors:</span> <span class="comment"># 全局的跨域处理</span></span><br><span class="line">        <span class="attr">add-to-simple-url-handler-mapping:</span> <span class="literal">true</span> <span class="comment"># 是否将当前cors配置加入到SimpleUrlHandlerMapping中，解决options请求被拦截问题</span></span><br><span class="line">        <span class="attr">corsConfigurations:</span></span><br><span class="line">          <span class="string">&#x27;[/**]&#x27;</span><span class="string">:</span></span><br><span class="line">            <span class="attr">allowedOrigins:</span> <span class="comment"># 允许哪些网站的跨域请求</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;http://manage.leyou.com&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;http://www.leyou.com&quot;</span></span><br><span class="line">            <span class="attr">allowedMethods:</span> <span class="comment"># 允许的跨域ajax的请求方式</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;GET&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;POST&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;DELETE&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;PUT&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;OPTIONS&quot;</span></span><br><span class="line">            <span class="attr">allowedHeaders:</span> <span class="string">&quot;*&quot;</span> <span class="comment"># 允许在请求中携带的头信息</span></span><br><span class="line">            <span class="attr">allowCredentials:</span> <span class="literal">true</span> <span class="comment"># 是否允许携带cookie</span></span><br><span class="line">            <span class="attr">maxAge:</span> <span class="number">360000</span> <span class="comment"># 这次跨域检测的有效期</span></span><br></pre></td></tr></table></figure>

<p>完整配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10010</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://ly-registry:10086/eureka</span></span><br><span class="line"><span class="attr">hystrix:</span></span><br><span class="line">  <span class="attr">command:</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line">      <span class="attr">execution.isolation.thread.timeoutInMilliseconds:</span> <span class="number">6000</span> <span class="comment"># 熔断超时时长：6000ms</span></span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">ConnectTimeout:</span> <span class="number">500</span> <span class="comment"># ribbon链接超时时长</span></span><br><span class="line">  <span class="attr">ReadTimeout:</span> <span class="number">2000</span> <span class="comment"># ribbon读取超时时长</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">ly-gateway</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">ly-redis</span> <span class="comment"># redis地址</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span> <span class="comment"># redis端口</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">default-filters:</span> <span class="comment"># 默认过滤项</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">StripPrefix=1</span> <span class="comment"># 去除路由前缀</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Hystrix</span> <span class="comment"># 指定过滤工厂名称（可以是任意过滤工厂类型）</span></span><br><span class="line">        <span class="attr">args:</span> <span class="comment"># 指定过滤的参数</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">fallbackcmd</span>  <span class="comment"># hystrix的指令名</span></span><br><span class="line">          <span class="attr">fallbackUri:</span> <span class="string">forward:/hystrix/fallback</span> <span class="comment"># 失败后的跳转路径</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">RequestRateLimiter</span> <span class="comment">#请求数限流 名字不能随便写</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">          <span class="attr">key-resolver:</span> <span class="string">&quot;#&#123;@ipKeyResolver&#125;&quot;</span> <span class="comment"># 通过spEL表达式指定一个key生成器，#&#123;&#125;是spEL，@代表spring中的Bean</span></span><br><span class="line">          <span class="attr">redis-rate-limiter.replenishRate:</span> <span class="number">2</span> <span class="comment"># 生成令牌的速率</span></span><br><span class="line">          <span class="attr">redis-rate-limiter.burstCapacity:</span> <span class="number">2</span> <span class="comment"># 桶的容量</span></span><br><span class="line">      <span class="attr">globalcors:</span> <span class="comment"># 全局的跨域处理</span></span><br><span class="line">        <span class="attr">add-to-simple-url-handler-mapping:</span> <span class="literal">true</span> <span class="comment"># 是否将当前cors配置加入到SimpleUrlHandlerMapping中，解决options请求被拦截问题</span></span><br><span class="line">        <span class="attr">corsConfigurations:</span></span><br><span class="line">          <span class="string">&#x27;[/**]&#x27;</span><span class="string">:</span> <span class="comment"># /** 代表拦截一切请求路径，都需要做CORS判断</span></span><br><span class="line">            <span class="attr">allowedOrigins:</span> <span class="comment"># 允许哪些网站的跨域请求</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;http://manage.leyou.com&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;http://www.leyou.com&quot;</span></span><br><span class="line">            <span class="attr">allowedMethods:</span> <span class="comment"># 允许的跨域ajax的请求方式</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;GET&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;POST&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;DELETE&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;PUT&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;OPTIONS&quot;</span></span><br><span class="line">            <span class="attr">allowedHeaders:</span> <span class="string">&quot;*&quot;</span> <span class="comment"># 允许在请求中携带的头信息</span></span><br><span class="line">            <span class="attr">allowCredentials:</span> <span class="literal">true</span> <span class="comment"># 是否允许携带cookie</span></span><br><span class="line">            <span class="attr">maxAge:</span> <span class="number">360000</span> <span class="comment"># 这次跨域检测的有效期</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">item-service</span> <span class="comment"># 商品微服务</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">lb://item-service</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/item/**</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.leyou:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>



<h2 id="4-4-再次测试"><a href="#4-4-再次测试" class="headerlink" title="4.4.再次测试"></a>4.4.再次测试</h2><p>重启网关，然后再次访问页面：</p>
<p><img src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20200711001156810.png" alt="image-20200711001156810"></p>
<h2 id="访问过程总结："><a href="#访问过程总结：" class="headerlink" title="访问过程总结："></a>访问过程总结：</h2><p>本来在浏览器中访问后台管理页面，访问的是http:manage.leyou.com/item/category/，紧接着点击某个分类，进行跨域请求（向后端微服务请求资源然后展示到浏览器中）；</p>
<p>其中跨域请求的<strong>url：http:api.leyou.com/item/category/of/parent?pid=0 然后回车，到浏览器中显示资源，中间经历了什么？？？？</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1</span> <span class="string">访问api.leyou.com域名，得到ip以及host信息（host信息为api.leyou.com），浏览器请求的端口默认为80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2</span> <span class="string">根据ip+端口，找到了目标机器的对应端口的服务。</span></span><br><span class="line"><span class="attr">3</span> <span class="string">由于目标机器配置的nginx监听的就是80端口，（nginx服务端口），于是接下来就是nginx的反向代理。</span></span><br><span class="line"><span class="attr">4</span> <span class="string">如何进行反向代理呢？？？根据host名称哈。由前面可知，host为api.leyou.com，结合nginx配置文件，</span></span><br><span class="line">	<span class="meta">要反向代理到：http</span>:<span class="string">//127.0.0.1:10010，这是网关地址+ip</span></span><br><span class="line"><span class="attr">5</span> <span class="string">此时达到网关时，访问的完整url为：http://127.0.0.1:10010/item/category/of/parent?pid=0</span></span><br><span class="line">	<span class="meta">这时候就要根据网关路由策略进行路由了，在网关服务的配置文件中可以知道</span> <span class="string">路由策略：/item/* </span></span><br><span class="line">	<span class="attr">其对应的服务uri为item-service；网关根据注册中心拉取下来的微服务信息，</span></span><br><span class="line">	<span class="attr">寻找item-service微服务的ip地址+端口</span></span><br><span class="line">	<span class="attr">注意1，网关并不是去注册中心找微服务的ip+端口的,</span></span><br><span class="line">		<span class="attr">网关去注册中心拉取服务以及对应的ip端口是周期性拉取的，</span></span><br><span class="line">		<span class="attr">网关首先在本地注册中查找微服务uri对应的ip端口信息，找不到就超时咯</span></span><br><span class="line">	<span class="attr">注意2，nginx除了反向代理，还可以负载均衡哦，这里没用到而已！</span></span><br><span class="line"><span class="attr">6</span> <span class="string">找到微服务的ip+端口，那么就可以进行最终url拼接了：http:微服务ip+微服务端口/category/of/parent?pid=0</span></span><br><span class="line">	<span class="attr">注意，/item路由前缀要去掉哈！</span></span><br></pre></td></tr></table></figure>

<p>nginx与网关的区别：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">相同点：</span></span><br><span class="line">	<span class="attr">网关跟nginx都可以做负载均衡，在springboot中，可以将网关配置为“利用ribbon进行负载均衡）</span></span><br><span class="line"><span class="attr">不同点：</span></span><br><span class="line">	<span class="attr">网关做了集群，那么网关前面一定要有相关服务（如，nginx，网关）来给网关集群进行负载均衡，</span></span><br><span class="line">	<span class="attr">而nginx做了集群也需要负载均衡，但是nginx内部已经有了负载均衡了，共同虚拟主机给集群中的nginx做负载均衡。</span></span><br></pre></td></tr></table></figure>





</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">高明辉</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/06/17/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/">http://example.com/2022/06/17/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Jason</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/">乐优商城项目</a></div><div class="post_share"><div class="social-share" data-image="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/%E5%B0%81%E9%9D%A2.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="添加微信"/></a><div class="post-qr-code-desc">添加微信</div></li><li class="reward-item"><a href="/img/pay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/pay.jpg" alt="付款码"/></a><div class="post-qr-code-desc">付款码</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/06/18/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-%E5%93%81%E7%89%8C%E7%AE%A1%E7%90%86/"><img class="prev-cover" src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/3%E5%93%81%E7%89%8C%E7%AE%A1%E7%90%86/%E5%B0%81%E9%9D%A2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">乐优商城项目-品牌管理</div></div></a></div><div class="next-post pull-right"><a href="/2022/06/15/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/"><img class="next-cover" src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/1%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/%E5%B0%81%E9%9D%A2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">乐优商城项目-项目搭建</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/06/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-ElesticSear%E6%95%B0%E6%8D%AE%E6%90%9C%E7%B4%A2%E4%BB%A5%E5%8F%8Aes%E4%B8%8Emysql%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/" title="乐优商城项目-ElesticSear数据搜索以及es与mysql数据同步"><img class="cover" src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/8%E6%90%9C%E7%B4%A2%E8%BF%87%E6%BB%A4%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/%E5%B0%81%E9%9D%A2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-26</div><div class="title">乐优商城项目-ElesticSear数据搜索以及es与mysql数据同步</div></div></a></div><div><a href="/2022/06/18/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-%E5%93%81%E7%89%8C%E7%AE%A1%E7%90%86/" title="乐优商城项目-品牌管理"><img class="cover" src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/3%E5%93%81%E7%89%8C%E7%AE%A1%E7%90%86/%E5%B0%81%E9%9D%A2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-18</div><div class="title">乐优商城项目-品牌管理</div></div></a></div><div><a href="/2022/06/20/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-%E5%95%86%E5%93%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1/" title="乐优商城项目-商品数据结构设计"><img class="cover" src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/4%E5%95%86%E5%93%81%E8%AE%BE%E8%AE%A1/%E5%B0%81%E9%9D%A2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-20</div><div class="title">乐优商城项目-商品数据结构设计</div></div></a></div><div><a href="/2022/06/15/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/" title="乐优商城项目-项目搭建"><img class="cover" src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/1%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/%E5%B0%81%E9%9D%A2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-15</div><div class="title">乐优商城项目-项目搭建</div></div></a></div><div><a href="/2022/06/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE-ElesticSearch%E5%AE%9E%E7%8E%B0%E5%9F%BA%E6%9C%AC%E6%90%9C%E7%B4%A2/" title="乐优商城项目-ElesticSearch实现基本搜索"><img class="cover" src="/img/java/06%E9%98%B6%E6%AE%B5%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/7Elasticsearch%E5%AE%9E%E7%8E%B0%E5%9F%BA%E6%9C%AC%E6%90%9C%E7%B4%A2/%E5%B0%81%E9%9D%A2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-26</div><div class="title">乐优商城项目-ElesticSearch实现基本搜索</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">分类管理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0-%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87"><span class="toc-number">2.</span> <span class="toc-text">0.学习目标</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE"><span class="toc-number">3.</span> <span class="toc-text">1.域名访问</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90"><span class="toc-number">3.1.</span> <span class="toc-text">1.1.域名解析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">3.2.</span> <span class="toc-text">1.2.反向代理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-%E8%AE%A4%E8%AF%86Nginx"><span class="toc-number">3.2.1.</span> <span class="toc-text">1.2.1.认识Nginx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%8E%9F%E7%90%86"><span class="toc-number">3.2.2.</span> <span class="toc-text">1.2.2.反向代理原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E5%AE%89%E8%A3%85Nginx"><span class="toc-number">3.3.</span> <span class="toc-text">1.3.安装Nginx</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%89%BE%E5%88%B080%E7%AB%AF%E5%8F%A3%E8%A2%AB%E5%8D%A0%E7%94%A8%E7%9A%84%E8%BF%9B%E7%A8%8B%E7%9A%84pid%EF%BC%8C%E7%94%B1%E5%9B%BE%E5%8F%AF%E7%9F%A5%E5%AF%B9%E5%BA%94pid%E4%B8%BA-65205"><span class="toc-number">3.3.0.0.1.</span> <span class="toc-text">1 找到80端口被占用的进程的pid，由图可知对应pid为 65205</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%9D%80%E6%AD%BB%E8%BF%9B%E7%A8%8B"><span class="toc-number">3.3.0.0.2.</span> <span class="toc-text">2 杀死进程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#nginx%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3%EF%BC%9A"><span class="toc-number">3.3.0.0.3.</span> <span class="toc-text">nginx中文乱码问题的解决：</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E9%85%8D%E7%BD%AEnginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">3.4.</span> <span class="toc-text">1.4.配置nginx反向代理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E5%AF%BC%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE"><span class="toc-number">3.4.1.</span> <span class="toc-text">1）导入自定义配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E9%85%8D%E7%BD%AE%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">3.4.2.</span> <span class="toc-text">2）配置反向代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89%E6%B5%8B%E8%AF%95"><span class="toc-number">3.4.3.</span> <span class="toc-text">3）测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%89"><span class="toc-number">3.5.</span> <span class="toc-text">1.5.负载均衡（了解）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E8%BD%AE%E8%AF%A2%E7%AD%96%E7%95%A5"><span class="toc-number">3.5.1.</span> <span class="toc-text">1）负载均衡轮询策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E5%8A%A0%E6%9D%83%E8%BD%AE%E8%AF%A2"><span class="toc-number">3.5.2.</span> <span class="toc-text">2）加权轮询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89IP%E5%93%88%E5%B8%8C"><span class="toc-number">3.5.3.</span> <span class="toc-text">3）IP哈希</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%89%E6%9C%80%E5%B0%91%E8%BF%9E%E6%8E%A5"><span class="toc-number">3.5.4.</span> <span class="toc-text">4）最少连接</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-MybatisPlus"><span class="toc-number">4.</span> <span class="toc-text">2.MybatisPlus</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.1.</span> <span class="toc-text">2.1.介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">4.2.</span> <span class="toc-text">2.2.快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE"><span class="toc-number">4.2.1.</span> <span class="toc-text">2.2.1.准备数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E5%87%86%E5%A4%87Demo%E5%B7%A5%E7%A8%8B"><span class="toc-number">4.2.2.</span> <span class="toc-text">2.2.2.准备Demo工程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">4.2.3.</span> <span class="toc-text">2.2.3.引入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-4-%E9%85%8D%E7%BD%AE"><span class="toc-number">4.2.4.</span> <span class="toc-text">2.2.4.配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-5-%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">4.2.5.</span> <span class="toc-text">2.2.5.实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-6-mapper%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.2.6.</span> <span class="toc-text">2.2.6.mapper接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-7-%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="toc-number">4.2.7.</span> <span class="toc-text">2.2.7.启动类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-8-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">4.2.8.</span> <span class="toc-text">2.2.8.单元测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E4%B8%80%E4%BA%9B%E6%B3%A8%E8%A7%A3"><span class="toc-number">4.3.</span> <span class="toc-text">2.3.一些注解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-TableName"><span class="toc-number">4.3.1.</span> <span class="toc-text">2.3.1.@TableName</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-TableId"><span class="toc-number">4.3.2.</span> <span class="toc-text">2.3.2.@TableId</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-TableField"><span class="toc-number">4.3.3.</span> <span class="toc-text">2.3.3.@TableField</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E5%B8%B8%E8%A7%81%E9%85%8D%E7%BD%AE"><span class="toc-number">4.4.</span> <span class="toc-text">2.4.常见配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-BaseMapper%E7%9A%84CRUD"><span class="toc-number">4.5.</span> <span class="toc-text">2.5.BaseMapper的CRUD</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-1-%E6%96%B0%E5%A2%9E"><span class="toc-number">4.5.1.</span> <span class="toc-text">2.5.1.新增</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="toc-number">4.5.1.1.</span> <span class="toc-text">方法：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="toc-number">4.5.1.2.</span> <span class="toc-text">参数说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A"><span class="toc-number">4.5.1.3.</span> <span class="toc-text">示例：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-2-%E5%88%A0%E9%99%A4"><span class="toc-number">4.5.2.</span> <span class="toc-text">2.5.2.删除</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%EF%BC%9A-1"><span class="toc-number">4.5.2.1.</span> <span class="toc-text">方法：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-1"><span class="toc-number">4.5.2.2.</span> <span class="toc-text">参数说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">4.5.2.3.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-3-%E4%BF%AE%E6%94%B9"><span class="toc-number">4.5.3.</span> <span class="toc-text">2.5.3.修改</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%EF%BC%9A-2"><span class="toc-number">4.5.3.1.</span> <span class="toc-text">方法：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%EF%BC%9A"><span class="toc-number">4.5.3.2.</span> <span class="toc-text">参数：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A-1"><span class="toc-number">4.5.3.3.</span> <span class="toc-text">示例：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-4-%E6%9F%A5%E8%AF%A2%E5%8D%95%E4%B8%AA"><span class="toc-number">4.5.4.</span> <span class="toc-text">2.5.4.查询单个</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%88%97%E8%A1%A8"><span class="toc-number">4.5.4.1.</span> <span class="toc-text">方法列表:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-2"><span class="toc-number">4.5.4.2.</span> <span class="toc-text">参数说明:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A-2"><span class="toc-number">4.5.4.3.</span> <span class="toc-text">示例：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-5-%E6%9F%A5%E8%AF%A2%E9%9B%86%E5%90%88%EF%BC%9A"><span class="toc-number">4.5.5.</span> <span class="toc-text">2.5.5.查询集合：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%88%97%E8%A1%A8%EF%BC%9A"><span class="toc-number">4.5.5.1.</span> <span class="toc-text">方法列表：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A-3"><span class="toc-number">4.5.5.2.</span> <span class="toc-text">示例：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-6-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.5.6.</span> <span class="toc-text">2.5.6.分页查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E5%BC%95%E5%85%A5%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6"><span class="toc-number">4.5.6.1.</span> <span class="toc-text">1）引入分页插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E6%B5%8B%E8%AF%95%E5%88%86%E9%A1%B5"><span class="toc-number">4.5.6.2.</span> <span class="toc-text">2）测试分页</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-IService%E7%9A%84CRUD"><span class="toc-number">4.6.</span> <span class="toc-text">2.6.IService的CRUD</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-1-%E6%96%B0%E5%A2%9E"><span class="toc-number">4.6.1.</span> <span class="toc-text">2.6.1.新增</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-3"><span class="toc-number">4.6.1.1.</span> <span class="toc-text">参数说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-2-SaveOrUpdate"><span class="toc-number">4.6.2.</span> <span class="toc-text">2.6.2.SaveOrUpdate</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-4"><span class="toc-number">4.6.2.1.</span> <span class="toc-text">参数说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-3-%E5%88%A0%E9%99%A4"><span class="toc-number">4.6.3.</span> <span class="toc-text">2.6.3.删除</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-5"><span class="toc-number">4.6.3.1.</span> <span class="toc-text">参数说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-4-%E4%BF%AE%E6%94%B9"><span class="toc-number">4.6.4.</span> <span class="toc-text">2.6.4.修改</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-6"><span class="toc-number">4.6.4.1.</span> <span class="toc-text">参数说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-5-%E6%9F%A5%E8%AF%A2%E5%8D%95%E4%B8%AA"><span class="toc-number">4.6.5.</span> <span class="toc-text">2.6.5.查询单个</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-7"><span class="toc-number">4.6.5.1.</span> <span class="toc-text">参数说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-6-%E6%9F%A5%E8%AF%A2%E5%A4%9A%E4%B8%AA"><span class="toc-number">4.6.6.</span> <span class="toc-text">2.6.6.查询多个</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-8"><span class="toc-number">4.6.6.0.1.</span> <span class="toc-text">参数说明</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-7-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.6.7.</span> <span class="toc-text">2.6.7.分页查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-9"><span class="toc-number">4.6.7.0.1.</span> <span class="toc-text">参数说明</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-8-%E6%9F%A5%E8%AF%A2%E6%95%B0%E9%87%8F"><span class="toc-number">4.6.8.</span> <span class="toc-text">2.6.8.查询数量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-10"><span class="toc-number">4.6.8.1.</span> <span class="toc-text">参数说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-9-%E9%93%BE%E5%BC%8F%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.6.9.</span> <span class="toc-text">2.6.9.链式查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-7-ServiceImpl"><span class="toc-number">4.7.</span> <span class="toc-text">2.7.ServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">3.分类管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">5.1.</span> <span class="toc-text">3.1.导入数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E5%BC%95%E5%85%A5mybatis-plus"><span class="toc-number">5.2.</span> <span class="toc-text">3.2.引入mybatis-plus</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E4%BE%9D%E8%B5%96"><span class="toc-number">5.2.1.</span> <span class="toc-text">1）依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE"><span class="toc-number">5.2.2.</span> <span class="toc-text">2）全局配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89%E5%90%AF%E5%8A%A8%E7%B1%BB%E7%9A%84%E6%B3%A8%E8%A7%A3"><span class="toc-number">5.2.3.</span> <span class="toc-text">3）启动类的注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%89%E5%BC%80%E5%90%AF%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6"><span class="toc-number">5.2.4.</span> <span class="toc-text">4）开启分页插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%89%E4%BF%AE%E6%94%B9%E6%97%A5%E5%BF%97advice%E7%9A%84%E5%88%87%E5%85%A5%E7%82%B9%E8%AF%AD%E6%B3%95"><span class="toc-number">5.2.5.</span> <span class="toc-text">5）修改日志advice的切入点语法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E5%9F%BA%E6%9C%AC%E4%BB%A3%E7%A0%81"><span class="toc-number">5.3.</span> <span class="toc-text">3.3.基本代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">5.3.1.</span> <span class="toc-text">3.3.1.实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-mapper"><span class="toc-number">5.3.2.</span> <span class="toc-text">3.3.2.mapper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-3-service"><span class="toc-number">5.3.3.</span> <span class="toc-text">3.3.3.service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-3-controller"><span class="toc-number">5.3.4.</span> <span class="toc-text">3.3.3.controller</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3"><span class="toc-number">5.4.</span> <span class="toc-text">3.4.接口文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-%E6%A0%B9%E6%8D%AEid%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB"><span class="toc-number">5.5.</span> <span class="toc-text">3.5.根据id查询分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-1-%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83"><span class="toc-number">5.5.1.</span> <span class="toc-text">3.5.1.接口规范</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="toc-number">5.5.1.1.</span> <span class="toc-text">1）基本信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E6%8E%A5%E5%8F%A3%E6%8F%8F%E8%BF%B0"><span class="toc-number">5.5.1.2.</span> <span class="toc-text">2）接口描述</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-2-DTO%E5%AF%B9%E8%B1%A1"><span class="toc-number">5.5.2.</span> <span class="toc-text">3.5.2.DTO对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-3-controller"><span class="toc-number">5.5.3.</span> <span class="toc-text">3.5.3.controller</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-%E6%A0%B9%E6%8D%AEid%E9%9B%86%E5%90%88%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB"><span class="toc-number">5.6.</span> <span class="toc-text">3.6.根据id集合查询分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7-%E6%A0%B9%E6%8D%AE%E7%88%B6%E7%B1%BB%E7%9B%AEid%E6%9F%A5%E8%AF%A2%E5%AD%90%E5%88%86%E7%B1%BB"><span class="toc-number">5.7.</span> <span class="toc-text">3.7.根据父类目id查询子分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-8-%E6%A0%B9%E6%8D%AE%E5%93%81%E7%89%8Cid%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB"><span class="toc-number">5.8.</span> <span class="toc-text">3.8.根据品牌id查询分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-1-%E4%B8%9A%E5%8A%A1%E5%88%86%E6%9E%90"><span class="toc-number">5.8.1.</span> <span class="toc-text">3.8.1.业务分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-2-%E4%B8%AD%E9%97%B4%E8%A1%A8%E4%BB%A3%E7%A0%81"><span class="toc-number">5.8.2.</span> <span class="toc-text">3.8.2.中间表代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">5.8.2.1.</span> <span class="toc-text">实体类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mapper"><span class="toc-number">5.8.2.2.</span> <span class="toc-text">mapper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#service"><span class="toc-number">5.8.2.3.</span> <span class="toc-text">service</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-3-%E6%8E%A5%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">5.8.3.</span> <span class="toc-text">3.8.3.接口声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-4-%E4%B8%9A%E5%8A%A1%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.8.4.</span> <span class="toc-text">3.8.4.业务实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-9-%E6%B5%8B%E8%AF%95"><span class="toc-number">5.9.</span> <span class="toc-text">3.9.测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-9-1-%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95"><span class="toc-number">5.9.1.</span> <span class="toc-text">3.9.1.接口测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-9-2-%E9%A1%B5%E9%9D%A2%E6%B5%8B%E8%AF%95"><span class="toc-number">5.9.2.</span> <span class="toc-text">3.9.2.页面测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-CORS%E8%B7%A8%E5%9F%9F"><span class="toc-number">6.</span> <span class="toc-text">4.CORS跨域</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="toc-number">6.1.</span> <span class="toc-text">4.1.跨域问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E4%BB%80%E4%B9%88%E6%98%AF%E8%B7%A8%E5%9F%9F"><span class="toc-number">6.1.1.</span> <span class="toc-text">4.1.1.什么是跨域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%89%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-number">6.1.2.</span> <span class="toc-text">4.1.2.为什么有跨域问题？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-3-%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%E7%9A%84%E6%96%B9%E6%A1%88"><span class="toc-number">6.1.3.</span> <span class="toc-text">4.1.3.解决跨域问题的方案</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-CORS%E4%BB%8B%E7%BB%8D"><span class="toc-number">6.2.</span> <span class="toc-text">4.2.CORS介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-SpringCloudGateway%E7%9A%84CORS"><span class="toc-number">6.3.</span> <span class="toc-text">4.3.SpringCloudGateway的CORS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E5%86%8D%E6%AC%A1%E6%B5%8B%E8%AF%95"><span class="toc-number">6.4.</span> <span class="toc-text">4.4.再次测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E8%BF%87%E7%A8%8B%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-number">6.5.</span> <span class="toc-text">访问过程总结：</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 高明辉</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'Aaee0Vekhg5KbLhMOJQrEU6A-gzGzoHsz',
      appKey: 'mmLHPEEtqvOSJhsqWra8Sq6K',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script type="text/javascript" src="/js/fairyDustCursor.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>